==================================================================
        韬睿量化 Cursor 扩展 MCP 集成规划
==================================================================

一、9步工作流 MCP 工具映射
-------------------------------------------------------------------

步骤 | 名称      | MCP Server        | 工具名称                  | 描述
-----|-----------|-------------------|---------------------------|------------------
1    | 信息获取   | data-source-server| data_source.check         | 数据源健康检查
     |           |                   | data_source.switch        | 切换数据源
2    | 市场趋势   | market-server     | market.status             | 市场状态分析
     |           |                   | market.trend              | 趋势识别
3    | 投资主线   | market-server     | market.mainlines          | 获取投资主线
     |           |                   | market.score_mainline     | 主线评分
4    | 候选池构建 | data-source-server| data_source.candidate_pool| 构建候选池
5    | 因子构建   | factor-server     | factor.recommend          | 因子推荐
     |           |                   | factor.build              | 构建因子
6    | 策略生成   | strategy-server   | strategy_template.list    | 策略模板列表
     |           |                   | strategy_template.generate| 生成策略代码
     |           |                   | strategy.convert          | 平台转换
7    | 回测验证   | backtest-server   | backtest.fast             | 快速回测(<5s)
     |           |                   | backtest.standard         | 标准回测(<30s)
     |           |                   | backtest.bullettrade      | BulletTrade回测
8    | 策略优化   | optimizer-server  | optimizer.grid_search     | 参数网格搜索
     |           |                   | optimizer.optuna          | Optuna优化
9    | 报告生成   | report-server     | report.generate           | 生成报告
     |           |                   | report.compare            | 对比报告


二、扩展文件修改清单
-------------------------------------------------------------------

1. extension/src/services/mcpClientV2.ts (新建)
   - 完整的9步工作流MCP工具定义
   - 类型安全的调用接口
   - 响应解析和错误处理

2. extension/src/views/workflowPanel.ts (升级)
   - 6步骤 → 9步骤
   - 每步骤MCP调用集成
   - 进度和结果显示

3. extension/src/views/strategyGeneratorPanel.ts (新建)
   - 策略模板选择
   - 参数配置UI
   - 多平台代码生成
   - 代码预览和保存

4. extension/src/views/backtestPanel.ts (升级)
   - 三层回测支持
   - 结果可视化
   - 报告查看

5. extension/src/views/strategyOptimizerPanel.ts (升级)
   - 参数网格配置
   - 批量回测
   - 最优参数发现

6. extension/src/views/reportPanel.ts (升级)
   - 多格式报告
   - 报告管理
   - 在线预览


三、MCP调用方式
-------------------------------------------------------------------

方式1: Cursor AI 自动调用 (推荐)
  - 用户通过自然语言描述需求
  - Cursor AI 自动选择合适的MCP工具
  - 扩展提供工具描述和类型定义

方式2: 扩展直接调用
  - 通过 Python Bridge 调用
  - extension → TRQuantClient → Python subprocess → MCP Server

示例调用流程:
```typescript
// 1. 创建工作流
const result = await client.callMCP('workflow.create', { name: '我的工作流' });

// 2. 执行步骤
await client.callMCP('workflow.run_step', { 
  workflow_id: result.workflow_id, 
  step_index: 0 
});

// 3. 获取结果
const status = await client.callMCP('workflow.status', { 
  workflow_id: result.workflow_id 
});
```


四、实现优先级
-------------------------------------------------------------------

P0 (核心):
  - MCP工具类型定义
  - 工作流面板9步骤
  - 策略生成MCP集成

P1 (重要):
  - 回测面板MCP集成
  - 优化面板MCP集成

P2 (增强):
  - 报告面板完善
  - 批量操作支持


五、测试验证
-------------------------------------------------------------------

1. 单元测试: 每个MCP工具调用测试
2. 集成测试: 完整9步工作流执行
3. UI测试: 面板交互和显示


==================================================================
