# Gitå†å²æ¸…ç†å½±å“åˆ†æ

## ğŸ“‹ é—®é¢˜æ¦‚è¿°

Gitå†å²ä¸­åŒ…å«è¶…è¿‡100MBçš„å¤§æ–‡ä»¶ï¼Œå¯¼è‡´æ— æ³•æ¨é€åˆ°GitHubã€‚éœ€è¦æ¸…ç†è¿™äº›æ–‡ä»¶ã€‚

## ğŸ” å½±å“åˆ†æ

### âœ… ä¸ä¼šå½±å“çš„å†…å®¹

1. **å½“å‰å·¥ä½œç›®å½•çš„æ–‡ä»¶**
   - æ¸…ç†å†å²ä¸ä¼šåˆ é™¤ä½ å½“å‰å·¥ä½œç›®å½•ä¸­çš„ä»»ä½•æ–‡ä»¶
   - æ‰€æœ‰ç°æœ‰æ–‡ä»¶ä¿æŒä¸å˜

2. **æœ€è¿‘çš„æäº¤**
   - æœ€è¿‘çš„æäº¤ï¼ˆåŒ…æ‹¬ç¬¬å…­å†Œå¼€å‘ï¼‰ä¸ä¼šå—å½±å“
   - åªæ˜¯ä»å†å²è®°å½•ä¸­ç§»é™¤å¤§æ–‡ä»¶

3. **ä»£ç å’Œæ–‡æ¡£**
   - æ‰€æœ‰æºä»£ç ã€æ–‡æ¡£ã€é…ç½®æ–‡ä»¶éƒ½ä¸å—å½±å“
   - åªæ˜¯ç§»é™¤äº†ä¸åº”è¯¥åœ¨Gitä¸­çš„å¤§æ–‡ä»¶

### âš ï¸ å¯èƒ½çš„å½±å“

1. **Gitå†å²é‡å†™**
   - æ‰€æœ‰æäº¤çš„SHAä¼šæ”¹å˜
   - å¦‚æœå…¶ä»–äººå·²ç»å…‹éš†äº†ä»“åº“ï¼Œä»–ä»¬éœ€è¦é‡æ–°å…‹éš†

2. **å¤‡ä»½æ–‡ä»¶**
   - `.taorui/` ç›®å½•ï¼ˆçŸ¥è¯†åº“ç´¢å¼•ï¼‰ä¼šè¢«ç§»é™¤
   - `.vsix` æ–‡ä»¶ï¼ˆæ‰©å±•åŒ…ï¼‰ä¼šè¢«ç§»é™¤
   - è¿™äº›æ–‡ä»¶æœ¬æ¥å°±ä¸åº”è¯¥åœ¨Gitä¸­

3. **åä½œå½±å“**
   - å¦‚æœæœ‰å…¶ä»–äººåœ¨ä½¿ç”¨è¿™ä¸ªä»“åº“ï¼Œéœ€è¦é€šçŸ¥ä»–ä»¬
   - ä»–ä»¬éœ€è¦é‡æ–°å…‹éš†æˆ–å¼ºåˆ¶æ¨é€

## ğŸ¯ æ¸…ç†æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä½¿ç”¨ git filter-branchï¼ˆæ¨èï¼Œä½†è¾ƒæ…¢ï¼‰

```bash
# ç§»é™¤.taoruiç›®å½•
git filter-branch --force --index-filter \
  'git rm -rf --cached --ignore-unmatch .taorui' \
  --prune-empty --tag-name-filter cat -- --all

# ç§»é™¤.vsixæ–‡ä»¶
git filter-branch --force --index-filter \
  'git rm -rf --cached --ignore-unmatch "*.vsix" "extension/*.vsix"' \
  --prune-empty --tag-name-filter cat -- --all

# å¼ºåˆ¶åƒåœ¾å›æ”¶
git for-each-ref --format='delete %(refname)' refs/original | git update-ref --stdin
git reflog expire --expire=now --all
git gc --prune=now --aggressive
```

**ä¼˜ç‚¹**ï¼š
- ä¿ç•™æ‰€æœ‰æäº¤å†å²
- åªç§»é™¤å¤§æ–‡ä»¶

**ç¼ºç‚¹**ï¼š
- é€Ÿåº¦è¾ƒæ…¢ï¼ˆå¤§ä»“åº“å¯èƒ½éœ€è¦å‡ å°æ—¶ï¼‰
- æ‰€æœ‰æäº¤SHAä¼šæ”¹å˜

### æ–¹æ¡ˆ2ï¼šåˆ›å»ºæ–°åˆ†æ”¯ï¼ˆå¿«é€Ÿï¼Œä½†ä¸¢å¤±å†å²ï¼‰

```bash
# åˆ›å»ºæ–°åˆ†æ”¯ï¼ŒåªåŒ…å«å½“å‰çŠ¶æ€
git checkout --orphan new-main
git add .
git commit -m "feat: é‡æ–°å¼€å§‹ï¼Œç§»é™¤å¤§æ–‡ä»¶"
git branch -D main
git branch -m main
```

**ä¼˜ç‚¹**ï¼š
- é€Ÿåº¦å¿«
- å¹²å‡€çš„å†å²

**ç¼ºç‚¹**ï¼š
- ä¸¢å¤±æ‰€æœ‰æäº¤å†å²
- æ— æ³•è¿½æº¯ä¹‹å‰çš„æ›´æ”¹

### æ–¹æ¡ˆ3ï¼šä½¿ç”¨ git filter-repoï¼ˆæ¨èï¼Œæœ€å¿«ï¼‰

```bash
# å®‰è£…git-filter-repo
pip install git-filter-repo

# ç§»é™¤.taoruiç›®å½•
git filter-repo --path .taorui --invert-paths

# ç§»é™¤.vsixæ–‡ä»¶
git filter-repo --path-glob '*.vsix' --invert-paths
git filter-repo --path-glob 'extension/*.vsix' --invert-paths
```

**ä¼˜ç‚¹**ï¼š
- é€Ÿåº¦å¿«
- åŠŸèƒ½å¼ºå¤§
- æ¨èå·¥å…·

**ç¼ºç‚¹**ï¼š
- éœ€è¦å®‰è£…é¢å¤–å·¥å…·
- æ‰€æœ‰æäº¤SHAä¼šæ”¹å˜

## ğŸ›¡ï¸ å®‰å…¨æªæ–½

### æ¸…ç†å‰å¤‡ä»½

```bash
# 1. åˆ›å»ºå®Œæ•´å¤‡ä»½
cd /home/taotao/dev/QuantTest/TRQuant
# ä½¿ç”¨æˆ‘ä»¬çš„å¤‡ä»½æœåŠ¡å™¨
# è°ƒç”¨ backup_full å·¥å…·

# 2. å…‹éš†ä¸€ä»½åˆ°å®‰å…¨ä½ç½®
cd /mnt/data/backups
git clone /home/taotao/dev/QuantTest/TRQuant TRQuant-backup-$(date +%Y%m%d)

# 3. å¯¼å‡ºæ‰€æœ‰æäº¤
cd /home/taotao/dev/QuantTest/TRQuant
git bundle create /mnt/data/backups/TRQuant-full-history.bundle --all
```

### æ¸…ç†åéªŒè¯

```bash
# 1. æ£€æŸ¥ä»“åº“å¤§å°
du -sh .git

# 2. æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å¤§æ–‡ä»¶
git rev-list --objects --all | \
  git cat-file --batch-check='%(objecttype) %(objectname) %(objectsize) %(rest)' | \
  awk '/^blob/ {print substr($0,6)}' | \
  sort --numeric-sort --key=2 | \
  tail -10

# 3. æµ‹è¯•æ¨é€
git push origin main --dry-run
```

## ğŸ“Š é£é™©è¯„ä¼°

### ä½é£é™© âœ…
- å½“å‰å·¥ä½œç›®å½•æ–‡ä»¶
- æœ€è¿‘çš„æäº¤å†…å®¹
- ä»£ç å’Œæ–‡æ¡£

### ä¸­é£é™© âš ï¸
- Gitå†å²è®°å½•ï¼ˆæäº¤SHAä¼šæ”¹å˜ï¼‰
- å¦‚æœæœ‰å…¶ä»–äººåœ¨ä½¿ç”¨ä»“åº“

### é«˜é£é™© ğŸ”´
- å¦‚æœæ²¡æœ‰å¤‡ä»½å°±æ¸…ç†
- å¦‚æœå¼ºåˆ¶æ¨é€è¦†ç›–äº†è¿œç¨‹çš„é‡è¦å†…å®¹

## ğŸ’¡ æ¨èæ–¹æ¡ˆ

**å¯¹äºä½ çš„æƒ…å†µï¼Œæ¨èä½¿ç”¨æ–¹æ¡ˆ3ï¼ˆgit filter-repoï¼‰**ï¼š

1. **å…ˆåˆ›å»ºå®Œæ•´å¤‡ä»½**ï¼ˆä½¿ç”¨æˆ‘ä»¬çš„å¤‡ä»½æœåŠ¡å™¨ï¼‰
2. **ä½¿ç”¨git filter-repoæ¸…ç†å†å²**
3. **éªŒè¯æ¸…ç†ç»“æœ**
4. **æ¨é€åˆ°è¿œç¨‹**

## ğŸ”„ æ¸…ç†æ­¥éª¤ï¼ˆæ¨èæµç¨‹ï¼‰

```bash
# æ­¥éª¤1: åˆ›å»ºå¤‡ä»½
# ä½¿ç”¨MCPå·¥å…·: backup_full

# æ­¥éª¤2: å®‰è£…git-filter-repo
pip install git-filter-repo

# æ­¥éª¤3: æ¸…ç†.taoruiç›®å½•
git filter-repo --path .taorui --invert-paths --force

# æ­¥éª¤4: æ¸…ç†.vsixæ–‡ä»¶
git filter-repo --path-glob '*.vsix' --invert-paths --force
git filter-repo --path-glob 'extension/*.vsix' --invert-paths --force

# æ­¥éª¤5: éªŒè¯
du -sh .git
git log --oneline | head -5

# æ­¥éª¤6: å¼ºåˆ¶æ¨é€ï¼ˆéœ€è¦è¦†ç›–è¿œç¨‹ï¼‰
git push origin main --force
```

## âš ï¸ é‡è¦æé†’

1. **æ¸…ç†å‰å¿…é¡»å¤‡ä»½**
2. **å¦‚æœæœ‰å…¶ä»–äººåœ¨ä½¿ç”¨ä»“åº“ï¼Œéœ€è¦åè°ƒ**
3. **æ¸…ç†åæ‰€æœ‰æäº¤SHAä¼šæ”¹å˜**
4. **éœ€è¦å¼ºåˆ¶æ¨é€ï¼ˆ--forceï¼‰**

## ğŸ¯ ç»“è®º

**æ¸…ç†å†å²æ˜¯å®‰å…¨çš„ï¼Œå‰ææ˜¯ï¼š**
- âœ… å…ˆåˆ›å»ºå®Œæ•´å¤‡ä»½
- âœ… ç¡®è®¤æ²¡æœ‰å…¶ä»–äººåœ¨ä½¿ç”¨ä»“åº“
- âœ… ä½¿ç”¨æ­£ç¡®çš„å·¥å…·å’Œæ–¹æ³•
- âœ… æ¸…ç†åéªŒè¯ç»“æœ

**è¿™äº›å¤§æ–‡ä»¶æœ¬æ¥å°±ä¸åº”è¯¥åœ¨Gitä¸­**ï¼Œæ¸…ç†å®ƒä»¬æ˜¯æ­£ç¡®çš„åšæ³•ã€‚

