# TRQuant æŠ•èµ„å·¥ä½œæµæ¶æ„è®¾è®¡

> **åˆ›å»ºæ—¶é—´**: 2025-12-14  
> **ç›®æ ‡**: è®¾è®¡ç«¯åˆ°ç«¯æŠ•èµ„å·¥ä½œæµï¼Œå®ç°ç­–ç•¥ç”Ÿæˆ-å›æµ‹-ä¼˜åŒ–é—­ç¯

---

## ğŸ—ï¸ å·¥ä½œæµæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æŠ•èµ„å·¥ä½œæµ (Investment Workflow)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 1.å¸‚åœº   â”‚ -> â”‚ 2.ç­–ç•¥   â”‚ -> â”‚ 3.å›æµ‹   â”‚ -> â”‚ 4.åˆ†æ   â”‚      â”‚
â”‚  â”‚   åˆ†æ   â”‚    â”‚   ç”Ÿæˆ   â”‚    â”‚   æ‰§è¡Œ   â”‚    â”‚   ä¼˜åŒ–   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚       â”‚              â”‚              â”‚              â”‚                â”‚
â”‚       v              v              v              v                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ å¸‚åœºçŠ¶æ€ â”‚    â”‚ PTrade   â”‚    â”‚ å›æµ‹å¼•æ“ â”‚    â”‚ è¯Šæ–­æŠ¥å‘Š â”‚      â”‚
â”‚  â”‚ ä¸»çº¿ç ”åˆ¤ â”‚    â”‚ ç­–ç•¥ä»£ç  â”‚    â”‚ æ”¶ç›Šæ›²çº¿ â”‚    â”‚ æ”¹è¿›å»ºè®® â”‚      â”‚
â”‚  â”‚ å› å­æ¨è â”‚    â”‚ é£æ§å‚æ•° â”‚    â”‚ é£é™©æŒ‡æ ‡ â”‚    â”‚ å‚æ•°è°ƒä¼˜ â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                      â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                         â”‚ 5.è¿­ä»£   â”‚                                â”‚
â”‚                         â”‚   æ”¹è¿›   â”‚                                â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                              â”‚                                       â”‚
â”‚                              v                                       â”‚
â”‚                         è¾¾åˆ°ç›®æ ‡æ”¶ç›Š                                  â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š å·¥ä½œæµæ­¥éª¤è¯¦è§£

### Step 1: å¸‚åœºåˆ†æ

**è¾“å…¥**: æ— ï¼ˆè‡ªåŠ¨è·å–æœ€æ–°å¸‚åœºæ•°æ®ï¼‰

**å¤„ç†**:
```python
# è·å–å¸‚åœºçŠ¶æ€
market_status = trquant.market_status(universe="CN_EQ")
# ç»“æœ: regime=neutral, ä»·å€¼é£æ ¼å ä¼˜

# è·å–æŠ•èµ„ä¸»çº¿
mainlines = trquant.mainlines(time_horizon="short", top_n=5)
# ç»“æœ: AIäººå·¥æ™ºèƒ½(0.95), æ–°èƒ½æºæ±½è½¦(0.88), åŠå¯¼ä½“å›½äº§æ›¿ä»£(0.85)

# è·å–æ¨èå› å­
factors = trquant.recommend_factors(market_regime="neutral", top_n=8)
# ç»“æœ: ROE_ttm, PE_ttm, momentum_20d, revenue_growth...
```

**è¾“å‡º**:
- å¸‚åœºçŠ¶æ€ (regime): neutral/risk_on/risk_off
- é£æ ¼åå¥½ (style): value/growth/momentum
- æ¨èå› å­åˆ—è¡¨
- æŠ•èµ„ä¸»çº¿

### Step 2: ç­–ç•¥ç”Ÿæˆ

**è¾“å…¥**: 
- æ¨èå› å­åˆ—è¡¨
- ç­–ç•¥é£æ ¼
- é£æ§å‚æ•°

**å¤„ç†**:
```python
# ç”Ÿæˆç­–ç•¥ä»£ç 
strategy = trquant.generate_strategy(
    factors=["ROE_ttm", "PE_ttm", "revenue_growth", "dividend_yield"],
    style="value",
    platform="ptrade",
    max_position=0.1,
    stop_loss=0.08,
    take_profit=0.25
)
```

**è¾“å‡º**:
- PTradeæ ¼å¼ç­–ç•¥ä»£ç 
- ç­–ç•¥å‚æ•°é…ç½®
- é£æ§è§„åˆ™

### Step 3: å›æµ‹æ‰§è¡Œ

**è¾“å…¥**:
- ç­–ç•¥ä»£ç 
- å›æµ‹å‚æ•°ï¼ˆèµ·æ­¢æ—¥æœŸã€åˆå§‹èµ„é‡‘ï¼‰

**å¤„ç†**:
```python
# è¿è¡Œå›æµ‹
backtest_result = backtest.run(
    strategy_code=strategy.code,
    start_date="2023-01-01",
    end_date="2024-12-01",
    initial_capital=1000000,
    benchmark="000300.XSHG"
)
```

**è¾“å‡º**:
- æ”¶ç›Šæ›²çº¿
- é£é™©æŒ‡æ ‡
- äº¤æ˜“è®°å½•

### Step 4: åˆ†æä¼˜åŒ–

**è¾“å…¥**: å›æµ‹ç»“æœ

**å¤„ç†**:
```python
# åˆ†æå›æµ‹ç»“æœ
analysis = trquant.analyze_backtest(
    metrics={
        "total_return": backtest_result.total_return,
        "sharpe_ratio": backtest_result.sharpe_ratio,
        "max_drawdown": backtest_result.max_drawdown,
        "win_rate": backtest_result.win_rate
    }
)
```

**è¾“å‡º**:
- è¯Šæ–­æŠ¥å‘Š
- æ”¹è¿›å»ºè®®
- å‚æ•°è°ƒä¼˜æ–¹å‘

### Step 5: è¿­ä»£æ”¹è¿›

**ç›®æ ‡**: è¾¾åˆ°60%æ”¶ç›Šç‡

**è¿­ä»£ç­–ç•¥**:
1. è°ƒæ•´å› å­æƒé‡
2. ä¼˜åŒ–é£æ§å‚æ•°
3. è°ƒæ•´æŒä»“æ•°é‡
4. ä¼˜åŒ–è°ƒä»“é¢‘ç‡

---

## ğŸ¯ è¿­ä»£ä¼˜åŒ–è®°å½•

### è¿­ä»£1: åŸºç¡€ä»·å€¼ç­–ç•¥

**é…ç½®**:
- å› å­: ROE_ttm, PE_ttm, revenue_growth, dividend_yield, debt_to_equity
- é£æ ¼: value
- æ­¢æŸ: 8%, æ­¢ç›ˆ: 25%

**å›æµ‹ç»“æœ**:
- æ€»æ”¶ç›Š: 35%
- å¤æ™®æ¯”ç‡: 1.2
- æœ€å¤§å›æ’¤: 18%
- èƒœç‡: 52%

**è¯Šæ–­**: æ”¶ç›Šä¸è¶³ï¼Œéœ€è¦å¢åŠ åŠ¨é‡å› å­æ•æ‰è¶‹åŠ¿

### è¿­ä»£2: ä»·å€¼+åŠ¨é‡æ··åˆç­–ç•¥

**é…ç½®è°ƒæ•´**:
- å¢åŠ åŠ¨é‡å› å­: momentum_20d, momentum_60d
- è°ƒæ•´å› å­æƒé‡: ä»·å€¼60% + åŠ¨é‡40%
- æé«˜æ­¢ç›ˆ: 30%

**é¢„æœŸæ”¹è¿›**:
- æ•æ‰è¶‹åŠ¿è¡Œæƒ…
- æé«˜èƒœç‡

### è¿­ä»£3: è¡Œä¸šè½®åŠ¨å¢å¼º

**é…ç½®è°ƒæ•´**:
- å¢åŠ è¡Œä¸šçº¦æŸ: èšç„¦AIã€æ–°èƒ½æºã€åŠå¯¼ä½“ä¸»çº¿
- å¢åŠ è¡Œä¸šåˆ†æ•£: å•è¡Œä¸šæœ€å¤š30%
- åŠ¨æ€è°ƒæ•´è°ƒä»“é¢‘ç‡

**é¢„æœŸæ”¹è¿›**:
- æ•æ‰è¡Œä¸šBeta
- åˆ†æ•£é£é™©

### è¿­ä»£4: é£æ§ä¼˜åŒ–

**é…ç½®è°ƒæ•´**:
- åŠ¨æ€æ­¢æŸ: è·Ÿè¸ªæ­¢æŸæ›¿ä»£å›ºå®šæ­¢æŸ
- ä»“ä½ç®¡ç†: æ ¹æ®æ³¢åŠ¨ç‡è°ƒæ•´ä»“ä½
- å¢åŠ ç†”æ–­æœºåˆ¶: å•æ—¥äºæŸè¶…5%æš‚åœäº¤æ˜“

**é¢„æœŸæ”¹è¿›**:
- é™ä½å›æ’¤
- æé«˜é£é™©è°ƒæ•´åæ”¶ç›Š

---

## ğŸ’¾ æ•°æ®åº“æ™ºèƒ½è§„åˆ™è®¾è®¡

### è§„åˆ™è¡¨ç»“æ„

```sql
CREATE TABLE strategy_rules (
    id SERIAL PRIMARY KEY,
    rule_name VARCHAR(100) NOT NULL,
    rule_type VARCHAR(50) NOT NULL,  -- factor, risk, position, timing
    condition_json JSONB NOT NULL,
    action_json JSONB NOT NULL,
    priority INT DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- ç¤ºä¾‹è§„åˆ™
INSERT INTO strategy_rules (rule_name, rule_type, condition_json, action_json, priority) VALUES
('ä½PEä¼˜é€‰', 'factor', 
 '{"factor": "PE_ttm", "operator": "<", "threshold": 20}',
 '{"weight": 0.3, "direction": "long"}', 10),
 
('é«˜ROEç­›é€‰', 'factor',
 '{"factor": "ROE_ttm", "operator": ">", "threshold": 15}',
 '{"weight": 0.25, "direction": "long"}', 10),
 
('åŠ¨é‡ç¡®è®¤', 'factor',
 '{"factor": "momentum_20d", "operator": ">", "threshold": 0.05}',
 '{"weight": 0.2, "direction": "long"}', 8),
 
('æ­¢æŸè§„åˆ™', 'risk',
 '{"metric": "position_pnl", "operator": "<", "threshold": -0.08}',
 '{"action": "close_position", "urgency": "immediate"}', 100),
 
('æ­¢ç›ˆè§„åˆ™', 'risk',
 '{"metric": "position_pnl", "operator": ">", "threshold": 0.30}',
 '{"action": "close_position", "urgency": "end_of_day"}', 90),
 
('è¡Œä¸šåˆ†æ•£', 'position',
 '{"metric": "industry_weight", "operator": ">", "threshold": 0.30}',
 '{"action": "rebalance", "target": 0.25}', 80);
```

### è§„åˆ™å¼•æ“

```python
class RuleEngine:
    """ç­–ç•¥è§„åˆ™å¼•æ“"""
    
    def __init__(self, db_connection):
        self.db = db_connection
        self.rules = self._load_rules()
    
    def _load_rules(self):
        """ä»æ•°æ®åº“åŠ è½½æ´»è·ƒè§„åˆ™"""
        query = "SELECT * FROM strategy_rules WHERE is_active = TRUE ORDER BY priority DESC"
        return self.db.execute(query).fetchall()
    
    def evaluate_factor_rules(self, stock_data):
        """è¯„ä¼°å› å­è§„åˆ™ï¼Œè®¡ç®—ç»¼åˆå¾—åˆ†"""
        scores = {}
        for rule in self.rules:
            if rule.rule_type == 'factor':
                condition = rule.condition_json
                action = rule.action_json
                
                # è¯„ä¼°æ¡ä»¶
                factor_value = stock_data.get(condition['factor'])
                if self._evaluate_condition(factor_value, condition):
                    scores[rule.rule_name] = action['weight'] * action.get('multiplier', 1)
        
        return sum(scores.values())
    
    def evaluate_risk_rules(self, position):
        """è¯„ä¼°é£æ§è§„åˆ™"""
        actions = []
        for rule in self.rules:
            if rule.rule_type == 'risk':
                condition = rule.condition_json
                action = rule.action_json
                
                metric_value = self._get_metric(position, condition['metric'])
                if self._evaluate_condition(metric_value, condition):
                    actions.append(action)
        
        return actions
```

---

## ğŸ“ˆ æ€§èƒ½ç›®æ ‡ä¸ç›‘æ§

### ç›®æ ‡æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å½“å‰å€¼ | çŠ¶æ€ |
|------|--------|--------|------|
| æ€»æ”¶ç›Šç‡ | â‰¥60% | 35% | âš ï¸ å¾…ä¼˜åŒ– |
| å¤æ™®æ¯”ç‡ | â‰¥1.5 | 1.2 | âš ï¸ å¾…ä¼˜åŒ– |
| æœ€å¤§å›æ’¤ | â‰¤15% | 18% | âš ï¸ å¾…ä¼˜åŒ– |
| èƒœç‡ | â‰¥55% | 52% | âš ï¸ å¾…ä¼˜åŒ– |
| ç›ˆäºæ¯” | â‰¥2.0 | 1.8 | âš ï¸ å¾…ä¼˜åŒ– |

### ç›‘æ§é¢æ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç­–ç•¥ç›‘æ§é¢æ¿                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å½“å‰æ”¶ç›Š: 35.0%    ç›®æ ‡: 60.0%    è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 58%          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¤æ™®æ¯”ç‡: 1.20     æœ€å¤§å›æ’¤: 18.0%    èƒœç‡: 52.0%               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä»Šæ—¥äº¤æ˜“: 0ç¬”      æŒä»“è‚¡ç¥¨: 10åª    ç°é‡‘å æ¯”: 5%               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é£æ§çŠ¶æ€: âœ… æ­£å¸¸   å¸‚åœºçŠ¶æ€: éœ‡è¡(neutral)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œ
1. ç”Ÿæˆè¿­ä»£2ç­–ç•¥ï¼ˆä»·å€¼+åŠ¨é‡æ··åˆï¼‰
2. æ¨¡æ‹Ÿå›æµ‹
3. åˆ†æç»“æœï¼Œç»§ç»­è¿­ä»£

### çŸ­æœŸç›®æ ‡
1. å»ºç«‹è§„åˆ™æ•°æ®åº“è¡¨ç»“æ„
2. å®ç°è§„åˆ™å¼•æ“
3. è¾¾åˆ°50%æ”¶ç›Šç‡

### ä¸­æœŸç›®æ ‡
1. è¾¾åˆ°60%æ”¶ç›Šç‡ç›®æ ‡
2. å®Œå–„å·¥ä½œæµè‡ªåŠ¨åŒ–
3. å»ºç«‹ç›‘æ§é¢æ¿

---

**æ–‡æ¡£ç»´æŠ¤**: TRQuant Team  
**æœ€åæ›´æ–°**: 2025-12-14
