---
title: "10.9 MCP Ã— Cursor Ã— å·¥å…·é“¾è”ç”¨è§„èŒƒ"
description: "æ·±å…¥è§£æTRQuant MCPã€Cursorå’Œå·¥å…·é“¾çš„ååŒä½¿ç”¨æ–¹æ³•ï¼ŒåŒ…æ‹¬ç»Ÿä¸€å·¥ä½œæ¨¡å¼ã€æ¨¡å—å¼€å‘æµç¨‹ã€Cursoré…ç½®ã€å·¥ä½œæµè®¾è®¡ç­‰æ ¸å¿ƒæŠ€æœ¯ï¼Œä¸ºé«˜æ•ˆå¼€å‘æä¾›å®Œæ•´çš„å¼€å‘æŒ‡å¯¼"
lang: "zh-CN"
layout: "/src/layouts/HandbookLayout.astro"
currentBook: "ashare-book6"
updateDate: "2025-12-12"
---

# ğŸ”— 10.9 MCP Ã— Cursor Ã— å·¥å…·é“¾è”ç”¨è§„èŒƒ

> **æ ¸å¿ƒæ‘˜è¦ï¼š**
> 
> æœ¬èŠ‚ç³»ç»Ÿä»‹ç»TRQuant MCPã€Cursorå’Œå·¥å…·é“¾çš„ååŒä½¿ç”¨æ–¹æ³•ï¼ŒåŒ…æ‹¬ç»Ÿä¸€å·¥ä½œæ¨¡å¼ã€æ¨¡å—å¼€å‘æµç¨‹ã€Cursoré…ç½®ã€å·¥ä½œæµè®¾è®¡ç­‰æ ¸å¿ƒæŠ€æœ¯ã€‚é€šè¿‡ç†è§£å·¥å…·é“¾è”ç”¨è§„èŒƒï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡MCPã€Cursorå’Œå·¥å…·é“¾çš„ååŒä½¿ç”¨æ–¹æ³•ï¼Œå®ç°é«˜æ•ˆã€ç¨³å®šã€å¯ç»´æŠ¤çš„å¼€å‘æµç¨‹ã€‚

TRQuantç³»ç»Ÿé€šè¿‡MCPæœåŠ¡å™¨ã€Cursor IDEå’Œå·¥å…·é“¾çš„ååŒå·¥ä½œï¼Œå®ç°æ™ºèƒ½åŒ–çš„å¼€å‘è¾…åŠ©ã€‚æœ¬èŠ‚è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨è¿™äº›å·¥å…·è¿›è¡Œé«˜æ•ˆåä½œã€‚

## ğŸ“‹ ç« èŠ‚æ¦‚è§ˆ

<script>
function scrollToSection(sectionId) {
  const element = document.getElementById(sectionId);
  if (element) {
    const headerOffset = 100;
    const elementPosition = element.getBoundingClientRect().top;
    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
    window.scrollTo({
      top: offsetPosition,
      behavior: 'smooth'
    });
  }
}
</script>

<div class="section-overview">
  <div class="section-item" onclick="scrollToSection('section-10-9-1')">
    <h4>ğŸ“ 10.9.1 ç»Ÿä¸€å·¥ä½œæ¨¡å¼</h4>
    <p>ä¸‰æ¡é“å¾‹ã€ä¿¡æ¯å…¥å£ã€å®‰å…¨å†™å…¥åè®®ã€ArtifactåŒ–</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-10-9-2')">
    <h4>ğŸ”„ 10.9.2 æ¨¡å—å¼€å‘æµç¨‹</h4>
    <p>å› å­åº“å¼€å‘ã€ç­–ç•¥å¼€å‘ã€å›æµ‹ä¼˜åŒ–ã€å¹³å°é›†æˆ</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-10-9-3')">
    <h4>âš™ï¸ 10.9.3 Cursoré…ç½®</h4>
    <p>MCPé…ç½®ã€å·¥ä½œåŒºè®¾ç½®ã€Pythonè§£é‡Šå™¨ã€ç»ˆç«¯é…ç½®</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-10-9-4')">
    <h4>ğŸ”§ 10.9.4 å·¥ä½œæµè®¾è®¡</h4>
    <p>å·¥ä½œæµç¼–æ’ã€æ­¥éª¤å®šä¹‰ã€é”™è¯¯å¤„ç†ã€ç»“æœéªŒè¯</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-10-9-5')">
    <h4>âœ… 10.9.5 æœ€ä½³å®è·µ</h4>
    <p>ç¨³å®šé«˜æ•ˆã€æ˜“ç»´æŠ¤ã€å¯è¿½æº¯ã€å¯å¤ç°</p>
  </div>
</div>

## ğŸ¯ å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬èŠ‚å­¦ä¹ ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š

- **ç†è§£ç»Ÿä¸€å·¥ä½œæ¨¡å¼**ï¼šæŒæ¡ä¸‰æ¡é“å¾‹å’Œæ ‡å‡†å·¥ä½œæµç¨‹
- **æ‰§è¡Œæ¨¡å—å¼€å‘æµç¨‹**ï¼šæŒæ¡å› å­åº“ã€ç­–ç•¥ã€å›æµ‹ç­‰æ¨¡å—çš„å¼€å‘æµç¨‹
- **é…ç½®Cursorç¯å¢ƒ**ï¼šæŒæ¡MCPé…ç½®å’Œå·¥ä½œåŒºè®¾ç½®
- **è®¾è®¡å·¥ä½œæµ**ï¼šæŒæ¡å·¥ä½œæµç¼–æ’å’Œæ­¥éª¤å®šä¹‰æ–¹æ³•
- **åº”ç”¨æœ€ä½³å®è·µ**ï¼šæŒæ¡é«˜æ•ˆã€ç¨³å®šã€å¯ç»´æŠ¤çš„å¼€å‘æ–¹æ³•

## ğŸ“š æ ¸å¿ƒæ¦‚å¿µ

### ä¸‰æ¡é“å¾‹

- **é“å¾‹A**ï¼šæ‰€æœ‰ä¿¡æ¯å…¥å£å…ˆMCP
- **é“å¾‹B**ï¼šæ‰€æœ‰å†™æ“ä½œèµ°"å®‰å…¨å†™å…¥åè®®"
- **é“å¾‹C**ï¼šæ‰€æœ‰å¤§è¾“å‡ºartifactåŒ–

### å·¥å…·é“¾ç»„æˆ

- **MCPæœåŠ¡å™¨**ï¼šæä¾›å·¥å…·å’Œèµ„æºè®¿é—®
- **Cursor IDE**ï¼šå¼€å‘ç¯å¢ƒå’ŒAIåŠ©æ‰‹
- **å·¥ä½œæµç¼–æ’å™¨**ï¼šç»Ÿä¸€ç¼–æ’å¼€å‘æµç¨‹

### å®‰å…¨å†™å…¥åè®®

æ ‡å‡†æµç¨‹ï¼š`dry_run` â†’ `confirm_token` â†’ `execute` â†’ `evidence.record` â†’ `git commit/tag` â†’ `report.compare`

<h2 id="section-10-9-1">ğŸ“ 10.9.1 ç»Ÿä¸€å·¥ä½œæ¨¡å¼</h2>

ç»Ÿä¸€å·¥ä½œæ¨¡å¼å®šä¹‰äº†TRQuantå¼€å‘çš„æ ‡å‡†æµç¨‹ï¼Œç¡®ä¿æ‰€æœ‰å¼€å‘è€…éµå¾ªç›¸åŒçš„è§„èŒƒã€‚

### é“å¾‹Aï¼šæ‰€æœ‰ä¿¡æ¯å…¥å£å…ˆMCP

æ‰€æœ‰ä¿¡æ¯æŸ¥è¯¢ä¼˜å…ˆä½¿ç”¨MCPæœåŠ¡å™¨ï¼Œé¿å…ç›´æ¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿæˆ–æ•°æ®åº“ã€‚

#### ä¿¡æ¯æŸ¥è¯¢å·¥å…·

<CodeFromFile 
  filePath="code_library/010_Chapter10_Development_Guide/10.9/code_10_9_factor_manager.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
# æŸ¥æ–‡æ¡£
docs_server.query(query="ç­–ç•¥å¼€å‘æµç¨‹")

# æŸ¥ä»£ç 
code_server.search(pattern="class FactorManager")

# æŸ¥çŸ¥è¯†
kb.query(query="å› å­è®¡ç®—", scope="manual", top_k=10)

# æŸ¥ç­–ç•¥
strategy_kb.query(query="å¤šå› å­ç­–ç•¥", top_k=5)

# æŸ¥è§„èŒƒ
spec_ser<CodeFromFile 
  filePath="code_library/010_Chapter10_Development_Guide/10.9/code_10_9_generate_artifact.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
# âŒ é”™è¯¯æ–¹å¼ï¼šç›´æ¥è¯»å–æ–‡ä»¶
with open("docs/strategy_guide.md", "r") as f:
    content =<CodeFromFile 
  filePath="code_library/010_Chapter10_Development_Guide/10.9/code_10_9_safe_write_workflow.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
# 1. Dry Runï¼ˆé¢„æ¼”ï¼‰
result = factor.create(
    name="momentum_20d",
    formula="...",
    dry_run=True
)
confirm_token = result["confirm_token"]

# 2. Executeï¼ˆæ‰§è¡Œï¼‰
result = factor.create(
    name="momentum_20d",
    formula="...",
    execute=True,
    confirm_token=confirm_token
)

# 3. Evidence Recordï¼ˆè®°å½•è¯æ®ï¼‰
evidence.record(
    action="factor.create",
    trace_id=result["trace_id"],
    purpose="æ–°å¢åŠ¨é‡å› å­",
    impact="å½±å“å› å­åº“å’Œç­–ç•¥ç”Ÿæˆ",
    rollback="åˆ é™¤å› å­æˆ–å›é€€ç‰ˆæœ¬",
    report_url=result["report_url"]
)

# 4. Git Commit/Tagï¼ˆç‰ˆæœ¬åŒ–ï¼‰
git.commit(
    message=f"feat: æ–°å¢å› å­ momentum_20d [trace_id: {result['trace_id']}]"
)
git.tag(f"factor-momentum_20d-v{result['version']}")

# 5. Report Compareï¼ˆå¯¹æ¯”æŠ¥å‘Šï¼‰
report.compare(
    baseline="factor-momentum_20d-v1.0",
<CodeFromFile 
  filePath="code_library/010_Chapter10_Development_Guide/10.9/code_10_9_generate_artifact.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
# å®šä¹‰é˜ˆå€¼
ARTIFACT_THRESHOLD = 1000  # å­—ç¬¦æ•°

def generate_artifact(content: str, artifact_type: str) -> str:
    """ç”Ÿæˆartifact pointer"""
    if len(content) > ARTIFACT_THRESHOLD:
        artifact_id = artifact.create(
            content=content,
            type=artifact_type,
            metadata={"timestamp": datetime.now().isoformat()}
        )
        return f"artifact://{artifact_id}"
    return content

# ä½¿ç”¨ç¤ºä¾‹
strategy_code = generate_strategy(...)
if len(strategy_code) > ARTIFACT_THRESHOLD:
    artifact_id = generate_artifact(strategy_code, "strategy")
    print(f"ç­–ç•¥ä»£ç å·²ç”Ÿæˆ: {artifact_id}")
els<CodeFromFile 
  filePath="code_library/010_Chapter10_Development_Guide/10.9/code_10_9_factor_manager.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
# 1. å®šä½å…¥å£ç±»/æ¥å£
code_result = code_server.search(pattern="class FactorManager")
factor_manager_path = code_result["file_path"]

# 2. æŸ¥æ¨¡å—è®¾è®¡æ–‡æ¡£
docs_result = docs_server.query(query="å› å­åº“è®¾è®¡ æ¥å£çº¦å®š å‘½åè§„èŒƒ")
design_doc = docs_result["content"]

# 3. æ ¡éªŒæ–‡æ¡£ç»“æ„
spec_result = spec_server.validate(
    spec_type="chapter",
    content=chapter_content
)

# 4. æ–°å¢å› å­ï¼ˆDry Runï¼‰
factor_result = factor.create(
    name="momentum_20d",
    formula="close / close.shift(20) - 1",
    category="momentum",
    dry_run=True
)
confirm_token = factor_result["confirm_token"]

# 5. æ‰§è¡Œåˆ›å»ºï¼ˆExecuteï¼‰
factor_result = factor.create(
    name="momentum_20d",
    formula="close / close.shift(20) - 1",
    category="momentum",
    execute=True,
    confirm_token=confirm_token,
    evidence=True
)

# 6. å›æµ‹éªŒè¯
backtest_result = workflow.run(
    workflow_type="backtest",
    factors=["momentum_20d"],
    start_date="2024-01-01",
    end_date="2024-12-31"
)
artifact_id = backtest_result["artifact_id"]

# 7. ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š
report_result = report.generate(
    baseline="factor-momentum_20d-v1.0",
    current="factor-momentum_20d-v1.1",
    metrics=["ic", "ir", "sharpe", "max_drawdown"]
)
compare_report = report_result["report_url"]

# 8. è®°å½•è¯æ®
evidence.record(
    action="factor.create",
    trace_id=factor_result["trace_id"],
    purpose="æ–°å¢20æ—¥åŠ¨é‡å› å­",
    impact="å½±å“å› å­åº“å’Œç­–ç•¥ç”Ÿæˆ",
    rollback="åˆ é™¤å› å­æˆ–å›é€€ç‰ˆæœ¬",
    report_url=compare_report,
    artifact_id=artifact_id
)

# 9. Gitæäº¤å’Œæ ‡ç­¾
git.commit(
    message=f"feat: æ–°å¢å› å­ momentum_20d [trace_id: {factor_result['trace_id']}]"
)
git.tag(f"factor-momentum_20d-v{factor_result['version']<CodeFromFile 
  filePath="code_library/010_Chapter10_Development_Guide/10.9/code_10_9_steps.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
# 1. æ£€ç´¢ç›¸å…³ç ”ç©¶å¡
strategy_kb_result = strategy_kb.query(
    query="å¤šå› å­ç­–ç•¥ åŠ¨é‡æˆé•¿",
    top_k=5
)

# 2. ç”Ÿæˆå€™é€‰ç­–ç•¥
strategy_result = workflow.strategy.generate_candidate(
    factors=["momentum_20d", "ROE_ttm", "revenue_growth"],
    style="momentum_growth",
    platform="ptrade"
)
strategy_code = strategy_result["code"]

# 3. å›æµ‹éªŒè¯
backtest_result = workflow.run(
    workflow_type="backtest",
    strategy_code=strategy_code,
    start_date="2024-01-01",
    end_date="2024-12-31"
)

# 4. ç­–ç•¥ä¼˜åŒ–
optimizer_result = optimizer.run(
    strategy_code=strategy_code,
    parameters=["max_position", "stop_loss", "take_profit"],
    method="grid_search"
)

# 5. å¯¹æ¯”æŠ¥å‘Š
report_result = report.compare(
    baseline="strategy-v1.0",
    current="strategy-v1.1",
    metrics=["total_return", "sharpe_ratio", "max_drawdown"]
)

# 6. è®°å½•è¯æ®
evidence.record(
    action="strategy.generate",
    trace_id=strategy_result["trace_id"],
    purpose="ç”Ÿæˆå¤šå› å­åŠ¨é‡æˆé•¿ç­–ç•¥",
    impact="å½±å“ç­–ç•¥åº“å’Œå®ç›˜äº¤æ˜“",
    rollback="å›é€€ç­–<CodeFromFile 
  filePath="code_library/010_Chapter10_Development_Guide/10.9/code_10_9_steps.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
# 1. æ‰¹é‡å›æµ‹ï¼ˆWalk-Forwardï¼‰
backtest_results = workflow.run(
    workflow_type="backtest",
    mode="walk_forward",
    window_size=252,  # ä¸€å¹´
    step_size=63,     # ä¸€ä¸ªå­£åº¦
    start_date="2020-01-01",
    end_date="2024-12-31"
)

# 2. å‚æ•°ä¼˜åŒ–
optimizer_result = optimizer.run(
    strategy_code=strategy_code,
    parameters=["max_position", "stop_loss", "take_profit"],
    method="bayesian_optimization",
    n_trials=100
)

# 3. æ•°æ®è´¨é‡é—¨ç¦
quality_result = quality.validate(
    data_source="jqdata",
    data_type="ohlcv",
    start_date="2024-01-01",
    end_date="2024-12-31"
)

# 4. å¯¹æ¯”æŠ¥å‘Š
report_result = report.compare(
    baseline="backtest-batch-1",
    current="backtest-batch-2",
    metrics=["total_return", "sharpe_ratio", "max_drawdown", "win_rate"]
)

# 5. ä»»åŠ¡è®°å½•
task_result = task_server.create(
    task_type="backtest_batch",
    batch_id="backtest-2024-12-12",
    status="completed",
    progress=100,
    results=backtest_results
)
```
--> 7. ç‰ˆæœ¬åŒ–
git.tag(f"strategy-multifactor-momentum-growth-v{strategy_result['version']}")
```

### å›æµ‹ä¸ä¼˜åŒ–æµç¨‹

**æ­¥éª¤**ï¼š

```python
# 1. æ‰¹é‡å›æµ‹ï¼ˆWalk-Forwardï¼‰
backtest_results = workflow.run(
    workflow_type="backtest",
    mode="walk_forward",
    window_size=252,  # ä¸€å¹´
    step_size=63,     # ä¸€ä¸ªå­£åº¦
    start_date="2020-01-01",
    end_date="2024-12-31"
)

# 2. å‚æ•°ä¼˜åŒ–
optimizer_result = optimizer.run(
    strategy_code=strategy_code,
    parameters=["max_position", "stop_loss", "take_profit"],
    method="bayesian_optimization",
    n_trials=100
)

# 3. æ•°æ®è´¨é‡é—¨ç¦
quality_result = quality.validate(
    data_source="jqdata",
    data_type="ohlcv",
    start_date="2024-01-01",
    end_date="2024-12-31"
)

# 4. å¯¹æ¯”æŠ¥å‘Š
report_result = report.compare(
    baseline="backtest-batch-1",
    current="backtest-batch-2",
    metrics=["total_return", "sharpe_ratio", "max_drawdown", "win_rate"]
)

# 5. ä»»åŠ¡è®°å½•
task_result = task_server.create(
    task_type="backtest_batch",
    batch_id="backtest-2024-12-12",
    status="completed",
    progress=100,
    results=backtest_results
)
```

<h2 id="section-10-9-3">âš™ï¸ 10.9.3 Cursoré…ç½®</h2>

Cursoré…ç½®åŒ…æ‹¬MCPæœåŠ¡å™¨é…ç½®ã€å·¥ä½œåŒºè®¾ç½®ã€Pythonè§£é‡Šå™¨ç­‰ã€‚

### MCPé…ç½®

åœ¨ `.cursor/mcp.json` ä¸­é…ç½®MCPæœåŠ¡å™¨ï¼š

```json
{
  "mcpServers": {
    "filesystem": {
      "command": "npx",
      "args": [
        "-y",
        "@modelcontextprotocol/server-filesystem",
        "/home/taotao/dev/QuantTest/TRQuant"
      ]
    },
    "trquant-business": {
      "command": "python",
      "args": [
        "extension/python/mcp_server.py"
      ],
      "env": {
        "PYTHONPATH": "${workspaceFolder}/extension:${workspaceFolder}"
      },
      "cwd": "${workspaceFolder}"
    },
    "tr<CodeFromFile 
  filePath="code_library/010_Chapter10_Development_Guide/10.9/code_10_9___init__.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
# core/workflow_orchestrator.py
class WorkflowOrchestrator:
    """å·¥ä½œæµç¼–æ’å™¨"""
    
    def __init__(self):
        self.db = None
        self._init_db()
        self._results = {}
    
    def run_full_workflow(self) -> FullWorkflowResult:
        """è¿è¡Œå®Œæ•´å·¥ä½œæµ"""
        steps = []
        
        # æ­¥éª¤1: æ•°æ®æºæ£€æµ‹
        result = self.check_data_sources()
        steps.append(result)
        if not result.success:
            return FullWorkflowResult(success=False, steps=steps)
        
        # æ­¥éª¤2: å¸‚åœºåˆ†æ
        result = self.analyze_market()
        steps.append(result)
        
        # æ­¥éª¤3: ä¸»çº¿è¯†åˆ«
        result = self.identify_mainlines()
        steps.append(result)
        
        # æ­¥éª¤4: å€™é€‰æ± æ„å»º
        result = self.build_candidate_pool()
        steps.append(result)
        
   <CodeFromFile 
  filePath="code_library/010_Chapter10_Development_Guide/10.9/code_10_9_class.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
@dataclass
class WorkflowResult:
    """å·¥ä½œæµæ­¥éª¤ç»“æœ"""
    step_name: str
    success: bool
    summary: str
    details: D<CodeFromFile 
  filePath="code_library/010_Chapter10_Development_Guide/10.9/code_10_9_run_step.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
def run_step(self, step_func, step_name: str) -> WorkflowResult:
    """è¿è¡Œå·¥ä½œæµæ­¥éª¤"""
    try:
        result = step_func()
        return WorkflowResult(
            step_name=step_name,
            success=True,
            summary=f"{step_name}å®Œæˆ",
            details=result
        )
    except Exception as e:
        logger.error(f"{step_name}å¤±è´¥: {e}", exc_info=True)
        return WorkflowResult(
            step_name=step_name,
            success=False,
            summary=f"{step_name}å¤±è´¥",
            error=str(e)
        )
```
-->WorkflowResult:
        """è¿è¡Œå®Œæ•´å·¥ä½œæµ"""
        steps = []
        
        # æ­¥éª¤1: æ•°æ®æºæ£€æµ‹
        result = self.check_data_sources()
        steps.append(result)
        if not result.success:
            return FullWorkflowResult(success=False, steps=steps)
        
        # æ­¥éª¤2: å¸‚åœºåˆ†æ
        result = self.analyze_market()
        steps.append(result)
        
        # æ­¥éª¤3: ä¸»çº¿è¯†åˆ«
        result = self.identify_mainlines()
        steps.append(result)
        
        # æ­¥éª¤4: å€™é€‰æ± æ„å»º
        result = self.build_candidate_pool()
        steps.append(result)
        
        # æ­¥éª¤5: ç­–ç•¥ç”Ÿæˆ
        result = self.generate_strategy()
        steps.append(result)
        
        return FullWorkflowResult(success=True, steps=steps)
```

### æ­¥éª¤å®šä¹‰

```python
@dataclass
class WorkflowResult:
    """å·¥ä½œæµæ­¥éª¤ç»“æœ"""
    step_name: str
    success: bool
    summary: str
    details: Dict[str, Any] = field(default_factory=dict)
    timestamp: str = field(default_factory=lambda: datetime.now().isoformat())
    error: Optional[str] = None
```

### é”™è¯¯å¤„ç†

```python
def run_step(self, step_func, step_name: str) -> WorkflowResult:
    """è¿è¡Œå·¥ä½œæµæ­¥éª¤"""
    try:
        result = step_func()
        return WorkflowResult(
            step_name=step_name,
            success=True,
            summary=f"{step_name}å®Œæˆ",
            details=result
        )
    except Exception as e:
        logger.error(f"{step_name}å¤±è´¥: {e}", exc_info=True)
        return WorkflowResult(
            step_name=step_name,
            success=False,
            summary=f"{step_name}å¤±è´¥",
            error=str(e)
        )
```

<h2 id="section-10-9-5">âœ… 10.9.5 æœ€ä½³å®è·µ</h2>

æœ€ä½³å®è·µç¡®ä¿å¼€å‘æµç¨‹ç¨³å®šã€é«˜æ•ˆã€æ˜“ç»´æŠ¤ã€‚

### ç¨³å®šã€é«˜æ•ˆã€æ˜“ç»´æŠ¤

#### ç¨³å®š

- **ç»Ÿä¸€å·¥å…·é“¾åè®®**ï¼šæ¯ä¸ªæ¨¡å—éƒ½æŒ‰åŒä¸€å¥—"å·¥å…·é“¾åè®®"èµ°ï¼Œä¸é ä¸ªäººç»éªŒ
- **æ ‡å‡†åŒ–æµç¨‹**ï¼šæ‰€æœ‰æ“ä½œéµå¾ªæ ‡å‡†æµç¨‹ï¼Œå‡å°‘äººä¸ºé”™è¯¯
- **è‡ªåŠ¨åŒ–éªŒè¯**ï¼šæ¯ä¸ªæ­¥éª¤éƒ½æœ‰è‡ªåŠ¨åŒ–éªŒè¯æœºåˆ¶

#### é«˜æ•ˆ

- **å……åˆ†åˆ©ç”¨MCPå·¥å…·é“¾**ï¼šé¿å…é‡å¤å·¥ä½œï¼Œä¼˜å…ˆä½¿ç”¨MCPå·¥å…·
- **æ‰¹é‡æ“ä½œ**ï¼šæ”¯æŒæ‰¹é‡å›æµ‹ã€æ‰¹é‡ä¼˜åŒ–ç­‰æ“ä½œ
- **å¹¶è¡Œå¤„ç†**ï¼šæ”¯æŒå¹¶è¡Œæ‰§è¡Œå¤šä¸ªä»»åŠ¡

#### æ˜“ç»´æŠ¤

- **å¯è¿½æº¯**ï¼šæ‰€æœ‰æ“ä½œéƒ½æœ‰trace_idå’Œevidenceè®°å½•
- **å¯å¤ç°**ï¼šä½¿ç”¨å›ºå®šæ•°æ®é›†å’Œseedï¼Œç¡®ä¿ç»“æœå¯å¤ç°
- **å¯å®¡è®¡**ï¼šå®Œæ•´çš„æ“ä½œæ—¥å¿—å’Œè¯æ®é“¾

### å…³é”®åŸåˆ™

1. **ä¿¡æ¯å…¥å£å…ˆMCP**ï¼šä¼˜å…ˆä½¿ç”¨MCPæœåŠ¡å™¨æŸ¥è¯¢ä¿¡æ¯
2. **å†™æ“ä½œèµ°å®‰å…¨åè®®**ï¼šdry_run â†’ confirm_token â†’ execute â†’ evidence
3. **å¤§è¾“å‡ºartifactåŒ–**ï¼šé¿å…ç»ˆç«¯/èŠå¤©ç²˜è´´å¤§æ®µå†…å®¹
4. **å¼•ç”¨å¼ºåˆ¶**ï¼šæ‰€æœ‰ç« èŠ‚å¿…é¡»åŒ…å«å¼•ç”¨ï¼ˆæ¥è‡ªkb.queryæˆ–strategy_kb.queryï¼‰
5. **ç‰ˆæœ¬ç»‘å®š**ï¼šæ‰€æœ‰ä»£ç ç¤ºä¾‹å¸¦ç‰ˆæœ¬æŒ‡çº¹

### æ–°æˆå‘˜å…¥é—¨æµç¨‹

1. **æ‰“å¼€repo** â†’ é€‰æ‹©interpreter â†’ å¯åŠ¨MCP servers
2. **è·‘ä¸€ä¸ªworkflow dry_run** â†’ ç”Ÿæˆä¸€ä¸ªreport
3. **æŸ¥çœ‹å¼€å‘æ‰‹å†Œ**ï¼š`docs/å¼€å‘æ‰‹å†Œå¼€å‘æµç¨‹_å·¥å…·ä½¿ç”¨æŒ‡å—.md`

## ğŸ”— ç›¸å…³ç« èŠ‚

- **10.7 MCPæœåŠ¡å™¨å¼€å‘æŒ‡å—**ï¼šäº†è§£MCPæœåŠ¡å™¨å¼€å‘æ–¹æ³•
- **10.3 å¼€å‘å·¥ä½œæµ**ï¼šäº†è§£å¼€å‘æµç¨‹
- **ç¬¬7ç« ï¼šç­–ç•¥å¼€å‘**ï¼šäº†è§£ç­–ç•¥å¼€å‘æµç¨‹

## ğŸ’¡ å…³é”®è¦ç‚¹

1. **ç»Ÿä¸€å·¥ä½œæ¨¡å¼**ï¼šä¸‰æ¡é“å¾‹ç¡®ä¿å¼€å‘æµç¨‹æ ‡å‡†åŒ–
2. **æ¨¡å—å¼€å‘æµç¨‹**ï¼šä¸åŒæ¨¡å—æœ‰æ ‡å‡†åŒ–çš„å¼€å‘æ­¥éª¤
3. **Cursoré…ç½®**ï¼šç»Ÿä¸€çš„MCPé…ç½®å’Œå·¥ä½œåŒºè®¾ç½®
4. **å·¥ä½œæµè®¾è®¡**ï¼šå·¥ä½œæµç¼–æ’å’Œæ­¥éª¤å®šä¹‰æ–¹æ³•
5. **æœ€ä½³å®è·µ**ï¼šç¨³å®šã€é«˜æ•ˆã€æ˜“ç»´æŠ¤çš„å¼€å‘æ–¹æ³•

## ğŸ”® æ€»ç»“ä¸å±•æœ›

<div class="summary-outlook">
  <h3>æœ¬èŠ‚å›é¡¾</h3>
  <p>æœ¬èŠ‚ç³»ç»Ÿä»‹ç»äº†MCP Ã— Cursor Ã— å·¥å…·é“¾è”ç”¨è§„èŒƒï¼ŒåŒ…æ‹¬ç»Ÿä¸€å·¥ä½œæ¨¡å¼ã€æ¨¡å—å¼€å‘æµç¨‹ã€Cursoré…ç½®ã€å·¥ä½œæµè®¾è®¡ã€æœ€ä½³å®è·µç­‰æ ¸å¿ƒæŠ€æœ¯ã€‚é€šè¿‡ç†è§£å·¥å…·é“¾è”ç”¨è§„èŒƒï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡MCPã€Cursorå’Œå·¥å…·é“¾çš„ååŒä½¿ç”¨æ–¹æ³•ã€‚</p>
  
  <h3>ä¸‹èŠ‚é¢„å‘Š</h3>
  <p>æŒæ¡äº†å·¥å…·é“¾è”ç”¨è§„èŒƒåï¼Œä¸‹ä¸€èŠ‚å°†ä»‹ç»RAGçŸ¥è¯†åº“å¼€å‘æŒ‡å—ï¼ŒåŒ…æ‹¬çŸ¥è¯†åº“æ¶æ„ã€æ–‡æ¡£å¤„ç†ã€å‘é‡åŒ–ã€æ£€ç´¢ä¼˜åŒ–ç­‰ã€‚é€šè¿‡ç†è§£RAGçŸ¥è¯†åº“å¼€å‘æ–¹æ³•ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡çŸ¥è¯†åº“çš„æ„å»ºå’Œç»´æŠ¤æŠ€å·§ã€‚</p>
  
  <a href="/ashare-book6/010_Chapter10_Development_Guide/10.10_RAG_KB_Development_Guide_CN" class="next-section">
    ç»§ç»­å­¦ä¹ ï¼š10.10 RAGçŸ¥è¯†åº“å¼€å‘æŒ‡å— â†’
  </a>
</div>

> **é€‚ç”¨ç‰ˆæœ¬**: v1.0.0+  
> **æœ€åæ›´æ–°**: 2025-12-12
