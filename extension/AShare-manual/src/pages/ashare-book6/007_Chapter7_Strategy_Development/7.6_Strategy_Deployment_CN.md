---
title: "7.6 ç­–ç•¥éƒ¨ç½²"
description: "æ·±å…¥è§£æç­–ç•¥éƒ¨ç½²ç³»ç»Ÿï¼ŒåŒ…æ‹¬ç­–ç•¥æ‰“åŒ…ã€ç­–ç•¥ä¸Šä¼ ã€ç­–ç•¥ç›‘æ§ç­‰æ ¸å¿ƒæŠ€æœ¯"
lang: "zh-CN"
layout: "/src/layouts/HandbookLayout.astro"
currentBook: "ashare-book6"
updateDate: "2025-12-12"
---

# ğŸš€ 7.6 ç­–ç•¥éƒ¨ç½²

> **æ ¸å¿ƒæ‘˜è¦ï¼š**
> 
> æœ¬èŠ‚ç³»ç»Ÿä»‹ç»TRQuantç³»ç»Ÿçš„ç­–ç•¥éƒ¨ç½²ç³»ç»Ÿï¼ŒåŒ…æ‹¬ç­–ç•¥æ‰“åŒ…ã€ç­–ç•¥ä¸Šä¼ å’Œç­–ç•¥ç›‘æ§ã€‚é€šè¿‡ç†è§£ç­–ç•¥éƒ¨ç½²çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡å¦‚ä½•å°†ç­–ç•¥éƒ¨ç½²åˆ°å®ç›˜äº¤æ˜“å¹³å°ã€‚

ç­–ç•¥éƒ¨ç½²æ˜¯å°†éªŒè¯é€šè¿‡çš„ç­–ç•¥éƒ¨ç½²åˆ°å®ç›˜äº¤æ˜“å¹³å°çš„è¿‡ç¨‹ã€‚TRQuantç³»ç»Ÿé‡‡ç”¨**åŒå±‚éƒ¨ç½²æ¶æ„**ï¼š

1. **ç¬¬ä¸€å±‚ï¼šå†…éƒ¨å›æµ‹éªŒè¯**ï¼ˆBulletTrade + èšå®½æ•°æ®æºï¼‰
   - åœ¨éŸ¬ç¿ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨BulletTradeå¼•æ“è¿›è¡Œå›æµ‹
   - ä½¿ç”¨èšå®½(JQData)æ•°æ®æºè·å–å†å²æ•°æ®
   - ç­–ç•¥ä»£ç ä¸ºèšå®½é£æ ¼ï¼ˆ`from jqdata import *`ï¼‰

2. **ç¬¬äºŒå±‚ï¼šåˆ¸å•†å¹³å°éƒ¨ç½²**ï¼ˆPTrade/QMTï¼‰
   - å°†èšå®½é£æ ¼ç­–ç•¥ä»£ç è½¬æ¢ä¸ºPTrade/QMTæ ¼å¼
   - éƒ¨ç½²åˆ°å›½é‡‘è¯åˆ¸çš„PTrade/QMTå¹³å°
   - è¿›è¡Œåˆ¸å•†ç¯å¢ƒå›æµ‹éªŒè¯å’Œå®ç›˜äº¤æ˜“

> **æ³¨æ„**ï¼šè¯¦ç»†çš„å›æµ‹æ¡†æ¶å’ŒPTrade/QMTéƒ¨ç½²æµç¨‹è¯·å‚è€ƒ[ç¬¬8ç« ï¼šå›æµ‹éªŒè¯](/ashare-book6/008_Chapter8_Backtest/8.1_Backtest_Framework_CN)å’Œ[ç¬¬9ç« ï¼šå¹³å°é›†æˆ](/ashare-book6/009_Chapter9_Platform_Integration/009_Chapter9_Platform_Integration_CN)ã€‚

## ğŸ“‹ ç« èŠ‚æ¦‚è§ˆ

<script>
function scrollToSection(sectionId) {
  const element = document.getElementById(sectionId);
  if (element) {
    const headerOffset = 100;
    const elementPosition = element.getBoundingClientRect().top;
    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
    window.scrollTo({
      top: offsetPosition,
      behavior: 'smooth'
    });
  }
}
</script>

<div class="section-overview">
  <div class="section-item" onclick="scrollToSection('section-7-6-1')">
    <h4>ğŸ“¦ 7.6.1 ç­–ç•¥æ‰“åŒ…</h4>
    <p>ç­–ç•¥æ–‡ä»¶æ‰“åŒ…ã€ä¾èµ–æ£€æŸ¥ã€é…ç½®æ–‡ä»¶ç”Ÿæˆ</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-7-6-2')">
    <h4>ğŸ“¤ 7.6.2 ç­–ç•¥ä¸Šä¼ </h4>
    <p>PTradeä¸Šä¼ ã€QMTä¸Šä¼ ã€ç‰ˆæœ¬ç®¡ç†</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-7-6-3')">
    <h4>ğŸ“Š 7.6.3 ç­–ç•¥ç›‘æ§</h4>
    <p>è¿è¡ŒçŠ¶æ€ç›‘æ§ã€æ€§èƒ½ç›‘æ§ã€å¼‚å¸¸ç›‘æ§</p>
  </div>
</div>

## ğŸ¯ å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬èŠ‚å­¦ä¹ ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š

- **æ‰“åŒ…ç­–ç•¥**ï¼šæŒæ¡ç­–ç•¥æ–‡ä»¶æ‰“åŒ…å’Œä¾èµ–æ£€æŸ¥æ–¹æ³•
- **ä¸Šä¼ ç­–ç•¥**ï¼šç†è§£PTradeå’ŒQMTå¹³å°çš„ä¸Šä¼ æµç¨‹
- **ç›‘æ§ç­–ç•¥**ï¼šæŒæ¡ç­–ç•¥è¿è¡ŒçŠ¶æ€å’Œæ€§èƒ½ç›‘æ§æ–¹æ³•

## ğŸ“š æ ¸å¿ƒæ¦‚å¿µ

### æ¨¡å—å®šä½

- **å·¥ä½œæµä½ç½®**ï¼šæ­¥éª¤8 - ğŸš€ å®ç›˜äº¤æ˜“
- **æ ¸å¿ƒèŒè´£**ï¼šç­–ç•¥æ‰“åŒ…ã€ç­–ç•¥ä¸Šä¼ ã€ç­–ç•¥ç›‘æ§
- **æœåŠ¡å¯¹è±¡**ï¼šå®ç›˜äº¤æ˜“å¹³å°

<h2 id="section-7-6-1">ğŸ“¦ 7.6.1 ç­–ç•¥æ‰“åŒ…</h2>

ç­–ç•¥æ‰“åŒ…å°†ç­–ç•¥ä»£ç å’Œä¾èµ–æ‰“åŒ…æˆå¯éƒ¨ç½²çš„åŒ…ï¼Œç¡®ä¿ç­–ç•¥å¯ä»¥ç‹¬ç«‹è¿è¡Œã€‚

### æ‰“åŒ…å®ç°

<CodeFromFile 
  filePath="code_library/007_Chapter7_Strategy_Development/7.6/code_7_6___init__.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
import zipfile
import json
import ast
from pathlib import Path
from typing import List, Set

class StrategyPackager:
    """ç­–ç•¥æ‰“åŒ…å™¨"""
    
    def __init__(self):
        self.output_dir = Path("packages")
        self.output_dir.mkdir(parents=True, exist_ok=True)
    
    def package_strategy(
        self,
        strategy_file: str,
        output_dir: str = "packages",
        include_dependencies: bool = True
    ) -> Dict[str, str]:
        """
        æ‰“åŒ…ç­–ç•¥
        
        Args:
            strategy_file: ç­–ç•¥æ–‡ä»¶è·¯å¾„
            output_dir: è¾“å‡ºç›®å½•
            include_dependencies: æ˜¯å¦åŒ…å«ä¾èµ–æ–‡ä»¶
        
        Returns:
            Dict: æ‰“åŒ…ç»“æœï¼ŒåŒ…å«package_path, manifest_pathç­‰
        """
        strategy_path = Path(strategy_file)
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        package_name = f"{strategy_path.stem}_{timestamp}.zip"
        package_path = Path(output_dir) / package_name
        
        # åˆ†æä¾èµ–
        dependencies = []
        if include_dependencies:
            dependencies = self._find_dependencies(strategy_file)
        
        # ç”Ÿæˆé…ç½®æ–‡ä»¶
        config = self._generate_config(strategy_file, dependencies)
        
        # åˆ›å»ºæ‰“åŒ…æ–‡ä»¶
        with zipfile.ZipFile(package_path, 'w', zipfile.ZIP_DEFLATED) as zipf:
            # æ·»åŠ ç­–ç•¥æ–‡ä»¶
            zipf.write(strategy_file, strategy_path.name)
            
            # æ·»åŠ ä¾èµ–æ–‡ä»¶
            for dep in dependencies:
                if Path(dep).exists():
                    zipf.write(dep, f"dependencies/{Path(dep).name}")
            
            # æ·»åŠ é…ç½®æ–‡ä»¶
            zipf.writestr('config.json', json.dumps(config, indent=2, ensure_ascii=False))
            
            # æ·»åŠ æ¸…å•æ–‡ä»¶
            manifest = self._generate_manifest(strategy_file, dependencies)
            zipf.writestr('MANIFEST.json', json.dumps(manifest, indent=2, ensure_ascii=False))
        
        return {
            'package_path': str(package_path),
            'package_name': package_name,
            'strategy_file': strategy_path.name,
            'dependencies': [Path(d).name for d in dependencies],
            'config': config
        }
    
    def _find_dependencies(self, strategy_file: str) -> List[str]:
        """æŸ¥æ‰¾ç­–ç•¥ä¾èµ–"""
        dependencies = []
        
        try:
            with open(strategy_file, 'r', encoding='utf-8') as f:
                code = f.read()
                tree = ast.parse(code)
                
                # æå–importè¯­å¥
                for node in ast.walk(tree):
                    if isinstance(node, ast.Import):
                        for alias in node.names:
                            module_name = alias.name
                            # æ£€æŸ¥æ˜¯å¦æ˜¯æœ¬åœ°æ¨¡å—
                            if self._is_local_module(module_name):
                                dep_path = self._find_module_path(module_name)
                                if dep_path:
                                    dependencies.append(dep_path)
                    elif isinstance(node, ast.ImportFrom):
                        if node.module and self._is_local_module(node.module):
                            dep_path = self._find_module_path(node.module)
                            if dep_path:
                                dependencies.append(dep_path)
        except Exception as e:
            logger.warning(f"åˆ†æä¾èµ–å¤±è´¥: {e}")
        
        return list(set(dependencies))
    
    def _is_local_module(self, module_name: str) -> bool:
        """åˆ¤æ–­æ˜¯å¦æ˜¯æœ¬åœ°æ¨¡å—"""
        # æ’é™¤æ ‡å‡†åº“å’Œç¬¬ä¸‰æ–¹åº“
        stdlib_modules = {'os', 'sys', 'json', 'datetime', 'pandas', 'numpy'}
        return module_name not in stdlib_modules and not module_name.startswith('_')
    
    def _find_module_path(self, module_name: str) -> str:
        """æŸ¥æ‰¾æ¨¡å—è·¯å¾„"""
        # åœ¨é¡¹ç›®ç›®å½•ä¸­æŸ¥æ‰¾
        project_root = Path(__file__).parent.parent.parent
        module_path = project_root / module_name.replace('.', '/')
        
        if module_path.with_suffix('.py').exists():
            return str(module_path.with_suffix('.py'))
        
        return None
    
    def _generate_config(
        self,
        strategy_file: str,
        dependencies: List[str]
    ) -> Dict[str, Any]:
        """ç”Ÿæˆé…ç½®æ–‡ä»¶"""
        strategy_path = Path(strategy_file)
        
        # æå–ç­–ç•¥å…ƒæ•°æ®
        metadata = self._extract_metadata(strategy_file)
        
        return {
            'strategy_name': metadata.get('name', strategy_path.stem),
            'version': metadata.get('version', '1.0.0'),
            'platform': metadata.get('platform', 'ptrade'),
            'created_at': datetime.now().isoformat(),
            'dependencies': dependencies,
            'requirements': self._extract_requirements(strategy_file)
        }
    
    def _generate_manifest(
        self,
        strategy_file: str,
        dependencies: List[str]
    ) -> Dict[str, Any]:
        """ç”Ÿæˆæ¸…å•æ–‡ä»¶"""
        return {
            'files': [
                Path(strategy_file).name,
                'config.json'
            ] + [Path(d).name for d in dependencies],
            'total_size': self._calculate_package_size(strategy_file, dependencies),
            'checksum': self._calculate_checksum(strategy_file)
        }
```
-->

<h2 id="section-7-6-2">ğŸ“¤ 7.6.2 ç­–ç•¥ä¸Šä¼ </h2>

ç­–ç•¥ä¸Šä¼ å°†æ‰“åŒ…çš„ç­–ç•¥ä¸Šä¼ åˆ°äº¤æ˜“å¹³å°ï¼Œæ”¯æŒPTradeå’ŒQMTä¸¤ç§å¹³å°ã€‚ä¸Šä¼ å‰éœ€è¦ç¡®ä¿ç­–ç•¥å·²ç»é€šè¿‡BulletTradeå›æµ‹éªŒè¯ã€‚

### éƒ¨ç½²å·¥ä½œæµ

å®Œæ•´çš„ç­–ç•¥éƒ¨ç½²å·¥ä½œæµå¦‚ä¸‹ï¼š

```
ç­–ç•¥å¼€å‘ï¼ˆèšå®½é£æ ¼ï¼‰
    â†“
BulletTradeå›æµ‹éªŒè¯ï¼ˆèšå®½æ•°æ®æºï¼‰
    â†“<CodeFromFile 
  filePath="code_library/007_Chapter7_Strategy_Development/7.6/code_7_6_convert_to_ptrade.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
from typing import Dict, Any
import re

class StrategyCodeConverter:
    """ç­–ç•¥ä»£ç è½¬æ¢å™¨ï¼ˆèšå®½é£æ ¼ â†’ PTrade/QMTæ ¼å¼ï¼‰"""
    
    def convert_to_ptrade(
        self,
        jq_strategy_code: str
    ) -> str:
        """
        å°†èšå®½é£æ ¼ç­–ç•¥ä»£ç è½¬æ¢ä¸ºPTradeæ ¼å¼
        
        **è®¾è®¡åŸç†**ï¼š
        - **æ­£åˆ™æ›¿æ¢**ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢APIè°ƒç”¨ï¼Œä¿æŒä»£ç é€»è¾‘ä¸å˜
        - **æ¨¡å—æ˜ å°„**ï¼šå°†èšå®½APIæ˜ å°„åˆ°PTrade APIï¼Œä¿æŒåŠŸèƒ½ä¸€è‡´æ€§
        - **åˆå§‹åŒ–æ³¨å…¥**ï¼šè‡ªåŠ¨æ·»åŠ PTradeåˆå§‹åŒ–ä»£ç ï¼Œç¡®ä¿å¹³å°æ­£ç¡®åˆå§‹åŒ–
        
        **ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡**ï¼š
        1. **è‡ªåŠ¨åŒ–**ï¼šè‡ªåŠ¨è½¬æ¢å‡å°‘äººå·¥é”™è¯¯ï¼Œæé«˜éƒ¨ç½²æ•ˆç‡
        2. **ä¸€è‡´æ€§**ï¼šä¿æŒç­–ç•¥é€»è¾‘ä¸å˜ï¼Œåªæ›¿æ¢APIè°ƒç”¨
        3. **å¯ç»´æŠ¤æ€§**ï¼šé›†ä¸­ç®¡ç†è½¬æ¢è§„åˆ™ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
        
        **ä½¿ç”¨åœºæ™¯**ï¼š
        - ç­–ç•¥éƒ¨ç½²åˆ°PTradeå¹³å°å‰ï¼Œè‡ªåŠ¨è½¬æ¢ä»£ç æ ¼å¼
        - ç­–ç•¥ä»èšå®½å¹³å°è¿ç§»åˆ°PTradeå¹³å°
        - ç­–ç•¥ä»£ç æ ¼å¼æ ‡å‡†åŒ–
        
        **æ³¨æ„äº‹é¡¹**ï¼š
        - è½¬æ¢åéœ€è¦äººå·¥æ£€æŸ¥ï¼Œç¡®ä¿APIæ˜ å°„æ­£ç¡®
        - æŸäº›èšå®½ç‰¹æœ‰åŠŸèƒ½å¯èƒ½éœ€è¦æ‰‹åŠ¨è°ƒæ•´
        - å»ºè®®åœ¨è½¬æ¢åè¿›è¡Œå›æµ‹éªŒè¯ï¼Œç¡®ä¿åŠŸèƒ½æ­£å¸¸
        
        Args:
            jq_strategy_code: èšå®½é£æ ¼ç­–ç•¥ä»£ç 
        
        Returns:
            str: PTradeæ ¼å¼ç­–ç•¥ä»£ç 
        """
        # è®¾è®¡åŸç†ï¼šä»£ç è½¬æ¢é‡‡ç”¨æ­£åˆ™æ›¿æ¢
        # åŸå› ï¼šèšå®½å’ŒPTrade APIç›¸ä¼¼ï¼Œåªéœ€æ›¿æ¢æ¨¡å—åå’Œå‡½æ•°è°ƒç”¨
        # å®ç°æ–¹å¼ï¼šä½¿ç”¨re.subè¿›è¡Œæ‰¹é‡æ›¿æ¢ï¼Œä¿æŒä»£ç é€»è¾‘ä¸å˜
        ptrade_code = jq_strategy_code
        
        # è®¾è®¡åŸç†ï¼šæ›¿æ¢å¯¼å…¥è¯­å¥
        # åŸå› ï¼šPTradeä½¿ç”¨ä¸åŒçš„APIæ¨¡å—ï¼Œéœ€è¦æ›¿æ¢å¯¼å…¥
        # æ˜ å°„å…³ç³»ï¼šjqdata â†’ ptrade_api
        ptrade_code = re.sub(
            r'from jqdata import \*',
            'from ptrade_api import *',
            ptrade_code
        )
        
        # è®¾è®¡åŸç†ï¼šæ›¿æ¢APIè°ƒç”¨
        # åŸå› ï¼šPTrade APIéœ€è¦æ¨¡å—å‰ç¼€ï¼Œèšå®½APIæ˜¯å…¨å±€å‡½æ•°
        # å®ç°æ–¹å¼ï¼šåœ¨å‡½æ•°åå‰æ·»åŠ ptrade.å‰ç¼€
        # get_price -> ptrade.get_price
        ptrade_code = re.sub(
            r'get_price\(',
            'ptrade.get_price(',
            ptrade_code
        )
        
        # order -> ptrade.order
        ptrade_code = re.sub(
            r'order\(',
            'ptrade.order(',
            ptrade_code
        )
        
        # è®¾è®¡åŸç†ï¼šæ·»åŠ PTradeåˆå§‹åŒ–ä»£ç 
        # åŸå› ï¼šPTradeå¹³å°éœ€è¦æ˜¾å¼åˆå§‹åŒ–ï¼Œèšå®½å¹³å°è‡ªåŠ¨åˆå§‹åŒ–
        # å®ç°æ–¹å¼ï¼šåœ¨ä»£ç å¼€å¤´æ·»åŠ åˆå§‹åŒ–ä»£ç 
        ptrade_init = """
# PTradeå¹³å°åˆå§‹åŒ–
import ptrade_api as ptrade
ptrade.init()
"""
        ptrade_code = ptrade_init + ptrade_code
        
        return ptrade_code
    
    def convert_to_qmt(
        self,
        jq_strategy_code: str
    ) -> str:
        """
        å°†èšå®½é£æ ¼ç­–ç•¥ä»£ç è½¬æ¢ä¸ºQMTæ ¼å¼
        
        Args:
            jq_strategy_code: èšå®½é£æ ¼ç­–ç•¥ä»£ç 
        
        Returns:
            str: QMTæ ¼å¼ç­–ç•¥ä»£ç 
        """
        # 1. æ›¿æ¢å¯¼å…¥è¯­å¥
        qmt_code = jq_strategy_code
        
        # æ›¿æ¢ jqdata å¯¼å…¥
        qmt_code = re.sub(
            r'from jqdata import \*',
            'from qmt_api import *',
            qmt_code
        )
        
        # 2. æ›¿æ¢APIè°ƒç”¨
        # get_price -> qmt.get_price
        qmt_code = re.sub(
            r'get_price\(',
            'qmt.get_price(',
            qmt_code
        )
        
        # order -> qmt.order
        qmt_code = re.sub(
            r'order\(',
            'qmt.order(',
            qmt_code
        )
        
  <CodeFromFile 
  filePath="code_library/007_Chapter7_Strategy_Development/7.6/code_7_6_deploy_strategy_workflow.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
from core.bullettrade import BulletTradeEngine, BTConfig
from core.ptrade_integration import PTradeDeployer, PTradeConfig
from core.qmt_integration import QMTDeployer, QMTConfig

def deploy_strategy_workflow(
    strategy_path: str,
    start_date: str,
    end_date: str,
    deploy_to_ptrade: bool = False,
    deploy_to_qmt: bool = False
) -> Dict[str, Any]:
    """
    å®Œæ•´ç­–ç•¥éƒ¨ç½²å·¥ä½œæµ
    
    1. BulletTradeå›æµ‹éªŒè¯
    2. å›æµ‹ç»“æœéªŒè¯
    3. ç­–ç•¥ä»£ç è½¬æ¢
    4. ç­–ç•¥æ‰“åŒ…
    5. ä¸Šä¼ åˆ°PTrade/QMTå¹³å°
    
    Args:
        strategy_path: ç­–ç•¥ä»£ç è·¯å¾„ï¼ˆèšå®½é£æ ¼ï¼‰
        start_date: å›æµ‹å¼€å§‹æ—¥æœŸ
        end_date: å›æµ‹ç»“æŸæ—¥æœŸ
        deploy_to_ptrade: æ˜¯å¦éƒ¨ç½²åˆ°PTrade
        deploy_to_qmt: æ˜¯å¦éƒ¨ç½²åˆ°QMT
    
    Returns:
        Dict: éƒ¨ç½²ç»“æœ
    """
    results = {
        'backtest_result': None,
        'backtest_passed': False,
        'ptrade_deployment': None,
        'qmt_deployment': None
    }
    
    # ========== ç¬¬ä¸€æ­¥ï¼šBulletTradeå›æµ‹éªŒè¯ ==========
    print("=" * 60)
    print("ç¬¬ä¸€æ­¥ï¼šBulletTradeå›æµ‹éªŒè¯")
    print("=" * 60)
    
    # åˆ›å»ºBulletTradeé…ç½®
    bt_config = BTConfig(
        start_date=start_date,
        end_date=end_date,
        initial_capital=1000000,
        commission_rate=0.0003,
        stamp_tax_rate=0.001,
        slippage=0.001,
        benchmark="000300.XSHG",
        data_provider="jqdata"  # ä½¿ç”¨èšå®½æ•°æ®æº
    )
    
    # åˆå§‹åŒ–BulletTradeå¼•æ“
    bt_engine = BulletTradeEngine(bt_config)
    
    # æ‰§è¡Œå›æµ‹
    backtest_result = bt_engine.run_backtest(
        strategy_path=strategy_path,
        start_date=start_date,
        end_date=end_date,
        frequency="day"
    )
    
    results['backtest_result'] = backtest_result
    
    # ========== ç¬¬äºŒæ­¥ï¼šå›æµ‹ç»“æœéªŒè¯ ==========
    print("=" * 60)
    print("ç¬¬äºŒæ­¥ï¼šå›æµ‹ç»“æœéªŒè¯")
    print("=" * 60)
    
    # éªŒè¯æ€§èƒ½æŒ‡æ ‡
    if (backtest_result.sharpe_ratio > 1.0 and 
        backtest_result.max_drawdown < 0.20 and
        backtest_result.annual_return > 0.05):
        results['backtest_passed'] = True
        print("âœ… å›æµ‹ç»“æœéªŒè¯é€šè¿‡")
    else:
        print("âŒ å›æµ‹ç»“æœéªŒè¯å¤±è´¥ï¼Œä¸æ»¡è¶³éƒ¨ç½²æ¡ä»¶")
        return results
    
    # ========== ç¬¬ä¸‰æ­¥ï¼šç­–ç•¥ä»£ç è½¬æ¢å’Œæ‰“åŒ… ==========
    print("=" * 60)
    print("ç¬¬ä¸‰æ­¥ï¼šç­–ç•¥ä»£ç è½¬æ¢å’Œæ‰“åŒ…")
    print("=" * 60)
    
    # è¯»å–ç­–ç•¥ä»£ç 
    with open(strategy_path, 'r', encoding='utf-8') as f:
        jq_strategy_code = f.read()
    
    # åˆ›å»ºä»£ç è½¬æ¢å™¨
    converter = StrategyCodeConverter()
    
    # åˆ›å»ºæ‰“åŒ…å™¨
    packager = StrategyPackager()
    
    # ========== ç¬¬å››æ­¥ï¼šéƒ¨ç½²åˆ°PTrade ==========
    if deploy_to_ptrade:
        print("=" * 60)
        print("ç¬¬å››æ­¥ï¼šéƒ¨ç½²åˆ°PTradeå¹³å°")
        print("=" * 60)
        
        # è½¬æ¢ä¸ºPTradeæ ¼å¼
        ptrade_code = converter.convert_to_ptrade(jq_strategy_code)
        
        # ä¿å­˜PTradeæ ¼å¼ä»£ç 
        ptrade_strategy_path = strategy_path.replace('.py', '_ptrade.py')
        with open(ptrade_strategy_path, 'w', encoding='utf-8') as f:
            f.write(ptrade_code)
        
        # æ‰“åŒ…ç­–ç•¥
        package_result = packager.package_strategy(
            ptrade_strategy_path,
            output_dir="packages"
        )
        
        # é…ç½®PTradeè¿æ¥
        ptrade_config = PTradeConfig(
            host="ptrade.gjzq.com",
            port=7709,
            account_id="8885019982",
            strategy_path="/path/to/ptrade/strategies"
        )
        
        # åˆ›å»ºPTradeéƒ¨ç½²å™¨
        ptrade_deployer = PTradeDeployer(ptrade_config)
        
        # ä¸Šä¼ ç­–ç•¥
        ptrade_result = ptrade_deployer.upload_strategy(
            package_path=package_result['package_path'],
            strategy_name=package_result['strategy_name']
        )
        
        results['ptrade_deployment'] = ptrade_result
    
    # ========== ç¬¬äº”æ­¥ï¼šéƒ¨ç½²åˆ°QMT ==========
    if deploy_to_qmt:
        print("=" * 60)
        print("ç¬¬äº”æ­¥ï¼šéƒ¨ç½²åˆ°QMTå¹³å°")
        print("=" * 60)
        
        # è½¬æ¢ä¸ºQMTæ ¼å¼
        qmt_code = converter.convert_to_qmt(jq_strategy_code)
        
        # ä¿å­˜QMTæ ¼å¼ä»£ç 
        qmt_strategy_path = strategy_path.replace('.py', '_qmt.py')
        with open(qmt_strategy_path, 'w', encoding='utf-8') as f:
            f.write(qmt_code)
        
        # æ‰“åŒ…ç­–ç•¥
        package_result = packager.package_strategy(
            qmt_strategy_path,
            output_dir="packages"
        )
        
        # é…ç½®QMTè¿æ¥
        qmt_config = QMTConfig(
            qmt_path="C:/QMT",
            account_id="your_account"
        )
        
        # åˆ›å»ºQMTéƒ¨ç½²å™¨
        qmt_deployer = QMTDeployer(qmt_config)
        
        # ä¸Šä¼ ç­–ç•¥
        qmt_result = qmt_deployer.upload_strategy(
            package_path=package_re<CodeFromFile 
  filePath="code_library/007_Chapter7_Strategy_Development/7.6/code_7_6___init__.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
from core.ptrade_integration import PTradeConfig, PTradeDeployer
from pathlib import Path

class PTRADEUploader:
    """PTradeä¸Šä¼ å™¨ï¼ˆå›½é‡‘è¯åˆ¸ï¼‰"""
    
    def __init__(self, config: PTradeConfig):
        """
        åˆå§‹åŒ–PTradeä¸Šä¼ å™¨
        
        Args:
            config: PTradeé…ç½®ï¼ˆåŒ…å«host, port, account_idç­‰ï¼‰
        """
        self.config = config
        self.deployer = PTradeDeployer(config)
    
    def upload_strategy(
        self,
        package_path: str,
        strategy_name: str = None
    ) -> Dict[str, Any]:
        """
        ä¸Šä¼ ç­–ç•¥åˆ°PTradeå¹³å°ï¼ˆå›½é‡‘è¯åˆ¸ï¼‰
        
        æ³¨æ„ï¼šä¸Šä¼ å‰éœ€è¦ç¡®ä¿ç­–ç•¥å·²ç»é€šè¿‡BulletTradeå›æµ‹éªŒè¯
        
        Args:
            package_path: æ‰“åŒ…æ–‡ä»¶è·¯å¾„ï¼ˆåŒ…å«å·²è½¬æ¢çš„PTradeæ ¼å¼ç­–ç•¥ï¼‰
            strategy_name: ç­–ç•¥åç§°ï¼ˆå¯é€‰ï¼‰
        
        Returns:
            Dict: ä¸Šä¼ ç»“æœ
        """
        package_file = Path(package_path)
        
        # 1. éªŒè¯æ‰“åŒ…æ–‡ä»¶
        if not package_file.exists():
            raise FileNotFoundError(f"æ‰“åŒ…æ–‡ä»¶ä¸å­˜åœ¨: {package_path}")
        
        # 2. è¯»å–é…ç½®
        with zipfile.ZipFile(package_path, 'r') as zipf:
            config_str = zipf.read('config.json').decode('utf-8')
            config = json.loads(config_str)
        
        # 3. éªŒè¯ç­–ç•¥æ ¼å¼ï¼ˆç¡®ä¿æ˜¯PTradeæ ¼å¼ï¼‰
        if config.get('platform') != 'ptrade':
            raise ValueError("ç­–ç•¥æ ¼å¼é”™è¯¯ï¼Œéœ€è¦PTradeæ ¼å¼")
        
        # 4. ä½¿ç”¨PTradeéƒ¨ç½²å™¨ä¸Šä¼ 
        try:
            result = self.deployer.upload_strategy(
                strategy_name=strategy_name or config.get('strategy_name'),
                strategy_code_path=package_path,
                account_id=self.config.account_id
            )
            
            return {
                'success': True,
                'strategy_id': result.get('strategy_id'),
                'upload_time': result.get('upload_time'),
                'message': 'ç­–ç•¥ä¸Šä¼ æˆåŠŸï¼ˆPTradeå¹³å°ï¼‰'
            }
        except Excepti<CodeFromFile 
  filePath="code_library/007_Chapter7_Strategy_Development/7.6/code_7_6___init__.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
from core.qmt_integration import QMTConfig, QMTDeployer
from pathlib import Path

class QMTUploader:
    """QMTä¸Šä¼ å™¨ï¼ˆå›½é‡‘è¯åˆ¸ï¼‰"""
    
    def __init__(self, config: QMTConfig):
        """
        åˆå§‹åŒ–QMTä¸Šä¼ å™¨
        
        Args:
            config: QMTé…ç½®ï¼ˆåŒ…å«qmt_path, account_idç­‰ï¼‰
        """
        self.config = config
        self.deployer = QMTDeployer(config)
        self.qmt_path = Path(config.qmt_path)
        self.strategies_dir = self.qmt_path / "strategies"
        self.strategies_dir.mkdir(parents=True, exist_ok=True)
    
    def upload_strategy(
        self,
        package_path: str,
        strategy_name: str = None
    ) -> Dict[str, Any]:
        """
        ä¸Šä¼ ç­–ç•¥åˆ°QMTå¹³å°ï¼ˆå›½é‡‘è¯åˆ¸ï¼‰
        
        æ³¨æ„ï¼šä¸Šä¼ å‰éœ€è¦ç¡®ä¿ç­–ç•¥å·²ç»é€šè¿‡BulletTradeå›æµ‹éªŒè¯
        
        Args:
            package_path: æ‰“åŒ…æ–‡ä»¶è·¯å¾„ï¼ˆåŒ…å«å·²è½¬æ¢çš„QMTæ ¼å¼ç­–ç•¥ï¼‰
            strategy_name: ç­–ç•¥åç§°ï¼ˆå¯é€‰ï¼‰
        
        Returns:
            Dict: ä¸Šä¼ ç»“æœ
        """
        # 1. è§£å‹æ‰“åŒ…æ–‡ä»¶
        extract_dir = self.strategies_dir / f"temp_{datetime.now().strftime('%Y%m%d_%H%M%S')}"
        extract_dir.mkdir(exist_ok=True)
        
        with zipfile.ZipFile(package_path, 'r') as zipf:
            zipf.extractall(extract_dir)
        
        # 2. è¯»å–é…ç½®
        config_file = extract_dir / 'config.json'
        with open(config_file, 'r', encoding='utf-8') as f:
            config = json.load(f)
        
        # 3. éªŒè¯ç­–ç•¥æ ¼å¼ï¼ˆç¡®ä¿æ˜¯QMTæ ¼å¼ï¼‰
        if config.get('platform') != 'qmt':
            raise ValueError("ç­–ç•¥æ ¼å¼é”™è¯¯ï¼Œéœ€è¦QMTæ ¼å¼")
        
        # 4. å¤åˆ¶ç­–ç•¥æ–‡ä»¶åˆ°QMTç­–ç•¥ç›®å½•
        strategy_files = list(extract_dir.glob("*.py"))
        if not strategy_files:
            return {
                'success': False,
                'error': 'æœªæ‰¾åˆ°ç­–ç•¥æ–‡ä»¶'
            }
        
        strategy_file = strategy_files[0]
        target_name = strategy_name or config.get('strategy_name', strategy_file.stem)
        target_path = self.strategies_dir / f"{target_name}.py"
        
        shutil.copy2(strategy_file, target_path)
        
        # 5. ä½¿ç”¨QMTéƒ¨ç½²å™¨æ³¨å†Œç­–ç•¥
        try:
            result = self.deployer.register_strategy(
                strategy_path=str(target_path),
                strategy_name=target_name,
                account_id=self.config.account_id
            )
            
            # 6. æ¸…ç†ä¸´æ—¶æ–‡ä»¶
            shutil.rmtree(extract_dir)
            
            return {
                'success': True,
                'strategy_path': str(target_path),
                'strategy_id': result.get('strategy_id'),
                'message': 'ç­–ç•¥ä¸Šä¼ æˆåŠŸï¼ˆQMTå¹³å°ï¼‰'
            }
        except Exception as e:
            # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
            shutil.rmtree(extract_dir)
            return {
                'success': False,
     <CodeFromFile 
  filePath="code_library/007_Chapter7_Strategy_Development/7.6/code_7_6___init__.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
from datetime import datetime, timedelta
from typing import Dict, List, Any

class StrategyMonitor:
    """ç­–ç•¥ç›‘æ§å™¨"""
    
    def __init__(self, platform: str = "ptrade"):
        self.platform = platform
        self.monitoring_interval = 60  # ç›‘æ§é—´éš”ï¼ˆç§’ï¼‰
    
    def monitor_strategy(
        self,
        strategy_id: str
    ) -> Dict[str, Any]:
        """
        ç›‘æ§ç­–ç•¥
        
        Args:
            strategy_id: ç­–ç•¥ID
        
        Returns:
            Dict: ç›‘æ§æ•°æ®
        """
        # 1. è·å–è¿è¡ŒçŠ¶æ€
        status = self._get_strategy_status(strategy_id)
        
        # 2. è·å–æ€§èƒ½æŒ‡æ ‡
        performance = self._get_performance_metrics(strategy_id)
        
        # 3. æ£€æŸ¥å¼‚å¸¸
        alerts = self._check_alerts(strategy_id, status, performance)
        
        return {
            'strategy_id': strategy_id,
            'status': status,
            'performance': performance,
            'alerts': alerts,
            'timestamp': datetime.now().isoformat()
        }
    
    def _get_strategy_status(self, strategy_id: str) -> str:
        """è·å–ç­–ç•¥è¿è¡ŒçŠ¶æ€"""
        # ä»å¹³å°APIè·å–çŠ¶æ€
        if self.platform == "ptrade":
            # è°ƒç”¨PTrade API
            return self._get_ptrade_status(strategy_id)
        elif self.platform == "qmt":
            # è°ƒç”¨QMT API
            return self._get_qmt_status(strategy_id)
        else:
            return "unknown"
    
    def _get_performance_metrics(self, strategy_id: str) -> Dict[str, Any]:
        """è·å–æ€§èƒ½æŒ‡æ ‡"""
        return {
            'total_return': 0.0,
            'daily_return': 0.0,
            'sharpe_ratio': 0.0,
            'max_drawdown': 0.0,
            'current_positions': 0,
            'total_trades': 0
        }
    
    def _check_alerts(
        self,
        strategy_id: str,
        status: str,
        performance: Dict[str, Any]
    ) -> List[Dict[str, Any]]:
        """æ£€æŸ¥å¼‚å¸¸å¹¶ç”Ÿæˆå‘Šè­¦"""
        alerts = []
        
        # æ£€æŸ¥è¿è¡ŒçŠ¶æ€
        if status != 'running':
            alerts.append({
                'level': 'warning',
                'type': 'status',
                'message': f'ç­–ç•¥çŠ¶æ€å¼‚å¸¸: {status}',
                'timestamp': datetime.now().isoformat()
            })
        
        # æ£€æŸ¥å›æ’¤
        if performance.get('max_drawdown', 0) > 0.15:
            alerts.append({
                'level': 'error',
                'type': 'drawdown',
                'message': f'æœ€å¤§å›æ’¤è¶…è¿‡é™åˆ¶: {performance["max_drawdown"]:.2%}',
                'timestamp': datetime.now().isoformat()
            })
        
        # æ£€æŸ¥æ”¶ç›Š
        if performance.get('total_return', 0) < -0.10:
            alerts.append({
                'level': 'warning',
                'type': 'return',
                <CodeFromFile 
  filePath="code_library/007_Chapter7_Strategy_Development/7.6/code_7_6_track_performance.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
class PerformanceMonitor:
    """æ€§èƒ½ç›‘æ§å™¨"""
    
    def track_performance(
        self,
        strategy_id: str,
        metrics: Dict[str, Any]
    ):
        """è·Ÿè¸ªæ€§èƒ½æŒ‡æ ‡"""
        # è®°å½•æ€§èƒ½æ•°æ®
        performance_record = {
            'strategy_id': strategy_id,
            'timestamp': datetime.now().isoformat(),
            'metrics': metrics
        }
        
        # ä¿å­˜åˆ°æ•°æ®åº“æˆ–æ–‡ä»¶
        self._save_performance_record(performance_record)
    
    def get_performance_history(
        self,
        strategy_id: str,
        start_date: str = None,
        end_date: str = None
    ) -> List[Dict[str, Any]]:
        """è·å–æ€§èƒ½å†å²"""
        # ä»æ•°æ®åº“æŸ¥è¯¢å†å²æ•°æ®
        return []
```
-->e.now().isoformat()
            })
        
        # æ£€æŸ¥æ”¶ç›Š
        if performance.get('total_return', 0) < -0.10:
            alerts.append({
                'level': 'warning',
                'type': 'return',
                'message': f'æ€»æ”¶ç›Šä¸ºè´Ÿ: {performance["total_return"]:.2%}',
                'timestamp': datetime.now().isoformat()
            })
        
        return alerts
```

### æ€§èƒ½ç›‘æ§

```python
class PerformanceMonitor:
    """æ€§èƒ½ç›‘æ§å™¨"""
    
    def track_performance(
        self,
        strategy_id: str,
        metrics: Dict[str, Any]
    ):
        """è·Ÿè¸ªæ€§èƒ½æŒ‡æ ‡"""
        # è®°å½•æ€§èƒ½æ•°æ®
        performance_record = {
            'strategy_id': strategy_id,
            'timestamp': datetime.now().isoformat(),
            'metrics': metrics
        }
        
        # ä¿å­˜åˆ°æ•°æ®åº“æˆ–æ–‡ä»¶
        self._save_performance_record(performance_record)
    
    def get_performance_history(
        self,
        strategy_id: str,
        start_date: str = None,
        end_date: str = None
    ) -> List[Dict[str, Any]]:
        """è·å–æ€§èƒ½å†å²"""
        # ä»æ•°æ®åº“æŸ¥è¯¢å†å²æ•°æ®
        return []
```

## ğŸ”— ç›¸å…³ç« èŠ‚

- **7.5 ç­–ç•¥æµ‹è¯•**ï¼šäº†è§£ç­–ç•¥æµ‹è¯•ï¼Œéƒ¨ç½²å‰éœ€è¦æµ‹è¯•é€šè¿‡
- **ç¬¬9ç« ï¼šå¹³å°é›†æˆ**ï¼šäº†è§£å¹³å°é›†æˆçš„è¯¦ç»†å†…å®¹

## ğŸ’¡ å…³é”®è¦ç‚¹

1. **ç­–ç•¥æ‰“åŒ…**ï¼šç¡®ä¿ç­–ç•¥å’Œä¾èµ–å®Œæ•´æ‰“åŒ…
2. **ç­–ç•¥ä¸Šä¼ **ï¼šæŒ‰ç…§å¹³å°è¦æ±‚ä¸Šä¼ ç­–ç•¥
3. **ç­–ç•¥ç›‘æ§**ï¼šå®æ—¶ç›‘æ§ç­–ç•¥è¿è¡ŒçŠ¶æ€

## ğŸ”® æ€»ç»“ä¸å±•æœ›

<div class="summary-outlook">
  <h3>æœ¬èŠ‚å›é¡¾</h3>
  <p>æœ¬èŠ‚ç³»ç»Ÿä»‹ç»äº†ç­–ç•¥éƒ¨ç½²ç³»ç»Ÿï¼ŒåŒ…æ‹¬ç­–ç•¥æ‰“åŒ…ã€ç­–ç•¥ä¸Šä¼ å’Œç­–ç•¥ç›‘æ§ã€‚é€šè¿‡ç†è§£ç­–ç•¥éƒ¨ç½²çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡å¦‚ä½•å°†ç­–ç•¥éƒ¨ç½²åˆ°å®ç›˜äº¤æ˜“å¹³å°ã€‚</p>
  
  <h3>ä¸‹èŠ‚é¢„å‘Š</h3>
  <p>æŒæ¡äº†ç­–ç•¥éƒ¨ç½²åï¼Œä¸‹ä¸€èŠ‚å°†ä»‹ç»MCPå·¥å…·é›†æˆï¼ŒåŒ…æ‹¬trquant_generate_strategyã€trquant_analyze_backtestç­‰å·¥å…·çš„ä½¿ç”¨ã€‚é€šè¿‡ç†è§£MCPå·¥å…·åœ¨ç­–ç•¥å¼€å‘ä¸­çš„åº”ç”¨ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡å¦‚ä½•ä½¿ç”¨MCPå·¥å…·æå‡ç­–ç•¥å¼€å‘æ•ˆç‡ã€‚</p>
  
  <a href="/ashare-book6/007_Chapter7_Strategy_Development/7.7_MCP_Tool_Integration_CN" class="next-section">
    ç»§ç»­å­¦ä¹ ï¼š7.7 MCPå·¥å…·é›†æˆ â†’
  </a>
</div>

> **é€‚ç”¨ç‰ˆæœ¬**: v1.0.0+  
> **æœ€åæ›´æ–°**: 2025-12-12

