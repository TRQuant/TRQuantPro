---
title: "5.2 ç­›é€‰è§„åˆ™"
description: "æ·±å…¥è§£æç­›é€‰è§„åˆ™æœºåˆ¶ï¼ŒåŒ…æ‹¬åŸºç¡€ç­›é€‰ã€ä¸»çº¿ç­›é€‰ã€è¡Œä¸šç­›é€‰ã€æŠ€æœ¯ç­›é€‰å’Œè§„åˆ™ç»„åˆ"
lang: "zh-CN"
layout: "/src/layouts/HandbookLayout.astro"
currentBook: "ashare-book6"
updateDate: "2025-12-12"
---

# ğŸ” 5.2 ç­›é€‰è§„åˆ™

> **æ ¸å¿ƒæ‘˜è¦ï¼š**
> 
> æœ¬èŠ‚ç³»ç»Ÿä»‹ç»TRQuantç³»ç»Ÿçš„ç­›é€‰è§„åˆ™æœºåˆ¶ï¼ŒåŒ…æ‹¬åŸºç¡€ç­›é€‰è§„åˆ™ï¼ˆSTã€åœç‰Œã€æ¶¨è·Œåœè¿‡æ»¤ï¼‰ã€ä¸»çº¿ç­›é€‰è§„åˆ™ï¼ˆåŸºäºæŠ•èµ„ä¸»çº¿çš„è¡Œä¸šåŒ¹é…ï¼‰ã€è¡Œä¸šç­›é€‰è§„åˆ™ï¼ˆè¡Œä¸šåˆ†ç±»ã€è¡Œä¸šæƒé‡ï¼‰ã€æŠ€æœ¯ç­›é€‰è§„åˆ™ï¼ˆæŠ€æœ¯çªç ´ã€ä»·æ ¼è¶‹åŠ¿ã€æˆäº¤é‡é…åˆï¼‰å’Œè§„åˆ™ç»„åˆï¼ˆé€»è¾‘ç»„åˆã€ä¼˜å…ˆçº§è®¾ç½®ã€è§„åˆ™æƒé‡ï¼‰ã€‚é€šè¿‡ç†è§£å„ç±»ç­›é€‰è§„åˆ™çš„é…ç½®ã€æ‰§è¡Œé€»è¾‘å’Œç»„åˆæ–¹æ³•ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡ç­›é€‰è§„åˆ™çš„æ ¸å¿ƒå®ç°ï¼Œä¸ºæ„å»ºçµæ´»é«˜æ•ˆçš„è‚¡ç¥¨ç­›é€‰ç³»ç»Ÿå¥ å®šåŸºç¡€ã€‚

## ğŸ“‹ ç« èŠ‚æ¦‚è§ˆ

<script>
function scrollToSection(sectionId) {
  const element = document.getElementById(sectionId);
  if (element) {
    const headerOffset = 100;
    const elementPosition = element.getBoundingClientRect().top;
    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
    window.scrollTo({
      top: offsetPosition,
      behavior: 'smooth'
    });
  }
}
</script>

<div class="section-overview">
  <div class="section-item" onclick="scrollToSection('section-5-2-1')">
    <h4>ğŸ›¡ï¸ 5.2.1 åŸºç¡€ç­›é€‰è§„åˆ™</h4>
    <p>STã€åœç‰Œã€æ¶¨è·Œåœè¿‡æ»¤ã€æµåŠ¨æ€§ç­›é€‰</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-5-2-2')">
    <h4>ğŸ”¥ 5.2.2 ä¸»çº¿ç­›é€‰è§„åˆ™</h4>
    <p>åŸºäºæŠ•èµ„ä¸»çº¿çš„è¡Œä¸šåŒ¹é…ã€é¾™å¤´è‚¡ç­›é€‰</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-5-2-3')">
    <h4>ğŸ“Š 5.2.3 æŠ€æœ¯ç­›é€‰è§„åˆ™</h4>
    <p>æŠ€æœ¯çªç ´ã€ä»·æ ¼è¶‹åŠ¿ã€æˆäº¤é‡é…åˆã€å‡çº¿çªç ´</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-5-2-4')">
    <h4>ğŸ’¼ 5.2.4 åŸºæœ¬é¢ç­›é€‰è§„åˆ™</h4>
    <p>ROEã€å‡€åˆ©æ¶¦å¢é•¿ã€è¥æ”¶å¢é•¿ã€è´¢åŠ¡æŒ‡æ ‡ç­›é€‰</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-5-2-5')">
    <h4>ğŸ”€ 5.2.5 è§„åˆ™ç»„åˆä¸æ‰§è¡Œ</h4>
    <p>é€»è¾‘ç»„åˆã€ä¼˜å…ˆçº§è®¾ç½®ã€è§„åˆ™æƒé‡ã€è§„åˆ™æ‰§è¡Œå¼•æ“</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-5-2-6')">
    <h4>ğŸ› ï¸ 5.2.6 MCPå·¥å…·ä½¿ç”¨</h4>
    <p>ä½¿ç”¨MCPå·¥å…·æŸ¥è¯¢ç­›é€‰è§„åˆ™ç›¸å…³æ–‡æ¡£</p>
  </div>
</div>

## ğŸ¯ å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬èŠ‚å­¦ä¹ ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š

- **æŒæ¡åŸºç¡€ç­›é€‰**ï¼šç†è§£STã€åœç‰Œã€æ¶¨è·Œåœè¿‡æ»¤ã€æµåŠ¨æ€§ç­›é€‰çš„å®ç°æ–¹æ³•
- **ç†è§£ä¸»çº¿ç­›é€‰**ï¼šæŒæ¡åŸºäºæŠ•èµ„ä¸»çº¿çš„è¡Œä¸šåŒ¹é…å’Œé¾™å¤´è‚¡ç­›é€‰é€»è¾‘
- **ç†Ÿæ‚‰æŠ€æœ¯ç­›é€‰**ï¼šç†è§£æŠ€æœ¯çªç ´ã€ä»·æ ¼è¶‹åŠ¿ã€æˆäº¤é‡é…åˆã€å‡çº¿çªç ´çš„ç­›é€‰æ¡ä»¶
- **äº†è§£åŸºæœ¬é¢ç­›é€‰**ï¼šæŒæ¡ROEã€å‡€åˆ©æ¶¦å¢é•¿ã€è¥æ”¶å¢é•¿ç­‰è´¢åŠ¡æŒ‡æ ‡ç­›é€‰
- **å®ç°è§„åˆ™ç»„åˆ**ï¼šç†è§£é€»è¾‘ç»„åˆã€ä¼˜å…ˆçº§è®¾ç½®ã€è§„åˆ™æƒé‡å’Œè§„åˆ™æ‰§è¡Œå¼•æ“
- **ä½¿ç”¨MCPå·¥å…·**ï¼šæŒæ¡ä½¿ç”¨MCPå·¥å…·è¿›è¡Œç­›é€‰è§„åˆ™ç›¸å…³ç ”ç©¶

<h2 id="section-5-2-1">ğŸ›¡ï¸ 5.2.1 åŸºç¡€ç­›é€‰è§„åˆ™</h2>

åŸºç¡€ç­›é€‰è§„åˆ™ç”¨äºè¿‡æ»¤ä¸å¯äº¤æ˜“çš„è‚¡ç¥¨ï¼Œç¡®ä¿å€™é€‰æ± ä¸­çš„è‚¡ç¥¨éƒ½æ˜¯å¯äº¤æ˜“çš„ã€‚

### è®¾è®¡åŸåˆ™

<div class="key-points">
  <div class="key-point">
    <h4>ğŸ›¡ï¸ å®‰å…¨æ€§ä¼˜å…ˆ</h4>
    <p>ä¼˜å…ˆè¿‡æ»¤STã€åœç‰Œã€æ¶¨è·Œåœç­‰ä¸å¯äº¤æ˜“è‚¡ç¥¨</p>
  </div>
  <div class="key-point">
    <h4>ğŸ’§ æµåŠ¨æ€§ä¿éšœ</h4>
    <p>ç¡®ä¿è‚¡ç¥¨æœ‰è¶³å¤Ÿçš„æµåŠ¨æ€§ï¼Œé¿å…æ— æ³•æˆäº¤</p>
  </div>
  <div class="key-point">
    <h4>âš¡ é«˜æ•ˆæ‰§è¡Œ</h4>
    <p>åŸºç¡€ç­›é€‰è§„åˆ™æ‰§è¡Œé€Ÿåº¦å¿«ï¼Œä¼˜å…ˆæ‰§è¡Œ</p>
  </div>
  <div class="key-point">
    <h4>ğŸ”§ å¯é…ç½®</h4>
    <p>ç­›é€‰æ¡ä»¶å¯é…ç½®ï¼Œé€‚åº”ä¸åŒå¸‚åœºç¯å¢ƒ</p>
  </div>
</div>

### STè‚¡ç¥¨è¿‡æ»¤

è¿‡æ»¤STã€*STç­‰ç‰¹æ®Šå¤„ç†è‚¡ç¥¨ï¼š

```python
def filter_st_stocks(stocks: List[str], date: str = None) -> List[str]:
    """
    è¿‡æ»¤STè‚¡ç¥¨
    
    Args:
        stocks: è‚¡ç¥¨ä»£ç åˆ—è¡¨
        date: æ—¥æœŸ
    
    Returns:
        è¿‡æ»¤åçš„è‚¡ç¥¨ä»£ç åˆ—è¡¨
    """
    filtered = []
    
    for stock_code in stocks:
        # æ£€æŸ¥æ˜¯å¦ä¸ºSTè‚¡ç¥¨
        stock_info = get_stock_info(stock_code, date=date)
        
        # STè‚¡ç¥¨é€šå¸¸åç§°åŒ…å«"ST"æˆ–"*ST"
        if stock_info and ("ST" in stock_info.get("name", "") or 
                          "*ST" in stock_info.get("name", "")):
            continue
        
        # æ£€æŸ¥æ˜¯å¦è¢«STå¤„ç†
        if stock_info and stock_info.get("is_st", False):
            continue
        
        filtered.append(stock_code)
    
    return filtered
```

### åœç‰Œè‚¡ç¥¨è¿‡æ»¤

è¿‡æ»¤åœç‰Œè‚¡ç¥¨ï¼š

```python
def filter_suspended_stocks(stocks: List[str], date: str = None) -> List[str]:
    """
    è¿‡æ»¤åœç‰Œè‚¡ç¥¨
    
    Args:
        stocks: è‚¡ç¥¨ä»£ç åˆ—è¡¨
        date: æ—¥æœŸ
    
    Returns:
        è¿‡æ»¤åçš„è‚¡ç¥¨ä»£ç åˆ—è¡¨
    """
    filtered = []
    
    for stock_code in stocks:
        # æ£€æŸ¥æ˜¯å¦åœç‰Œ
        is_suspended = check_suspension(stock_code, date=date)
        
        if not is_suspended:
            filtered.append(stock_code)
    
    return filtered
```

### æ¶¨è·Œåœè¿‡æ»¤

è¿‡æ»¤æ¶¨åœæˆ–è·Œåœè‚¡ç¥¨ï¼ˆæ ¹æ®ç­–ç•¥éœ€æ±‚ï¼‰ï¼š

```python
def filter_limit_stocks(
    stocks: List[str], 
    date: str = None,
    filter_limit_up: bool = True,
    filter_limit_down: bool = True
) -> List[str]:
    """
    è¿‡æ»¤æ¶¨è·Œåœè‚¡ç¥¨
    
    Args:
        stocks: è‚¡ç¥¨ä»£ç åˆ—è¡¨
        date: æ—¥æœŸ
        filter_limit_up: æ˜¯å¦è¿‡æ»¤æ¶¨åœè‚¡ç¥¨
        filter_limit_down: æ˜¯å¦è¿‡æ»¤è·Œåœè‚¡ç¥¨
    
    Returns:
        è¿‡æ»¤åçš„è‚¡ç¥¨ä»£ç åˆ—è¡¨
    """
    filtered = []
    
    for stock_code in stocks:
        # è·å–æ¶¨è·Œå¹…
        price_data = get_price_data(stock_code, date=date)
        if price_data.empty:
            continue
        
        change_pct = price_data['change_pct'].iloc[-1]
        
        # æ¶¨åœï¼ˆæ¶¨è·Œå¹… >= 9.5%ï¼‰
        is_limit_up = change_pct >= 9.5
        
        # è·Œåœï¼ˆæ¶¨è·Œå¹… <= -9.5%ï¼‰
        is_limit_down = change_pct <= -9.5
        
        # æ ¹æ®ç­–ç•¥å†³å®šæ˜¯å¦è¿‡æ»¤
        if filter_limit_up and is_limit_up:
            continue
        if filter_limit_down and is_limit_down:
            continue
        
        filtered.append(stock_code)
    
    return filtered
```

### æµåŠ¨æ€§ç­›é€‰

ç­›é€‰æœ‰è¶³å¤ŸæµåŠ¨æ€§çš„è‚¡ç¥¨ï¼š

```python
def filter_by_liquidity(
    stocks: List[str],
    date: str = None,
    min_turnover: float = 0.01,  # æœ€å°æ¢æ‰‹ç‡
    min_volume: float = 1000000   # æœ€å°æˆäº¤é‡ï¼ˆæ‰‹ï¼‰
) -> List[str]:
    """
    æ ¹æ®æµåŠ¨æ€§ç­›é€‰è‚¡ç¥¨
    
    Args:
        stocks: è‚¡ç¥¨ä»£ç åˆ—è¡¨
        date: æ—¥æœŸ
        min_turnover: æœ€å°æ¢æ‰‹ç‡
        min_volume: æœ€å°æˆäº¤é‡ï¼ˆæ‰‹ï¼‰
    
    Returns:
        è¿‡æ»¤åçš„è‚¡ç¥¨ä»£ç åˆ—è¡¨
    """
    filtered = []
    
    for stock_code in stocks:
        # è·å–æˆäº¤é‡å’Œæ¢æ‰‹ç‡
        market_data = get_market_data(stock_code, date=date)
        if market_data.empty:
            continue
        
        volume = market_data['volume'].iloc[-1]
        turnover = market_data.get('turnover', 0)
        
        # æ£€æŸ¥æµåŠ¨æ€§
        if volume >= min_volume and turnover >= min_turnover:
            filtered.append(stock_code)
    
    return filtered
```

### ç»¼åˆåŸºç¡€ç­›é€‰

```python
class BasicFilter:
    """åŸºç¡€ç­›é€‰å™¨"""
    
    def __init__(self):
        self.filter_st = True
        self.filter_suspended = True
        self.filter_limit_up = False  # é»˜è®¤ä¸è¿‡æ»¤æ¶¨åœï¼ˆå¯èƒ½æ˜¯æœ‰æœºä¼šçš„è‚¡ç¥¨ï¼‰
        self.filter_limit_down = True  # è¿‡æ»¤è·Œåœ
        self.min_turnover = 0.01
        self.min_volume = 1000000
    
    def filter(self, stocks: List[str], date: str = None) -> List[str]:
        """
        æ‰§è¡ŒåŸºç¡€ç­›é€‰
        
        Args:
            stocks: è‚¡ç¥¨ä»£ç åˆ—è¡¨
            date: æ—¥æœŸ
        
        Returns:
            è¿‡æ»¤åçš„è‚¡ç¥¨ä»£ç åˆ—è¡¨
        """
        filtered = stocks
        
        # 1. è¿‡æ»¤STè‚¡ç¥¨
        if self.filter_st:
            filtered = filter_st_stocks(filtered, date=date)
        
        # 2. è¿‡æ»¤åœç‰Œè‚¡ç¥¨
        if self.filter_suspended:
            filtered = filter_suspended_stocks(filtered, date=date)
        
        # 3. è¿‡æ»¤æ¶¨è·Œåœè‚¡ç¥¨
        filtered = filter_limit_stocks(
            filtered,
            date=date,
            filter_limit_up=self.filter_limit_up,
            filter_limit_down=self.filter_limit_down
        )
        
        # 4. æµåŠ¨æ€§ç­›é€‰
        filtered = filter_by_liquidity(
            filtered,
            date=date,
            min_turnover=self.min_turnover,
            min_volume=self.min_volume
        )
        
        return filtered
```

<h2 id="section-5-2-2">ğŸ”¥ 5.2.2 ä¸»çº¿ç­›é€‰è§„åˆ™</h2>

ä¸»çº¿ç­›é€‰è§„åˆ™åŸºäºæŠ•èµ„ä¸»çº¿è¿›è¡Œç­›é€‰ï¼Œä¼˜å…ˆé€‰æ‹©ä¸ä¸»çº¿ç›¸å…³çš„è‚¡ç¥¨ã€‚

### è¡Œä¸šåŒ¹é…ç­›é€‰

æ ¹æ®ä¸»çº¿çš„ç›¸å…³è¡Œä¸šç­›é€‰è‚¡ç¥¨ï¼š

```python
def filter_by_mainline_industry(
    stocks: List[str],
    mainline: Dict,
    date: str = None
) -> List[str]:
    """
    æ ¹æ®ä¸»çº¿è¡Œä¸šç­›é€‰è‚¡ç¥¨
    
    Args:
        stocks: è‚¡ç¥¨ä»£ç åˆ—è¡¨
        mainline: ä¸»çº¿ä¿¡æ¯ï¼ˆåŒ…å«industrieså­—æ®µï¼‰
        date: æ—¥æœŸ
    
    Returns:
        è¿‡æ»¤åçš„è‚¡ç¥¨ä»£ç åˆ—è¡¨
    """
    # è·å–ä¸»çº¿ç›¸å…³è¡Œä¸š
    mainline_industries = mainline.get("industries", [])
    
    if not mainline_industries:
        return stocks
    
    filtered = []
    
    for stock_code in stocks:
        # è·å–è‚¡ç¥¨è¡Œä¸š
        stock_info = get_stock_info(stock_code, date=date)
        stock_industry = stock_info.get("industry", "")
        
        # æ£€æŸ¥æ˜¯å¦å±äºä¸»çº¿ç›¸å…³è¡Œä¸š
        if stock_industry in mainline_industries:
            filtered.append(stock_code)
    
    return filtered
```

### é¾™å¤´è‚¡ç­›é€‰

ç­›é€‰ä¸»çº¿ç›¸å…³çš„é¾™å¤´è‚¡ï¼š

```python
def filter_mainline_leaders(
    stocks: List[str],
    mainline: Dict,
    date: str = None,
    top_n: int = 10
) -> List[str]:
    """
    ç­›é€‰ä¸»çº¿é¾™å¤´è‚¡
    
    Args:
        stocks: è‚¡ç¥¨ä»£ç åˆ—è¡¨
        mainline: ä¸»çº¿ä¿¡æ¯ï¼ˆåŒ…å«stockså­—æ®µï¼‰
        date: æ—¥æœŸ
        top_n: è¿”å›å‰Nåªé¾™å¤´è‚¡
    
    Returns:
        é¾™å¤´è‚¡ä»£ç åˆ—è¡¨
    """
    # è·å–ä¸»çº¿é¾™å¤´è‚¡åˆ—è¡¨
    mainline_stocks = mainline.get("stocks", [])
    
    if not mainline_stocks:
        return []
    
    # ç­›é€‰å‡ºåœ¨å€™é€‰æ± ä¸­çš„é¾™å¤´è‚¡
    leaders = [s for s in stocks if s in mainline_stocks]
    
    # æŒ‰å¸‚å€¼æˆ–è¯„åˆ†æ’åºï¼Œå–å‰Nåª
    leaders_with_score = []
    for stock_code in leaders:
        stock_info = get_stock_info(stock_code, date=date)
        market_cap = stock_info.get("market_cap", 0)
        leaders_with_score.append((stock_code, market_cap))
    
    leaders_with_score.sort(key=lambda x: x[1], reverse=True)
    
    return [s[0] for s in leaders_with_score[:top_n]]
```

<h2 id="section-5-2-3">ğŸ“Š 5.2.3 æŠ€æœ¯ç­›é€‰è§„åˆ™</h2>

æŠ€æœ¯ç­›é€‰è§„åˆ™åŸºäºæŠ€æœ¯æŒ‡æ ‡è¿›è¡Œç­›é€‰ï¼Œè¯†åˆ«æŠ€æœ¯çªç ´ã€ä»·æ ¼è¶‹åŠ¿ç­‰ä¿¡å·ã€‚

### æŠ€æœ¯çªç ´ç­›é€‰

ç­›é€‰æŠ€æœ¯çªç ´è‚¡ç¥¨ï¼š

```python
def filter_technical_breakthrough(
    stocks: List[str],
    date: str = None
) -> List[Dict]:
    """
    æŠ€æœ¯çªç ´ç­›é€‰
    
    ç­›é€‰æ¡ä»¶ï¼š
    - æ¶¨åœ
    - æ”¾é‡çªç ´ï¼ˆæˆäº¤é‡æ”¾å¤§50%ä»¥ä¸Šï¼‰
    - ç«™ä¸Šå‡çº¿ï¼ˆå¦‚60æ—¥å‡çº¿ï¼‰
    - è¿ç»­ä¸Šæ¶¨ï¼ˆ3å¤©ä»¥ä¸Šï¼‰
    
    Args:
        stocks: è‚¡ç¥¨ä»£ç åˆ—è¡¨
        date: æ—¥æœŸ
    
    Returns:
        å€™é€‰è‚¡ç¥¨åˆ—è¡¨ï¼ˆåŒ…å«æŠ€æœ¯ä¿¡å·ï¼‰
    """
    candidates = []
    
    for stock_code in stocks:
        try:
            # è·å–ä»·æ ¼æ•°æ®ï¼ˆå‘å‰æ¨120å¤©ï¼‰
            end_dt = datetime.strptime(date, "%Y-%m-%d") if date else datetime.now()
            start_dt = end_dt - timedelta(days=120)
            start_date = start_dt.strftime("%Y-%m-%d")
            end_date = end_dt.strftime("%Y-%m-%d")
            
            price_data = get_price_data(stock_code, start_date=start_date, end_date=end_date)
            
            if price_data.empty or len(price_data) < 20:
                continue
            
            # è®¡ç®—æŠ€æœ¯æŒ‡æ ‡
            latest = price_data.iloc[-1]
            prev = price_data.iloc[-2] if len(price_data) > 1 else latest
            
            # æ¶¨è·Œå¹…
            change_pct = ((latest["close"] - prev["close"]) / prev["close"]) * 100 \
                        if prev["close"] > 0 else 0
            
            # æ˜¯å¦æ¶¨åœï¼ˆæ¶¨è·Œå¹… >= 9.5%ï¼‰
            is_limit_up = change_pct >= 9.5
            
            # æ˜¯å¦æ”¾é‡ï¼ˆæˆäº¤é‡è¾ƒå‰ä¸€æ—¥æ”¾å¤§50%ä»¥ä¸Šï¼‰
            volume_ratio = latest["volume"] / prev["volume"] if prev["volume"] > 0 else 1
            is_volume_breakout = volume_ratio >= 1.5
            
            # æ˜¯å¦ç«™ä¸Šå‡çº¿
            data_len = len(price_data)
            if data_len >= 60:
                ma60 = price_data["close"].tail(60).mean()
                is_ma_breakthrough = latest["close"] > ma60
            elif data_len >= 30:
                ma30 = price_data["close"].tail(30).mean()
                is_ma_breakthrough = latest["close"] > ma30
            else:
                ma_avg = price_data["close"].mean()
                is_ma_breakthrough = latest["close"] > ma_avg
            
            # è¿ç»­ä¸Šæ¶¨å¤©æ•°
            consecutive_up = 0
            for i in range(len(price_data) - 1, 0, -1):
                if price_data.iloc[i]["close"] > price_data.iloc[i - 1]["close"]:
                    consecutive_up += 1
                else:
                    break
            
            # æŠ€æœ¯é¢ç­›é€‰ï¼šè‡³å°‘æ»¡è¶³ä¸€ä¸ªæ¡ä»¶
            if is_limit_up or is_volume_breakout or is_ma_breakthrough or consecutive_up >= 3:
                candidate = {
                    "code": stock_code,
                    "is_limit_up": is_limit_up,
                    "is_volume_breakout": is_volume_breakout,
                    "is_ma_breakthrough": is_ma_breakthrough,
                    "consecutive_up_days": consecutive_up,
                    "change_pct": round(change_pct, 2)
                }
                candidates.append(candidate)
        
        except Exception as e:
            logger.debug(f"å¤„ç†è‚¡ç¥¨ {stock_code} æ—¶å‡ºé”™: {e}")
            continue
    
    return candidates
```

<h2 id="section-5-2-4">ğŸ’¼ 5.2.4 åŸºæœ¬é¢ç­›é€‰è§„åˆ™</h2>

åŸºæœ¬é¢ç­›é€‰è§„åˆ™åŸºäºè´¢åŠ¡æŒ‡æ ‡è¿›è¡Œç­›é€‰ï¼Œç¡®ä¿è‚¡ç¥¨çš„åŸºæœ¬é¢è´¨é‡ã€‚

### è´¢åŠ¡æŒ‡æ ‡ç­›é€‰

```python
def filter_fundamental(
    stocks: List[str],
    date: str = None,
    min_roe: float = 0.10,           # æœ€å°ROE
    min_profit_growth: float = 0.30, # æœ€å°å‡€åˆ©æ¶¦å¢é•¿ç‡
    min_revenue_growth: float = 0.20 # æœ€å°è¥æ”¶å¢é•¿ç‡
) -> List[str]:
    """
    è´¢åŠ¡å› å­ç­›é€‰
    
    ç­›é€‰æ¡ä»¶ï¼š
    - ROE > 10%
    - å‡€åˆ©æ¶¦åŒæ¯”å¢é•¿ > 30%
    - è¥æ”¶åŒæ¯”å¢é•¿ > 20%
    
    Args:
        stocks: è‚¡ç¥¨ä»£ç åˆ—è¡¨
        date: æ—¥æœŸ
        min_roe: æœ€å°ROE
        min_profit_growth: æœ€å°å‡€åˆ©æ¶¦å¢é•¿ç‡
        min_revenue_growth: æœ€å°è¥æ”¶å¢é•¿ç‡
    
    Returns:
        è¿‡æ»¤åçš„è‚¡ç¥¨ä»£ç åˆ—è¡¨
    """
    filtered = []
    
    # æ‰¹é‡è·å–è´¢åŠ¡æ•°æ®
    batch_size = 1000
    for i in range(0, len(stocks), batch_size):
        batch = stocks[i:i + batch_size]
        
        try:
            # è·å–è´¢åŠ¡æŒ‡æ ‡
            fundamental_data = get_fundamental_data(batch, date=date)
            
            for stock_code in batch:
                if stock_code not in fundamental_data:
                    continue
                
                data = fundamental_data[stock_code]
                
                # æ£€æŸ¥ROE
                roe = data.get("roe", 0)
                if roe < min_roe:
                    continue
                
                # æ£€æŸ¥å‡€åˆ©æ¶¦å¢é•¿ç‡
                profit_growth = data.get("profit_growth", 0)
                if profit_growth < min_profit_growth:
                    continue
                
                # æ£€æŸ¥è¥æ”¶å¢é•¿ç‡
                revenue_growth = data.get("revenue_growth", 0)
                if revenue_growth < min_revenue_growth:
                    continue
                
                filtered.append(stock_code)
        
        except Exception as e:
            logger.warning(f"è·å–è´¢åŠ¡æ•°æ®å¤±è´¥: {e}")
            continue
    
    return filtered
```

<h2 id="section-5-2-5">ğŸ”€ 5.2.5 è§„åˆ™ç»„åˆä¸æ‰§è¡Œ</h2>

è§„åˆ™ç»„åˆæ”¯æŒé€»è¾‘ç»„åˆï¼ˆANDã€ORã€NOTï¼‰ã€ä¼˜å…ˆçº§è®¾ç½®å’Œè§„åˆ™æƒé‡ã€‚

### è§„åˆ™å®šä¹‰

```python
from dataclasses import dataclass
from typing import List, Dict, Callable
from enum import Enum

class RuleLogic(Enum):
    """è§„åˆ™é€»è¾‘"""
    AND = "AND"  # æ‰€æœ‰è§„åˆ™å¿…é¡»æ»¡è¶³
    OR = "OR"    # ä»»ä¸€è§„åˆ™æ»¡è¶³å³å¯
    NOT = "NOT"  # è§„åˆ™ä¸æ»¡è¶³

@dataclass
class FilterRule:
    """ç­›é€‰è§„åˆ™"""
    name: str                    # è§„åˆ™åç§°
    rule_type: str              # è§„åˆ™ç±»å‹ï¼ˆbasic/mainline/technical/fundamentalï¼‰
    condition: Callable          # ç­›é€‰æ¡ä»¶å‡½æ•°
    weight: float = 1.0         # è§„åˆ™æƒé‡
    priority: int = 3            # ä¼˜å…ˆçº§ï¼ˆ1æœ€é«˜ï¼Œ5æœ€ä½ï¼‰
    logic: RuleLogic = RuleLogic.AND  # é€»è¾‘ç»„åˆ

class FilterEngine:
    """ç­›é€‰è§„åˆ™å¼•æ“"""
    
    def __init__(self):
        self.rules: List[FilterRule] = []
        self.basic_filter = BasicFilter()
    
    def add_rule(self, rule: FilterRule):
        """æ·»åŠ è§„åˆ™"""
        self.rules.append(rule)
    
    def filter(
        self,
        stocks: List[str],
        date: str = None,
        rule_combination: Dict = None
    ) -> List[str]:
        """
        æ‰§è¡Œç­›é€‰
        
        Args:
            stocks: è‚¡ç¥¨ä»£ç åˆ—è¡¨
            date: æ—¥æœŸ
            rule_combination: è§„åˆ™ç»„åˆé…ç½®
                {
                    "logic": "AND",  # é€»è¾‘ç»„åˆ
                    "weights": {...}  # è§„åˆ™æƒé‡
                }
        
        Returns:
            ç­›é€‰åçš„è‚¡ç¥¨ä»£ç åˆ—è¡¨
        """
        if rule_combination is None:
            rule_combination = {
                "logic": "AND",
                "weights": {}
            }
        
        # 1. åŸºç¡€ç­›é€‰ï¼ˆä¼˜å…ˆæ‰§è¡Œï¼‰
        filtered = self.basic_filter.filter(stocks, date=date)
        
        # 2. æŒ‰ä¼˜å…ˆçº§æ’åºè§„åˆ™
        sorted_rules = sorted(self.rules, key=lambda r: r.priority)
        
        # 3. æ‰§è¡Œè§„åˆ™
        logic = rule_combination.get("logic", "AND")
        weights = rule_combination.get("weights", {})
        
        if logic == "AND":
            # æ‰€æœ‰è§„åˆ™å¿…é¡»æ»¡è¶³
            for rule in sorted_rules:
                weight = weights.get(rule.name, rule.weight)
                filtered = self._apply_rule(filtered, rule, date=date, weight=weight)
        elif logic == "OR":
            # ä»»ä¸€è§„åˆ™æ»¡è¶³å³å¯ï¼ˆåˆå¹¶ç»“æœï¼‰
            all_results = []
            for rule in sorted_rules:
                weight = weights.get(rule.name, rule.weight)
                result = self._apply_rule(filtered, rule, date=date, weight=weight)
                all_results.extend(result)
            # å»é‡
            filtered = list(set(all_results))
        
        return filtered
    
    def _apply_rule(
        self,
        stocks: List[str],
        rule: FilterRule,
        date: str = None,
        weight: float = 1.0
    ) -> List[str]:
        """åº”ç”¨å•ä¸ªè§„åˆ™"""
        try:
            result = rule.condition(stocks, date=date)
            return result
        except Exception as e:
            logger.error(f"æ‰§è¡Œè§„åˆ™ {rule.name} å¤±è´¥: {e}")
            return stocks

# ä½¿ç”¨ç¤ºä¾‹
engine = FilterEngine()

# æ·»åŠ ä¸»çº¿ç­›é€‰è§„åˆ™
mainline_rule = FilterRule(
    name="ä¸»çº¿ç­›é€‰",
    rule_type="mainline",
    condition=lambda stocks, date: filter_by_mainline_industry(
        stocks, mainline_info, date
    ),
    weight=0.3,
    priority=1
)
engine.add_rule(mainline_rule)

# æ·»åŠ æŠ€æœ¯ç­›é€‰è§„åˆ™
tech_rule = FilterRule(
    name="æŠ€æœ¯çªç ´",
    rule_type="technical",
    condition=lambda stocks, date: [
        c["code"] for c in filter_technical_breakthrough(stocks, date)
    ],
    weight=0.3,
    priority=2
)
engine.add_rule(tech_rule)

# æ·»åŠ åŸºæœ¬é¢ç­›é€‰è§„åˆ™
fundamental_rule = FilterRule(
    name="åŸºæœ¬é¢ç­›é€‰",
    rule_type="fundamental",
    condition=lambda stocks, date: filter_fundamental(stocks, date),
    weight=0.4,
    priority=3
)
engine.add_rule(fundamental_rule)

# æ‰§è¡Œç­›é€‰
rule_combination = {
    "logic": "AND",
    "weights": {
        "ä¸»çº¿ç­›é€‰": 0.3,
        "æŠ€æœ¯çªç ´": 0.3,
        "åŸºæœ¬é¢ç­›é€‰": 0.4
    }
}

filtered_stocks = engine.filter(
    stocks=all_stocks,
    date="2024-12-12",
    rule_combination=rule_combination
)
```

<h2 id="section-5-2-6">ğŸ› ï¸ 5.2.6 MCPå·¥å…·ä½¿ç”¨</h2>

ç­›é€‰è§„åˆ™æ¨¡å—ä¸MCPå·¥å…·é›†æˆï¼Œæ”¯æŒçŸ¥è¯†åº“æŸ¥è¯¢ã€æ•°æ®æ”¶é›†ç­‰åŠŸèƒ½ã€‚

### KB MCP Serverå·¥å…·

#### kb.query

æŸ¥è¯¢çŸ¥è¯†åº“ï¼Œè·å–ç­›é€‰è§„åˆ™ç›¸å…³çš„æ–‡æ¡£å’Œä»£ç ï¼š

```python
# æŸ¥è¯¢ç­›é€‰è§„åˆ™ç›¸å…³çš„çŸ¥è¯†
results = mcp_client.call_tool(
    "kb.query",
    {
        "query": "ç­›é€‰è§„åˆ™ æŠ€æœ¯çªç ´ åŸºæœ¬é¢ç­›é€‰ è§„åˆ™ç»„åˆ",
        "collection": "manual_kb",
        "top_k": 5
    }
)
```

### Data Collector MCPå·¥å…·

#### data_collector.crawl_web

çˆ¬å–ç½‘é¡µå†…å®¹ï¼Œæ”¶é›†ç­›é€‰è§„åˆ™ç›¸å…³çš„ç ”ç©¶èµ„æ–™ï¼š

```python
# çˆ¬å–ç­›é€‰è§„åˆ™ç›¸å…³ç½‘é¡µ
content = mcp_client.call_tool(
    "data_collector.crawl_web",
    {
        "url": "https://example.com/filtering-rules",
        "extract_text": True
    }
)
```

## ğŸ”— ç›¸å…³ç« èŠ‚

- **ç¬¬2ç« ï¼šæ•°æ®æºæ¨¡å—** - äº†è§£æ•°æ®è·å–æœºåˆ¶ï¼Œä¸ºç­›é€‰è§„åˆ™æä¾›æ•°æ®æ”¯æ’‘
- **ç¬¬3ç« ï¼šå¸‚åœºåˆ†ææ¨¡å—** - å¸‚åœºåˆ†æç»“æœç”¨äºç­›é€‰æ¡ä»¶è°ƒæ•´
- **ç¬¬4ç« ï¼šæŠ•èµ„ä¸»çº¿è¯†åˆ«** - ä¸»çº¿è¯†åˆ«ç»“æœç”¨äºä¸»çº¿ç­›é€‰
- **ç¬¬5ç« ï¼šå€™é€‰æ± æ„å»º** - äº†è§£å€™é€‰æ± æ„å»ºæ¨¡å—çš„æ•´ä½“è®¾è®¡
- **ç¬¬5.1èŠ‚ï¼šè‚¡ç¥¨æ± ç®¡ç†** - è‚¡ç¥¨æ± ç®¡ç†ä¸ºç­›é€‰è§„åˆ™æä¾›è‚¡ç¥¨æ± 
- **ç¬¬6ç« ï¼šå› å­åº“** - ç­›é€‰åçš„è‚¡ç¥¨ç”¨äºå› å­è®¡ç®—
- **ç¬¬10ç« ï¼šå¼€å‘æŒ‡å—** - äº†è§£ç­›é€‰è§„åˆ™æ¨¡å—çš„å¼€å‘è§„èŒƒ

## ğŸ”® æ€»ç»“ä¸å±•æœ›

<div class="summary-outlook">
  <h3>æœ¬èŠ‚å›é¡¾</h3>
  <p>æœ¬èŠ‚ç³»ç»Ÿä»‹ç»äº†ç­›é€‰è§„åˆ™å¼•æ“ï¼ŒåŒ…æ‹¬åŸºç¡€ç­›é€‰ã€ä¸»çº¿ç­›é€‰ã€è¡Œä¸šç­›é€‰ã€æŠ€æœ¯ç­›é€‰å’Œè§„åˆ™ç»„åˆé€»è¾‘ã€‚é€šè¿‡ç†è§£ç­›é€‰è§„åˆ™å¼•æ“çš„å®ç°ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡å¦‚ä½•ä»è‚¡ç¥¨æ± ä¸­ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„å€™é€‰è‚¡ç¥¨ï¼Œä¸ºå€™é€‰æ± æ„å»ºæä¾›æ ¸å¿ƒç­›é€‰èƒ½åŠ›ã€‚</p>
  
  <h3>ä¸‹èŠ‚é¢„å‘Š</h3>
  <p>æŒæ¡äº†ç­›é€‰è§„åˆ™åï¼Œä¸‹ä¸€èŠ‚å°†ä»‹ç»è‚¡ç¥¨è¯„åˆ†ç³»ç»Ÿï¼ŒåŒ…æ‹¬å¤šå› å­è¯„åˆ†ã€ç»¼åˆè¯„åˆ†è®¡ç®—å’Œè¯„åˆ†æ’åºæ–¹æ³•ã€‚é€šè¿‡ç†è§£è‚¡ç¥¨è¯„åˆ†ç³»ç»Ÿçš„å®ç°ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡å¦‚ä½•å¯¹å€™é€‰è‚¡ç¥¨è¿›è¡Œç»¼åˆè¯„åˆ†ã€‚</p>
  
  <a href="/ashare-book6/005_Chapter5_Candidate_Pool/5.3_Stock_Scoring_CN" class="next-section">
    ç»§ç»­å­¦ä¹ ï¼š5.3 è‚¡ç¥¨è¯„åˆ† â†’
  </a>
</div>

> **é€‚ç”¨ç‰ˆæœ¬**: v1.0.0+  
> **æœ€åæ›´æ–°**: 2025-12-12
