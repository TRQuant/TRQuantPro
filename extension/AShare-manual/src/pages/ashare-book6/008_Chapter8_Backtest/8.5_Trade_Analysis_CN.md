---
title: "8.5 äº¤æ˜“åˆ†æ"
description: "æ·±å…¥è§£æäº¤æ˜“åˆ†æç³»ç»Ÿï¼ŒåŒ…æ‹¬äº¤æ˜“æ¬¡æ•°ã€æ¢æ‰‹ç‡ã€èƒœç‡ã€ç›ˆäºæ¯”ã€æŒä»“åˆ†æç­‰æ ¸å¿ƒæŠ€æœ¯"
lang: "zh-CN"
layout: "/src/layouts/HandbookLayout.astro"
currentBook: "ashare-book6"
updateDate: "2025-12-12"
---

# ğŸ“ˆ 8.5 äº¤æ˜“åˆ†æ

> **æ ¸å¿ƒæ‘˜è¦ï¼š**
> 
> æœ¬èŠ‚è¯¦ç»†ä»‹ç»TRQuantç³»ç»Ÿçš„äº¤æ˜“åˆ†æåŠŸèƒ½ï¼ŒåŸºäºBulletTradeå›æµ‹ç»“æœè¿›è¡Œå…¨é¢çš„äº¤æ˜“è¯„ä¼°ã€‚åŒ…æ‹¬äº¤æ˜“æ¬¡æ•°ã€æ¢æ‰‹ç‡ã€èƒœç‡ã€ç›ˆäºæ¯”ã€æŒä»“åˆ†æã€äº¤æ˜“æˆæœ¬åˆ†æç­‰å¤šä¸ªç»´åº¦çš„åˆ†æã€‚é€šè¿‡ç†è§£äº¤æ˜“åˆ†æçš„æ ¸å¿ƒæŠ€æœ¯ï¼Œå¸®åŠ©å¼€å‘è€…å…¨é¢è¯„ä¼°ç­–ç•¥çš„äº¤æ˜“è¡¨ç°ï¼Œè¯†åˆ«äº¤æ˜“ç‰¹å¾å’Œäº¤æ˜“é—®é¢˜ï¼Œä¸ºç­–ç•¥ä¼˜åŒ–æä¾›ä¾æ®ã€‚

äº¤æ˜“åˆ†ææ˜¯å›æµ‹åˆ†æçš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œè´Ÿè´£å…¨é¢è¯„ä¼°ç­–ç•¥çš„äº¤æ˜“è¡¨ç°ï¼Œä»BulletTradeå›æµ‹ç»“æœä¸­æå–äº¤æ˜“è®°å½•ï¼Œè¿›è¡Œå¤šç»´åº¦åˆ†æã€‚

## ğŸ“‹ ç« èŠ‚æ¦‚è§ˆ

<script>
function scrollToSection(sectionId) {
  const element = document.getElementById(sectionId);
  if (element) {
    const headerOffset = 100;
    const elementPosition = element.getBoundingClientRect().top;
    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
    window.scrollTo({
      top: offsetPosition,
      behavior: 'smooth'
    });
  }
}
</script>

<div class="section-overview">
  <div class="section-item" onclick="scrollToSection('section-8-5-1')">
    <h4>ğŸ“Š 8.5.1 äº¤æ˜“ç»Ÿè®¡</h4>
    <p>äº¤æ˜“æ¬¡æ•°ã€ä¹°å…¥æ¬¡æ•°ã€å–å‡ºæ¬¡æ•°ã€äº¤æ˜“é¢‘ç‡ã€äº¤æ˜“åˆ†å¸ƒ</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-8-5-2')">
    <h4>ğŸ”„ 8.5.2 æ¢æ‰‹ç‡åˆ†æ</h4>
    <p>æ¢æ‰‹ç‡è®¡ç®—ã€æ¢æ‰‹ç‡åˆ†è§£ã€æ¢æ‰‹ç‡ç¨³å®šæ€§ã€æ¢æ‰‹ç‡ä¼˜åŒ–</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-8-5-3')">
    <h4>ğŸ¯ 8.5.3 èƒœç‡åˆ†æ</h4>
    <p>èƒœç‡è®¡ç®—ã€ç›ˆäºæ¯”ã€å¹³å‡ç›ˆåˆ©ã€å¹³å‡äºæŸã€ç›ˆäºåˆ†å¸ƒ</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-8-5-4')">
    <h4>ğŸ“¦ 8.5.4 æŒä»“åˆ†æ</h4>
    <p>å¹³å‡æŒä»“å‘¨æœŸã€æŒä»“åˆ†å¸ƒã€æŒä»“é›†ä¸­åº¦ã€æŒä»“è½®æ¢</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-8-5-5')">
    <h4>ğŸ’° 8.5.5 äº¤æ˜“æˆæœ¬åˆ†æ</h4>
    <p>æ‰‹ç»­è´¹ç»Ÿè®¡ã€æ»‘ç‚¹æˆæœ¬ã€æ€»äº¤æ˜“æˆæœ¬ã€æˆæœ¬å æ¯”</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-8-5-6')">
    <h4>ğŸ“Š 8.5.6 äº¤æ˜“å¯è§†åŒ–</h4>
    <p>äº¤æ˜“åˆ†å¸ƒå›¾ã€ç›ˆäºåˆ†å¸ƒå›¾ã€æŒä»“å‘¨æœŸå›¾ã€äº¤æ˜“æˆæœ¬å›¾</p>
  </div>
</div>

## ğŸ¯ å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬èŠ‚å­¦ä¹ ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š

- **ç»Ÿè®¡äº¤æ˜“æ¬¡æ•°**ï¼šæŒæ¡äº¤æ˜“æ¬¡æ•°çš„ç»Ÿè®¡æ–¹æ³•å’Œäº¤æ˜“é¢‘ç‡åˆ†æ
- **åˆ†ææ¢æ‰‹ç‡**ï¼šç†è§£æ¢æ‰‹ç‡çš„è®¡ç®—å’Œæ¢æ‰‹ç‡åˆ†è§£æ–¹æ³•
- **è®¡ç®—èƒœç‡**ï¼šæŒæ¡èƒœç‡å’Œç›ˆäºæ¯”çš„è®¡ç®—æ–¹æ³•
- **åˆ†ææŒä»“**ï¼šç†è§£å¹³å‡æŒä»“å‘¨æœŸå’ŒæŒä»“é›†ä¸­åº¦çš„åˆ†ææ–¹æ³•
- **è¯„ä¼°äº¤æ˜“æˆæœ¬**ï¼šæŒæ¡äº¤æ˜“æˆæœ¬çš„ç»Ÿè®¡å’Œæˆæœ¬å æ¯”åˆ†ææ–¹æ³•
- **å¯è§†åŒ–äº¤æ˜“**ï¼šç†è§£äº¤æ˜“å¯è§†åŒ–çš„æ–¹æ³•å’Œå›¾è¡¨ç±»å‹

## ğŸ“š æ ¸å¿ƒæ¦‚å¿µ

### æ¨¡å—å®šä½

- **å·¥ä½œæµä½ç½®**ï¼šæ­¥éª¤7 - ğŸ”„ å›æµ‹éªŒè¯ï¼ˆå›æµ‹åˆ†æå™¨ä¹‹åï¼‰
- **æ ¸å¿ƒèŒè´£**ï¼šäº¤æ˜“ç»Ÿè®¡ã€æ¢æ‰‹ç‡åˆ†æã€èƒœç‡åˆ†æã€æŒä»“åˆ†æã€äº¤æ˜“æˆæœ¬åˆ†æ
- **æœåŠ¡å¯¹è±¡**ï¼šç­–ç•¥ä¼˜åŒ–ã€å›æµ‹æŠ¥å‘Šã€äº¤æ˜“æ‰§è¡Œ
- **æ•°æ®æ¥æº**ï¼šBulletTradeå›æµ‹ç»“æœï¼ˆäº¤æ˜“è®°å½•ã€æŒä»“è®°å½•ï¼‰

### æŠ€æœ¯æ ˆ

äº¤æ˜“åˆ†æåŸºäºä»¥ä¸‹æŠ€æœ¯ï¼š

1. **æ•°æ®æå–**ï¼šä»BulletTradeå›æµ‹ç»“æœä¸­æå–äº¤æ˜“è®°å½•å’ŒæŒä»“è®°å½•
2. **ç»Ÿè®¡åˆ†æ**ï¼šä½¿ç”¨Pandasè¿›è¡Œäº¤æ˜“æ•°æ®ç»Ÿè®¡å’Œåˆ†æ
3. **æˆæœ¬è®¡ç®—**ï¼šè®¡ç®—æ‰‹ç»­è´¹ã€æ»‘ç‚¹ç­‰äº¤æ˜“æˆæœ¬
4. **å¯è§†åŒ–**ï¼šä½¿ç”¨Matplotlibå’ŒPlotlyç”Ÿæˆäº¤æ˜“åˆ†æå›¾è¡¨

<h2 id="section-8-5-1">ğŸ“Š 8.5.1 äº¤æ˜“ç»Ÿè®¡</h2>

äº¤æ˜“ç»Ÿè®¡è¯„ä¼°ç­–ç•¥çš„äº¤æ˜“é¢‘ç‡å’Œäº¤æ˜“åˆ†å¸ƒã€‚

### ä»BulletTradeç»“æœæå–äº¤æ˜“è®°å½•

<CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.5/code_8_5_extract_trades_from_bullettrade.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
from core.bullettrade import BulletTradeEngine, BTConfig

# æ‰§è¡ŒBulletTradeå›æµ‹
bt_engine =<CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.5/code_8_5_analyze_trade_statistics.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
import pandas as pd
import numpy as np
from typing import List, Dict, Any
from dataclasses import dataclass

@dataclass
class TradeRecord:
    """äº¤æ˜“è®°å½•"""
    date: str
    security: str
    action: str  # 'buy' or 'sell'
    price: float
    amount: int
    commission: float
    pnl: float = 0.0  # å–å‡ºæ—¶çš„ç›ˆäº

class TradeStatisticsAnalyzer:
    """äº¤æ˜“ç»Ÿè®¡åˆ†æå™¨"""
    
    def analyze_trade_statistics(
        self,
        trades: List[TradeRecord],
        equity_curve: pd.DataFrame = None
    ) -> Dict[str, Any]:
        """
        åˆ†æäº¤æ˜“ç»Ÿè®¡
        
        Args:
            trades: äº¤æ˜“è®°å½•åˆ—è¡¨
            equity_curve: å‡€å€¼æ›²çº¿ï¼ˆç”¨äºè®¡ç®—äº¤æ˜“é¢‘ç‡ï¼‰
        
        Returns:
            Dict: äº¤æ˜“ç»Ÿè®¡ç»“æœ
        """
        if not trades:
            return {}
        
        # è½¬æ¢ä¸ºDataFrame
        trades_df = pd.DataFrame([
            {
                'date': t.date,
                'security': t.security,
                'action': t.action,
                'price': t.price,
                'amount': t.amount,
                'commission': t.commission,
                'pnl': t.pnl,
                'value': t.price * t.amount
            }
            for t in trades
        ])
        
        # åŸºæœ¬ç»Ÿè®¡
        total_trades = len(trades_df)
        buy_trades = len(trades_df[trades_df['action'] == 'buy'])
        sell_trades = len(trades_df[trades_df['action'] == 'sell'])
        
        # äº¤æ˜“é¢‘ç‡
        if equity_curve is not None:
            equity_curve = equity_curve.sort_values('date')
            start_date = pd.to_datetime(equity_curve['date'].iloc[0])
            end_date = pd.to_datetime(equity_curve['date'].iloc[-1])
            days = (end_date - start_date).days
            trades_per_day = total_trades / days if days > 0 else 0
            trades_per_month = total_trades / (days / 30) if days > 0 else 0
        else:
            trades_per_day = 0
            trades_per_month = 0
        
        # äº¤æ˜“åˆ†å¸ƒï¼ˆæŒ‰æ—¥æœŸï¼‰
        trades_df['date'] = pd.to_datetime(trades_df['date'])
        trades_by_date = trades_df.groupby(trades_df['date'].dt.date).size()
        
        # äº¤æ˜“åˆ†å¸ƒï¼ˆæŒ‰è‚¡ç¥¨ï¼‰
        trades_by_security = trades_df.groupby('security').size()
        
        # äº¤æ˜“åˆ†å¸ƒï¼ˆæŒ‰æœˆä»½ï¼‰
        trades_df['year_month'] = trades_df['date'].dt.to_period('M')
        trades_by_month = trades_df.groupby('year_month').size()
        
        return {
            'total_trades': total_trades,
            'buy_trades': buy_trades,
            'sell_trades': sell_trades,
            'trades_per_day': trades_per_day,
            'trades_per_month': trades_per_month,
            'trades_by_date': trades_by_date.to_dict(),
            'trades_by_security': trades_by_security.to_dict(),
            'trades_by_month': trades_by_month.to_dict(),
            'most_traded_security': trades_by_security.idxmax() if len(trades_by_security) > 0 else None,
       <CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.5/code_8_5_analyze_turnover.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
class TurnoverAnalyzer:
    """æ¢æ‰‹ç‡åˆ†æå™¨"""
    
    def analyze_turnover(
        self,
        trades: List[TradeRecord],
        equity_curve: pd.DataFrame
    ) -> Dict[str, Any]:
        """
        åˆ†ææ¢æ‰‹ç‡
        
        Args:
            trades: äº¤æ˜“è®°å½•åˆ—è¡¨
            equity_curve: å‡€å€¼æ›²çº¿
        
        Returns:
            Dict: æ¢æ‰‹ç‡åˆ†æç»“æœ
        """
        trades_df = pd.DataFrame([
            {
                'date': t.date,
                'action': t.action,
                'value': t.price * t.amount
            }
            for t in trades
        ])
        
        # æ€»äº¤æ˜“é‡‘é¢
        total_trade_value = trades_df['value'].sum()
        
        # å¹³å‡èµ„äº§
        equity_curve = equity_curve.sort_values('date')
        avg_equity = equity_curve['equity'].mean()
        
        # æ¢æ‰‹ç‡ = æ€»äº¤æ˜“é‡‘é¢ / å¹³å‡èµ„äº§
        turnover_rate = total_trade_value / avg_equity if avg_equity > 0 else 0
        
        # å¹´åŒ–æ¢æ‰‹ç‡
        start_date = pd.to_datetime(equity_curve['date'].iloc[0])
        end_date = pd.to_datetime(equity_curve['date'].iloc[-1])
        days = (end_date - start_date).days
        years = days / 365.25
        annual_turnover = turnover_rate / years if years > 0 else 0
        
        # æŒ‰æ—¶é—´æ®µåˆ†è§£æ¢æ‰‹ç‡
        trades_df['date'] = pd.to_datetime(trades_df['date'])
        trades_df['year_month'] = trades_df['date'].dt.to_period('M')
        monthly_turnover = self._calculate_monthly_turnover(trades_df, equity_curve)
        
        return {
            'total_trade_value': total_trade_value,
            'avg_equity': avg_equity,
            'turnover_rate': turnover_rate,
            'annual_turnover': annual_turnover,
            'monthly_turnover': monthly_turnover
        }
    
    def _calculate_monthly_turnover(
        self,
        trades_df: pd.DataFrame,
        equity_curve: pd.DataFrame
    ) -> Dict[str, float]:
        """è®¡ç®—æœˆåº¦æ¢æ‰‹ç‡"""
        monthly_turnover = {}
        
        for year_month in trades_df['year_month'].unique():
            month_trades = trades_df[trades_df['year_month'] == year_month]
            month_trade_value = month_trades['value'].sum()
            
            # è¯¥æœˆçš„å¹³å‡èµ„äº§
            equity_curve['year_month'] = pd.to_datetime(equity_curve['date']).dt.to_period('M')
            month_equity = equity_curve[equity_curve['year_month'] == year_month]['equity'].mean()
            
            month_turnover = month_trade_value / month_equity if month_equity > 0 else 0
            <CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.5/code_8_5_analyze_win_rate.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
class WinRateAnalyzer:
    """èƒœç‡åˆ†æå™¨"""
    
    def analyze_win_rate(
        self,
        trades: List[TradeRecord]
    ) -> Dict[str, Any]:
        """
        åˆ†æèƒœç‡
        
        Args:
            trades: äº¤æ˜“è®°å½•åˆ—è¡¨
        
        Returns:
            Dict: èƒœç‡åˆ†æç»“æœ
        """
        # åªè€ƒè™‘å–å‡ºäº¤æ˜“
        sell_trades = [t for t in trades if t.action == 'sell']
        
        if not sell_trades:
            return {}
        
        # ç›ˆåˆ©å’ŒäºæŸäº¤æ˜“
        winning_trades = [t for t in sell_trades if t.pnl > 0]
        losing_trades = [t for t in sell_trades if t.pnl < 0]
        breakeven_trades = [t for t in sell_trades if t.pnl == 0]
        
        # èƒœç‡
        win_rate = len(winning_trades) / len(sell_trades) if len(sell_trades) > 0 else 0
        
        # å¹³å‡ç›ˆåˆ©å’Œå¹³å‡äºæŸ
        avg_profit = np.mean([t.pnl for t in winning_trades]) if winning_trades else 0
        avg_loss = abs(np.mean([t.pnl for t in losing_trades])) if losing_trades else 0
        
        # ç›ˆäºæ¯”
        profit_loss_ratio = avg_profit / avg_loss if avg_loss > 0 else 0
        
        # æ€»ç›ˆåˆ©å’Œæ€»äºæŸ
        total_profit = sum([t.pnl for t in winning_trades])
        total_loss = abs(sum([t.pnl for t in losing_trades]))
        
        # ç›ˆäºåˆ†å¸ƒ
        pnl_distribution = self._analyze_pnl_distribution(sell_trades)
        
        return {
            'total_trades': len(sell_trades),
            'winning_trades': len(winning_trades),
            'losing_trades': len(losing_trades),
            'breakeven_trades': len(breakeven_trades),
            'win_rate': win_rate,
            'avg_profit': avg_profit,
            'avg_loss': avg_loss,
            'profit_loss_ratio': profit_loss_ratio,
            'total_profit': total_profit,
            'total_loss': total_loss,
            'net_pnl': total_profit - total_loss,
            'pnl_distribution': pnl_distribution
        }
    
    def _analyze_pnl_distribution(self, trades: List[TradeRecord]) -> Dict[str, int]:
        """åˆ†æç›ˆäºåˆ†å¸ƒ"""
        pnls = [t.pnl for t in trades]
        
        return {
            '>10%': len([p for p in pnls if p > 0.1]),
            '5%-10%': len([p for p in pnls if 0.05 < p <= 0.1]),
            '0-5%': len([p for p in pnls if 0 < p <= 0.05]),
            '0': len([p for p in pnls if p == 0]),
            '-5%-0': len([p for p in pnls if -0.05 <= p < 0]),
            '-10%--5%': len([p for p in p<CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.5/code_8_5_analyze_positions.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
class PositionAnalyzer:
    """æŒä»“åˆ†æå™¨"""
    
    def analyze_positions(
        self,
        trades: List[TradeRecord]
    ) -> Dict[str, Any]:
        """
        åˆ†ææŒä»“
        
        Args:
            trades: äº¤æ˜“è®°å½•åˆ—è¡¨
        
        Returns:
            Dict: æŒä»“åˆ†æç»“æœ
        """
        trades_df = pd.DataFrame([
            {
                'date': pd.to_datetime(t.date),
                'security': t.security,
                'action': t.action,
                'amount': t.amount if t.action == 'buy' else -t.amount
            }
            for t in trades
        ])
        
        # è®¡ç®—æŒä»“å‘¨æœŸ
        holding_periods = self._calculate_holding_periods(trades_df)
        
        # æŒä»“é›†ä¸­åº¦ï¼ˆåŒæ—¶æŒæœ‰çš„è‚¡ç¥¨æ•°é‡ï¼‰
        position_concentration = self._analyze_position_concentration(trades_df)
        
        # æŒä»“è½®æ¢ï¼ˆè‚¡ç¥¨æ›´æ¢é¢‘ç‡ï¼‰
        position_rotation = self._analyze_position_rotation(trades_df)
        
        return {
            'avg_holding_period': np.mean(holding_periods) if holding_periods else 0,
            'median_holding_period': np.median(holding_periods) if holding_periods else 0,
            'max_holding_period': max(holding_periods) if holding_periods else 0,
            'min_holding_period': min(holding_periods) if holding_periods else 0,
            'holding_periods': holding_periods,
            'position_concentration': position_concentration,
            'position_rotation': position_rotation
        }
    
    def _calculate_holding_periods(self, trades_df: pd.DataFrame) -> List[int]:
        """è®¡ç®—æŒä»“å‘¨æœŸ"""
        holding_periods = []
        
        for security in trades_df['security'].unique():
            security_trades = trades_df[trades_df['security'] == security].sort_values('date')
            
            # é…å¯¹ä¹°å…¥å’Œå–å‡º
            buy_dates = security_trades[security_trades['amount'] > 0]['date'].tolist()
            sell_dates = security_trades[security_trades['amount'] < 0]['date'].tolist()
            
            for buy_date, sell_date in zip(buy_dates, sell_dates):
                period = (sell_date - buy_date).days
                if period > 0:
                    holding_periods.append(period)
        
        return holding_periods
    
    def _analyze_position_concentration(self, trades_df: pd.DataFrame) -> Dict[str, Any]:
        """åˆ†ææŒä»“é›†ä¸­åº¦"""
        # æŒ‰æ—¥æœŸç»Ÿè®¡æŒä»“è‚¡ç¥¨æ•°é‡
        trades_df = trades_df.sort_values('date')
        position_counts = []
        
        current_positions = {}
        for _, trade in trades_df.iterrows():
            security = trade['security']
            amount = trade['amount']
            
            if security not in current_positions:
                current_positions[security] = 0
            current_positions[security] += amount
            
            if current_positions[security] <= 0:
                del current_positions[security]
            
            position_counts.append(len(current_positions))
        
        return {
            'avg_position_count': np.mean(position_counts) if position_counts else 0,
            'max_position_count': max(position_counts) if position_counts else 0,
            'min_position_count': min(position_counts) if position_counts else 0
        }
    
    def _analyze_position_rotation(self, trades_df: pd.DataFrame) -> Dict[str, Any]:
        """åˆ†ææŒä»“è½®æ¢"""
        # è®¡ç®—æŒä»“æ›´æ¢é¢‘ç‡
        trades_df = trades_df.sort_values('date')
        rotation_count = 0
        
        current_positions = set()
        for _, trade in trades_df.iterrows():
            security = trade['security']
            
            if trade['action'] == 'buy':
                if security not in current_positions:
                    current_positions.add(security)
            else:  # sell
                if security in current_positions:
                    current_positions.remove(security)
                    rotation_count += 1
        
        return {
            'rotation_count': rotation_count,
            'r<CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.5/code_8_5_analyze_trading_costs.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
class TradingCostAnalyzer:
    """äº¤æ˜“æˆæœ¬åˆ†æå™¨"""
    
    def analyze_trading_costs(
        self,
        trades: List[TradeRecord],
        equity_curve: pd.DataFrame
    ) -> Dict[str, Any]:
        """
        åˆ†æäº¤æ˜“æˆæœ¬
        
        Args:
            trades: äº¤æ˜“è®°å½•åˆ—è¡¨
            equity_curve: å‡€å€¼æ›²çº¿
        
        Returns:
            Dict: äº¤æ˜“æˆæœ¬åˆ†æç»“æœ
        """
        trades_df = pd.DataFrame([
            {
                'date': t.date,
                'action': t.action,
                'value': t.price * t.amount,
                'commission': t.commission
            }
            for t in trades
        ])
        
        # æ€»æ‰‹ç»­è´¹
        total_commission = trades_df['commission'].sum()
        
        # æ€»äº¤æ˜“é‡‘é¢
        total_trade_value = trades_df['value'].sum()
        
        # æ‰‹ç»­è´¹ç‡
        commission_rate = total_commission / total_trade_value if total_trade_value > 0 else 0
        
        # å¹³å‡èµ„äº§
        equity_curve = equity_curve.sort_values('date')
        avg_equity = equity_curve['equity'].mean()
        
        # æˆæœ¬å æ¯”
        cost_ratio = total_commission / avg_equity if avg_equity > 0 else 0
        
        # æŒ‰æ—¶é—´æ®µåˆ†è§£æˆæœ¬
        trades_df['date'] = pd.to_datetime(trades_df['date'])
        trades_df['year_month'] = trades_df['date'].dt.to_period('M')
        monthly_costs = trades_df.groupby('year_month')['commission'].sum().to_dict()
        
        return {
            'total_commission': total_commission,
            'total_trade_value': total_trade_value,
            'commission_rate': commission_rate,<CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.5/code_8_5_plot_trade_distribution.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
import matplotlib.pyplot as plt

class TradeVisualizer:
    """äº¤æ˜“å¯è§†åŒ–å™¨"""
    
    def plot_trade_distribution(
        self,
        trades_by_date: Dict,
        save_path: str = None
    ):
        """ç»˜åˆ¶äº¤æ˜“åˆ†å¸ƒå›¾"""
        fig, ax = plt.subplots(figsize=(12, 6))
        
        dates = list(trades_by_date.keys())
        counts = list(trades_by_date.values())
        
        ax.bar(dates, counts, alpha=0.7)
        ax.set_xlabel('æ—¥æœŸ', fontsize=12)
        ax.set_ylabel('äº¤æ˜“æ¬¡æ•°', fontsize=12)
        ax.set_title('äº¤æ˜“åˆ†å¸ƒ', fontsize=14, fontweight='bold')
        ax.grid(True, alpha=0.3, axis='y')
        
        plt.xticks(rotation=45)
        plt.tight_layout()
        
        if save_path:
            plt.savefig(save_path, dpi=300, bbox_inches='tight')
        
        return fig
```
-->de_value': total_trade_value,
            'commission_rate': commission_rate,
            'cost_ratio': cost_ratio,
            'monthly_costs': monthly_costs
        }
```

<h2 id="section-8-5-6">ğŸ“Š 8.5.6 äº¤æ˜“å¯è§†åŒ–</h2>

äº¤æ˜“å¯è§†åŒ–å°†äº¤æ˜“åˆ†æç»“æœä»¥å›¾è¡¨å½¢å¼å±•ç¤ºã€‚

### äº¤æ˜“å›¾è¡¨ç”Ÿæˆ

```python
import matplotlib.pyplot as plt

class TradeVisualizer:
    """äº¤æ˜“å¯è§†åŒ–å™¨"""
    
    def plot_trade_distribution(
        self,
        trades_by_date: Dict,
        save_path: str = None
    ):
        """ç»˜åˆ¶äº¤æ˜“åˆ†å¸ƒå›¾"""
        fig, ax = plt.subplots(figsize=(12, 6))
        
        dates = list(trades_by_date.keys())
        counts = list(trades_by_date.values())
        
        ax.bar(dates, counts, alpha=0.7)
        ax.set_xlabel('æ—¥æœŸ', fontsize=12)
        ax.set_ylabel('äº¤æ˜“æ¬¡æ•°', fontsize=12)
        ax.set_title('äº¤æ˜“åˆ†å¸ƒ', fontsize=14, fontweight='bold')
        ax.grid(True, alpha=0.3, axis='y')
        
        plt.xticks(rotation=45)
        plt.tight_layout()
        
        if save_path:
            plt.savefig(save_path, dpi=300, bbox_inches='tight')
        
        return fig
```

## ğŸ”— ç›¸å…³ç« èŠ‚

- **8.1 å›æµ‹æ¡†æ¶**ï¼šäº†è§£å›æµ‹æ¡†æ¶ï¼Œäº¤æ˜“åˆ†æåŸºäºå›æµ‹ç»“æœ
- **8.2 å›æµ‹åˆ†æå™¨**ï¼šäº†è§£å›æµ‹åˆ†æå™¨ï¼Œäº¤æ˜“åˆ†ææ˜¯åˆ†æå™¨çš„ä¸€éƒ¨åˆ†
- **8.3 æ”¶ç›Šåˆ†æ**ï¼šäº†è§£æ”¶ç›Šåˆ†æï¼Œäº¤æ˜“å’Œæ”¶ç›Šéœ€è¦ç»“åˆåˆ†æ

## ğŸ’¡ å…³é”®è¦ç‚¹

1. **äº¤æ˜“ç»Ÿè®¡**ï¼šè¯„ä¼°ç­–ç•¥çš„äº¤æ˜“é¢‘ç‡å’Œäº¤æ˜“åˆ†å¸ƒ
2. **æ¢æ‰‹ç‡åˆ†æ**ï¼šè¯„ä¼°ç­–ç•¥çš„äº¤æ˜“æ´»è·ƒç¨‹åº¦
3. **èƒœç‡åˆ†æ**ï¼šè¯„ä¼°ç­–ç•¥çš„äº¤æ˜“èƒœç‡å’Œç›ˆäºæ¯”
4. **æŒä»“åˆ†æ**ï¼šè¯„ä¼°ç­–ç•¥çš„æŒä»“ç‰¹å¾å’ŒæŒä»“å‘¨æœŸ
5. **äº¤æ˜“æˆæœ¬åˆ†æ**ï¼šè¯„ä¼°ç­–ç•¥çš„äº¤æ˜“æˆæœ¬å’Œæˆæœ¬å æ¯”
6. **äº¤æ˜“å¯è§†åŒ–**ï¼šé€šè¿‡å›¾è¡¨ç›´è§‚å±•ç¤ºäº¤æ˜“åˆ†æç»“æœ

## ğŸ”® æ€»ç»“ä¸å±•æœ›

<div class="summary-outlook">
  <h3>æœ¬èŠ‚å›é¡¾</h3>
  <p>æœ¬èŠ‚è¯¦ç»†ä»‹ç»äº†äº¤æ˜“åˆ†æåŠŸèƒ½ï¼ŒåŒ…æ‹¬äº¤æ˜“ç»Ÿè®¡ã€æ¢æ‰‹ç‡åˆ†æã€èƒœç‡åˆ†æã€æŒä»“åˆ†æã€äº¤æ˜“æˆæœ¬åˆ†æç­‰å¤šä¸ªç»´åº¦çš„åˆ†æã€‚é€šè¿‡ç†è§£äº¤æ˜“åˆ†æçš„æ ¸å¿ƒæŠ€æœ¯ï¼Œå¸®åŠ©å¼€å‘è€…å…¨é¢è¯„ä¼°ç­–ç•¥çš„äº¤æ˜“è¡¨ç°ï¼Œè¯†åˆ«äº¤æ˜“ç‰¹å¾å’Œäº¤æ˜“é—®é¢˜ï¼Œä¸ºç­–ç•¥ä¼˜åŒ–æä¾›ä¾æ®ã€‚</p>
  
  <h3>ä¸‹èŠ‚é¢„å‘Š</h3>
  <p>æŒæ¡äº†äº¤æ˜“åˆ†æåï¼Œä¸‹ä¸€èŠ‚å°†è¯¦ç»†ä»‹ç»å›æµ‹æŠ¥å‘Šï¼ŒåŒ…æ‹¬æŠ¥å‘Šç”Ÿæˆã€æŠ¥å‘Šæ ¼å¼ã€æŠ¥å‘Šå¯è§†åŒ–ç­‰ã€‚é€šè¿‡ç†è§£å›æµ‹æŠ¥å‘Šçš„è¯¦ç»†æ–¹æ³•ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡å¦‚ä½•ç”Ÿæˆä¸“ä¸šçš„å›æµ‹æŠ¥å‘Šã€‚</p>
  
  <a href="/ashare-book6/008_Chapter8_Backtest/8.6_Backtest_Report_CN" class="next-section">
    ç»§ç»­å­¦ä¹ ï¼š8.6 å›æµ‹æŠ¥å‘Š â†’
  </a>
</div>

> **é€‚ç”¨ç‰ˆæœ¬**: v1.0.0+  
> **æœ€åæ›´æ–°**: 2025-12-12

