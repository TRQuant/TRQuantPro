---
title: "8.1 å›æµ‹æ¡†æ¶"
description: "æ·±å…¥è§£æå›æµ‹æ¡†æ¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬å›æµ‹å¼•æ“ã€æ•°æ®ç®¡ç†ã€äº¤æ˜“æ¨¡æ‹Ÿã€æ€§èƒ½è®¡ç®—ç­‰æ ¸å¿ƒæŠ€æœ¯"
lang: "zh-CN"
layout: "/src/layouts/HandbookLayout.astro"
currentBook: "ashare-book6"
updateDate: "2025-12-12"
---

# âš™ï¸ 8.1 å›æµ‹æ¡†æ¶

> **æ ¸å¿ƒæ‘˜è¦ï¼š**
> 
> æœ¬èŠ‚ç³»ç»Ÿä»‹ç»TRQuantç³»ç»Ÿçš„å›æµ‹æ¡†æ¶ï¼Œé‡‡ç”¨**åŒå±‚å›æµ‹æ¶æ„**ï¼šå†…éƒ¨ä½¿ç”¨BulletTradeå›æµ‹å¼•æ“+èšå®½æ•°æ®æºè¿›è¡Œç­–ç•¥å¼€å‘å’ŒéªŒè¯ï¼Œç”Ÿæˆçš„ç­–ç•¥ä»£ç éƒ¨ç½²åˆ°å›½é‡‘è¯åˆ¸çš„PTrade/QMTå¹³å°è¿›è¡Œåˆ¸å•†ç¯å¢ƒå›æµ‹å’Œå®ç›˜äº¤æ˜“ã€‚BulletTradeæ˜¯ä¸€ä¸ªå…¼å®¹èšå®½(JoinQuant) APIçš„æœ¬åœ°é‡åŒ–æ¡†æ¶ï¼Œç­–ç•¥ä»£ç ä½¿ç”¨èšå®½é£æ ¼çš„APIï¼Œæ•°æ®æºé€šè¿‡èšå®½(JQData)è·å–ã€‚é€šè¿‡ç†è§£åŒå±‚å›æµ‹æ¶æ„ã€BulletTradeå›æµ‹å¼•æ“ã€èšå®½æ•°æ®æºé›†æˆã€PTrade/QMTéƒ¨ç½²æµç¨‹ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡å®Œæ•´çš„å›æµ‹å’Œå®ç›˜éƒ¨ç½²æµç¨‹ã€‚

å›æµ‹æ¡†æ¶æ˜¯å›æµ‹éªŒè¯æ¨¡å—çš„æ ¸å¿ƒï¼Œé‡‡ç”¨**åŒå±‚å›æµ‹æ¶æ„**ï¼Œè´Ÿè´£æä¾›å®Œæ•´çš„å›æµ‹å’Œå®ç›˜éƒ¨ç½²åŠŸèƒ½ã€‚

## ğŸ“‹ ç« èŠ‚æ¦‚è§ˆ

<script>
function scrollToSection(sectionId) {
  const element = document.getElementById(sectionId);
  if (element) {
    const headerOffset = 100;
    const elementPosition = element.getBoundingClientRect().top;
    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
    window.scrollTo({
      top: offsetPosition,
      behavior: 'smooth'
    });
  }
}
</script>

<div class="section-overview">
  <div class="section-item" onclick="scrollToSection('section-8-1-1')">
    <h4>âš™ï¸ 8.1.1 å›æµ‹å¼•æ“</h4>
    <p>äº‹ä»¶é©±åŠ¨å›æµ‹ã€æ—¶é—´åºåˆ—å¤„ç†ã€ç­–ç•¥æ‰§è¡Œã€å›æµ‹é…ç½®</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-8-1-2')">
    <h4>ğŸ“Š 8.1.2 æ•°æ®ç®¡ç†</h4>
    <p>å†å²æ•°æ®è·å–ã€æ•°æ®é¢„å¤„ç†ã€æ•°æ®å¯¹é½ã€æ•°æ®ç¼“å­˜</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-8-1-3')">
    <h4>ğŸ’¹ 8.1.3 äº¤æ˜“æ¨¡æ‹Ÿ</h4>
    <p>è®¢å•ç”Ÿæˆã€è®¢å•æ‰§è¡Œã€æ»‘ç‚¹æ¨¡æ‹Ÿã€æ‰‹ç»­è´¹è®¡ç®—</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-8-1-4')">
    <h4>ğŸ“ˆ 8.1.4 æŠ•èµ„ç»„åˆç®¡ç†</h4>
    <p>æŒä»“ç®¡ç†ã€èµ„é‡‘ç®¡ç†ã€èµ„äº§ä¼°å€¼ã€å†å²è®°å½•</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-8-1-5')">
    <h4>ğŸ“Š 8.1.5 æ€§èƒ½è®¡ç®—</h4>
    <p>æ”¶ç›Šç‡è®¡ç®—ã€é£é™©æŒ‡æ ‡è®¡ç®—ã€ç»©æ•ˆåˆ†æã€æŒ‡æ ‡æ±‡æ€»</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-8-1-6')">
    <h4>ğŸ”„ 8.1.6 å›æµ‹å·¥ä½œæµ</h4>
    <p>å›æµ‹é…ç½®ã€å›æµ‹æ‰§è¡Œã€ç»“æœç”Ÿæˆã€å·¥ä½œæµé›†æˆ</p>
  </div>
</div>

## ğŸ¯ å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬èŠ‚å­¦ä¹ ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š

- **ç†è§£å›æµ‹å¼•æ“**ï¼šæŒæ¡äº‹ä»¶é©±åŠ¨å›æµ‹å’Œæ—¶é—´åºåˆ—å¤„ç†æœºåˆ¶
- **æŒæ¡æ•°æ®ç®¡ç†**ï¼šç†è§£å†å²æ•°æ®è·å–ã€é¢„å¤„ç†å’Œç¼“å­˜æ–¹æ³•
- **å®ç°äº¤æ˜“æ¨¡æ‹Ÿ**ï¼šæŒæ¡è®¢å•ç”Ÿæˆã€æ‰§è¡Œå’Œæ»‘ç‚¹æ¨¡æ‹ŸæŠ€æœ¯
- **ç®¡ç†æŠ•èµ„ç»„åˆ**ï¼šç†è§£æŒä»“ç®¡ç†ã€èµ„é‡‘ç®¡ç†å’Œèµ„äº§ä¼°å€¼æ–¹æ³•
- **è®¡ç®—æ€§èƒ½æŒ‡æ ‡**ï¼šæŒæ¡æ”¶ç›Šç‡ã€é£é™©æŒ‡æ ‡å’Œç»©æ•ˆåˆ†ææ–¹æ³•

## ğŸ“š æ ¸å¿ƒæ¦‚å¿µ

### æ¨¡å—å®šä½

- **å·¥ä½œæµä½ç½®**ï¼šæ­¥éª¤7 - ğŸ”„ å›æµ‹éªŒè¯
- **æ ¸å¿ƒèŒè´£**ï¼šå›æµ‹å¼•æ“ã€æ•°æ®ç®¡ç†ã€äº¤æ˜“æ¨¡æ‹Ÿã€æ€§èƒ½è®¡ç®—
- **æœåŠ¡å¯¹è±¡**ï¼šç­–ç•¥ä¼˜åŒ–ã€å®ç›˜äº¤æ˜“

### åŒå±‚å›æµ‹æ¶æ„

å›æµ‹æ¡†æ¶é‡‡ç”¨åŒå±‚å›æµ‹æ¶æ„ï¼Œå®ç°ä»å¼€å‘åˆ°å®ç›˜çš„å®Œæ•´æµç¨‹ï¼š

#### ç¬¬ä¸€å±‚ï¼šå†…éƒ¨å›æµ‹ï¼ˆéŸ¬ç¿ç³»ç»Ÿï¼‰

**æŠ€æœ¯æ ˆ**ï¼š
- **å›æµ‹å¼•æ“**ï¼šBulletTradeï¼ˆå…¼å®¹èšå®½APIçš„æœ¬åœ°é‡åŒ–æ¡†æ¶ï¼‰
- **æ•°æ®æº**ï¼šèšå®½(JQData)ï¼ˆä¸»è¦æ•°æ®æºï¼‰
- **ç­–ç•¥æ ¼å¼**ï¼šèšå®½é£æ ¼ç­–ç•¥ä»£ç ï¼ˆ`from jqdata import *`ï¼‰
- **æ‰§è¡Œæ–¹å¼**ï¼šBulletTrade CLIï¼ˆ`bullet-trade backtest`ï¼‰

**åŠŸèƒ½**ï¼š
- ç­–ç•¥å¼€å‘å’Œå¿«é€ŸéªŒè¯
- å†å²æ•°æ®å›æµ‹
- æ€§èƒ½æŒ‡æ ‡è®¡ç®—
- HTMLæŠ¥å‘Šç”Ÿæˆ

#### ç¬¬äºŒå±‚ï¼šåˆ¸å•†å¹³å°å›æµ‹ï¼ˆå›½é‡‘è¯åˆ¸ï¼‰

**æŠ€æœ¯æ ˆ**ï¼š
- **äº¤æ˜“å¹³å°**ï¼šPTradeï¼ˆæ’ç”Ÿäº¤æ˜“ç³»ç»Ÿï¼‰/ QMTï¼ˆè¿…æŠ•é‡åŒ–ç»ˆç«¯ï¼‰
- **åˆ¸å•†**ï¼šå›½é‡‘è¯åˆ¸
- **ç­–ç•¥æ ¼å¼**ï¼šèšå®½é£æ ¼ç­–ç•¥ä»£ç ï¼ˆé€‚é…PTrade/QMT APIï¼‰
- **æ‰§è¡Œæ–¹å¼**ï¼šPTrade/QMTå¹³å°å›æµ‹å’Œå®ç›˜äº¤æ˜“

**åŠŸèƒ½**ï¼š
- åˆ¸å•†ç¯å¢ƒå›æµ‹éªŒè¯
- å®ç›˜äº¤æ˜“æ‰§è¡Œ
- äº¤æ˜“æ•°æ®åŒæ­¥
- é£æ§å’Œåˆè§„æ£€æŸ¥

### å®Œæ•´æµç¨‹

```
ç­–ç•¥å¼€å‘ï¼ˆéŸ¬ç¿ç³»ç»Ÿï¼‰
    â†“
BulletTradeå›æµ‹ï¼ˆèšå®½æ•°æ®æºï¼‰
    â†“
ç­–ç•¥ä»£ç ç”Ÿæˆï¼ˆèšå®½é£æ ¼ï¼‰
    â†“
PTrade/QMTå¹³å°éƒ¨ç½²ï¼ˆå›½é‡‘è¯åˆ¸ï¼‰
    â†“
åˆ¸å•†ç¯å¢ƒå›æµ‹éªŒè¯
    â†“
å®ç›˜äº¤æ˜“æ‰§è¡Œ
```

### è®¾è®¡ç†å¿µ

å›æµ‹æ¡†æ¶éµå¾ªä»¥ä¸‹è®¾è®¡ç†å¿µï¼š

1. **èšå®½å…¼å®¹**ï¼šç­–ç•¥ä»£ç ä½¿ç”¨èšå®½APIï¼Œæ— éœ€ä¿®æ”¹å³å¯åœ¨BulletTradeä¸­è¿è¡Œ
2. **çœŸå®æ¨¡æ‹Ÿ**ï¼šé‡‡ç”¨å®é™…å¸‚åœºä»·æ ¼æ’®åˆäº¤æ˜“ï¼Œè‡ªåŠ¨å¤„ç†åˆ†çº¢é€è‚¡ç­‰
3. **åŒå±‚éªŒè¯**ï¼šå†…éƒ¨å›æµ‹å¿«é€Ÿè¿­ä»£ï¼Œåˆ¸å•†å¹³å°å›æµ‹ç¡®ä¿å®ç›˜ä¸€è‡´æ€§
4. **è‡ªåŠ¨åŒ–**ï¼šä¸€é”®å›æµ‹ï¼Œè‡ªåŠ¨ç”ŸæˆHTMLæŠ¥å‘Š
5. **å¯éƒ¨ç½²æ€§**ï¼šç”Ÿæˆçš„ç­–ç•¥ä»£ç å¯ç›´æ¥éƒ¨ç½²åˆ°PTrade/QMTå¹³å°

### è®¾è®¡å†³ç­–ï¼šä¸ºä»€ä¹ˆé€‰æ‹©BulletTrade + JQData + PTrade/QMTåŒå±‚æ¶æ„ï¼Ÿ

**å†³ç­–**ï¼šé‡‡ç”¨å†…éƒ¨BulletTradeå›æµ‹ + å¤–éƒ¨PTrade/QMTå›æµ‹çš„åŒå±‚æ¶æ„

**èƒŒæ™¯**ï¼š
- éœ€è¦å¿«é€Ÿè¿­ä»£ç­–ç•¥ï¼ˆå†…éƒ¨å›æµ‹ï¼‰
- éœ€è¦ç¡®ä¿å®ç›˜ä¸€è‡´æ€§ï¼ˆåˆ¸å•†å¹³å°å›æµ‹ï¼‰
- éœ€è¦æ”¯æŒå®ç›˜äº¤æ˜“ï¼ˆPTrade/QMTå¹³å°ï¼‰

**è€ƒè™‘å› ç´ **ï¼š

1. **å¼€å‘æ•ˆç‡**ï¼š
   - **å†…éƒ¨å›æµ‹ï¼ˆBulletTradeï¼‰**ï¼šå¿«é€Ÿè¿­ä»£ï¼Œæ— éœ€è¿æ¥åˆ¸å•†å¹³å°
   - **å¤–éƒ¨å›æµ‹ï¼ˆPTrade/QMTï¼‰**ï¼šçœŸå®ç¯å¢ƒéªŒè¯ï¼Œç¡®ä¿å®ç›˜ä¸€è‡´æ€§

2. **æ•°æ®ä¸€è‡´æ€§**ï¼š
   - **JQData**ï¼šç»Ÿä¸€æ•°æ®æºï¼Œå†…éƒ¨å›æµ‹å’Œç­–ç•¥ç”Ÿæˆä½¿ç”¨ç›¸åŒæ•°æ®
   - **åˆ¸å•†å¹³å°**ï¼šä½¿ç”¨åˆ¸å•†å®é™…æ•°æ®ï¼Œç¡®ä¿å®ç›˜ä¸€è‡´æ€§

3. **éƒ¨ç½²ä¾¿åˆ©æ€§**ï¼š
   - **èšå®½é£æ ¼ä»£ç **ï¼šç­–ç•¥ä»£ç ä½¿ç”¨èšå®½APIï¼Œæ˜“äºè½¬æ¢åˆ°PTrade/QMT
   - **è‡ªåŠ¨è½¬æ¢**ï¼šç³»ç»Ÿè‡ªåŠ¨å°†èšå®½é£æ ¼ä»£ç è½¬æ¢ä¸ºPTrade/QMTæ ¼å¼

**å†³ç­–**ï¼šé€‰æ‹©åŒå±‚æ¶æ„

**åæœ**ï¼š
- âœ… **ä¼˜ç‚¹**ï¼š
  - å¼€å‘æ•ˆç‡é«˜ï¼ˆå†…éƒ¨å¿«é€Ÿè¿­ä»£ï¼‰
  - å®ç›˜ä¸€è‡´æ€§å¥½ï¼ˆåˆ¸å•†å¹³å°éªŒè¯ï¼‰
  - éƒ¨ç½²ä¾¿åˆ©ï¼ˆè‡ªåŠ¨ä»£ç è½¬æ¢ï¼‰
- âŒ **ç¼ºç‚¹**ï¼š
  - éœ€è¦ç»´æŠ¤ä¸¤å¥—å›æµ‹ç¯å¢ƒ
  - ä»£ç è½¬æ¢å¯èƒ½ä¸å®Œå…¨å‡†ç¡®
- ğŸ“ **ç¼“è§£æªæ–½**ï¼š
  - å»ºç«‹ä»£ç è½¬æ¢æµ‹è¯•ï¼Œç¡®ä¿è½¬æ¢å‡†ç¡®æ€§
  - åœ¨åˆ¸å•†å¹³å°å›æµ‹é€šè¿‡åå†å®ç›˜

<h2 id="section-8-1-1">âš™ï¸ 8.1.1 å›æµ‹å¼•æ“</h2>

å›æµ‹å¼•æ“æ˜¯å›æµ‹æ¡†æ¶çš„æ ¸å¿ƒï¼ŒåŸºäº**BulletTradeå›æµ‹å¼•æ“**ï¼Œè´Ÿè´£æ‰§è¡Œç­–ç•¥å›æµ‹ã€‚

### BulletTradeå›æµ‹å¼•æ“

BulletTradeæ˜¯ä¸€ä¸ªå…¼å®¹èšå®½(JoinQuant) APIçš„æœ¬åœ°é‡åŒ–æ¡†æ¶ï¼Œç­–ç•¥ä»£ç ä½¿ç”¨èšå®½é£æ ¼çš„APIï¼Œå¯ä»¥ç›´æ¥åœ¨æœ¬åœ°è¿è¡Œå›æµ‹ã€‚

#### åˆå§‹åŒ–BulletTradeå¼•æ“

<CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.1/code_8_1_init_bullettrade_engine.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
from core.bullettrade import BulletTradeEngine, BTConfig

# åˆ›å»ºå›æµ‹é…ç½®
# è®¾è®¡åŸç†ï¼šé…ç½®å‚æ•°åˆ†ç¦»ï¼Œä¾¿äºå¤ç”¨å’Œæµ‹è¯•
# åŸå› ï¼šä¸åŒç­–ç•¥å¯èƒ½éœ€è¦ä¸åŒçš„å›æµ‹é…ç½®ï¼Œåˆ†ç¦»é…ç½®ä¾¿äºç®¡ç†
config = BTConfig(
    start_date="2023-01-01",
    end_date="2024-12-31",
    initial_capital=1000000,  # è®¾è®¡è€ƒè™‘ï¼šåˆå§‹èµ„é‡‘å½±å“å›æµ‹ç»“æœï¼Œéœ€è¦åˆç†è®¾ç½®
    commission_rate=0.0003,  # è®¾è®¡è€ƒè™‘ï¼šæ‰‹ç»­è´¹ç‡å½±å“æ”¶ç›Šï¼Œéœ€è¦ä¸å®é™…ä¸€è‡´
    stamp_tax_rate=0.001,  # è®¾è®¡è€ƒè™‘ï¼šå°èŠ±ç¨ä»…å–å‡ºæ—¶æ”¶å–ï¼Œéœ€è¦å‡†ç¡®æ¨¡æ‹Ÿ
    slippage=0.001,  # è®¾è®¡è€ƒè™‘ï¼šæ»‘ç‚¹å½±å“å¤§å•äº¤æ˜“ï¼Œéœ€è¦åˆç†ä¼°è®¡
    benchmark="000300.XSHG",  # è®¾è®¡è€ƒè™‘ï¼šåŸºå‡†ç”¨äºè®¡ç®—è¶…é¢æ”¶ç›Šï¼Œé€‰æ‹©å¸‚åœºä»£è¡¨æ€§æŒ‡æ•°
    data_provider="jqdata"  # è®¾è®¡åŸç†ï¼šä½¿ç”¨JQDataä½œä¸ºæ•°æ®æºï¼Œä¸ç­–ç•¥ç”Ÿæˆä¿æŒä¸€è‡´
)

# åˆ›å»ºå›æµ‹å¼•æ“
# è®¾è®¡åŸç†ï¼šå¼•æ“ä¸é…ç½®åˆ†ç¦»ï¼Œæ”¯æŒå¤šé…ç½®å¤ç”¨
engine = BulletTradeEngine(config)

# æ£€æŸ¥BulletTrade CLIå¯ç”¨æ€§
# è®¾è®¡åŸç†ï¼šæ£€æŸ¥CLIå¯ç”¨æ€§ï¼Œä¸å¯ç”¨æ—¶é™çº§åˆ°ç®€åŒ–å¼•æ“
# åŸå› ï¼šCLIæä¾›å®Œæ•´åŠŸèƒ½ï¼Œç®€åŒ–å¼•æ“æä¾›åŸºæœ¬åŠŸèƒ½ï¼Œä¿è¯ç³»ç»Ÿå¯ç”¨æ€§
if engine.check_cli_available():
    print("BulletTrade CLIå¯ç”¨")
else:
    print("è­¦å‘Šï¼šBulletTrade CLIä¸å¯ç”¨ï¼Œå°†ä½¿ç”¨ç®€åŒ–å›æµ‹å¼•æ“")
```
-->

**è®¾è®¡è¯´æ˜**ï¼š

- **é…ç½®åˆ†ç¦»**ï¼šå›æµ‹é…ç½®ç‹¬ç«‹äºå¼•æ“ï¼Œä¾¿äºå¤ç”¨å’Œæµ‹è¯•ã€‚ä¸åŒç­–ç•¥å¯ä»¥ä½¿ç”¨ä¸åŒé…ç½®ï¼Œæ— éœ€åˆ›å»ºå¤šä¸ªå¼•æ“å®ä¾‹ã€‚
- **å‚æ•°è®¾è®¡**ï¼š
  - **åˆå§‹èµ„é‡‘**ï¼šå½±å“å›æµ‹ç»“æœçš„å¯æ¯”æ€§ï¼Œå»ºè®®ä½¿ç”¨æ ‡å‡†é‡‘é¢ï¼ˆå¦‚100ä¸‡ï¼‰
  - **æ‰‹ç»­è´¹ç‡**ï¼šéœ€è¦ä¸å®é™…äº¤æ˜“ä¸€è‡´ï¼Œé¿å…å›æµ‹ç»“æœè¿‡äºä¹è§‚
  <CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.1/code_8_1_execute_backtest.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
# åŠ è½½ç­–ç•¥ä»£ç ï¼ˆèšå®½é£æ ¼ï¼‰
strategy_path = "strategies/my_strategy.py"

# æ‰§è¡Œå›æµ‹
result = engine.run_backtest(
    strategy_path=strategy_path,
    start_date="2023-01-01",
    end_date="2024-12-31",
    frequency="day"  # æ—¥çº¿å›æµ‹
)

# è·å–å›æµ‹ç»“æœ
print(f"æ€»æ”¶ç›Šç‡: {result.total_return:.2%}")
print(f"å¹´åŒ–æ”¶ç›Šç‡: {result.annual_return:.2%}")
print(f"æœ€å¤§å›æ’¤: {result.max_drawdown:.2%}")
print(f"å¤æ™®æ¯”ç‡: {result.sharpe_ratio:.2f}")

# ç”ŸæˆHTMLæŠ¥å‘Š
report_path = engine.generate_report(result, output_dir="backtest_results")
print(f"å›æµ‹æŠ¥å‘Šå·²ç”Ÿæˆ: {report_path}")
```
-->.2%}")
print(f"å¤æ™®æ¯”ç‡: {result.sharpe_ratio:.2f}")

# ç”ŸæˆHTMLæŠ¥å‘Š
report_path = engine.generate_report(result, output_dir="backtest_results")
print(f"å›æµ‹æŠ¥å‘Šå·²ç”Ÿæˆ: {report<CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.1/code_8_1_ptrade_platform_deployment.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
from core.ptrade_integration import PTradeConfig, PTradeDeployer

# é…ç½®PTradeè¿æ¥
ptrade_config = PTradeConfig(
    host="ptrade.gjzq.com",
    port=7709,
    account_id="8885019982",
    strategy_path="/path/to/ptrade/strategies"
)

# åˆ›å»ºéƒ¨ç½²å™¨
deployer = PTradeDeployer(ptrade_config)

# éƒ¨ç½²ç­–ç•¥ä»£ç ï¼ˆèšå®½é£æ ¼ â†’ PTradeæ ¼å¼ï¼‰
strategy_code = load_strategy_code("strategies/my_strategy.py")
ptrade_code = deployer.convert_to_ptrade(strategy_code)

# ä¸Šä¼ åˆ°PTradeå¹³å°
deployer.upload_strategy(
    strategy_name="my_strategy",
    strategy_code=ptrade_code
)

# åœ¨PTradeå¹³å°æ‰§è¡Œå›æµ‹
backtest_result = deployer.run_backtest(
    strategy_name="my_strategy",
    start_date="2023-01-01",
<CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.1/code_8_1_qmt_platform_deployment.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
from core.trading.qmt_interface import QMTTrader, QMTConfig

# é…ç½®QMTè¿æ¥
qmt_config = QMTConfig(
    qmt_path="/path/to/qmt",
    account_id="8885019982",
    session_id=123456
)

# åˆ›å»ºQMTäº¤æ˜“æ¥å£
qmt_trader = QMTTrader(qmt_config)

# è¿æ¥QMT
if qmt_trader.connect():
    print("QMTè¿æ¥æˆåŠŸ")
    
    # éƒ¨ç½²ç­–ç•¥ä»£ç 
    strategy_code = load_strategy_code("strategies/my_strategy.py")
    qmt_trader.upload_strategy("my_strategy", strategy_code)
    
    # åœ¨QMTå¹³å°æ‰§è¡Œå›æµ‹
    backtest_result = qmt_trader.run_backtest(
        strategy_name="my_strategy",
        start_date="2023-01-01",
        end_date="2024-12-31"
  <CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.1/code_8_1___init__.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
from datetime import datetime, timedelta
from typing import List, Dict, Callable, Any
from enum import Enum
import pandas as pd

class EventType(Enum):
    """äº‹ä»¶ç±»å‹"""
    MARKET_OPEN = "market_open"
    MARKET_CLOSE = "market_close"
    BEFORE_TRADING = "before_trading"
    AFTER_TRADING = "after_trading"
    BAR = "bar"  # Kçº¿æ•°æ®
    ORDER_FILLED = "order_filled"
    ORDER_CANCELLED = "order_cancelled"

class Event:
    """å›æµ‹äº‹ä»¶"""
    def __init__(self, event_type: EventType, timestamp: datetime, data: Any = None):
        self.event_type = event_type
        self.timestamp = timestamp
        self.data = data

class BacktestEngine:
    """å›æµ‹å¼•æ“"""
    
    def __init__(self, config: BacktestConfig):
        self.config = config
        self.events = []  # äº‹ä»¶é˜Ÿåˆ—
        self.current_date = None
        self.strategy = None
        self.portfolio = None
        self.data_provider = None
        self.order_manager = None
    
    def run(self, strategy: Any) -> BacktestResult:
        """
        æ‰§è¡Œå›æµ‹
        
        Args:
            strategy: ç­–ç•¥å¯¹è±¡
        
        Returns:
            BacktestResult: å›æµ‹ç»“æœ
        """
        # åˆå§‹åŒ–
        self.strategy = strategy
        self.portfolio = Portfolio(self.config.initial_capital)
        self.order_manager = OrderManager(
            commission_rate=self.config.commission_rate,
            slippage=self.config.slippage
        )
        
        # ç”Ÿæˆäº‹ä»¶åºåˆ—
        self._generate_events()
        
        # å¤„ç†äº‹ä»¶
        while self.events:
            event = self.events.pop(0)
            self._process_event(event)
        
        # è®¡ç®—æ€§èƒ½æŒ‡æ ‡
        return self._calculate_results()
    
    def _generate_events(self):
        """ç”Ÿæˆäº‹ä»¶åºåˆ—"""
        # è·å–äº¤æ˜“æ—¥æœŸ
        dates = pd.date_range(
            self.config.start_date,
            self.config.end_date,
            freq='B'  # å·¥ä½œæ—¥
        )
        
        for date in dates:
            # ç›˜å‰äº‹ä»¶
            self.events.append(Event(
                EventType.BEFORE_TRADING,
                date.replace(hour=9, minute=0)
            ))
            
            # å¼€ç›˜äº‹ä»¶
            self.events.append(Event(
                EventType.MARKET_OPEN,
                date.replace(hour=9, minute=30)
            ))
            
            # Kçº¿æ•°æ®äº‹ä»¶
            self.events.append(Event(
                EventType.BAR,
                date.replace(hour=15, minute=0),
                data={'date': date}
            ))
            
            # æ”¶ç›˜äº‹ä»¶
            self.events.append(Event(
                EventType.MARKET_CLOSE,
                date.replace(hour=15, minute=0)
            ))
            
            # ç›˜åäº‹ä»¶
            self.events.append(Event(
                EventType.AFTER_TRADING,
                date.replace(hour=15, minute=30)
            ))
        
        # æŒ‰æ—¶é—´æ’åº
        self.events.sort(key=lambda e: e.timestamp)
    
    def _process_event(self, event: Event):
        """å¤„ç†äº‹ä»¶"""
        self.current_date = event.timestamp
        
        if event.event_type == EventType.BEFORE_TRADING:
            if hasattr(self.strategy, 'before_trading_start'):
                self.strategy.before_trading_start(self._get_context())
        
        elif event.event_type == EventType.MARKET_OPEN:
            if hasattr(self.strategy, 'market_open'):
                self.strategy.market_open(self._get_context())
        
        elif event.event_type == EventType.BAR:
            # æ›´æ–°æ•°æ®
            market_data = self._get_market_data(event.data['date'])
            
            # æ‰§è¡Œç­–ç•¥
            if hasattr(self.strategy, 'handle_data'):
                self.strategy.handle_data(market_data, event.data['date'])
            
            # å¤„ç†è®¢å•
            self._process_orders(market_data)
            
            # æ›´æ–°æŒä»“
            self._update_positions(market_data)
        
        elif event.event_type == EventType.MARKET_CLOSE:
            if hasattr(self.strategy, 'market_close'):
                self.strategy.market_close(self._get_context())
        
        elif event.event_type == EventType.AFTER_TRADING:
            if hasattr(self.strategy, 'after_trading_end'):
        <CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.1/code_8_1_validate.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
@dataclass
class BacktestConfig:
    """å›æµ‹é…ç½®"""
    
    start_date: str                    # å¼€å§‹æ—¥æœŸ
    end_date: str                      # ç»“æŸæ—¥æœŸ
    initial_capital: float = 1000000.0  # åˆå§‹èµ„é‡‘
    commission_rate: float = 0.0003    # ä½£é‡‘ç‡
    stamp_tax_rate: float = 0.001      # å°èŠ±ç¨
    slippage: float = 0.001            # æ»‘ç‚¹
    benchmark: str = "000300.XSHG"     # åŸºå‡†
    position_limit: int = 20           # æœ€å¤§æŒä»“æ•°
    rebalance_freq: str = "monthly"    # è°ƒä»“é¢‘ç‡
    
    def validate(self) -> Tuple[bool, List[str]]:
        """éªŒè¯é…ç½®"""
        errors = []
        
        # éªŒè¯æ—¥æœŸ
        try:
            start = pd.to_datetime(self.start_date)
            end = pd.to_datetime(self.end_date)
            if start >= end:
                errors.append("å¼€å§‹æ—¥æœŸå¿…é¡»æ—©äºç»“æŸæ—¥æœŸ")
        except Exception as e:
            errors.append(f"æ—¥æœŸæ ¼å¼é”™è¯¯: {e}")
        
        # éªŒè¯èµ„é‡‘
        if self.initial_capital <= 0:
            errors.append("åˆå§‹èµ„é‡‘å¿…é¡»å¤§äº0")
        
        # éªŒè¯è´¹ç‡
        if self.commission_rate < 0 or self.commission_rate > 0.01:
            errors.append("ä½£é‡‘ç‡å¿…é¡»åœ¨0-1%ä¹‹é—´")
        <CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.1/code_8_1_joinquant_data_source_integration.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
from core.data_source_manager import DataSourceManager
from core.data_provider import DataProvider

# åˆå§‹åŒ–æ•°æ®æºç®¡ç†å™¨
data_manager = DataSourceManager()

# é…ç½®èšå®½æ•°æ®æº
from config.config_manager import get_config_manager
config_manager = get_config_manager()
jq_config = config_manager.get_jqdata_config()

# åˆå§‹åŒ–èšå®½å®¢æˆ·ç«¯
data_manager.init_jqdata(
    username=jq_config.get('username'),
    password=jq_config.get('password')
)

# åˆ›å»ºæ•°æ®æä¾›è€…
data_provider = DataProvider(jq_client=data_manager.get_jq_client())

# è·å–ä»·æ ¼æ•°æ®ï¼ˆèšå®½æ ¼å¼ï¼‰
securities = ['000001.XSHE', '000002.XSHE']  # èšå®½è‚¡ç¥¨ä»£ç æ ¼å¼
start_date = '2023-01-01'
end_date = '2024-12-31'

price_data = data_provider.get_price(
    securities=securities,
    start_date=start_date,
    <CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.1/code_8_1___init__.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
class DataProvider:
    """æ•°æ®æä¾›è€…ï¼ˆèšå®½æ•°æ®æºï¼‰"""
    
    def __init__(self, jq_client=None):
        self.jq_client = jq_client
        self.cache = {}  # å†…å­˜ç¼“å­˜
        self.cache_dir = Path("data/cache")
        self.cache_dir.mkdir(parents=True, exist_ok=True)
    
    def get_price(
        self,
        securities: List[str],
        start_date: str,
        end_date: str,
        frequency: str = 'day'
    ) -> pd.DataFrame:
        """
        è·å–ä»·æ ¼æ•°æ®ï¼ˆèšå®½æ ¼å¼ï¼‰
        
        Args:
            securities: è‚¡ç¥¨ä»£ç åˆ—è¡¨ï¼ˆèšå®½æ ¼å¼ï¼Œå¦‚ '000001.XSHE'ï¼‰
            start_date: å¼€å§‹æ—¥æœŸ
            end_date: ç»“æŸæ—¥æœŸ
            frequency: é¢‘ç‡ï¼ˆ'day', 'minute'ç­‰ï¼‰
        
        Returns:
            pd.DataFrame: ä»·æ ¼æ•°æ®ï¼ˆèšå®½æ ¼å¼ï¼‰
        """
        # æ£€æŸ¥ç¼“å­˜
        cache_key = f"{','.join(securities)}_{start_date}_{end_date}_{frequency}"
        cache_file = self.cache_dir / f"{hash(cache_key)}.parquet"
        
        if cache_file.exists():
            return pd.read_parquet(cache_file)
        
        # ä»èšå®½è·å–æ•°æ®
        if self.jq_client is None:
            raise Exception("æœªè®¾ç½®èšå®½å®¢æˆ·ç«¯ï¼Œæ— æ³•è·å–æ•°æ®")
        
        logger.info(f"ä»èšå®½APIè·å–æ•°æ®: {securities}, {start_date} to {end_date}")
        data = self.jq_client.get_price(
            securities=securities,
            start_date=start_date,
            end_date=end_date,
            frequency=frequency
        )
        
        # ç¼“å­˜æ•°æ®
        data.to_parq<CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.1/code_8_1___init__.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
class OrderManager:
    """è®¢å•ç®¡ç†å™¨"""
    
    def __init__(self, commission_rate: float = 0.0003, slippage: float = 0.001):
        self.commission_rate = commission_rate
        self.slippage = slippage
        self.orders: List[Order] = []
        self.filled_orders: List[Order] = []
    
    def create_order(
        self,
        security: str,
        amount: float,
        order_type: OrderType = OrderType.MARKET,
        price: Optional[float] = None
    ) -> Order:
        """åˆ›å»ºè®¢å•"""
        order = Order(security, amount, order_type, price)
        self.orders.append(order)
        return order
    
    def process_order(self, order: Order, current_price: float) -> bool:
        """å¤„ç†è®¢å•ï¼ˆæ¨¡æ‹Ÿæˆäº¤ï¼‰"""
        if order.status != OrderStatus.PENDING:
            return False
        
        # è®¡ç®—æˆäº¤ä»·æ ¼ï¼ˆè€ƒè™‘æ»‘ç‚¹ï¼‰
        if order.order_type == OrderType.MARKET:
            if order.amount > 0:  # ä¹°å…¥
                fill_price = current_price * (1 + self.slippage)
            else:  # å–å‡º
                fill_price = current_price * (1 - self.slippage)
        else:  # é™ä»·å•
            if order.price is None:
                order.status = OrderStatus.REJECTED
                return False
            
            if order.amount > 0:  # ä¹°å…¥é™ä»·å•
                if current_price <= order.price:
                    fill_price = min(current_price, order.price) * (1 + self.slippage)
                else:
                    return False  # ä»·æ ¼æœªè¾¾åˆ°
            else:  # å–å‡ºé™ä»·å•
                if current_price >= order.price:
                    fill_price = max(current_price, order.price) * (1 - self.slippage)
                else:
                    return False  # ä»·æ ¼æœªè¾¾åˆ°
        
        # è®¡ç®—æ‰‹ç»­è´¹
        commission = abs(order.amount * fill_price) * self.commission_rate
        
        # æˆäº¤è®¢å•
        order.fill(fill_price, time=datetime.n<CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.1/code_8_1___init__.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
class Portfolio:
    """æŠ•èµ„ç»„åˆ"""
    
    def __init__(self, initial_cash: float = 1000000):
        self.initial_cash = initial_cash
        self.cash = initial_cash
        self.positions: Dict[str, Position] = {}
        self.total_value_history = []
        self.cash_history = []
        self.date_history = []
    
    def add_position(self, security: str, amount: float, price: float):
        """æ·»åŠ æŒä»“"""
        if security in self.positions:
            # æ›´æ–°æŒä»“
            pos = self.positions[security]
            total_cost = pos.cost_value + amount * price
            total_amount = pos.amount + amount
            pos.amount = total_amount
            pos.cost_price = total_cost / total_amount if total_amount > 0 else price
        else:
            # æ–°å»ºæŒä»“
            self.positions[security] = Position(security, amount, price)
    
    def remove_position(self, security: str, amount: float, price: float):
        """å‡å°‘æŒä»“"""
        if security not in self.positions:
            return
        
        pos = self.positions[security]
        if amount >= pos.amount:
            del self.positions[security]
        else:
            pos.amount -= amount
    
    def get_total_value(self) -> float:
        """è·å–æ€»èµ„äº§"""
        positions_value = sum(pos.market_value<CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.1/code_8_1_calculate_metrics.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
class PerformanceCalculator:
    """æ€§èƒ½è®¡ç®—å™¨"""
    
    def calculate_metrics(
        self,
        equity_curve: pd.DataFrame,
        benchmark_curve: pd.DataFrame = None
    ) -> PerformanceMetrics:
        """è®¡ç®—æ€§èƒ½æŒ‡æ ‡"""
        returns = equity_curve['equity'].pct_change().dropna()
        
        # æ€»æ”¶ç›Šç‡
        total_return = (equity_curve['equity'].iloc[-1] / equity_curve['equity'].iloc[0]) - 1
        
        # å¹´åŒ–æ”¶ç›Šç‡
        days = (equity_curve.index[-1] - equity_curve.index[0]).days
        years = days / 365.25
        annual_return = (1 + total_return) ** (1 / years) - 1 if years > 0 else 0
        
        # æœ€å¤§å›æ’¤
        max_drawdown, max_drawdown_duration = self._calculate_max_drawdown(equity_curve)
        
        # å¤æ™®æ¯”ç‡
        sharpe_ratio = self._calculate_sharpe_ratio(returns)
        
        # æ³¢åŠ¨ç‡
        volatility = returns.std() * np.sqrt(252)
        
        return PerformanceMetrics(
            total_return=total_return,
            annual_return=annual_return,
            sharpe_ratio=sharpe_ratio,
            max_drawdown=max_drawdown,
            max_drawdown_duration=max_drawdown_durati<CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.1/code_8_1_run_complete_backtest_workflow.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
from core.bullettrade import BulletTradeEngine, BTConfig
from core.ptrade_integration import PTradeDeployer, PTradeConfig
from core.trading.qmt_interface import QMTTrader, QMTConfig

def run_complete_backtest_workflow(
    strategy_path: str,
    start_date: str,
    end_date: str,
    deploy_to_ptrade: bool = True,
    deploy_to_qmt: bool = False
) -> Dict:
    """
    æ‰§è¡Œå®Œæ•´åŒå±‚å›æµ‹å·¥ä½œæµ
    
    1. å†…éƒ¨å›æµ‹ï¼šBulletTrade + èšå®½æ•°æ®æº
    2. åˆ¸å•†å¹³å°å›æµ‹ï¼šPTrade/QMTå¹³å°
    3. å®ç›˜éƒ¨ç½²ï¼šå¦‚æœå›æµ‹é€šè¿‡
    
    Args:
        strategy_path: ç­–ç•¥ä»£ç è·¯å¾„ï¼ˆèšå®½é£æ ¼ï¼‰
        start_date: å¼€å§‹æ—¥æœŸ
        end_date: ç»“æŸæ—¥æœŸ
        deploy_to_ptrade: æ˜¯å¦éƒ¨ç½²åˆ°PTrade
        deploy_to_qmt: æ˜¯å¦éƒ¨ç½²åˆ°QMT
    
    Returns:
        Dict: åŒ…å«å†…éƒ¨å›æµ‹å’Œåˆ¸å•†å¹³å°å›æµ‹ç»“æœ
    """
    results = {
        'internal_backtest': None,
        'ptrade_backtest': None,
        'qmt_backtest': None,
        'deployment_status': {}
    }
    
    # ========== ç¬¬ä¸€å±‚ï¼šå†…éƒ¨å›æµ‹ï¼ˆBulletTrade + èšå®½æ•°æ®æºï¼‰ ==========
    print("=" * 60)
    print("ç¬¬ä¸€å±‚ï¼šå†…éƒ¨å›æµ‹ï¼ˆBulletTrade + èšå®½æ•°æ®æºï¼‰")
    print("=" * 60)
    
    # 1. åˆ›å»ºBulletTradeé…ç½®
    bt_config = BTConfig(
        start_date=start_date,
        end_date=end_date,
        initial_capital=1000000,
        commission_rate=0.0003,
        stamp_tax_rate=0.001,
        slippage=0.001,
        benchmark="000300.XSHG",
        data_provider="jqdata"  # ä½¿ç”¨èšå®½æ•°æ®æº
    )
    
    # 2. åˆå§‹åŒ–BulletTradeå¼•æ“
    bt_engine = BulletTradeEngine(bt_config)
    
    # 3. æ‰§è¡Œå†…éƒ¨å›æµ‹
    print(f"æ‰§è¡ŒBulletTradeå›æµ‹: {strategy_path}")
    internal_result = bt_engine.run_backtest(
        strategy_path=strategy_path,
        start_date=start_date,
        end_date=end_date,
        frequency="day"
    )
    
    results['internal_backtest'] = {
        'total_return': internal_result.total_return,
        'annual_return': internal_result.annual_return,
        'max_drawdown': internal_result.max_drawdown,
        'sharpe_ratio': internal_result.sharpe_ratio,
        'report_path': internal_result.report_path
    }
    
    print(f"å†…éƒ¨å›æµ‹å®Œæˆ:")
    print(f"  æ€»æ”¶ç›Šç‡: {internal_result.total_return:.2%}")
    print(f"  å¹´åŒ–æ”¶ç›Šç‡: {internal_result.annual_return:.2%}")
    print(f"  æœ€å¤§å›æ’¤: {internal_result.max_drawdown:.2%}")
    print(f"  å¤æ™®æ¯”ç‡: {internal_result.sharpe_ratio:.2f}")
    
    # 4. åˆ¤æ–­æ˜¯å¦æ»¡è¶³éƒ¨ç½²æ¡ä»¶
    if internal_result.total_return < 0.10:  # æ”¶ç›Šç‡ä½äº10%
        print("è­¦å‘Šï¼šå†…éƒ¨å›æµ‹æ”¶ç›Šç‡è¾ƒä½ï¼Œä¸å»ºè®®éƒ¨ç½²åˆ°åˆ¸å•†å¹³å°")
        return results
    
    # ========== ç¬¬äºŒå±‚ï¼šåˆ¸å•†å¹³å°å›æµ‹ï¼ˆPTrade/QMTï¼‰ ==========
    print("\n" + "=" * 60)
    print("ç¬¬äºŒå±‚ï¼šåˆ¸å•†å¹³å°å›æµ‹ï¼ˆå›½é‡‘è¯åˆ¸ PTrade/QMTï¼‰")
    print("=" * 60)
    
    # 5. PTradeå¹³å°éƒ¨ç½²å’Œå›æµ‹
    if deploy_to_ptrade:
        print("\néƒ¨ç½²åˆ°PTradeå¹³å°...")
        try:
            ptrade_config = PTradeConfig.load()
            ptrade_deployer = PTradeDeployer(ptrade_config)
            
            # è½¬æ¢ç­–ç•¥ä»£ç ï¼ˆèšå®½é£æ ¼ â†’ PTradeæ ¼å¼ï¼‰
            strategy_code = open(strategy_path, 'r', encoding='utf-8').read()
            ptrade_code = ptrade_deployer.convert_to_ptrade(strategy_code)
            
            # ä¸Šä¼ ç­–ç•¥
            strategy_name = Path(strategy_path).stem
            ptrade_deployer.upload_strategy(strategy_name, ptrade_code)
            
            # åœ¨PTradeå¹³å°æ‰§è¡Œå›æµ‹
            print("åœ¨PTradeå¹³å°æ‰§è¡Œå›æµ‹...")
            ptrade_result = ptrade_deployer.run_backtest(
                strategy_name=strategy_name,
                start_date=start_date,
                end_date=end_date
            )
            
            results['ptrade_backtest'] = {
                'total_return': ptrade_result.total_return,
                'annual_return': ptrade_result.annual_return,
                'max_drawdown': ptrade_result.max_drawdown,
                'sharpe_ratio': ptrade_result.sharpe_ratio
            }
            
            print(f"PTradeå›æµ‹å®Œæˆ:")
            print(f"  æ€»æ”¶ç›Šç‡: {ptrade_result.total_return:.2%}")
            print(f"  å¹´åŒ–æ”¶ç›Šç‡: {ptrade_result.annual_return:.2%}")
            print(f"  æœ€å¤§å›æ’¤: {ptrade_result.max_drawdown:.2%}")
            
            # å¦‚æœPTradeå›æµ‹é€šè¿‡ï¼Œå¯åŠ¨å®ç›˜äº¤æ˜“
            if ptrade_result.total_return > 0.15:
                print("PTradeå›æµ‹é€šè¿‡ï¼Œå¯åŠ¨å®ç›˜äº¤æ˜“...")
                ptrade_deployer.start_live_trading(strategy_name)
                results['deployment_status']['ptrade'] = 'live_trading'
            else:
                results['deployment_status']['ptrade'] = 'backtest_only'
                
        except Exception as e:
            print(f"PTradeéƒ¨ç½²å¤±è´¥: {e}")
            results['deployment_status']['ptrade'] = f'failed: {str(e)}'
    
    # 6. QMTå¹³å°éƒ¨ç½²å’Œå›æµ‹
    if deploy_to_qmt:
        print("\néƒ¨ç½²åˆ°QMTå¹³å°...")
        try:
            qmt_config = QMTConfig(
                qmt_path="/path/to/qmt",
                account_id="8885019982",
                session_id=123456
            )
            qmt_trader = QMTTrader(qmt_config)
            
            if qmt_trader.connect():
                # ä¸Šä¼ ç­–ç•¥
                strategy_code = open(strategy_path, 'r', encoding='utf-8').read()
                strategy_name = Path(strategy_path).stem
                qmt_trader.upload_strategy(strategy_name, strategy_code)
                
                # åœ¨QMTå¹³å°æ‰§è¡Œå›æµ‹
                print("åœ¨QMTå¹³å°æ‰§è¡Œå›æµ‹...")
                qmt_result = qmt_trader.run_backtest(
                    strategy_name=strategy_name,
                    start_date=start_date,
                    end_date=end_date
                )
                
                results['qmt_backtest'] = {
                    'total_return': qmt_result.total_return,
                    'annual_return': qmt_result.annual_return,
                    'max_drawdown': qmt_result.max_drawdown,
                    'sharpe_ratio': qmt_result.sharpe_ratio
                }
                
                print(f"QMTå›æµ‹å®Œæˆ:")
                print(f"  æ€»æ”¶ç›Šç‡: {qmt_result.total_return:.2%}")
                print(f"  å¹´åŒ–æ”¶ç›Šç‡: {qmt_result.annual_return:.2%}")
                print(f"  æœ€å¤§å›æ’¤: {qmt_result.max_drawdown:.2%}")
                
                # å¦‚æœQMTå›æµ‹é€šè¿‡ï¼Œå¯åŠ¨å®ç›˜äº¤æ˜“
                if qmt_result.total_return > 0.15:
                    print("QMTå›æµ‹é€šè¿‡ï¼Œå¯åŠ¨å®ç›˜äº¤æ˜“...")
                    qmt_trader.start_live_trading(strategy_name)
                    results['deployment_status']['qmt'] = 'live_trading'
                else:
                    results['deployment_status']['qmt'] = 'backtest_only'
            else:
                print("QMTè¿æ¥å¤±è´¥")
                results['deployment_status']['qmt'] = 'connection_failed'
         <CodeFromFile 
  filePath="code_library/008_Chapter8_Backtest/8.1/code_8_1_usage_example.py"
  language="python"
  showDesignPrinciples="true"
/>

<!-- åŸå§‹ä»£ç ï¼ˆä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰ï¼š
```python
# æ‰§è¡Œå®Œæ•´åŒå±‚å›æµ‹å·¥ä½œæµ
results = run_complete_backtest_workflow(
    strategy_path="strategies/my_strategy.py",
    start_date="2023-01-01",
    end_date="2024-12-31",
    deploy_to_ptrade=True,
    deploy_to_qmt=False
)

# æŸ¥çœ‹ç»“æœ
print("\nå›æµ‹ç»“æœæ±‡æ€»:")
print(f"å†…éƒ¨å›æµ‹ï¼ˆBulletTradeï¼‰: {results['internal_backtest']}")
print(f"PTradeå›æµ‹: {results['ptrade_backtest']}")
print(f"éƒ¨ç½²çŠ¶æ€: {results['deployment_status']}")
```
-->er.upload_strategy(strategy_name, strategy_code)
                
                # åœ¨QMTå¹³å°æ‰§è¡Œå›æµ‹
                print("åœ¨QMTå¹³å°æ‰§è¡Œå›æµ‹...")
                qmt_result = qmt_trader.run_backtest(
                    strategy_name=strategy_name,
                    start_date=start_date,
                    end_date=end_date
                )
                
                results['qmt_backtest'] = {
                    'total_return': qmt_result.total_return,
                    'annual_return': qmt_result.annual_return,
                    'max_drawdown': qmt_result.max_drawdown,
                    'sharpe_ratio': qmt_result.sharpe_ratio
                }
                
                print(f"QMTå›æµ‹å®Œæˆ:")
                print(f"  æ€»æ”¶ç›Šç‡: {qmt_result.total_return:.2%}")
                print(f"  å¹´åŒ–æ”¶ç›Šç‡: {qmt_result.annual_return:.2%}")
                print(f"  æœ€å¤§å›æ’¤: {qmt_result.max_drawdown:.2%}")
                
                # å¦‚æœQMTå›æµ‹é€šè¿‡ï¼Œå¯åŠ¨å®ç›˜äº¤æ˜“
                if qmt_result.total_return > 0.15:
                    print("QMTå›æµ‹é€šè¿‡ï¼Œå¯åŠ¨å®ç›˜äº¤æ˜“...")
                    qmt_trader.start_live_trading(strategy_name)
                    results['deployment_status']['qmt'] = 'live_trading'
                else:
                    results['deployment_status']['qmt'] = 'backtest_only'
            else:
                print("QMTè¿æ¥å¤±è´¥")
                results['deployment_status']['qmt'] = 'connection_failed'
                
        except Exception as e:
            print(f"QMTéƒ¨ç½²å¤±è´¥: {e}")
            results['deployment_status']['qmt'] = f'failed: {str(e)}'
    
    return results
```

### ä½¿ç”¨ç¤ºä¾‹

```python
# æ‰§è¡Œå®Œæ•´åŒå±‚å›æµ‹å·¥ä½œæµ
results = run_complete_backtest_workflow(
    strategy_path="strategies/my_strategy.py",
    start_date="2023-01-01",
    end_date="2024-12-31",
    deploy_to_ptrade=True,
    deploy_to_qmt=False
)

# æŸ¥çœ‹ç»“æœ
print("\nå›æµ‹ç»“æœæ±‡æ€»:")
print(f"å†…éƒ¨å›æµ‹ï¼ˆBulletTradeï¼‰: {results['internal_backtest']}")
print(f"PTradeå›æµ‹: {results['ptrade_backtest']}")
print(f"éƒ¨ç½²çŠ¶æ€: {results['deployment_status']}")
```

## ğŸ”— ç›¸å…³ç« èŠ‚

- **7.2 ç­–ç•¥ç”Ÿæˆ**ï¼šäº†è§£ç­–ç•¥ç”Ÿæˆï¼Œå›æµ‹åŸºäºç”Ÿæˆçš„ç­–ç•¥
- **7.3 ç­–ç•¥ä¼˜åŒ–**ï¼šäº†è§£ç­–ç•¥ä¼˜åŒ–ï¼Œå›æµ‹ç»“æœä¸ºä¼˜åŒ–æä¾›åé¦ˆ
- **8.2 å›æµ‹åˆ†æå™¨**ï¼šäº†è§£å›æµ‹åˆ†æï¼Œåˆ†æå›æµ‹ç»“æœ

## ğŸ’¡ å…³é”®è¦ç‚¹

1. **åŒå±‚å›æµ‹æ¶æ„**ï¼šå†…éƒ¨BulletTradeå›æµ‹ï¼ˆå¿«é€Ÿè¿­ä»£ï¼‰+ åˆ¸å•†å¹³å°å›æµ‹ï¼ˆå®ç›˜éªŒè¯ï¼‰
2. **èšå®½å…¼å®¹**ï¼šç­–ç•¥ä»£ç ä½¿ç”¨èšå®½APIï¼Œæ— éœ€ä¿®æ”¹å³å¯åœ¨BulletTradeä¸­è¿è¡Œ
3. **çœŸå®æ¨¡æ‹Ÿ**ï¼šBulletTradeé‡‡ç”¨å®é™…å¸‚åœºä»·æ ¼æ’®åˆäº¤æ˜“ï¼Œè‡ªåŠ¨å¤„ç†åˆ†çº¢é€è‚¡ç­‰
4. **æ•°æ®æºç»Ÿä¸€**ï¼šå†…éƒ¨å›æµ‹ä½¿ç”¨èšå®½æ•°æ®æºï¼Œç¡®ä¿æ•°æ®è´¨é‡å’Œä¸€è‡´æ€§
5. **å¯éƒ¨ç½²æ€§**ï¼šç”Ÿæˆçš„ç­–ç•¥ä»£ç å¯ç›´æ¥éƒ¨ç½²åˆ°å›½é‡‘è¯åˆ¸çš„PTrade/QMTå¹³å°
6. **å®Œæ•´æµç¨‹**ï¼šä»ç­–ç•¥å¼€å‘ â†’ å†…éƒ¨å›æµ‹ â†’ åˆ¸å•†å¹³å°å›æµ‹ â†’ å®ç›˜äº¤æ˜“çš„å®Œæ•´é—­ç¯

## ğŸ”® æ€»ç»“ä¸å±•æœ›

<div class="summary-outlook">
  <h3>æœ¬èŠ‚å›é¡¾</h3>
  <p>æœ¬èŠ‚ç³»ç»Ÿä»‹ç»äº†TRQuantç³»ç»Ÿçš„å›æµ‹æ¡†æ¶ï¼Œé‡‡ç”¨åŒå±‚å›æµ‹æ¶æ„ï¼šå†…éƒ¨ä½¿ç”¨BulletTradeå›æµ‹å¼•æ“+èšå®½æ•°æ®æºè¿›è¡Œç­–ç•¥å¼€å‘å’Œå¿«é€ŸéªŒè¯ï¼Œç”Ÿæˆçš„ç­–ç•¥ä»£ç éƒ¨ç½²åˆ°å›½é‡‘è¯åˆ¸çš„PTrade/QMTå¹³å°è¿›è¡Œåˆ¸å•†ç¯å¢ƒå›æµ‹å’Œå®ç›˜äº¤æ˜“ã€‚é€šè¿‡ç†è§£åŒå±‚å›æµ‹æ¶æ„ã€BulletTradeå›æµ‹å¼•æ“ã€èšå®½æ•°æ®æºé›†æˆã€PTrade/QMTéƒ¨ç½²æµç¨‹ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡å®Œæ•´çš„å›æµ‹å’Œå®ç›˜éƒ¨ç½²æµç¨‹ã€‚</p>
  
  <h3>ä¸‹èŠ‚é¢„å‘Š</h3>
  <p>æŒæ¡äº†å›æµ‹æ¡†æ¶åï¼Œä¸‹ä¸€èŠ‚å°†ä»‹ç»å›æµ‹åˆ†æå™¨ï¼ŒåŒ…æ‹¬æ”¶ç›Šåˆ†æã€é£é™©åˆ†æå’Œäº¤æ˜“åˆ†æã€‚é€šè¿‡ç†è§£å›æµ‹åˆ†æçš„æ ¸å¿ƒæŠ€æœ¯ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡å¦‚ä½•æ·±å…¥åˆ†æå›æµ‹ç»“æœï¼Œè¯†åˆ«ç­–ç•¥çš„ä¼˜ç¼ºç‚¹ã€‚</p>
  
  <a href="/ashare-book6/008_Chapter8_Backtest/8.2_Backtest_Analyzer_CN" class="next-section">
    ç»§ç»­å­¦ä¹ ï¼š8.2 å›æµ‹åˆ†æå™¨ â†’
  </a>
</div>

> **é€‚ç”¨ç‰ˆæœ¬**: v1.0.0+  
> **æœ€åæ›´æ–°**: 2025-12-12
