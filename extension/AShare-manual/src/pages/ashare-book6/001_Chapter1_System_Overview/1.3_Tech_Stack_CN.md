---
title: "1.3 技术栈选型"
description: "详细介绍后端、前端、工具链技术栈的选择理由和最佳实践，为技术决策提供参考"
lang: "zh-CN"
layout: "/src/layouts/HandbookLayout.astro"
currentBook: "ashare-book6"
updateDate: "2025-12-11"
---

# 💻 1.3 技术栈选型

> **核心摘要：**
> 
> 本节系统介绍TRQuant系统的技术栈选型，包括后端、前端、工具链的技术选择理由和最佳实践。通过理解Python后端、PyQt6桌面系统、TypeScript Cursor扩展、Astro文档站点、MCP协议、RAG知识库等技术选型，帮助开发者理解系统的技术架构和设计决策。

## 📋 章节概览

<script>
function scrollToSection(sectionId) {
  const element = document.getElementById(sectionId);
  if (element) {
    const headerOffset = 100;
    const elementPosition = element.getBoundingClientRect().top;
    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
    window.scrollTo({
      top: offsetPosition,
      behavior: 'smooth'
    });
  }
}
</script>

<div class="section-overview">
  <div class="section-item" onclick="scrollToSection('section-1-3-1')">
    <h4>🐍 1.3.1 后端技术栈</h4>
    <p>Python 3.11+、模块化设计、依赖管理</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-1-3-2')">
    <h4>🖥️ 1.3.2 桌面系统技术栈</h4>
    <p>PyQt6、GUI组件系统、样式主题</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-1-3-3')">
    <h4>🔌 1.3.3 Cursor扩展技术栈</h4>
    <p>TypeScript、React、WebView、MCP集成</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-1-3-4')">
    <h4>🚀 1.3.4 文档站点技术栈</h4>
    <p>Astro、React、静态生成、MDX支持</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-1-3-5')">
    <h4>🛠️ 1.3.5 工具链技术栈</h4>
    <p>MCP协议、RAG知识库、Strategy KB</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-1-3-6')">
    <h4>📦 1.3.6 数据存储技术栈</h4>
    <p>Chroma向量数据库、BM25索引、文件系统</p>
  </div>
</div>

<h2 id="section-1-3-1">🐍 1.3.1 后端技术栈</h2>

### Python 3.11+

**选择理由**：
- **生态丰富**：量化投资领域Python生态成熟，pandas、numpy等库完善
- **开发效率高**：语法简洁，适合快速开发和迭代
- **社区支持**：大量开源库和工具支持
- **性能平衡**：在数据处理和计算方面性能良好

### 核心依赖

<div class="comparison-table">
  <table>
    <thead>
      <tr>
        <th>依赖包</th>
        <th>版本</th>
        <th>用途</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>pandas</strong></td>
        <td>>=1.5.0</td>
        <td>数据处理和分析</td>
      </tr>
      <tr>
        <td><strong>numpy</strong></td>
        <td>>=1.21.0</td>
        <td>数值计算</td>
      </tr>
      <tr>
        <td><strong>akshare</strong></td>
        <td>>=1.10.0</td>
        <td>A股数据源</td>
      </tr>
      <tr>
        <td><strong>pymongo</strong></td>
        <td>>=4.0.0</td>
        <td>MongoDB数据库（可选）</td>
      </tr>
      <tr>
        <td><strong>langchain</strong></td>
        <td>最新</td>
        <td>RAG知识库支持</td>
      </tr>
      <tr>
        <td><strong>chromadb</strong></td>
        <td>最新</td>
        <td>向量数据库</td>
      </tr>
      <tr>
        <td><strong>sentence-transformers</strong></td>
        <td>最新</td>
        <td>文本嵌入模型</td>
      </tr>
    </tbody>
  </table>
</div>

### 模块化设计

**设计原则**：
- **依赖注入**：通过接口抽象实现模块解耦
- **单一职责**：每个模块职责清晰
- **可测试性**：支持单元测试和集成测试

<h2 id="section-1-3-2">🖥️ 1.3.2 桌面系统技术栈</h2>

### PyQt6

**选择理由**：
- **原生GUI**：提供原生桌面应用体验
- **跨平台**：支持Windows、macOS、Linux
- **功能丰富**：提供完整的GUI组件库
- **性能优秀**：原生渲染，性能好

### GUI组件系统

**核心组件**：
- **MainWindow**：主窗口，负责整体布局
- **Widgets**：功能面板组件（数据源、市场分析、策略开发等）
- **Styles**：样式系统（主题、颜色、字体）
- **Dialogs**：对话框组件

### 样式主题

支持明暗主题切换，使用CSS样式系统，提供统一的视觉体验。

<h2 id="section-1-3-3">🔌 1.3.3 Cursor扩展技术栈</h2>

### TypeScript + React

**选择理由**：
- **类型安全**：TypeScript提供类型检查，减少错误
- **组件化**：React组件化开发，易于维护
- **生态成熟**：丰富的React生态和工具链
- **IDE集成**：与Cursor IDE无缝集成

### WebView架构

**架构设计**：
```
Cursor IDE
    ↓
WebView (Chromium)
    ↓
React应用
    ↓
MCP Server (通过stdio)
    ↓
后端服务
```

### MCP集成

通过MCP协议与后端服务通信，实现：
- 工具调用（kb.query、data_collector.crawl_web等）
- 资源访问（文件、数据等）
- 实时通信（进度更新、状态同步）

<h2 id="section-1-3-4">🚀 1.3.4 文档站点技术栈</h2>

### Astro

**选择理由**：
- **静态生成**：高性能，SEO友好
- **组件化**：支持React组件，复用性强
- **MDX支持**：Markdown + JSX，灵活强大
- **构建优化**：自动代码分割和优化

### 核心特性

<div class="key-points">
  <div class="key-point">
    <h4>📄 MDX支持</h4>
    <p>支持Markdown + JSX，可以在Markdown中使用React组件</p>
  </div>
  <div class="key-point">
    <h4>🎨 主题系统</h4>
    <p>支持明暗主题切换，响应式设计</p>
  </div>
  <div class="key-point">
    <h4>🔍 搜索功能</h4>
    <p>内置搜索功能，快速定位内容</p>
  </div>
  <div class="key-point">
    <h4>📱 响应式设计</h4>
    <p>适配桌面、平板、手机等多种设备</p>
  </div>
</div>

### 依赖管理

**主要依赖**：
- `astro` (^5.11.1) - 核心框架
- `@astrojs/mdx` (^4.3.0) - MDX支持
- `mathjax-full` (^3.2.2) - 数学公式渲染
- `puppeteer` (^24.16.0) - PDF生成

<h2 id="section-1-3-5">🛠️ 1.3.5 工具链技术栈</h2>

### MCP (Model Context Protocol)

**选择理由**：
- **标准化**：统一的AI工具交互协议
- **安全控制**：权限管理和访问控制
- **可扩展**：支持自定义工具和资源
- **跨平台**：支持多种编程语言

### RAG知识库

**技术栈**：
- **LangChain**：知识库框架
- **Chroma**：向量数据库
- **sentence-transformers**：文本嵌入模型
- **rank-bm25**：关键词检索
- **CrossEncoder**：重排序模型

### Strategy KB

**技术栈**：
- **结构化存储**：JSON格式存储策略知识
- **规则引擎**：策略规则验证
- **LangChain集成**：与LangChain集成，支持策略生成

<h2 id="section-1-3-6">📦 1.3.6 数据存储技术栈</h2>

### 分层/多存储架构（Polyglot Persistence）

TRQuant系统采用**分层/多存储（Polyglot Persistence）**架构，根据数据类型选择最适合的存储方案。

### 主数据库：PostgreSQL

**选择理由**：
- **成熟ACID**：完整的事务支持，保证数据一致性
- **强约束**：外键、唯一键、检查约束，保证数据完整性
- **SQL生态**：丰富的SQL功能和工具链
- **审计体系**：完善的权限管理和审计功能
- **JSONB支持**：支持半结构化数据存储和检索

**存储内容**：
- 策略仓库（策略元数据、版本、参数集）
- 审批流（策略评审、风控审批、变更记录）
- 实盘账务（账户、订单、成交、持仓、资金流水）
- 审计日志（操作记录、可追溯性）

### 时序分析库：ClickHouse 或 TimescaleDB

**ClickHouse（极致分析）**：
- **列式存储**：压缩率高，查询性能极佳
- **向量化执行**：适合高频聚合分析
- **大规模数据**：支持全市场分钟/逐笔数据
- **适用场景**：回测指标批量生成、分层回测、滚动窗口分析

**TimescaleDB（一体化）**：
- **PostgreSQL扩展**：保留Postgres生态和工具链
- **时序优化**：时序查询优化、压缩与保留策略
- **中等规模**：适合因子库/分钟线规模中等场景
- **适用场景**：希望一体化方案，但又需要较强时序能力

**存储内容**：
- 行情数据（OHLCV日/分钟/Tick）
- 因子数据（每日/每分钟因子矩阵）
- 回测输出（净值曲线、持仓快照）
- 实盘监控（PnL曲线、回撤、风控事件时间线）

**补充方案**：也可使用 **Parquet/HDF5** 文件缓存作为补充

### 对象存储：MinIO/S3

**选择理由**：
- **大文件存储**：适合存储HTML/PDF报告、图表等大文件
- **版本管理**：支持对象版本控制
- **访问控制**：支持细粒度权限控制
- **成本优化**：数据库只存元数据，降低数据库压力

**存储内容**：
- 回测报告（HTML/PDF格式）
- 图表产物（策略图表、分析图表）
- 研究文档（研究笔记、策略说明、Prompt版本快照）

### 缓存/队列：Redis

**选择理由**：
- **高性能**：内存存储，访问速度快
- **丰富数据结构**：支持String、Hash、List、Set、Sorted Set等
- **发布/订阅**：支持实时消息推送
- **过期策略**：支持TTL自动过期

**存储内容**：
- 行情快照缓存（实时行情数据缓存）
- 任务队列（回测任务、数据更新任务）
- 风控状态机（短期状态存储）

### 向量数据库：Chroma

**选择理由**：
- **轻量级**：无需独立服务器，文件存储
- **易集成**：与LangChain无缝集成
- **性能好**：向量检索性能优秀
- **开源免费**：MIT许可证

**存储内容**：
- Manual KB（开发手册知识库）
- Engineering KB（工程知识库）

### 关键词检索：BM25

**选择理由**：
- **经典算法**：BM25是成熟的检索算法
- **轻量级**：内存占用小，检索速度快
- **互补性**：与向量检索互补，提升检索质量

### 混合检索策略

**实现方式**：
1. **向量检索**：语义相似度检索
2. **BM25检索**：关键词匹配检索
3. **结果融合**：Reciprocal Rank Fusion (RRF)
4. **重排序**：CrossEncoder重新排序

<div class="tip-box">
  <h4>💡 数据库架构设计原则</h4>
  <p>TRQuant系统采用<strong>分层/多存储（Polyglot Persistence）</strong>架构，根据数据类型选择最适合的存储方案。关键业务数据使用PostgreSQL保证强一致性和可审计性，时序数据使用时序库保证高性能分析，文档数据使用对象存储降低成本，缓存数据使用Redis保证高性能访问。详细设计请参考<strong>1.9 数据库架构设计</strong>章节。</p>
</div>

<div class="tip-box">
  <h4>💡 技术选型原则</h4>
  <p>TRQuant系统的技术选型遵循以下原则：<strong>成熟稳定</strong>、<strong>生态丰富</strong>、<strong>易于集成</strong>、<strong>性能优秀</strong>。所有技术选型都经过充分评估，确保系统的稳定性和可维护性。</p>
</div>

## 🔗 相关章节

- **1.2 系统架构总览**：了解系统的整体架构设计
- **1.6 桌面系统架构**：深入了解PyQt6桌面系统
- **1.7 Cursor扩展架构**：深入了解Cursor扩展实现
- **1.8 前端技术栈**：深入了解Astro文档站点
- **1.9 数据库架构设计**：深入了解分层/多存储架构设计
- **10.7 MCP Server开发指南**：掌握MCP服务器开发
- **10.10 RAG知识库开发指南**：掌握RAG知识库开发

## 💡 关键要点

1. **技术选型原则**：成熟稳定、生态丰富、易于集成、性能优秀
2. **后端技术**：Python 3.11+，模块化设计，依赖注入
3. **前端技术**：PyQt6（桌面）、TypeScript+React（扩展）、Astro（文档）
4. **工具链技术**：MCP协议、RAG知识库、Strategy KB
5. **数据存储**：分层/多存储架构
   - PostgreSQL：主数据库（强事务/强审计）
   - ClickHouse/TimescaleDB：时序分析库（OLAP/TSDB）
   - MinIO/S3：对象存储（文档/文件）
   - Redis：缓存/队列（高性能内存存储）
   - Chroma：向量数据库（知识库）
   - BM25：关键词检索

---

*最后更新: 2025-12-11*  
*适用版本: v1.0.0+*
