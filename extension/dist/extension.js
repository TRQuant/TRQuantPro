(()=>{"use strict";var n={3:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.TRQuantClient=void 0;const i=o(t(317)),d=o(t(928)),c=o(t(857)),l=o(t(896)),p=t(628),m=t(478),u=t(799);e.TRQuantClient=class{MODULE="TRQuantClient";extensionPath;configManager;constructor(n){this.extensionPath=n.extensionPath,this.configManager=m.ConfigManager.getInstance(),p.logger.info("TRQuantClientåˆå§‹åŒ–å®Œæˆ",this.MODULE)}async getMarketStatus(n){return this.callBridge("get_market_status",{universe:n?.universe||"CN_EQ",as_of:n?.as_of||this.getTodayDate(),lookback_days:n?.lookback_days||60})}async getMainlines(n){return this.callBridge("get_mainlines",{top_n:n?.top_n||20,time_horizon:n?.time_horizon||"short"})}async recommendFactors(n){return this.callBridge("recommend_factors",{market_regime:n?.market_regime,mainlines:n?.mainlines,top_n:n?.top_n||10})}async generateStrategy(n){u.ErrorHandler.validateRequired(n,["factors"]);const e={max_position:n.risk_params?.max_position||this.configManager.get("defaultRiskParams").maxPosition,stop_loss:n.risk_params?.stop_loss||this.configManager.get("defaultRiskParams").stopLoss,take_profit:n.risk_params?.take_profit||this.configManager.get("defaultRiskParams").takeProfit};return this.callBridge("generate_strategy",{factors:n.factors,style:n.style||this.configManager.get("defaultStyle"),platform:n.platform||this.configManager.get("defaultPlatform"),risk_params:e})}async analyzeBacktest(n){return this.callBridge("analyze_backtest",n)}async assessRisk(n){return u.ErrorHandler.validateRequired(n,["portfolio"]),this.callBridge("risk_assessment",n)}async healthCheck(){try{return(await this.callBridge("health_check",{})).ok}catch{return!1}}async callBridge(n,e){const t=Date.now();p.logger.debug(`è°ƒç”¨Bridge: ${n}`,this.MODULE,{params:e});try{const a=await this.executeSubprocess(n,e),r=Date.now()-t;return p.logger.info(`Bridgeè°ƒç”¨å®Œæˆ: ${n}`,this.MODULE,{duration:`${r}ms`,ok:a.ok}),a}catch(e){const a=Date.now()-t;throw p.logger.error(`Bridgeè°ƒç”¨å¤±è´¥: ${n}`,this.MODULE,{duration:`${a}ms`,error:e instanceof Error?e.message:String(e)}),e}}executeSubprocess(n,e){return new Promise((t,a)=>{const r=this.configManager.getPythonPath(this.extensionPath),s=d.join(this.extensionPath,"python","bridge.py"),o=this.configManager.get("timeout"),m={action:n,params:e},g=JSON.stringify(m);if(p.logger.debug(`æ‰§è¡ŒPython: ${r}`,this.MODULE,{bridgePath:s}),"win32"!==c.platform()&&!l.existsSync(r))return p.logger.error(`Pythonè§£é‡Šå™¨è·¯å¾„ä¸å­˜åœ¨: ${r}`,this.MODULE),void a(new u.TRQuantError(u.ErrorCode.PYTHON_NOT_FOUND,`Pythonè§£é‡Šå™¨æœªæ‰¾åˆ°: ${r}`,{pythonPath:r,bridgePath:s}));let f=d.dirname(this.extensionPath);f=this.extensionPath.endsWith("extension")||this.extensionPath.endsWith("extension/")?d.dirname(this.extensionPath):process.env.TRQUANT_ROOT||f;const v={...process.env,PYTHONIOENCODING:"utf-8",TRQUANT_ROOT:f,PYTHONPATH:d.join(this.extensionPath,"python")},h=i.spawn(r,[s],{cwd:d.join(this.extensionPath,"python"),env:v,stdio:["pipe","pipe","pipe"]});let b="",y="";h.stdout?.on("data",n=>{b+=n.toString()}),h.stderr?.on("data",n=>{y+=n.toString()});const w=setTimeout(()=>{h.kill("SIGTERM"),a(new u.TRQuantError(u.ErrorCode.TIMEOUT,`æ“ä½œè¶…æ—¶ (${o}ms)`,{action:n}))},o);h.on("close",e=>{if(clearTimeout(w),0!==e)return p.logger.error(`Pythonè¿›ç¨‹é€€å‡º: ${e}`,this.MODULE,{stderr:y}),void a(new u.PythonError(y||`è¿›ç¨‹é€€å‡ºç : ${e}`,{action:n,code:e,stderr:y}));try{const n=JSON.parse(b.trim());t(n)}catch(n){p.logger.error("å“åº”è§£æå¤±è´¥",this.MODULE,{stdout:b}),a(new u.TRQuantError(u.ErrorCode.BRIDGE_RESPONSE_PARSE_ERROR,"æ— æ³•è§£æåç«¯å“åº”",{stdout:b,parseError:n instanceof Error?n.message:String(n)}))}}),h.on("error",n=>{clearTimeout(w),p.logger.error("è¿›ç¨‹å¯åŠ¨å¤±è´¥",this.MODULE,{error:n.message}),n.message.includes("ENOENT")?a(new u.TRQuantError(u.ErrorCode.PYTHON_NOT_FOUND,`Pythonè§£é‡Šå™¨æœªæ‰¾åˆ°: ${r}`,{pythonPath:r})):a(new u.PythonError(n.message,{error:n}))}),h.stdin?.write(g),h.stdin?.end()})}getTodayDate(){return(new Date).toISOString().split("T")[0]}dispose(){p.logger.info("TRQuantClientå·²é‡Šæ”¾",this.MODULE)}}},82:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.OptimizerPanel=void 0;const i=o(t(398)),d=t(628),c=t(290),l="OptimizerPanel",p=[{id:"grid_search",name:"ç½‘æ ¼æœç´¢",icon:"ğŸ”²",tool:"optimizer.grid_search",description:"ç©·ä¸¾æ‰€æœ‰å‚æ•°ç»„åˆï¼Œæ‰¾åˆ°æœ€ä¼˜é…ç½®"},{id:"optuna",name:"Optunaæ™ºèƒ½ä¼˜åŒ–",icon:"ğŸ§ ",tool:"optimizer.optuna",description:"TPEç®—æ³•æ™ºèƒ½æœç´¢æœ€ä¼˜å‚æ•°"},{id:"walk_forward",name:"æ»šåŠ¨éªŒè¯",icon:"ğŸ“Š",tool:"optimizer.walk_forward",description:"æ ·æœ¬å¤–éªŒè¯ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ"}],m=[{name:"lookback",label:"å›çœ‹å‘¨æœŸ",min:5,max:60,step:5,default:[10,20,30]},{name:"top_n",label:"é€‰è‚¡æ•°é‡",min:3,max:30,step:3,default:[5,10,15]},{name:"stop_loss",label:"æ­¢æŸæ¯”ä¾‹",min:.03,max:.15,step:.02,default:[.05,.08,.1]},{name:"take_profit",label:"æ­¢ç›ˆæ¯”ä¾‹",min:.1,max:.5,step:.05,default:[.15,.2,.3]}];class u{static currentPanel;_panel;_extensionUri;_client;_disposables=[];_strategyCode="";_baseResult=null;_optimizeResults=[];constructor(n,e,t,a){this._panel=n,this._extensionUri=e,this._client=t,this._strategyCode=a?.code||"",this._baseResult=a?.baseResult||null,this._panel.webview.html=this._getHtmlContent(),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.onDidReceiveMessage(n=>this._handleMessage(n),null,this._disposables)}static createOrShow(n,e,t){d.logger.info("åˆ›å»ºä¼˜åŒ–é¢æ¿V2",l);const a=i.ViewColumn.One;if(u.currentPanel)return u.currentPanel._panel.reveal(a),u.currentPanel;const r=i.window.createWebviewPanel("trquantOptimizerV2","âš™ï¸ å‚æ•°ä¼˜åŒ–",a,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[n]});return u.currentPanel=new u(r,n,e,t),u.currentPanel}dispose(){for(u.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const n=this._disposables.pop();n&&n.dispose()}}async _handleMessage(n){switch(d.logger.info(`[OptimizerPanel] æ”¶åˆ°æ¶ˆæ¯: ${n.command}`,l),n.command){case"runOptimize":await this._runOptimize(n.method,n.config);break;case"applyBest":await this._applyBestParams(n.params);break;case"generateReport":await this._generateCompareReport()}}async _runOptimize(n,e){const t=p.find(e=>e.id===n);if(t){this._postMessage({command:"optimizeStarted",method:n});try{const a=Date.now(),r={strategy_type:e.strategyType||"momentum",securities:e.securities||["000001.XSHE","600000.XSHG"],start_date:e.startDate,end_date:e.endDate};"grid_search"===n?r.param_ranges=e.paramRanges:"optuna"===n?(r.param_space=e.paramRanges,r.n_trials=e.nTrials||50):"walk_forward"===n&&(r.window_size=e.windowSize||252),d.logger.info(`æ‰§è¡Œä¼˜åŒ–: ${t.tool}`,l,r);const s=await this._client.callBridge("call_mcp_tool",{tool_name:t.tool,arguments:r,trace_id:(0,c.generateTraceId)()}),o=(Date.now()-a)/1e3;if(!s.ok||!s.data)throw new Error(s.error||"ä¼˜åŒ–å¤±è´¥");this._optimizeResults=s.data.all_results||[],this._postMessage({command:"optimizeCompleted",method:n,result:s.data,duration:o}),d.logger.info(`ä¼˜åŒ–å®Œæˆ: ${n}, è€—æ—¶ ${o.toFixed(2)}s`,l)}catch(e){d.logger.error(`ä¼˜åŒ–å¤±è´¥: ${e.message}`,l),this._postMessage({command:"optimizeFailed",method:n,error:e.message}),i.window.showErrorMessage(`ä¼˜åŒ–å¤±è´¥: ${e.message}`)}}else i.window.showErrorMessage(`æœªçŸ¥ä¼˜åŒ–æ–¹æ³•: ${n}`)}async _applyBestParams(n){await i.commands.executeCommand("trquant.openStrategyGenerator",{params:n})}async _generateCompareReport(){if(0!==this._optimizeResults.length)try{const n=await this._client.callBridge("call_mcp_tool",{tool_name:"report.compare",arguments:{results:this._optimizeResults.slice(0,10)},trace_id:(0,c.generateTraceId)()});n.ok&&n.data&&i.window.showInformationMessage(`å¯¹æ¯”æŠ¥å‘Šå·²ç”Ÿæˆ: ${n.data.file_path}`)}catch(n){i.window.showErrorMessage(`æŠ¥å‘Šç”Ÿæˆå¤±è´¥: ${n.message}`)}else i.window.showWarningMessage("è¯·å…ˆè¿è¡Œä¼˜åŒ–")}_postMessage(n){this._panel.webview.postMessage(n)}_getHtmlContent(){const n=p.map(n=>`\n            <div class="method-card" data-method="${n.id}">\n                <span class="method-icon">${n.icon}</span>\n                <div class="method-info">\n                    <div class="method-name">${n.name}</div>\n                    <div class="method-desc">${n.description}</div>\n                </div>\n                <input type="radio" name="method" value="${n.id}" ${"grid_search"===n.id?"checked":""}>\n            </div>\n        `).join(""),e=m.map(n=>`\n            <div class="param-config">\n                <div class="param-header">\n                    <label>\n                        <input type="checkbox" class="param-enabled" data-param="${n.name}" checked>\n                        ${n.label}\n                    </label>\n                </div>\n                <div class="param-values">\n                    <input type="text" class="param-range" data-param="${n.name}" \n                           value="${n.default.join(", ")}" \n                           placeholder="è¾“å…¥å€¼ï¼Œé€—å·åˆ†éš”">\n                </div>\n            </div>\n        `).join(""),t=new Date;return t.setMonth(t.getMonth()-6),`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>å‚æ•°ä¼˜åŒ–</title>\n    <style>\n        :root {\n            --bg-primary: #0d1117;\n            --bg-secondary: #161b22;\n            --bg-tertiary: #21262d;\n            --text-primary: #f0f6fc;\n            --text-secondary: #8b949e;\n            --border-primary: #30363d;\n            --accent: #58a6ff;\n            --success: #3fb950;\n            --warning: #d29922;\n            --error: #f85149;\n        }\n        \n        * { box-sizing: border-box; margin: 0; padding: 0; }\n        \n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n        }\n        \n        .header h1 { font-size: 24px; margin-bottom: 8px; }\n        .header { margin-bottom: 24px; }\n        \n        .main-grid {\n            display: grid;\n            grid-template-columns: 400px 1fr;\n            gap: 24px;\n        }\n        \n        .config-panel, .result-panel {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-primary);\n            border-radius: 12px;\n            padding: 20px;\n        }\n        \n        .section-title {\n            font-size: 14px;\n            font-weight: 600;\n            color: var(--text-secondary);\n            margin-bottom: 12px;\n        }\n        \n        .methods-list {\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n            margin-bottom: 24px;\n        }\n        \n        .method-card {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            padding: 12px;\n            background: var(--bg-tertiary);\n            border: 2px solid transparent;\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n        \n        .method-card:hover,\n        .method-card:has(input:checked) {\n            border-color: var(--accent);\n        }\n        \n        .method-icon { font-size: 24px; }\n        .method-info { flex: 1; }\n        .method-name { font-weight: 600; }\n        .method-desc { font-size: 12px; color: var(--text-secondary); }\n        \n        .method-card input { display: none; }\n        \n        .params-config {\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n            margin-bottom: 24px;\n        }\n        \n        .param-config {\n            background: var(--bg-tertiary);\n            border-radius: 8px;\n            padding: 12px;\n        }\n        \n        .param-header {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            margin-bottom: 8px;\n        }\n        \n        .param-header label {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            cursor: pointer;\n        }\n        \n        .param-range {\n            width: 100%;\n            padding: 8px;\n            background: var(--bg-primary);\n            border: 1px solid var(--border-primary);\n            border-radius: 4px;\n            color: var(--text-primary);\n            font-size: 13px;\n        }\n        \n        .form-row {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 12px;\n            margin-bottom: 16px;\n        }\n        \n        .form-group label {\n            display: block;\n            font-size: 12px;\n            color: var(--text-secondary);\n            margin-bottom: 4px;\n        }\n        \n        .form-group input {\n            width: 100%;\n            padding: 8px;\n            background: var(--bg-tertiary);\n            border: 1px solid var(--border-primary);\n            border-radius: 4px;\n            color: var(--text-primary);\n        }\n        \n        .btn {\n            width: 100%;\n            padding: 12px;\n            border: none;\n            border-radius: 8px;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 600;\n            transition: all 0.2s;\n        }\n        \n        .btn-primary {\n            background: var(--accent);\n            color: white;\n        }\n        \n        .btn-primary:hover { opacity: 0.9; }\n        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }\n        \n        .progress-container {\n            margin-bottom: 24px;\n        }\n        \n        .progress-bar {\n            height: 8px;\n            background: var(--bg-tertiary);\n            border-radius: 4px;\n            overflow: hidden;\n        }\n        \n        .progress-fill {\n            height: 100%;\n            background: linear-gradient(90deg, var(--accent), var(--success));\n            width: 0%;\n            transition: width 0.3s;\n        }\n        \n        .progress-text {\n            text-align: center;\n            margin-top: 8px;\n            font-size: 12px;\n            color: var(--text-secondary);\n        }\n        \n        .best-result {\n            background: rgba(63, 185, 80, 0.1);\n            border: 2px solid var(--success);\n            border-radius: 12px;\n            padding: 20px;\n            margin-bottom: 24px;\n        }\n        \n        .best-title {\n            font-size: 16px;\n            font-weight: 600;\n            color: var(--success);\n            margin-bottom: 12px;\n        }\n        \n        .best-metrics {\n            display: grid;\n            grid-template-columns: repeat(3, 1fr);\n            gap: 12px;\n            margin-bottom: 16px;\n        }\n        \n        .best-metric {\n            text-align: center;\n        }\n        \n        .best-metric-value {\n            font-size: 20px;\n            font-weight: 700;\n            color: var(--success);\n        }\n        \n        .best-metric-label {\n            font-size: 11px;\n            color: var(--text-secondary);\n        }\n        \n        .best-params {\n            font-size: 13px;\n            color: var(--text-secondary);\n        }\n        \n        .results-table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n        \n        .results-table th, .results-table td {\n            padding: 10px;\n            text-align: left;\n            border-bottom: 1px solid var(--border-primary);\n            font-size: 13px;\n        }\n        \n        .results-table th {\n            color: var(--text-secondary);\n            font-weight: 600;\n        }\n        \n        .results-table tr:hover {\n            background: var(--bg-tertiary);\n        }\n        \n        .placeholder {\n            text-align: center;\n            padding: 40px;\n            color: var(--text-secondary);\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <h1>âš™ï¸ å‚æ•°ä¼˜åŒ–</h1>\n        <p style="color: var(--text-secondary);">æœç´¢æœ€ä¼˜ç­–ç•¥å‚æ•°ï¼Œæå‡ç­–ç•¥è¡¨ç°</p>\n    </div>\n    \n    <div class="main-grid">\n        <div class="config-panel">\n            <div class="section-title">ğŸ”§ ä¼˜åŒ–æ–¹æ³•</div>\n            <div class="methods-list">\n                ${n}\n            </div>\n            \n            <div class="section-title">ğŸ“Š å‚æ•°èŒƒå›´</div>\n            <div class="params-config">\n                ${e}\n            </div>\n            \n            <div class="section-title">ğŸ“… å›æµ‹åŒºé—´</div>\n            <div class="form-row">\n                <div class="form-group">\n                    <label>å¼€å§‹æ—¥æœŸ</label>\n                    <input type="date" id="start-date" value="${t.toISOString().split("T")[0]}">\n                </div>\n                <div class="form-group">\n                    <label>ç»“æŸæ—¥æœŸ</label>\n                    <input type="date" id="end-date" value="${(new Date).toISOString().split("T")[0]}">\n                </div>\n            </div>\n            \n            <button class="btn btn-primary" id="optimize-btn" onclick="runOptimize()">\n                ğŸš€ å¼€å§‹ä¼˜åŒ–\n            </button>\n        </div>\n        \n        <div class="result-panel">\n            <div class="section-title">ğŸ“ˆ ä¼˜åŒ–ç»“æœ</div>\n            \n            <div class="progress-container" id="progress" style="display: none;">\n                <div class="progress-bar">\n                    <div class="progress-fill" id="progress-fill"></div>\n                </div>\n                <div class="progress-text" id="progress-text">å‡†å¤‡ä¸­...</div>\n            </div>\n            \n            <div id="result-content">\n                <div class="placeholder">é…ç½®å‚æ•°èŒƒå›´å¹¶ç‚¹å‡»"å¼€å§‹ä¼˜åŒ–"</div>\n            </div>\n        </div>\n    </div>\n    \n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        function getSelectedMethod() {\n            const checked = document.querySelector('input[name="method"]:checked');\n            return checked ? checked.value : 'grid_search';\n        }\n        \n        function getParamRanges() {\n            const ranges = {};\n            document.querySelectorAll('.param-config').forEach(config => {\n                const enabled = config.querySelector('.param-enabled');\n                const input = config.querySelector('.param-range');\n                \n                if (enabled.checked) {\n                    const param = enabled.dataset.param;\n                    const values = input.value.split(',').map(v => parseFloat(v.trim())).filter(v => !isNaN(v));\n                    if (values.length > 0) {\n                        ranges[param] = values;\n                    }\n                }\n            });\n            return ranges;\n        }\n        \n        function runOptimize() {\n            const btn = document.getElementById('optimize-btn');\n            btn.disabled = true;\n            btn.textContent = 'ä¼˜åŒ–ä¸­...';\n            \n            document.getElementById('progress').style.display = 'block';\n            \n            vscode.postMessage({\n                command: 'runOptimize',\n                method: getSelectedMethod(),\n                config: {\n                    paramRanges: getParamRanges(),\n                    startDate: document.getElementById('start-date').value,\n                    endDate: document.getElementById('end-date').value,\n                    strategyType: 'momentum',\n                    securities: ['000001.XSHE', '600000.XSHG', '000002.XSHE']\n                }\n            });\n        }\n        \n        function applyBest(params) {\n            vscode.postMessage({ command: 'applyBest', params });\n        }\n        \n        function formatPercent(value) {\n            return (value * 100).toFixed(2) + '%';\n        }\n        \n        function renderResult(result) {\n            const content = document.getElementById('result-content');\n            const best = result.best_params || {};\n            const allResults = result.all_results || [];\n            \n            let html = '';\n            \n            // æœ€ä½³ç»“æœ\n            html += \`\n                <div class="best-result">\n                    <div class="best-title">ğŸ† æœ€ä¼˜å‚æ•°ç»„åˆ</div>\n                    <div class="best-metrics">\n                        <div class="best-metric">\n                            <div class="best-metric-value">\${(result.best_sharpe || 0).toFixed(2)}</div>\n                            <div class="best-metric-label">å¤æ™®æ¯”ç‡</div>\n                        </div>\n                        <div class="best-metric">\n                            <div class="best-metric-value">\${formatPercent(result.best_return || 0)}</div>\n                            <div class="best-metric-label">æ€»æ”¶ç›Š</div>\n                        </div>\n                        <div class="best-metric">\n                            <div class="best-metric-value">\${result.total_trials || 0}</div>\n                            <div class="best-metric-label">æµ‹è¯•ç»„åˆæ•°</div>\n                        </div>\n                    </div>\n                    <div class="best-params">\n                        <strong>æœ€ä¼˜å‚æ•°:</strong> \${JSON.stringify(best)}\n                    </div>\n                    <button class="btn btn-primary" style="margin-top: 12px;" onclick='applyBest(\${JSON.stringify(best)})'>\n                        âœ… åº”ç”¨æœ€ä¼˜å‚æ•°\n                    </button>\n                </div>\n            \`;\n            \n            // æ‰€æœ‰ç»“æœè¡¨æ ¼\n            if (allResults.length > 0) {\n                html += \`\n                    <div class="section-title">ğŸ“‹ æ‰€æœ‰ç»“æœ (Top 20)</div>\n                    <table class="results-table">\n                        <tr>\n                            <th>æ’å</th>\n                            <th>å‚æ•°</th>\n                            <th>å¤æ™®</th>\n                            <th>æ”¶ç›Š</th>\n                            <th>å›æ’¤</th>\n                        </tr>\n                        \${allResults.slice(0, 20).map((r, i) => \`\n                            <tr>\n                                <td>\${i + 1}</td>\n                                <td>\${JSON.stringify(r.params || {})}</td>\n                                <td>\${(r.sharpe || 0).toFixed(2)}</td>\n                                <td>\${formatPercent(r.return_pct || 0)}</td>\n                                <td>\${formatPercent(Math.abs(r.drawdown || 0))}</td>\n                            </tr>\n                        \`).join('')}\n                    </table>\n                \`;\n            }\n            \n            content.innerHTML = html;\n        }\n        \n        window.addEventListener('message', event => {\n            const message = event.data;\n            const btn = document.getElementById('optimize-btn');\n            const progress = document.getElementById('progress');\n            \n            switch (message.command) {\n                case 'optimizeStarted':\n                    document.getElementById('progress-fill').style.width = '10%';\n                    document.getElementById('progress-text').textContent = 'æ­£åœ¨æœç´¢æœ€ä¼˜å‚æ•°...';\n                    break;\n                    \n                case 'optimizeCompleted':\n                    btn.disabled = false;\n                    btn.textContent = 'ğŸš€ å¼€å§‹ä¼˜åŒ–';\n                    progress.style.display = 'none';\n                    renderResult(message.result);\n                    break;\n                    \n                case 'optimizeFailed':\n                    btn.disabled = false;\n                    btn.textContent = 'ğŸš€ å¼€å§‹ä¼˜åŒ–';\n                    progress.style.display = 'none';\n                    document.getElementById('result-content').innerHTML = \n                        '<div class="placeholder" style="color: var(--error);">ä¼˜åŒ–å¤±è´¥: ' + message.error + '</div>';\n                    break;\n            }\n        });\n        \n        // æ–¹æ³•å¡ç‰‡ç‚¹å‡»\n        document.querySelectorAll('.method-card').forEach(card => {\n            card.addEventListener('click', () => {\n                card.querySelector('input').checked = true;\n            });\n        });\n    <\/script>\n</body>\n</html>`}}e.OptimizerPanel=u},126:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.MainDashboard=void 0,e.registerMainDashboard=function(n,e){n.subscriptions.push(i.commands.registerCommand("trquant.openDashboard",()=>{m.createOrShow(n.extensionUri,e)})),l.logger.info("æŠ•èµ„å·¥ä½œæµä»ªè¡¨ç›˜å·²æ³¨å†Œ",p)},e.showMainDashboard=function(n,e){m.createOrShow(n,e)};const i=o(t(398)),d=o(t(896)),c=o(t(928)),l=t(628),p="MainDashboard";class m{static currentPanel;_panel;_extensionUri;_client;_extensionPath;_disposables=[];_marketStatus=null;_mainlines=[];_factors=[];constructor(n,e,t,a){this._panel=n,this._extensionUri=e,this._client=t,this._extensionPath=a,this._panel.webview.onDidReceiveMessage(n=>this.handleMessage(n),null,this._disposables),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this.updateContent(),this.refreshAllData()}static createOrShow(n,e,t){const a=i.ViewColumn.One;if(m.currentPanel)return m.currentPanel._panel.reveal(a),m.currentPanel;let r=t;if(!r){const e=i.extensions.getExtension("trquant.trquant-cursor-extension");r=e?.extensionPath||n.fsPath}const s=i.window.createWebviewPanel("trquantDashboard","ğŸ‰ éŸ¬ç¿é‡åŒ–å·¥ä½œå°",a,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[n]});return m.currentPanel=new m(s,n,e,r),m.currentPanel}async handleMessage(n){switch(console.log("[MainDashboard] æ”¶åˆ°æ¶ˆæ¯:",n.command),n.command){case"openStep":await this.openWorkflowStep(n.step);break;case"refreshAll":await this.refreshAllData();break;case"refreshMarket":await this.refreshMarketStatus();break;case"refreshMainlines":await this.refreshMainlines();break;case"refreshFactors":await this.refreshFactors();break;case"createProject":console.log("[MainDashboard] æ‰§è¡Œ createProject å‘½ä»¤"),await i.commands.executeCommand("trquant.createProject");break;case"openProject":i.commands.executeCommand("trquant.openProject");break;case"openBacktestConfig":i.commands.executeCommand("trquant.openBacktestConfig");break;case"generateStrategy":i.commands.executeCommand("trquant.generateStrategy");break;case"showLogs":i.commands.executeCommand("trquant.showLogs");break;case"openSettings":i.commands.executeCommand("trquant.openSettings");break;case"openFileManager":i.commands.executeCommand("trquant.openFileManager");break;case"launchFileDashboard":await this.launchFileDashboard();break;case"openKnowledgeBase":i.commands.executeCommand("trquant.openKnowledgeBase");break;case"openAShareManual":i.commands.executeCommand("trquant.openAShareManual");break;case"launchAShareManual":await this.launchAShareManual();break;case"runFullWorkflow":await this.runFullWorkflow();break;case"openWorkflowPanel":console.log("[MainDashboard] å‡†å¤‡å¯åŠ¨æ¡Œé¢ç³»ç»Ÿ");try{await i.commands.executeCommand("trquant.openWorkflowPanel"),console.log("[MainDashboard] æ¡Œé¢ç³»ç»Ÿå¯åŠ¨å‘½ä»¤å·²æ‰§è¡Œ")}catch(n){console.error("[MainDashboard] å¯åŠ¨æ¡Œé¢ç³»ç»Ÿå¤±è´¥:",n),i.window.showErrorMessage(`å¯åŠ¨æ¡Œé¢ç³»ç»Ÿå¤±è´¥: ${n}`)}break;case"generateInvestmentReport":await this.generateInvestmentReport();break;case"syncFileChanges":await this.syncFileChanges();break;case"exportDatabase":await this.exportDatabase();break;case"openFile":await this.openFile(n.path);break;case"optimizeStrategy":i.commands.executeCommand("trquant.optimizeStrategy")}}async openWorkflowStep(n){const e={1:{id:"data_source",name:"ä¿¡æ¯è·å–"},2:{id:"market_trend",name:"å¸‚åœºè¶‹åŠ¿"},3:{id:"mainline",name:"æŠ•èµ„ä¸»çº¿"},4:{id:"candidate_pool",name:"å€™é€‰æ± æ„å»º"},5:{id:"factor",name:"å› å­æ„å»º"},6:{id:"strategy",name:"ç­–ç•¥ç”Ÿæˆ"},7:{id:"backtest",name:"å›æµ‹éªŒè¯"},8:{id:"optimization",name:"ç­–ç•¥ä¼˜åŒ–"},9:{id:"report",name:"æŠ¥å‘Šç”Ÿæˆ"}}[n];if(e)if(7!==n){this._panel.webview.postMessage({command:"stepStarted",step:n,stepId:e.id,stepName:e.name});try{const t=await this._client.callBridge("call_mcp_tool",{tool_name:"workflow.run_step",arguments:{workflow_id:"default_workflow",step_index:n-1,step_args:{}}}),a=t.summary||(t.ok?"æ‰§è¡ŒæˆåŠŸ":"æ‰§è¡Œå¤±è´¥"),r=t.data||{};this._panel.webview.postMessage({command:"stepResult",step:n,stepId:e.id,stepName:e.name,success:t.ok,summary:a,details:r,error:t.error})}catch(t){l.logger.error(`æ­¥éª¤${n}æ‰§è¡Œå¤±è´¥: ${t}`,p),this._panel.webview.postMessage({command:"stepResult",step:n,stepId:e.id,stepName:e.name,success:!1,summary:`æ‰§è¡Œå¤±è´¥: ${t}`,details:{},error:String(t)})}}else i.commands.executeCommand("trquant.openBacktestConfig")}async refreshAllData(){this._panel.webview.postMessage({command:"loadingStart"}),await Promise.all([this.refreshMarketStatus(),this.refreshMainlines(),this.refreshFactors()]),this._panel.webview.postMessage({command:"loadingEnd"})}async refreshMarketStatus(){try{const n=await this._client.getMarketStatus();if(n.ok&&n.data){this._marketStatus=n.data;const e={regime:this._marketStatus.regime,regime_cn:this.getRegimeCN(this._marketStatus.regime),indices:this.formatIndices(this._marketStatus.index_trend),style_rotation:this._marketStatus.style_rotation?.[0]?.style||"å‡è¡¡"};this._panel.webview.postMessage({command:"marketStatusUpdated",data:e})}}catch(n){l.logger.error(`è·å–å¸‚åœºçŠ¶æ€å¤±è´¥: ${n}`,p)}}getRegimeCN(n){return{risk_on:"é£é™©åå¥½",risk_off:"é£é™©è§„é¿",neutral:"ä¸­æ€§"}[n]||n}formatIndices(n){const e=[],t={sh_index:"ä¸Šè¯æŒ‡æ•°",sz_index:"æ·±è¯æˆæŒ‡",cy_index:"åˆ›ä¸šæ¿æŒ‡"};for(const[a,r]of Object.entries(n||{}))e.push({name:t[a]||a,value:r?.zscore||0,change:r?.change_pct||0});return e}async refreshMainlines(){try{const n=await this._client.getMainlines({time_horizon:"short",top_n:5});n.ok&&n.data&&(this._mainlines=n.data,this._panel.webview.postMessage({command:"mainlinesUpdated",data:this._mainlines}))}catch(n){l.logger.error(`è·å–æŠ•èµ„ä¸»çº¿å¤±è´¥: ${n}`,p)}}async refreshFactors(){try{const n=this._marketStatus?.regime||"neutral",e=await this._client.recommendFactors({market_regime:n,top_n:5});e.ok&&e.data&&(this._factors=e.data,this._panel.webview.postMessage({command:"factorsUpdated",data:this._factors}))}catch(n){l.logger.error(`è·å–æ¨èå› å­å¤±è´¥: ${n}`,p)}}async runFullWorkflow(){l.logger.info("=== ä¸€é”®æ‰§è¡Œå®Œæ•´æŠ•èµ„å·¥ä½œæµ ===",p);const n=[{id:"step1",name:"ğŸ“¡ ä¿¡æ¯è·å–",step_id:"data_source",step_index:0},{id:"step2",name:"ğŸ“ˆ å¸‚åœºè¶‹åŠ¿",step_id:"market_trend",step_index:1},{id:"step3",name:"ğŸ”¥ æŠ•èµ„ä¸»çº¿",step_id:"mainline",step_index:2},{id:"step4",name:"ğŸ“¦ å€™é€‰æ± æ„å»º",step_id:"candidate_pool",step_index:3},{id:"step5",name:"ğŸ“Š å› å­æ„å»º",step_id:"factor",step_index:4},{id:"step6",name:"ğŸ› ï¸ ç­–ç•¥ç”Ÿæˆ",step_id:"strategy",step_index:5},{id:"step7",name:"ğŸ”„ å›æµ‹éªŒè¯",step_id:"backtest",step_index:6},{id:"step8",name:"âš™ï¸ ç­–ç•¥ä¼˜åŒ–",step_id:"optimization",step_index:7},{id:"step9",name:"ğŸ“„ æŠ¥å‘Šç”Ÿæˆ",step_id:"report",step_index:8}];await i.window.withProgress({location:i.ProgressLocation.Notification,title:"ğŸ‰ æ‰§è¡Œå®Œæ•´æŠ•èµ„å·¥ä½œæµ",cancellable:!0},async(e,t)=>{const a=[];let r=!1;for(let s=0;s<n.length;s++){if(t.isCancellationRequested){i.window.showWarningMessage("å·¥ä½œæµå·²å–æ¶ˆ");break}const o=n[s];e.report({message:`(${s+1}/${n.length}) ${o.name}`,increment:100/n.length});try{l.logger.info(`æ‰§è¡Œæ­¥éª¤: ${o.name}`,p),this._panel.webview.postMessage({command:"workflowProgress",data:{currentStep:o.id,stepName:o.name,progress:(s+1)/n.length*100,status:"running"}});const e=await this._client.callBridge("call_mcp_tool",{tool_name:"workflow.run_step",arguments:{workflow_id:"default_workflow",step_index:o.step_index,step_args:{}}});e.ok?(a.push({step:o.name,success:!0,data:e.data}),this._panel.webview.postMessage({command:"workflowStepResult",data:{stepId:o.id,stepName:o.name,result:e.data,success:!0}})):(r=!0,a.push({step:o.name,success:!1,error:e.error})),await new Promise(n=>setTimeout(n,500))}catch(n){r=!0;const e=n instanceof Error?n.message:String(n);l.logger.error(`æ­¥éª¤ ${o.name} å¤±è´¥: ${e}`,p),a.push({step:o.name,success:!1,error:e})}}this._panel.webview.postMessage({command:"workflowComplete",data:{results:a,hasError:r}}),r?i.window.showWarningMessage("âš ï¸ å·¥ä½œæµå®Œæˆï¼Œéƒ¨åˆ†æ­¥éª¤æœ‰é”™è¯¯"):i.window.showInformationMessage("âœ… å®Œæ•´æŠ•èµ„å·¥ä½œæµæ‰§è¡Œå®Œæˆï¼"),await this.refreshAllData()})}async launchAShareManual(){l.logger.info("=== å¯åŠ¨Aè‚¡å®æ“æ‰‹å†Œ ===",p);try{const n=i.workspace.workspaceFolders?.[0];if(!n)return void i.window.showErrorMessage("è¯·å…ˆæ‰“å¼€TRQuantå·¥ä½œåŒº");const e=c.join(n.uri.fsPath,"extension","AShare-manual");if(l.logger.info(`æ‰‹å†Œè·¯å¾„: ${e}`,p),!d.existsSync(e))return i.window.showErrorMessage(`Aè‚¡æ‰‹å†Œç›®å½•ä¸å­˜åœ¨: ${e}`),void l.logger.error(`ç›®å½•ä¸å­˜åœ¨: ${e}`,p);if(!d.existsSync(c.join(e,"package.json")))return void i.window.showErrorMessage("Aè‚¡æ‰‹å†Œé…ç½®æ–‡ä»¶ç¼ºå¤±");if(!d.existsSync(c.join(e,"node_modules"))){if("å®‰è£…"===await i.window.showWarningMessage("Aè‚¡æ‰‹å†Œéœ€è¦å®‰è£…ä¾èµ–ï¼Œæ˜¯å¦å®‰è£…ï¼Ÿ","å®‰è£…","å–æ¶ˆ")){const n=i.window.createTerminal({name:"Aè‚¡æ‰‹å†Œä¾èµ–å®‰è£…",cwd:e});n.show(),n.sendText('npm install && echo "ä¾èµ–å®‰è£…å®Œæˆï¼Œè¯·é‡æ–°ç‚¹å‡»Aè‚¡å®æ“æ‰‹å†Œ"')}return}const t=i.window.terminals.find(n=>"Aè‚¡æ‰‹å†ŒæœåŠ¡"===n.name);if(t)return l.logger.info("å‘ç°å·²å­˜åœ¨çš„æ‰‹å†ŒæœåŠ¡ç»ˆç«¯",p),t.show(),i.window.showInformationMessage("æ­£åœ¨æ‰“å¼€Aè‚¡æ‰‹å†Œ..."),void setTimeout(()=>{i.env.openExternal(i.Uri.parse("http://localhost:4321"))},500);l.logger.info("åˆ›å»ºæ–°ç»ˆç«¯å¯åŠ¨AstroæœåŠ¡",p);const a=i.window.createTerminal({name:"Aè‚¡æ‰‹å†ŒæœåŠ¡",cwd:e,env:{...process.env}});a.show(),a.sendText("npm run dev"),i.window.showInformationMessage("ğŸ“š æ­£åœ¨å¯åŠ¨Aè‚¡æ‰‹å†ŒæœåŠ¡å™¨..."),setTimeout(()=>{l.logger.info("å°è¯•æ‰“å¼€æµè§ˆå™¨",p),i.env.openExternal(i.Uri.parse("http://localhost:4321")),i.window.showInformationMessage("âœ… Aè‚¡é«˜å€è‚¡å®æ“æ‰‹å†Œå·²å¯åŠ¨")},3e3)}catch(n){const e=n instanceof Error?n.message:String(n);l.logger.error(`å¯åŠ¨å¤±è´¥: ${e}`,p),i.window.showErrorMessage(`å¯åŠ¨Aè‚¡æ‰‹å†Œå¤±è´¥: ${e}`)}}async launchFileDashboard(){l.logger.info("=== å¯åŠ¨Extension Dashboard ===",p);try{const n=i.workspace.workspaceFolders?.[0];if(!n)return void i.window.showErrorMessage("è¯·å…ˆæ‰“å¼€å·¥ä½œåŒº");const e=i.window.terminals.find(n=>"TRQuant Dashboard"===n.name);if(e)return l.logger.info("DashboardæœåŠ¡å·²åœ¨è¿è¡Œ",p),e.show(),i.window.showInformationMessage("ğŸ“ æ­£åœ¨æ‰“å¼€æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ..."),void setTimeout(()=>{i.env.openExternal(i.Uri.parse("http://localhost:5000"))},500);const t=c.join(n.uri.fsPath,"extension"),a=c.join(t,"start_dashboard.py");if(!d.existsSync(a))return void i.window.showErrorMessage(`Dashboardå¯åŠ¨è„šæœ¬ä¸å­˜åœ¨: ${a}`);l.logger.info(`Dashboardè„šæœ¬: ${a}`,p);const r=i.window.createTerminal({name:"TRQuant Dashboard",cwd:t});r.show();const s="win32"===process.platform,o=s?c.join(t,"venv","Scripts","activate.bat"):c.join(t,"venv","bin","activate"),m=s?c.join(n.uri.fsPath,"venv","Scripts","activate.bat"):c.join(n.uri.fsPath,"venv","bin","activate");let u="";d.existsSync(o)?(u=s?`"${o}" && python start_dashboard.py`:`source "${o}" && python start_dashboard.py`,l.logger.info("ä½¿ç”¨extension venv",p)):d.existsSync(m)?(u=s?`"${m}" && python start_dashboard.py`:`source "${m}" && python start_dashboard.py`,l.logger.info("ä½¿ç”¨å·¥ä½œåŒºæ ¹ç›®å½•venv",p)):(u=(s?"python":"python3")+" start_dashboard.py",l.logger.info("ä½¿ç”¨ç³»ç»ŸPython",p)),r.sendText(u),i.window.showInformationMessage("ğŸ“ æ­£åœ¨å¯åŠ¨Extension Dashboard..."),setTimeout(()=>{i.env.openExternal(i.Uri.parse("http://localhost:5000")),i.window.showInformationMessage("âœ… Extension Dashboardå·²å¯åŠ¨ - http://localhost:5000")},3e3)}catch(n){const e=n instanceof Error?n.message:String(n);l.logger.error(`å¯åŠ¨Dashboardå¤±è´¥: ${e}`,p),i.window.showErrorMessage(`å¯åŠ¨æ–‡ä»¶ç®¡ç†ç³»ç»Ÿå¤±è´¥: ${e}`)}}async generateInvestmentReport(){l.logger.info("ç”ŸæˆæŠ•èµ„æŠ¥å‘Š...",p);try{i.window.showInformationMessage("ğŸ“Š æ­£åœ¨ç”ŸæˆæŠ•èµ„æŠ¥å‘Š...");const n=await this._client.callBridge("generate_investment_report",{type:"full"});if(n.ok&&n.data){const e=n.data,t=e.path||e.file||"";i.window.showInformationMessage(`âœ… æŠ¥å‘Šå·²ç”Ÿæˆ: ${c.basename(t)}`,"æ‰“å¼€æŠ¥å‘Š").then(n=>{if("æ‰“å¼€æŠ¥å‘Š"===n){const n=i.workspace.workspaceFolders?.[0];if(n&&t){const e=c.join(n.uri.fsPath,t);i.env.openExternal(i.Uri.file(e))}}})}else i.window.showErrorMessage(`ç”ŸæˆæŠ¥å‘Šå¤±è´¥: ${n.error||"æœªçŸ¥é”™è¯¯"}`)}catch(n){const e=n instanceof Error?n.message:String(n);l.logger.error(`ç”ŸæˆæŠ¥å‘Šå¤±è´¥: ${e}`,p),i.window.showErrorMessage(`ç”ŸæˆæŠ¥å‘Šå¤±è´¥: ${e}`)}}async syncFileChanges(){l.logger.info("åŒæ­¥æ–‡ä»¶å˜åŒ–...",p);try{const n=await this._client.callBridge("sync_file_changes",{});if(n.ok&&n.data){const e=n.data,t=e.total_count||0,a=e.recent_files||[];if(t>0){const n=a.slice(0,3).map(n=>n.name).join(", ");i.window.showInformationMessage(`ğŸ”„ æ£€æµ‹åˆ° ${t} ä¸ªæ›´æ–°æ–‡ä»¶: ${n}${t>3?"...":""}`)}else i.window.showInformationMessage("âœ… æ–‡ä»¶å·²æ˜¯æœ€æ–°çŠ¶æ€")}}catch(n){const e=n instanceof Error?n.message:String(n);l.logger.error(`åŒæ­¥å¤±è´¥: ${e}`,p)}}async exportDatabase(){l.logger.info("å¯¼å‡ºæ•°æ®åº“...",p);try{i.window.showInformationMessage("ğŸ—„ï¸ æ­£åœ¨å¯¼å‡ºæ•°æ®åº“...");const n=await this._client.callBridge("export_database",{});if(n.ok&&n.data){const e=n.data;i.window.showInformationMessage(`âœ… æ•°æ®åº“å·²å¯¼å‡º: ${e.collections||0}ä¸ªé›†åˆ, ${e.total_docs||0}æ¡è®°å½•`,"æ‰“å¼€æ–‡ä»¶").then(n=>{if("æ‰“å¼€æ–‡ä»¶"===n){const n=i.workspace.workspaceFolders?.[0];n&&e.file&&i.env.openExternal(i.Uri.file(e.file))}})}else i.window.showErrorMessage(`å¯¼å‡ºå¤±è´¥: ${n.error||"è¯·ç¡®ä¿MongoDBå·²å¯åŠ¨"}`)}catch(n){const e=n instanceof Error?n.message:String(n);l.logger.error(`å¯¼å‡ºæ•°æ®åº“å¤±è´¥: ${e}`,p),i.window.showErrorMessage(`å¯¼å‡ºæ•°æ®åº“å¤±è´¥: ${e}`)}}async openFile(n){if(!n)return;const e=i.workspace.workspaceFolders?.[0];if(!e)return;const t=c.join(e.uri.fsPath,n),a=c.extname(n).toLowerCase();if([".py",".json",".yaml",".yml",".md",".txt"].includes(a)){const n=await i.workspace.openTextDocument(t);await i.window.showTextDocument(n)}else i.env.openExternal(i.Uri.file(t))}updateContent(){this._panel.webview.html=this.generateHtml()}generateHtml(){return'<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>éŸ¬ç¿é‡åŒ–å·¥ä½œå°</title>\n    <style>\n        :root {\n            --bg-dark: #0a0e14;\n            --bg-primary: #0d1117;\n            --bg-secondary: #161b22;\n            --bg-card: #1c2128;\n            --bg-hover: #262c36;\n            --text-primary: #e6edf3;\n            --text-secondary: #8b949e;\n            --text-muted: #6e7681;\n            --accent-gold: #f0b429;\n            --accent-green: #3fb950;\n            --accent-blue: #58a6ff;\n            --accent-purple: #a371f7;\n            --accent-red: #f85149;\n            --accent-orange: #f0883e;\n            --border-color: #30363d;\n            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            --gradient-gold: linear-gradient(135deg, #f0b429 0%, #e85d04 100%);\n        }\n        \n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body {\n            font-family: \'SF Pro Display\', -apple-system, BlinkMacSystemFont, \'Segoe UI\', sans-serif;\n            background: var(--bg-dark);\n            color: var(--text-primary);\n            min-height: 100vh;\n            overflow-x: hidden;\n        }\n        \n        /* é¡¶éƒ¨æ ‡é¢˜æ  */\n        .header {\n            background: linear-gradient(135deg, #1a1f2e 0%, #0d1117 100%);\n            padding: 24px 32px;\n            border-bottom: 1px solid var(--border-color);\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        \n        .header-left {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n        \n        .logo {\n            width: 48px;\n            height: 48px;\n            background: var(--gradient-gold);\n            border-radius: 12px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 24px;\n            font-weight: bold;\n            color: #fff;\n            box-shadow: 0 4px 12px rgba(240, 180, 41, 0.3);\n        }\n        \n        .header-title h1 {\n            font-size: 24px;\n            font-weight: 700;\n            background: linear-gradient(90deg, var(--accent-gold), #fff);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            letter-spacing: 1px;\n        }\n        \n        .header-title .subtitle {\n            font-size: 13px;\n            color: var(--text-muted);\n            margin-top: 4px;\n        }\n        \n        .header-right {\n            display: flex;\n            gap: 12px;\n        }\n        \n        .header-btn {\n            padding: 10px 20px;\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            color: var(--text-secondary);\n            font-size: 13px;\n            cursor: pointer;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n        \n        .header-btn:hover {\n            background: var(--bg-hover);\n            border-color: var(--accent-blue);\n            color: var(--text-primary);\n        }\n        \n        .header-btn.primary {\n            background: var(--gradient-primary);\n            border: none;\n            color: #fff;\n        }\n        \n        .header-btn.primary:hover {\n            transform: translateY(-1px);\n            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n        }\n        \n        /* ä¸»å®¹å™¨ */\n        .main-container {\n            padding: 24px 32px;\n            max-width: 1600px;\n            margin: 0 auto;\n        }\n        \n        /* å¸‚åœºçŠ¶æ€å¡ç‰‡ */\n        .market-section {\n            margin-bottom: 24px;\n        }\n        \n        .market-grid {\n            display: grid;\n            grid-template-columns: repeat(5, 1fr);\n            gap: 16px;\n        }\n        \n        .market-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 20px;\n            text-align: center;\n            transition: all 0.2s;\n        }\n        \n        .market-card:hover {\n            transform: translateY(-2px);\n            border-color: var(--accent-blue);\n        }\n        \n        .market-card.regime {\n            background: linear-gradient(135deg, rgba(63, 185, 80, 0.1), rgba(88, 166, 255, 0.1));\n            border-color: var(--accent-green);\n        }\n        \n        .market-card .label {\n            font-size: 12px;\n            color: var(--text-muted);\n            margin-bottom: 8px;\n            text-transform: uppercase;\n            letter-spacing: 1px;\n        }\n        \n        .market-card .value {\n            font-size: 24px;\n            font-weight: 700;\n        }\n        \n        .market-card .change {\n            font-size: 14px;\n            margin-top: 4px;\n        }\n        \n        .market-card .change.up { color: var(--accent-red); }\n        .market-card .change.down { color: var(--accent-green); }\n        \n        .market-card.regime .value {\n            color: var(--accent-green);\n        }\n        \n        /* åŒæ å¸ƒå±€ */\n        .content-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 24px;\n            margin-bottom: 24px;\n        }\n        \n        .card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            overflow: hidden;\n        }\n        \n        .card-header {\n            padding: 16px 20px;\n            background: rgba(0, 0, 0, 0.2);\n            border-bottom: 1px solid var(--border-color);\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        \n        .card-header h3 {\n            font-size: 15px;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n        \n        .card-header .actions {\n            display: flex;\n            gap: 8px;\n        }\n        \n        .card-header .btn-small {\n            padding: 6px 12px;\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 6px;\n            color: var(--text-secondary);\n            font-size: 12px;\n            cursor: pointer;\n        }\n        \n        .card-header .btn-small:hover {\n            background: var(--accent-blue);\n            border-color: var(--accent-blue);\n            color: #fff;\n        }\n        \n        .card-body {\n            padding: 20px;\n        }\n        \n        /* æŠ•èµ„ä¸»çº¿åˆ—è¡¨ */\n        .mainline-list {\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n        }\n        \n        .mainline-item {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n            padding: 14px 16px;\n            background: var(--bg-card);\n            border-radius: 8px;\n            transition: all 0.2s;\n            cursor: pointer;\n        }\n        \n        .mainline-item:hover {\n            background: var(--bg-hover);\n            transform: translateX(4px);\n        }\n        \n        .mainline-rank {\n            width: 28px;\n            height: 28px;\n            background: var(--gradient-gold);\n            border-radius: 6px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 14px;\n            font-weight: 700;\n            color: #fff;\n        }\n        \n        .mainline-rank.silver { background: linear-gradient(135deg, #9ca3af, #6b7280); }\n        .mainline-rank.bronze { background: linear-gradient(135deg, #d97706, #92400e); }\n        \n        .mainline-info {\n            flex: 1;\n        }\n        \n        .mainline-name {\n            font-size: 15px;\n            font-weight: 600;\n            margin-bottom: 4px;\n        }\n        \n        .mainline-industries {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        .mainline-score {\n            font-size: 20px;\n            font-weight: 700;\n            color: var(--accent-gold);\n        }\n        \n        /* å› å­åˆ—è¡¨ */\n        .factor-list {\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n        }\n        \n        .factor-item {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            padding: 14px 16px;\n            background: var(--bg-card);\n            border-radius: 8px;\n        }\n        \n        .factor-icon {\n            width: 36px;\n            height: 36px;\n            background: var(--gradient-primary);\n            border-radius: 8px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 16px;\n        }\n        \n        .factor-info {\n            flex: 1;\n        }\n        \n        .factor-name {\n            font-size: 14px;\n            font-weight: 600;\n            margin-bottom: 2px;\n        }\n        \n        .factor-category {\n            font-size: 11px;\n            color: var(--text-muted);\n        }\n        \n        .factor-weight {\n            font-size: 16px;\n            font-weight: 700;\n            color: var(--accent-purple);\n        }\n        \n        /* 8æ­¥éª¤å·¥ä½œæµ */\n        .workflow-section {\n            margin-bottom: 24px;\n        }\n        \n        .section-title {\n            font-size: 13px;\n            font-weight: 600;\n            color: var(--text-muted);\n            text-transform: uppercase;\n            letter-spacing: 2px;\n            margin-bottom: 16px;\n            padding-left: 4px;\n        }\n        \n        .section-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 16px;\n        }\n        \n        .run-all-btn {\n            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);\n            color: white;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 8px;\n            cursor: pointer;\n            font-weight: 600;\n            font-size: 14px;\n            transition: all 0.3s;\n        }\n        .run-all-btn:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);\n        }\n        \n        .workflow-container {\n            display: flex;\n            gap: 20px;\n        }\n        \n        .workflow-grid {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 12px;\n            flex: 1;\n        }\n        \n        .workflow-step {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 16px 12px;\n            text-align: center;\n            cursor: pointer;\n            transition: all 0.3s;\n            position: relative;\n        }\n        \n        .workflow-step::after {\n            display: none;\n        }\n        \n        .workflow-step:last-child::after {\n            display: none;\n        }\n        \n        .workflow-step:hover {\n            transform: translateY(-4px);\n            border-color: var(--accent-blue);\n            box-shadow: 0 8px 24px rgba(88, 166, 255, 0.15);\n        }\n        \n        .workflow-step.active {\n            background: linear-gradient(135deg, rgba(88, 166, 255, 0.15), rgba(163, 113, 247, 0.15));\n            border-color: var(--accent-blue);\n        }\n        \n        .step-number {\n            width: 24px;\n            height: 24px;\n            background: var(--bg-card);\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 11px;\n            font-weight: 600;\n            color: var(--text-muted);\n            margin: 0 auto 12px;\n        }\n        \n        .workflow-step:hover .step-number {\n            background: var(--accent-blue);\n            color: #fff;\n        }\n        \n        .step-icon {\n            font-size: 28px;\n            margin-bottom: 10px;\n        }\n        \n        .step-name {\n            font-size: 13px;\n            font-weight: 600;\n            color: var(--text-secondary);\n        }\n        \n        .workflow-step:hover .step-name {\n            color: var(--text-primary);\n        }\n        \n        .step-status {\n            position: absolute;\n            top: 8px;\n            right: 8px;\n            font-size: 14px;\n        }\n        \n        .workflow-step.running {\n            border-color: #f59e0b;\n            animation: pulse 1.5s infinite;\n        }\n        \n        .workflow-step.completed {\n            border-color: #10b981;\n        }\n        \n        .workflow-step.failed {\n            border-color: #ef4444;\n        }\n        \n        @keyframes pulse {\n            0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }\n            50% { box-shadow: 0 0 0 8px rgba(245, 158, 11, 0); }\n        }\n        \n        /* ç»“æœé¢æ¿ */\n        .result-panel {\n            flex: 1;\n            min-width: 400px;\n            max-width: 500px;\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 16px;\n            display: none;\n        }\n        \n        .result-panel.visible {\n            display: block;\n        }\n        \n        .result-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 12px;\n        }\n        \n        .result-title {\n            font-size: 16px;\n            font-weight: 600;\n            color: var(--text-primary);\n        }\n        \n        .close-btn {\n            background: transparent;\n            border: none;\n            color: var(--text-muted);\n            cursor: pointer;\n            font-size: 16px;\n            padding: 4px 8px;\n            border-radius: 4px;\n        }\n        .close-btn:hover {\n            background: var(--bg-hover);\n            color: var(--text-primary);\n        }\n        \n        .result-summary {\n            background: var(--bg-card);\n            padding: 12px;\n            border-radius: 8px;\n            color: var(--text-secondary);\n            font-size: 14px;\n            margin-bottom: 12px;\n        }\n        \n        .result-progress {\n            margin-bottom: 12px;\n        }\n        \n        .progress-bar {\n            height: 6px;\n            background: var(--bg-card);\n            border-radius: 3px;\n            overflow: hidden;\n            margin-bottom: 8px;\n        }\n        \n        .progress-fill {\n            height: 100%;\n            background: linear-gradient(90deg, #6366f1, #8b5cf6);\n            width: 0%;\n            transition: width 0.3s;\n        }\n        \n        .progress-text {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        .result-details {\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            padding: 12px;\n            max-height: 300px;\n            overflow-y: auto;\n            font-size: 13px;\n            margin-bottom: 12px;\n        }\n        \n        .result-details table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n        \n        .result-details th, .result-details td {\n            padding: 8px;\n            text-align: left;\n            border-bottom: 1px solid var(--border-color);\n        }\n        \n        .result-details th {\n            background: var(--bg-secondary);\n            font-weight: 600;\n            color: var(--text-secondary);\n        }\n        \n        .result-files {\n            max-height: 100px;\n            overflow-y: auto;\n        }\n        \n        .file-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 8px;\n            background: var(--bg-card);\n            border-radius: 6px;\n            margin-bottom: 4px;\n            cursor: pointer;\n            font-size: 12px;\n        }\n        .file-item:hover {\n            background: var(--bg-hover);\n        }\n        \n        /* å¿«æ·æ“ä½œåŒº */\n        .quick-section {\n            margin-bottom: 24px;\n        }\n        \n        .quick-grid {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 16px;\n        }\n        \n        .quick-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 24px;\n            cursor: pointer;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n        \n        .quick-card:hover {\n            transform: translateY(-2px);\n            border-color: var(--accent-blue);\n        }\n        \n        .quick-card.highlight {\n            background: linear-gradient(135deg, rgba(240, 180, 41, 0.1), rgba(232, 93, 4, 0.1));\n            border-color: var(--accent-gold);\n        }\n        \n        .quick-icon {\n            width: 48px;\n            height: 48px;\n            background: var(--bg-card);\n            border-radius: 12px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 24px;\n        }\n        \n        .quick-card.highlight .quick-icon {\n            background: var(--gradient-gold);\n        }\n        \n        .quick-info h4 {\n            font-size: 15px;\n            font-weight: 600;\n            margin-bottom: 4px;\n        }\n        \n        .quick-info p {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        /* åº•éƒ¨åŒæ  */\n        .bottom-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 24px;\n        }\n        \n        .project-list, .backtest-list {\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n        }\n        \n        .project-item, .backtest-item {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 12px 16px;\n            background: var(--bg-card);\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n        \n        .project-item:hover, .backtest-item:hover {\n            background: var(--bg-hover);\n        }\n        \n        .item-name {\n            font-size: 14px;\n            font-weight: 500;\n        }\n        \n        .item-date {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        .item-return {\n            font-size: 14px;\n            font-weight: 600;\n        }\n        \n        .item-return.positive { color: var(--accent-red); }\n        .item-return.negative { color: var(--accent-green); }\n        \n        /* åŠ è½½çŠ¶æ€ */\n        .loading-overlay {\n            display: none;\n            position: fixed;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background: rgba(10, 14, 20, 0.8);\n            justify-content: center;\n            align-items: center;\n            z-index: 1000;\n        }\n        \n        .loading-overlay.active {\n            display: flex;\n        }\n        \n        .loading-spinner {\n            width: 48px;\n            height: 48px;\n            border: 3px solid var(--border-color);\n            border-top-color: var(--accent-gold);\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n        }\n        \n        @keyframes spin {\n            to { transform: rotate(360deg); }\n        }\n        \n        /* ç©ºçŠ¶æ€ */\n        .empty-state {\n            text-align: center;\n            padding: 32px;\n            color: var(--text-muted);\n        }\n        \n        .empty-state .icon {\n            font-size: 48px;\n            margin-bottom: 12px;\n            opacity: 0.5;\n        }\n        \n        /* å“åº”å¼ */\n        @media (max-width: 1400px) {\n            .workflow-grid {\n                grid-template-columns: repeat(4, 1fr);\n            }\n            .workflow-step::after {\n                display: none;\n            }\n        }\n        \n        @media (max-width: 1000px) {\n            .content-grid, .bottom-grid {\n                grid-template-columns: 1fr;\n            }\n            .market-grid {\n                grid-template-columns: repeat(3, 1fr);\n            }\n            .quick-grid {\n                grid-template-columns: repeat(2, 1fr);\n            }\n        }\n    </style>\n</head>\n<body>\n    \x3c!-- é¡¶éƒ¨æ ‡é¢˜æ  --\x3e\n    <div class="header">\n        <div class="header-left">\n            <div class="logo">TR</div>\n            <div class="header-title">\n                <h1>éŸ¬ç¿é‡åŒ–å·¥ä½œå°</h1>\n                <div class="subtitle">TRQuant Professional - Aè‚¡å®Œæ•´æŠ•èµ„æµç¨‹ç³»ç»Ÿ V1</div>\n            </div>\n        </div>\n        <div class="header-right">\n            <button class="header-btn" onclick="vscode.postMessage({command: \'refreshAll\'})">\n                ğŸ”„ åˆ·æ–°æ•°æ®\n            </button>\n            <button class="header-btn" onclick="vscode.postMessage({command: \'openSettings\'})">\n                âš™ï¸ è®¾ç½®\n            </button>\n            <button class="header-btn primary" onclick="openWorkflowPanel()">\n                ğŸ–¥ï¸ æ‰“å¼€æ¡Œé¢ç³»ç»Ÿ\n            </button>\n        </div>\n    </div>\n    \n    <div class="main-container">\n        \x3c!-- å¿«æ·æ“ä½œï¼ˆç½®é¡¶ï¼‰ --\x3e\n        <div class="quick-section">\n            <div class="section-title">âš¡ å¿«æ·æ“ä½œ</div>\n            <div class="quick-grid">\n                <div class="quick-card highlight" onclick="console.log(\'ç‚¹å‡»æ–°å»ºé¡¹ç›®\'); vscode.postMessage({command: \'createProject\'})">\n                    <div class="quick-icon">ğŸ“</div>\n                    <div class="quick-info">\n                        <h4>æ–°å»ºé¡¹ç›®</h4>\n                        <p>ä¸€é”®ç”Ÿæˆä¸­å›½é£ç­–ç•¥</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'launchFileDashboard\'})">\n                    <div class="quick-icon">ğŸ“‚</div>\n                    <div class="quick-info">\n                        <h4>æ–‡ä»¶ç³»ç»Ÿ</h4>\n                        <p>ç­–ç•¥/æŠ¥å‘Š/æ•°æ®ç®¡ç†</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="openWorkflowPanel()">\n                    <div class="quick-icon">ğŸ–¥ï¸</div>\n                    <div class="quick-info">\n                        <h4>æ¡Œé¢ç³»ç»Ÿ</h4>\n                        <p>æŸ¥çœ‹å®Œæ•´æŠ•èµ„æµç¨‹</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'runBacktest\'})">\n                    <div class="quick-icon">ğŸ§ª</div>\n                    <div class="quick-info">\n                        <h4>è¿è¡Œå›æµ‹</h4>\n                        <p>é…ç½®å¹¶æ‰§è¡Œç­–ç•¥å›æµ‹</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'launchAShareManual\'})">\n                    <div class="quick-icon">ğŸ“š</div>\n                    <div class="quick-info">\n                        <h4>å®æ“æ‰‹å†Œ</h4>\n                        <p>Aè‚¡æŠ•èµ„æŒ‡å—</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'generateInvestmentReport\'})">\n                    <div class="quick-icon">ğŸ“Š</div>\n                    <div class="quick-info">\n                        <h4>ç”ŸæˆæŠ¥å‘Š</h4>\n                        <p>AIæŠ•èµ„åˆ†ææŠ¥å‘Š</p>\n                    </div>\n                </div>\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'optimizeStrategy\'})">\n                    <div class="quick-icon">ğŸ”</div>\n                    <div class="quick-info">\n                        <h4>ç­–ç•¥ä¼˜åŒ–</h4>\n                        <p>åˆ†æå¹¶ä¼˜åŒ–ç­–ç•¥ä»£ç </p>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- å¸‚åœºçŠ¶æ€ --\x3e\n        <div class="market-section">\n            <div class="market-grid" id="marketGrid">\n                <div class="market-card regime">\n                    <div class="label">å¸‚åœºçŠ¶æ€</div>\n                    <div class="value" id="marketRegime">åŠ è½½ä¸­...</div>\n                    <div class="change" id="marketStyle">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">ä¸Šè¯æŒ‡æ•°</div>\n                    <div class="value" id="shIndex">-</div>\n                    <div class="change" id="shChange">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">æ·±è¯æˆæŒ‡</div>\n                    <div class="value" id="szIndex">-</div>\n                    <div class="change" id="szChange">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">åˆ›ä¸šæ¿æŒ‡</div>\n                    <div class="value" id="cyIndex">-</div>\n                    <div class="change" id="cyChange">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">åŒ—å‘èµ„é‡‘</div>\n                    <div class="value" id="northFlow">-</div>\n                    <div class="change" id="northChange">-</div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- æŠ•èµ„ä¸»çº¿ & æ¨èå› å­ --\x3e\n        <div class="content-grid">\n            \x3c!-- æŠ•èµ„ä¸»çº¿ --\x3e\n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ”¥ å½“å‰æŠ•èµ„ä¸»çº¿ TOP5</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'refreshMainlines\'})">åˆ·æ–°</button>\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'openStep\', step: 3})">æŸ¥çœ‹å…¨éƒ¨</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="mainline-list" id="mainlineList">\n                        <div class="empty-state">\n                            <div class="icon">ğŸ”¥</div>\n                            <div>ç‚¹å‡»åˆ·æ–°è·å–æŠ•èµ„ä¸»çº¿</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            \x3c!-- æ¨èå› å­ --\x3e\n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ“Š æ™ºèƒ½æ¨èå› å­</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'refreshFactors\'})">åˆ·æ–°</button>\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'generateStrategy\'})">ç”Ÿæˆç­–ç•¥</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="factor-list" id="factorList">\n                        <div class="empty-state">\n                            <div class="icon">ğŸ“Š</div>\n                            <div>ç‚¹å‡»åˆ·æ–°è·å–å› å­æ¨è</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- 9æ­¥éª¤å·¥ä½œæµ --\x3e\n        <div class="workflow-section">\n            <div class="section-header">\n                <div class="section-title">ğŸ“‹ 9æ­¥éª¤æŠ•èµ„å·¥ä½œæµï¼ˆä¸åŒ…æ‹¬å®ç›˜ï¼‰</div>\n                <button class="run-all-btn" onclick="vscode.postMessage({command: \'runFullWorkflow\'})">\n                    â–¶ï¸ ä¸€é”®æ‰§è¡Œå…¨éƒ¨\n                </button>\n            </div>\n            <div class="workflow-container">\n                <div class="workflow-grid">\n                    <div class="workflow-step" id="step-1" onclick="runStep(1)">\n                        <div class="step-number">1</div>\n                        <div class="step-icon">ğŸ“¡</div>\n                        <div class="step-name">ä¿¡æ¯è·å–</div>\n                        <div class="step-status" id="status-1">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-2" onclick="runStep(2)">\n                        <div class="step-number">2</div>\n                        <div class="step-icon">ğŸ“ˆ</div>\n                        <div class="step-name">å¸‚åœºè¶‹åŠ¿</div>\n                        <div class="step-status" id="status-2">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-3" onclick="runStep(3)">\n                        <div class="step-number">3</div>\n                        <div class="step-icon">ğŸ”¥</div>\n                        <div class="step-name">æŠ•èµ„ä¸»çº¿</div>\n                        <div class="step-status" id="status-3">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-4" onclick="runStep(4)">\n                        <div class="step-number">4</div>\n                        <div class="step-icon">ğŸ“¦</div>\n                        <div class="step-name">å€™é€‰æ± </div>\n                        <div class="step-status" id="status-4">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-5" onclick="runStep(5)">\n                        <div class="step-number">5</div>\n                        <div class="step-icon">ğŸ“Š</div>\n                        <div class="step-name">å› å­æ„å»º</div>\n                        <div class="step-status" id="status-5">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-6" onclick="runStep(6)">\n                        <div class="step-number">6</div>\n                        <div class="step-icon">ğŸ› ï¸</div>\n                        <div class="step-name">ç­–ç•¥å¼€å‘</div>\n                        <div class="step-status" id="status-6">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-7" onclick="runStep(7)">\n                        <div class="step-number">7</div>\n                        <div class="step-icon">ğŸ”„</div>\n                        <div class="step-name">å›æµ‹éªŒè¯</div>\n                        <div class="step-status" id="status-7">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-8" onclick="runStep(8)">\n                        <div class="step-number">8</div>\n                        <div class="step-icon">âš™ï¸</div>\n                        <div class="step-name">ç­–ç•¥ä¼˜åŒ–</div>\n                        <div class="step-status" id="status-8">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-9" onclick="runStep(9)">\n                        <div class="step-number">9</div>\n                        <div class="step-icon">ğŸ“„</div>\n                        <div class="step-name">æŠ¥å‘Šç”Ÿæˆ</div>\n                        <div class="step-status" id="status-9">â–¶ï¸</div>\n                    </div>\n                </div>\n                \n                \x3c!-- æ‰§è¡Œç»“æœåŒºåŸŸ --\x3e\n                <div class="result-panel" id="result-panel">\n                    <div class="result-header">\n                        <span class="result-title" id="result-title">ğŸ“‹ æ‰§è¡Œç»“æœ</span>\n                        <button class="close-btn" onclick="hideResultPanel()">âœ•</button>\n                    </div>\n                    <div class="result-summary" id="result-summary">\n                        ç‚¹å‡»å·¦ä¾§æ­¥éª¤å¼€å§‹æ‰§è¡Œ...\n                    </div>\n                    <div class="result-progress" id="result-progress" style="display:none;">\n                        <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>\n                        <span class="progress-text" id="progress-text">æ‰§è¡Œä¸­...</span>\n                    </div>\n                    <div class="result-details" id="result-details"></div>\n                    <div class="result-files" id="result-files"></div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- å¿«æ·æ“ä½œ --\x3e\n        <div class="quick-section">\n            <div class="section-title">âš¡ å¿«æ·æ“ä½œ</div>\n            <div class="quick-grid">\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'openBacktestConfig\'})">\n                    <div class="quick-icon">ğŸ§ª</div>\n                    <div class="quick-info">\n                        <h4>å›æµ‹é…ç½®</h4>\n                        <p>é…ç½®å¹¶è¿è¡Œç­–ç•¥å›æµ‹</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'createProject\'})">\n                    <div class="quick-icon">ğŸ“</div>\n                    <div class="quick-info">\n                        <h4>æ–°å»ºé¡¹ç›®</h4>\n                        <p>åˆ›å»ºæ–°çš„é‡åŒ–é¡¹ç›®</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'generateStrategy\'})">\n                    <div class="quick-icon">ğŸ¤–</div>\n                    <div class="quick-info">\n                        <h4>AIç”Ÿæˆç­–ç•¥</h4>\n                        <p>æ™ºèƒ½ç”ŸæˆPTradeä»£ç </p>\n                    </div>\n                </div>\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'optimizeStrategy\'})">\n                    <div class="quick-icon">ğŸ”</div>\n                    <div class="quick-info">\n                        <h4>ç­–ç•¥ä¼˜åŒ–</h4>\n                        <p>åˆ†æå¹¶ä¼˜åŒ–ç­–ç•¥ä»£ç </p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'showLogs\'})">\n                    <div class="quick-icon">ğŸ“‹</div>\n                    <div class="quick-info">\n                        <h4>æŸ¥çœ‹æ—¥å¿—</h4>\n                        <p>ç³»ç»Ÿè¿è¡Œæ—¥å¿—</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- ç³»ç»Ÿç®¡ç† --\x3e\n        <div class="quick-section">\n            <div class="section-title">ğŸ”§ ç³»ç»Ÿç®¡ç†ä¸æ–‡ä»¶ä¸­å¿ƒ</div>\n            <div class="quick-grid">\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'launchFileDashboard\'})">\n                    <div class="quick-icon">ğŸ“</div>\n                    <div class="quick-info">\n                        <h4>æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ</h4>\n                        <p>Webä»ªè¡¨ç›˜(ç­–ç•¥/æŠ¥å‘Š/æ•°æ®åº“)</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'generateInvestmentReport\'})">\n                    <div class="quick-icon">ğŸ“Š</div>\n                    <div class="quick-info">\n                        <h4>ç”ŸæˆæŠ•èµ„æŠ¥å‘Š</h4>\n                        <p>AIç»¼åˆåˆ†ææŠ¥å‘Š</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'syncFileChanges\'})">\n                    <div class="quick-icon">ğŸ”„</div>\n                    <div class="quick-info">\n                        <h4>æ™ºèƒ½åŒæ­¥</h4>\n                        <p>æ£€æµ‹æ›´æ–°çš„æ–‡ä»¶</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'exportDatabase\'})">\n                    <div class="quick-icon">ğŸ—„ï¸</div>\n                    <div class="quick-info">\n                        <h4>æ•°æ®åº“ç®¡ç†</h4>\n                        <p>å¯¼å‡º/å¤‡ä»½MongoDB</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'openSettings\'})">\n                    <div class="quick-icon">âš™ï¸</div>\n                    <div class="quick-info">\n                        <h4>ç³»ç»Ÿè®¾ç½®</h4>\n                        <p>é…ç½®å‚æ•°ç®¡ç†</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'showLogs\'})">\n                    <div class="quick-icon">ğŸ“‹</div>\n                    <div class="quick-info">\n                        <h4>è¿è¡Œæ—¥å¿—</h4>\n                        <p>ç³»ç»Ÿè¿è¡Œæ—¥å¿—</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- æœ€è¿‘é¡¹ç›® & å›æµ‹ --\x3e\n        <div class="bottom-grid">\n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ“ æœ€è¿‘é¡¹ç›®</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'openProject\'})">æ‰“å¼€é¡¹ç›®</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="project-list" id="projectList">\n                        <div class="project-item">\n                            <div>\n                                <div class="item-name">ğŸ‰ ç¿æ™ºé‡‘é¾™</div>\n                                <div class="item-date">2024-12-03</div>\n                            </div>\n                            <span style="color: var(--text-muted)">â†’</span>\n                        </div>\n                        <div class="project-item">\n                            <div>\n                                <div class="item-name">ğŸ¦… çµåŠ¨ç¢§é¹¤</div>\n                                <div class="item-date">2024-12-02</div>\n                            </div>\n                            <span style="color: var(--text-muted)">â†’</span>\n                        </div>\n                        <div class="project-item">\n                            <div>\n                                <div class="item-name">ğŸ‹ é£˜é€¸ç´«ç«¹</div>\n                                <div class="item-date">2024-12-01</div>\n                            </div>\n                            <span style="color: var(--text-muted)">â†’</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ“Š æœ€è¿‘å›æµ‹</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'openStep\', step: 7})">æŸ¥çœ‹å…¨éƒ¨</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="backtest-list" id="backtestList">\n                        <div class="backtest-item">\n                            <div>\n                                <div class="item-name">test1 åŠ¨é‡æˆé•¿ç­–ç•¥</div>\n                                <div class="item-date">2024-12-03 15:30</div>\n                            </div>\n                            <div class="item-return positive">+15.2%</div>\n                        </div>\n                        <div class="backtest-item">\n                            <div>\n                                <div class="item-name">momentum ç­–ç•¥</div>\n                                <div class="item-date">2024-12-02 10:15</div>\n                            </div>\n                            <div class="item-return positive">+8.5%</div>\n                        </div>\n                        <div class="backtest-item">\n                            <div>\n                                <div class="item-name">multi_factor å¤šå› å­</div>\n                                <div class="item-date">2024-12-01 14:20</div>\n                            </div>\n                            <div class="item-return negative">-2.1%</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    \x3c!-- åŠ è½½é®ç½© --\x3e\n    <div class="loading-overlay" id="loadingOverlay">\n        <div class="loading-spinner"></div>\n    </div>\n    \n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        // æ‰“å¼€æ¡Œé¢ç³»ç»Ÿï¼ˆå®Œæ•´å·¥ä½œæµï¼‰\n        function openWorkflowPanel() {\n            console.log(\'[MainDashboard HTML] ç‚¹å‡»æ‰“å¼€æ¡Œé¢ç³»ç»ŸæŒ‰é’®\');\n            try {\n                vscode.postMessage({command: \'openWorkflowPanel\'});\n                console.log(\'[MainDashboard HTML] å¯åŠ¨æ¡Œé¢ç³»ç»Ÿæ¶ˆæ¯å·²å‘é€\');\n            } catch (error) {\n                console.error(\'[MainDashboard HTML] å‘é€æ¶ˆæ¯å¤±è´¥:\', error);\n            }\n        }\n        \n        // æ›´æ–°å¸‚åœºçŠ¶æ€\n        function updateMarketStatus(data) {\n            if (!data) return;\n            \n            // å¸‚åœºRegime\n            document.getElementById(\'marketRegime\').textContent = data.regime_cn || data.regime || \'ä¸­æ€§\';\n            document.getElementById(\'marketStyle\').textContent = data.style_rotation || \'å‡è¡¡\';\n            \n            // æŒ‡æ•°æ•°æ®\n            if (data.indices && data.indices.length >= 3) {\n                const [sh, sz, cy] = data.indices;\n                \n                document.getElementById(\'shIndex\').textContent = sh.value?.toFixed(2) || \'-\';\n                document.getElementById(\'shChange\').textContent = (sh.change >= 0 ? \'+\' : \'\') + (sh.change * 100)?.toFixed(2) + \'%\';\n                document.getElementById(\'shChange\').className = \'change \' + (sh.change >= 0 ? \'up\' : \'down\');\n                \n                document.getElementById(\'szIndex\').textContent = sz.value?.toFixed(2) || \'-\';\n                document.getElementById(\'szChange\').textContent = (sz.change >= 0 ? \'+\' : \'\') + (sz.change * 100)?.toFixed(2) + \'%\';\n                document.getElementById(\'szChange\').className = \'change \' + (sz.change >= 0 ? \'up\' : \'down\');\n                \n                document.getElementById(\'cyIndex\').textContent = cy.value?.toFixed(2) || \'-\';\n                document.getElementById(\'cyChange\').textContent = (cy.change >= 0 ? \'+\' : \'\') + (cy.change * 100)?.toFixed(2) + \'%\';\n                document.getElementById(\'cyChange\').className = \'change \' + (cy.change >= 0 ? \'up\' : \'down\');\n            }\n        }\n        \n        // æ›´æ–°æŠ•èµ„ä¸»çº¿\n        function updateMainlines(data) {\n            const container = document.getElementById(\'mainlineList\');\n            if (!data || data.length === 0) {\n                container.innerHTML = \'<div class="empty-state"><div class="icon">ğŸ”¥</div><div>æš‚æ— æŠ•èµ„ä¸»çº¿æ•°æ®</div></div>\';\n                return;\n            }\n            \n            container.innerHTML = data.map((m, i) => {\n                const rankClass = i === 0 ? \'\' : i === 1 ? \'silver\' : i === 2 ? \'bronze\' : \'\';\n                return `\n                    <div class="mainline-item">\n                        <div class="mainline-rank ${rankClass}">${i + 1}</div>\n                        <div class="mainline-info">\n                            <div class="mainline-name">${m.name}</div>\n                            <div class="mainline-industries">${m.industries?.slice(0, 3).join(\' Â· \') || \'\'}</div>\n                        </div>\n                        <div class="mainline-score">â­${m.score}</div>\n                    </div>\n                `;\n            }).join(\'\');\n        }\n        \n        // æ›´æ–°å› å­\n        function updateFactors(data) {\n            const container = document.getElementById(\'factorList\');\n            if (!data || data.length === 0) {\n                container.innerHTML = \'<div class="empty-state"><div class="icon">ğŸ“Š</div><div>æš‚æ— å› å­æ¨è</div></div>\';\n                return;\n            }\n            \n            const icons = [\'ğŸ“ˆ\', \'ğŸ’¹\', \'ğŸ’°\', \'âš¡\', \'ğŸ¯\'];\n            container.innerHTML = data.map((f, i) => `\n                <div class="factor-item">\n                    <div class="factor-icon">${icons[i % icons.length]}</div>\n                    <div class="factor-info">\n                        <div class="factor-name">${f.name}</div>\n                        <div class="factor-category">${f.category || \'é‡åŒ–å› å­\'}</div>\n                    </div>\n                    <div class="factor-weight">${(f.weight * 100).toFixed(0)}%</div>\n                </div>\n            `).join(\'\');\n        }\n        \n        // =====================\n        // å·¥ä½œæµæ­¥éª¤æ‰§è¡Œ\n        // =====================\n        \n        function runStep(step) {\n            vscode.postMessage({command: \'openStep\', step: step});\n        }\n        \n        function showResultPanel() {\n            document.getElementById(\'result-panel\').classList.add(\'visible\');\n        }\n        \n        function hideResultPanel() {\n            document.getElementById(\'result-panel\').classList.remove(\'visible\');\n        }\n        \n        function setStepStatus(step, status) {\n            const stepEl = document.getElementById(\'step-\' + step);\n            const statusEl = document.getElementById(\'status-\' + step);\n            \n            // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»\n            stepEl.classList.remove(\'running\', \'completed\', \'failed\');\n            \n            switch(status) {\n                case \'running\':\n                    stepEl.classList.add(\'running\');\n                    statusEl.textContent = \'â³\';\n                    break;\n                case \'completed\':\n                    stepEl.classList.add(\'completed\');\n                    statusEl.textContent = \'âœ…\';\n                    break;\n                case \'failed\':\n                    stepEl.classList.add(\'failed\');\n                    statusEl.textContent = \'âŒ\';\n                    break;\n                default:\n                    statusEl.textContent = \'â–¶ï¸\';\n            }\n        }\n        \n        function showProgress(show, value, text) {\n            const el = document.getElementById(\'result-progress\');\n            el.style.display = show ? \'block\' : \'none\';\n            if (show) {\n                document.getElementById(\'progress-fill\').style.width = value + \'%\';\n                document.getElementById(\'progress-text\').textContent = text || \'æ‰§è¡Œä¸­...\';\n            }\n        }\n        \n        function formatDetails(details) {\n            if (!details || Object.keys(details).length === 0) {\n                return \'<div style="color:var(--text-muted);">æ— è¯¦ç»†æ•°æ®</div>\';\n            }\n            \n            let html = \'\';\n            \n            // æŠ•èµ„ä¸»çº¿\n            if (details.top_mainlines) {\n                const mainlines = details.top_mainlines;\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#f59e0b;">ğŸ”¥ æŠ•èµ„ä¸»çº¿ TOP\' + mainlines.length + \'</strong></div>\';\n                html += \'<table><tr><th>æ’å</th><th>åç§°</th><th>è¯„åˆ†</th></tr>\';\n                mainlines.slice(0, 10).forEach(ml => {\n                    html += \'<tr><td>#\' + (ml.rank || \'-\') + \'</td><td>\' + (ml.name || \'-\') + \'</td><td style="color:#10b981;">\' + ((ml.composite_score || ml.score || 0).toFixed?.(1) || ml.composite_score || ml.score || \'-\') + \'</td></tr>\';\n                });\n                if (mainlines.length > 10) {\n                    html += \'<tr><td colspan="3" style="color:var(--text-muted);">... å…±\' + mainlines.length + \'ä¸ªä¸»çº¿</td></tr>\';\n                }\n                html += \'</table>\';\n            }\n            \n            // å€™é€‰æ± è‚¡ç¥¨\n            else if (details.stocks) {\n                const stocks = details.stocks;\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#8b5cf6;">ğŸ“¦ å€™é€‰æ± è‚¡ç¥¨ (\' + stocks.length + \'åª)</strong></div>\';\n                html += \'<table><tr><th>ä»£ç </th><th>åç§°</th><th>æ¥æº</th><th>è¯„åˆ†</th></tr>\';\n                stocks.slice(0, 15).forEach(s => {\n                    html += \'<tr><td>\' + (s.code || \'-\') + \'</td><td>\' + (s.name || \'-\') + \'</td><td style="color:var(--text-muted);">\' + (s.source || \'-\') + \'</td><td style="color:#10b981;">\' + ((s.score || 0).toFixed?.(1) || \'-\') + \'</td></tr>\';\n                });\n                html += \'</table>\';\n            }\n            \n            // æ¨èå› å­\n            else if (details.recommended_factors) {\n                const factors = details.recommended_factors;\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#10b981;">ğŸ§® æ¨èå› å­</strong></div>\';\n                html += \'<ul style="margin:0;padding-left:20px;">\';\n                factors.forEach(f => {\n                    const weight = ((f.weight || 0) * 100).toFixed(0);\n                    html += \'<li style="margin:6px 0;"><strong>\' + (f.name || \'-\') + \'</strong> (æƒé‡\' + weight + \'%) - \' + (f.reason || \'\') + \'</li>\';\n                });\n                html += \'</ul>\';\n            }\n            \n            // æ•°æ®æºæ£€æµ‹\n            else if (details.jqdata !== undefined || details.akshare !== undefined) {\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#6366f1;">ğŸ“¡ æ•°æ®æºçŠ¶æ€</strong></div>\';\n                html += \'<table><tr><th>æ•°æ®æº</th><th>çŠ¶æ€</th></tr>\';\n                if (details.jqdata !== undefined) {\n                    html += \'<tr><td>JQData</td><td style="color:\' + (details.jqdata ? \'#10b981\' : \'#ef4444\') + \';">\' + (details.jqdata ? \'âœ… å¯ç”¨\' : \'âŒ ä¸å¯ç”¨\') + \'</td></tr>\';\n                }\n                if (details.akshare !== undefined) {\n                    html += \'<tr><td>AKShare</td><td style="color:\' + (details.akshare ? \'#10b981\' : \'#ef4444\') + \';">\' + (details.akshare ? \'âœ… å¯ç”¨\' : \'âŒ ä¸å¯ç”¨\') + \'</td></tr>\';\n                }\n                html += \'</table>\';\n            }\n            \n            // å¸‚åœºè¶‹åŠ¿\n            else if (details.regime || details.trend_strength !== undefined) {\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#6366f1;">ğŸ“ˆ å¸‚åœºè¶‹åŠ¿åˆ†æ</strong></div>\';\n                html += \'<table><tr><th>æŒ‡æ ‡</th><th>æ•°å€¼</th></tr>\';\n                if (details.regime) html += \'<tr><td>å¸‚åœºRegime</td><td>\' + details.regime + \'</td></tr>\';\n                if (details.trend_strength !== undefined) html += \'<tr><td>è¶‹åŠ¿å¼ºåº¦</td><td>\' + details.trend_strength + \'</td></tr>\';\n                if (details.volatility !== undefined) html += \'<tr><td>æ³¢åŠ¨ç‡</td><td>\' + details.volatility + \'</td></tr>\';\n                if (details.style_rotation) html += \'<tr><td>é£æ ¼è½®åŠ¨</td><td>\' + details.style_rotation + \'</td></tr>\';\n                html += \'</table>\';\n            }\n            \n            // ç­–ç•¥æ–‡ä»¶\n            else if (details.strategy_file) {\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#10b981;">ğŸ’» ç­–ç•¥ç”Ÿæˆå®Œæˆ</strong></div>\';\n                html += \'<div style="background:var(--bg-card);padding:12px;border-radius:8px;">\';\n                html += \'<div>ğŸ“„ ç­–ç•¥æ–‡ä»¶: <strong>\' + details.strategy_file.split(\'/\').pop() + \'</strong></div>\';\n                if (details.platform) html += \'<div>ğŸ¯ ç›®æ ‡å¹³å°: \' + details.platform + \'</div>\';\n                if (details.style) html += \'<div>ğŸ“Š ç­–ç•¥é£æ ¼: \' + details.style + \'</div>\';\n                html += \'</div>\';\n            }\n            \n            // é»˜è®¤JSONæ˜¾ç¤º\n            else {\n                html += \'<pre style="font-size:11px;overflow-x:auto;">\' + JSON.stringify(details, null, 2) + \'</pre>\';\n            }\n            \n            return html;\n        }\n        \n        // å¤„ç†æ¶ˆæ¯\n        window.addEventListener(\'message\', event => {\n            const message = event.data;\n            \n            switch (message.command) {\n                case \'loadingStart\':\n                    document.getElementById(\'loadingOverlay\').classList.add(\'active\');\n                    break;\n                case \'loadingEnd\':\n                    document.getElementById(\'loadingOverlay\').classList.remove(\'active\');\n                    break;\n                case \'marketStatusUpdated\':\n                    updateMarketStatus(message.data);\n                    break;\n                case \'mainlinesUpdated\':\n                    updateMainlines(message.data);\n                    break;\n                case \'factorsUpdated\':\n                    updateFactors(message.data);\n                    break;\n                    \n                // å·¥ä½œæµæ­¥éª¤æ‰§è¡Œ\n                case \'stepStarted\':\n                    setStepStatus(message.step, \'running\');\n                    showResultPanel();\n                    document.getElementById(\'result-title\').textContent = \'ğŸ“‹ \' + message.stepName + \' - æ‰§è¡Œä¸­\';\n                    document.getElementById(\'result-summary\').textContent = \'æ­£åœ¨æ‰§è¡Œ \' + message.stepName + \'...\';\n                    document.getElementById(\'result-details\').innerHTML = \'\';\n                    showProgress(true, 30, \'æ‰§è¡Œä¸­...\');\n                    break;\n                    \n                case \'stepResult\':\n                    setStepStatus(message.step, message.success ? \'completed\' : \'failed\');\n                    showProgress(false);\n                    document.getElementById(\'result-title\').textContent = \'ğŸ“‹ \' + message.stepName + \' - \' + (message.success ? \'âœ… å®Œæˆ\' : \'âŒ å¤±è´¥\');\n                    document.getElementById(\'result-summary\').textContent = message.summary || (message.success ? \'æ‰§è¡ŒæˆåŠŸ\' : \'æ‰§è¡Œå¤±è´¥\');\n                    document.getElementById(\'result-details\').innerHTML = formatDetails(message.details);\n                    break;\n                \n                // ä¸€é”®æ‰§è¡Œå…¨éƒ¨å·¥ä½œæµçš„æ¶ˆæ¯å¤„ç†\n                case \'workflowProgress\':\n                    var data = message.data;\n                    if (data.currentStep) {\n                        setStepStatus(data.currentStep, \'running\');\n                    }\n                    showResultPanel();\n                    document.getElementById(\'result-title\').textContent = \'ğŸ”„ æ‰§è¡Œå·¥ä½œæµ - \' + data.stepName;\n                    document.getElementById(\'result-summary\').textContent = \'è¿›åº¦: \' + Math.round(data.progress) + \'%\';\n                    showProgress(true, data.progress, data.stepName);\n                    break;\n                    \n                case \'workflowStepResult\':\n                    var stepData = message.data;\n                    if (stepData.stepId) {\n                        setStepStatus(stepData.stepId, stepData.success ? \'completed\' : \'failed\');\n                    }\n                    // ç´¯åŠ æ˜¾ç¤ºç»“æœ\n                    var detailsEl = document.getElementById(\'result-details\');\n                    var stepHtml = \'<div style="margin:8px 0;padding:8px;background:var(--bg-card);border-radius:6px;border-left:3px solid \' + \n                        (stepData.success ? \'#10b981\' : \'#ef4444\') + \';">\';\n                    stepHtml += \'<strong>\' + stepData.stepName + \'</strong>: \' + (stepData.success ? \'âœ…\' : \'âŒ\');\n                    stepHtml += \'</div>\';\n                    detailsEl.innerHTML += stepHtml;\n                    break;\n                    \n                case \'workflowComplete\':\n                    var completeData = message.data;\n                    showProgress(false);\n                    document.getElementById(\'result-title\').textContent = completeData.hasError ? \'âš ï¸ å·¥ä½œæµå®Œæˆï¼ˆéƒ¨åˆ†å¤±è´¥ï¼‰\' : \'âœ… å·¥ä½œæµæ‰§è¡Œå®Œæˆ\';\n                    document.getElementById(\'result-summary\').textContent = \'å…±æ‰§è¡Œ \' + completeData.results.length + \' ä¸ªæ­¥éª¤\';\n                    \n                    // æ˜¾ç¤ºæ±‡æ€»\n                    var summaryHtml = \'<div style="margin-top:16px;">\';\n                    summaryHtml += \'<h4 style="color:var(--accent-gold);margin-bottom:8px;">æ‰§è¡Œç»“æœæ±‡æ€»</h4>\';\n                    completeData.results.forEach(function(r) {\n                        summaryHtml += \'<div style="display:flex;align-items:center;gap:8px;margin:4px 0;">\';\n                        summaryHtml += \'<span>\' + (r.success ? \'âœ…\' : \'âŒ\') + \'</span>\';\n                        summaryHtml += \'<span>\' + r.step + \'</span>\';\n                        if (r.error) {\n                            summaryHtml += \'<span style="color:#ef4444;font-size:11px;">(\' + r.error + \')</span>\';\n                        }\n                        summaryHtml += \'</div>\';\n                    });\n                    summaryHtml += \'</div>\';\n                    document.getElementById(\'result-details\').innerHTML += summaryHtml;\n                    break;\n            }\n        });\n    <\/script>\n</body>\n</html>'}dispose(){for(m.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const n=this._disposables.pop();n&&n.dispose()}}}e.MainDashboard=m},133:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.StrategyGeneratorPanel=void 0;const i=o(t(398)),d=o(t(928)),c=t(628),l=t(290),p="StrategyGeneratorPanel",m=[{id:"momentum",name:"åŠ¨é‡ç­–ç•¥",icon:"ğŸš€",color:"#3B82F6",description:"è¿½æ¶¨å¼ºåŠ¿è‚¡ï¼Œé€‚åˆè¶‹åŠ¿å¸‚",params:[{name:"short_period",label:"çŸ­æœŸå‘¨æœŸ",type:"number",default:5,min:1,max:30},{name:"long_period",label:"é•¿æœŸå‘¨æœŸ",type:"number",default:20,min:5,max:120},{name:"max_stocks",label:"æŒè‚¡æ•°é‡",type:"number",default:10,min:1,max:50},{name:"rebalance_days",label:"è°ƒä»“å‘¨æœŸ",type:"number",default:5,min:1,max:30},{name:"stop_loss",label:"æ­¢æŸæ¯”ä¾‹",type:"number",default:.08,min:.01,max:.3,step:.01},{name:"take_profit",label:"æ­¢ç›ˆæ¯”ä¾‹",type:"number",default:.2,min:.05,max:1,step:.05}]},{id:"mean_reversion",name:"å‡å€¼å›å½’",icon:"ğŸ”„",color:"#10B981",description:"ä¹°å…¥è¶…è·Œè‚¡ç¥¨ï¼Œé€‚åˆéœ‡è¡å¸‚",params:[{name:"lookback",label:"å›çœ‹å‘¨æœŸ",type:"number",default:20,min:5,max:60},{name:"std_threshold",label:"æ ‡å‡†å·®é˜ˆå€¼",type:"number",default:2,min:1,max:3,step:.1},{name:"max_stocks",label:"æŒè‚¡æ•°é‡",type:"number",default:10,min:1,max:50},{name:"holding_days",label:"æŒæœ‰å¤©æ•°",type:"number",default:5,min:1,max:20}]},{id:"rotation",name:"è½®åŠ¨ç­–ç•¥",icon:"ğŸ”",color:"#F59E0B",description:"è¡Œä¸š/é£æ ¼è½®åŠ¨ï¼Œé€‚åˆç»“æ„æ€§è¡Œæƒ…",params:[{name:"momentum_period",label:"åŠ¨é‡å‘¨æœŸ",type:"number",default:20,min:5,max:60},{name:"holding_period",label:"æŒæœ‰å‘¨æœŸ",type:"number",default:5,min:1,max:20},{name:"top_n",label:"é€‰æ‹©æ•°é‡",type:"number",default:3,min:1,max:10}]}],u=[{id:"joinquant",name:"JoinQuant",icon:"ğŸ“Š"},{id:"bullettrade",name:"BulletTrade",icon:"ğŸ¯"},{id:"ptrade",name:"PTrade",icon:"ğŸ’¼"},{id:"qmt",name:"QMT",icon:"ğŸ“ˆ"}];class g{static currentPanel;_panel;_extensionUri;_client;_disposables=[];_generatedCode="";_currentStrategy="momentum";_currentPlatform="joinquant";constructor(n,e,t){this._panel=n,this._extensionUri=e,this._client=t,this._panel.webview.html=this._getHtmlContent(),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.onDidReceiveMessage(n=>this._handleMessage(n),null,this._disposables)}static createOrShow(n,e){c.logger.info("åˆ›å»ºç­–ç•¥ç”Ÿæˆé¢æ¿",p);const t=i.ViewColumn.One;if(g.currentPanel)return g.currentPanel._panel.reveal(t),g.currentPanel;const a=i.window.createWebviewPanel("trquantStrategyGenerator","ğŸ› ï¸ ç­–ç•¥ç”Ÿæˆå™¨",t,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[n]});return g.currentPanel=new g(a,n,e),g.currentPanel}dispose(){for(g.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const n=this._disposables.pop();n&&n.dispose()}}async _handleMessage(n){switch(c.logger.info(`[StrategyGeneratorPanel] æ”¶åˆ°æ¶ˆæ¯: ${n.command}`,p),n.command){case"generate":await this._generateStrategy(n.strategyType,n.params,n.platform);break;case"convert":await this._convertStrategy(n.code,n.fromPlatform,n.toPlatform);break;case"validate":await this._validateStrategy(n.code,n.platform);break;case"save":await this._saveStrategy(n.code,n.filename);break;case"copyToClipboard":await i.env.clipboard.writeText(n.code),i.window.showInformationMessage("ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿");break;case"openInEditor":await this._openInEditor(n.code);break;case"runBacktest":await this._runBacktest(n.code)}}async _generateStrategy(n,e,t){this._postMessage({command:"generating"});try{const a=await this._client.callBridge("call_mcp_tool",{tool_name:"strategy_template.generate",arguments:{strategy_type:n,params:e,platform:t},trace_id:(0,l.generateTraceId)()});if(!a.ok||!a.data)throw new Error(a.error||"ç”Ÿæˆå¤±è´¥");this._generatedCode=a.data.code||a.data,this._currentStrategy=n,this._currentPlatform=t,this._postMessage({command:"generated",code:this._generatedCode,strategyName:a.data.strategy_name||`${n}_strategy`,platform:t}),c.logger.info(`ç­–ç•¥ç”ŸæˆæˆåŠŸ: ${n} -> ${t}`,p)}catch(n){c.logger.error(`ç­–ç•¥ç”Ÿæˆå¤±è´¥: ${n.message}`,p),this._postMessage({command:"error",message:`ç­–ç•¥ç”Ÿæˆå¤±è´¥: ${n.message}`}),i.window.showErrorMessage(`ç­–ç•¥ç”Ÿæˆå¤±è´¥: ${n.message}`)}}async _convertStrategy(n,e,t){this._postMessage({command:"converting"});try{const a=await this._client.callBridge("call_mcp_tool",{tool_name:"strategy.convert",arguments:{code:n,from_platform:e,to_platform:t},trace_id:(0,l.generateTraceId)()});if(!a.ok||!a.data)throw new Error(a.error||"è½¬æ¢å¤±è´¥");this._generatedCode=a.data.code||a.data,this._currentPlatform=t,this._postMessage({command:"converted",code:this._generatedCode,fromPlatform:e,toPlatform:t}),i.window.showInformationMessage(`ç­–ç•¥å·²è½¬æ¢: ${e} â†’ ${t}`)}catch(n){this._postMessage({command:"error",message:`è½¬æ¢å¤±è´¥: ${n.message}`})}}async _validateStrategy(n,e){try{const t=await this._client.callBridge("call_mcp_tool",{tool_name:"strategy.validate",arguments:{code:n,platform:e},trace_id:(0,l.generateTraceId)()});if(t.ok&&t.data){const n=t.data.valid,e=t.data.issues||[];this._postMessage({command:"validated",valid:n,issues:e}),n?i.window.showInformationMessage("ç­–ç•¥ä»£ç éªŒè¯é€šè¿‡ âœ…"):i.window.showWarningMessage(`ç­–ç•¥ä»£ç æœ‰ ${e.length} ä¸ªé—®é¢˜`)}}catch(n){this._postMessage({command:"error",message:`éªŒè¯å¤±è´¥: ${n.message}`})}}async _saveStrategy(n,e){const t=`${this._currentStrategy}_${this._currentPlatform}_${Date.now()}.py`,a=await i.window.showSaveDialog({defaultUri:i.Uri.file(d.join(i.workspace.workspaceFolders?.[0]?.uri.fsPath||"","strategies",e||t)),filters:{Python:["py"]}});if(a){await i.workspace.fs.writeFile(a,Buffer.from(n,"utf-8")),i.window.showInformationMessage(`ç­–ç•¥å·²ä¿å­˜: ${a.fsPath}`);const e=await i.workspace.openTextDocument(a);await i.window.showTextDocument(e)}}async _openInEditor(n){const e=await i.workspace.openTextDocument({content:n,language:"python"});await i.window.showTextDocument(e)}async _runBacktest(n){await i.commands.executeCommand("trquant.openBacktestPanel",{code:n})}_postMessage(n){this._panel.webview.postMessage(n)}_getHtmlContent(){return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>ç­–ç•¥ç”Ÿæˆå™¨</title>\n    <style>\n        :root {\n            --bg-primary: #0d1117;\n            --bg-secondary: #161b22;\n            --bg-tertiary: #21262d;\n            --text-primary: #f0f6fc;\n            --text-secondary: #8b949e;\n            --border-primary: #30363d;\n            --accent: #58a6ff;\n            --success: #3fb950;\n            --warning: #d29922;\n            --error: #f85149;\n        }\n        \n        * { box-sizing: border-box; margin: 0; padding: 0; }\n        \n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n        }\n        \n        .header {\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border-primary);\n        }\n        \n        .header h1 {\n            font-size: 24px;\n            margin-bottom: 8px;\n        }\n        \n        .header p {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n        \n        .main-grid {\n            display: grid;\n            grid-template-columns: 350px 1fr;\n            gap: 24px;\n        }\n        \n        .config-panel {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-primary);\n            border-radius: 12px;\n            padding: 20px;\n        }\n        \n        .section-title {\n            font-size: 14px;\n            font-weight: 600;\n            color: var(--text-secondary);\n            margin-bottom: 12px;\n        }\n        \n        .template-list {\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n            margin-bottom: 24px;\n        }\n        \n        .template-card {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            padding: 12px;\n            background: var(--bg-tertiary);\n            border: 2px solid transparent;\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n        \n        .template-card:hover {\n            border-color: var(--accent);\n        }\n        \n        .template-card.selected {\n            border-color: var(--accent);\n            background: rgba(88, 166, 255, 0.1);\n        }\n        \n        .template-icon {\n            font-size: 24px;\n        }\n        \n        .template-name {\n            font-weight: 600;\n        }\n        \n        .template-desc {\n            font-size: 12px;\n            color: var(--text-secondary);\n        }\n        \n        .params-form {\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n            margin-bottom: 24px;\n        }\n        \n        .param-group {\n            display: flex;\n            flex-direction: column;\n            gap: 4px;\n        }\n        \n        .param-label {\n            font-size: 12px;\n            color: var(--text-secondary);\n        }\n        \n        .param-input {\n            padding: 8px 12px;\n            background: var(--bg-tertiary);\n            border: 1px solid var(--border-primary);\n            border-radius: 6px;\n            color: var(--text-primary);\n            font-size: 14px;\n        }\n        \n        .platform-select {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 8px;\n            margin-bottom: 24px;\n        }\n        \n        .platform-option {\n            cursor: pointer;\n        }\n        \n        .platform-option input {\n            display: none;\n        }\n        \n        .platform-label {\n            display: inline-block;\n            padding: 8px 16px;\n            background: var(--bg-tertiary);\n            border: 2px solid transparent;\n            border-radius: 6px;\n            font-size: 13px;\n            transition: all 0.2s;\n        }\n        \n        .platform-option input:checked + .platform-label {\n            border-color: var(--accent);\n            background: rgba(88, 166, 255, 0.1);\n        }\n        \n        .btn {\n            padding: 12px 24px;\n            border: none;\n            border-radius: 8px;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 600;\n            width: 100%;\n            transition: all 0.2s;\n        }\n        \n        .btn-primary {\n            background: var(--accent);\n            color: white;\n        }\n        \n        .btn-primary:hover {\n            opacity: 0.9;\n        }\n        \n        .btn-primary:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n        }\n        \n        .code-panel {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-primary);\n            border-radius: 12px;\n            display: flex;\n            flex-direction: column;\n        }\n        \n        .code-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 12px 16px;\n            border-bottom: 1px solid var(--border-primary);\n        }\n        \n        .code-actions {\n            display: flex;\n            gap: 8px;\n        }\n        \n        .btn-small {\n            padding: 6px 12px;\n            font-size: 12px;\n            border-radius: 4px;\n        }\n        \n        .code-content {\n            flex: 1;\n            padding: 16px;\n            overflow: auto;\n            min-height: 400px;\n        }\n        \n        .code-content pre {\n            margin: 0;\n            font-family: 'Monaco', 'Consolas', monospace;\n            font-size: 13px;\n            line-height: 1.5;\n            white-space: pre-wrap;\n        }\n        \n        .placeholder {\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            height: 100%;\n            color: var(--text-secondary);\n        }\n        \n        .loading {\n            text-align: center;\n            padding: 40px;\n            color: var(--accent);\n        }\n        \n        .loading::after {\n            content: '';\n            display: inline-block;\n            width: 20px;\n            height: 20px;\n            border: 2px solid var(--accent);\n            border-top-color: transparent;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n            margin-left: 8px;\n        }\n        \n        @keyframes spin {\n            to { transform: rotate(360deg); }\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <h1>ğŸ› ï¸ ç­–ç•¥ç”Ÿæˆå™¨</h1>\n        <p>é€‰æ‹©ç­–ç•¥æ¨¡æ¿ï¼Œé…ç½®å‚æ•°ï¼Œä¸€é”®ç”Ÿæˆå¤šå¹³å°é‡åŒ–ç­–ç•¥ä»£ç </p>\n    </div>\n    \n    <div class="main-grid">\n        <div class="config-panel">\n            <div class="section-title">ğŸ“‹ ç­–ç•¥æ¨¡æ¿</div>\n            <div class="template-list">\n                ${m.map(n=>`\n            <div class="template-card" data-id="${n.id}" onclick="selectTemplate('${n.id}')">\n                <div class="template-icon" style="color: ${n.color}">${n.icon}</div>\n                <div class="template-info">\n                    <div class="template-name">${n.name}</div>\n                    <div class="template-desc">${n.description}</div>\n                </div>\n            </div>\n        `).join("")}\n            </div>\n            \n            <div class="section-title">âš™ï¸ å‚æ•°é…ç½®</div>\n            <div class="params-form" id="params-form">\n                \x3c!-- åŠ¨æ€å¡«å…… --\x3e\n            </div>\n            \n            <div class="section-title">ğŸ–¥ï¸ ç›®æ ‡å¹³å°</div>\n            <div class="platform-select">\n                ${u.map(n=>`\n            <label class="platform-option">\n                <input type="radio" name="platform" value="${n.id}" ${"joinquant"===n.id?"checked":""}>\n                <span class="platform-label">${n.icon} ${n.name}</span>\n            </label>\n        `).join("")}\n            </div>\n            \n            <button class="btn btn-primary" id="generate-btn" onclick="generate()">\n                ğŸš€ ç”Ÿæˆç­–ç•¥ä»£ç \n            </button>\n        </div>\n        \n        <div class="code-panel">\n            <div class="code-header">\n                <span id="code-title">ç”Ÿæˆçš„ä»£ç </span>\n                <div class="code-actions">\n                    <button class="btn btn-small" onclick="copyCode()">ğŸ“‹ å¤åˆ¶</button>\n                    <button class="btn btn-small" onclick="saveCode()">ğŸ’¾ ä¿å­˜</button>\n                    <button class="btn btn-small" onclick="openInEditor()">ğŸ“ ç¼–è¾‘</button>\n                    <button class="btn btn-small btn-primary" onclick="runBacktest()">â–¶ï¸ å›æµ‹</button>\n                </div>\n            </div>\n            <div class="code-content" id="code-content">\n                <div class="placeholder">é€‰æ‹©ç­–ç•¥æ¨¡æ¿å¹¶ç‚¹å‡»"ç”Ÿæˆç­–ç•¥ä»£ç "</div>\n            </div>\n        </div>\n    </div>\n    \n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        const templates = ${JSON.stringify(m)};\n        let currentTemplate = templates[0];\n        let generatedCode = '';\n        \n        // åˆå§‹åŒ–\n        selectTemplate('momentum');\n        \n        function selectTemplate(id) {\n            currentTemplate = templates.find(t => t.id === id);\n            \n            // æ›´æ–°UI\n            document.querySelectorAll('.template-card').forEach(card => {\n                card.classList.toggle('selected', card.dataset.id === id);\n            });\n            \n            // æ›´æ–°å‚æ•°è¡¨å•\n            renderParams();\n        }\n        \n        function renderParams() {\n            const form = document.getElementById('params-form');\n            form.innerHTML = currentTemplate.params.map(p => \`\n                <div class="param-group">\n                    <label class="param-label">\${p.label}</label>\n                    <input type="number" \n                           class="param-input" \n                           id="param-\${p.name}" \n                           value="\${p.default}"\n                           min="\${p.min || 0}"\n                           max="\${p.max || 1000}"\n                           step="\${p.step || 1}">\n                </div>\n            \`).join('');\n        }\n        \n        function getParams() {\n            const params = {};\n            currentTemplate.params.forEach(p => {\n                const input = document.getElementById('param-' + p.name);\n                params[p.name] = parseFloat(input.value);\n            });\n            return params;\n        }\n        \n        function getPlatform() {\n            const selected = document.querySelector('input[name="platform"]:checked');\n            return selected ? selected.value : 'joinquant';\n        }\n        \n        function generate() {\n            const btn = document.getElementById('generate-btn');\n            btn.disabled = true;\n            btn.textContent = 'ç”Ÿæˆä¸­...';\n            \n            vscode.postMessage({\n                command: 'generate',\n                strategyType: currentTemplate.id,\n                params: getParams(),\n                platform: getPlatform()\n            });\n        }\n        \n        function copyCode() {\n            if (generatedCode) {\n                vscode.postMessage({ command: 'copyToClipboard', code: generatedCode });\n            }\n        }\n        \n        function saveCode() {\n            if (generatedCode) {\n                vscode.postMessage({ command: 'save', code: generatedCode });\n            }\n        }\n        \n        function openInEditor() {\n            if (generatedCode) {\n                vscode.postMessage({ command: 'openInEditor', code: generatedCode });\n            }\n        }\n        \n        function runBacktest() {\n            if (generatedCode) {\n                vscode.postMessage({ command: 'runBacktest', code: generatedCode });\n            }\n        }\n        \n        // æ¶ˆæ¯å¤„ç†\n        window.addEventListener('message', event => {\n            const message = event.data;\n            const btn = document.getElementById('generate-btn');\n            const content = document.getElementById('code-content');\n            const title = document.getElementById('code-title');\n            \n            switch (message.command) {\n                case 'generating':\n                    content.innerHTML = '<div class="loading">æ­£åœ¨ç”Ÿæˆç­–ç•¥ä»£ç </div>';\n                    break;\n                    \n                case 'generated':\n                    btn.disabled = false;\n                    btn.textContent = 'ğŸš€ ç”Ÿæˆç­–ç•¥ä»£ç ';\n                    generatedCode = message.code;\n                    content.innerHTML = '<pre>' + escapeHtml(message.code) + '</pre>';\n                    title.textContent = message.strategyName + ' (' + message.platform + ')';\n                    break;\n                    \n                case 'error':\n                    btn.disabled = false;\n                    btn.textContent = 'ğŸš€ ç”Ÿæˆç­–ç•¥ä»£ç ';\n                    content.innerHTML = '<div class="placeholder" style="color: var(--error);">' + message.message + '</div>';\n                    break;\n            }\n        });\n        \n        function escapeHtml(text) {\n            const div = document.createElement('div');\n            div.textContent = text;\n            return div.innerHTML;\n        }\n    <\/script>\n</body>\n</html>`}}e.StrategyGeneratorPanel=g},235:(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.registerBacktestManager=function(n,e){}},238:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.generateStrategy=async function(n,e){d.logger.info("æ‰§è¡Œç”Ÿæˆç­–ç•¥å‘½ä»¤",l);try{const e=await async function(){const n=await i.window.showQuickPick(p,{placeHolder:"é€‰æ‹©ç­–ç•¥å¹³å°",title:"Step 1/3: é€‰æ‹©ç›®æ ‡å¹³å°"});return n?.value}();if(!e)return;const t=await async function(){const n=await i.window.showQuickPick(m,{placeHolder:"é€‰æ‹©ç­–ç•¥é£æ ¼",title:"Step 2/3: é€‰æ‹©ç­–ç•¥é£æ ¼"});return n?.value}();if(!t)return;const a=await async function(){const n=await i.window.showQuickPick([{label:"âœ… ä½¿ç”¨é»˜è®¤å‚æ•°",value:"default",description:"æ­¢æŸ8%, æ­¢ç›ˆ20%, å•ç¥¨10%"},{label:"âš™ï¸ è‡ªå®šä¹‰å‚æ•°",value:"custom",description:"æ‰‹åŠ¨é…ç½®é£æ§å‚æ•°"}],{placeHolder:"é£æ§å‚æ•°é…ç½®",title:"Step 3/3: é…ç½®é£æ§å‚æ•°"});if(!n)return;if("default"===n.value)return{max_position:.1,stop_loss:.08,take_profit:.2};const e=await i.window.showInputBox({prompt:"å•ç¥¨æœ€å¤§ä»“ä½ (%)",value:"10",validateInput:n=>{const e=parseFloat(n);return isNaN(e)||e<=0||e>100?"è¯·è¾“å…¥1-100ä¹‹é—´çš„æ•°å­—":null}});if(!e)return;const t=await i.window.showInputBox({prompt:"æ­¢æŸçº¿ (%)",value:"8",validateInput:n=>{const e=parseFloat(n);return isNaN(e)||e<=0||e>50?"è¯·è¾“å…¥1-50ä¹‹é—´çš„æ•°å­—":null}});if(!t)return;const a=await i.window.showInputBox({prompt:"æ­¢ç›ˆçº¿ (%)",value:"20",validateInput:n=>{const e=parseFloat(n);return isNaN(e)||e<=0||e>100?"è¯·è¾“å…¥1-100ä¹‹é—´çš„æ•°å­—":null}});return a?{max_position:parseFloat(e)/100,stop_loss:parseFloat(t)/100,take_profit:parseFloat(a)/100}:void 0}();if(!a)return;await async function(n,e,t,a,r){await i.window.withProgress({location:i.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(e,s)=>{try{e.report({message:"è·å–å¸‚åœºçŠ¶æ€...",increment:0});const o=await n.getMarketStatus();if(s.isCancellationRequested)return;e.report({message:"è·å–æ¨èå› å­...",increment:20});const c=await n.recommendFactors({market_regime:o.data?.regime});if(s.isCancellationRequested)return;e.report({message:`ç”Ÿæˆ${t.toUpperCase()}ç­–ç•¥ä»£ç ...`,increment:30});const p=(c.data||[]).slice(0,5).map(n=>n.name),m=await n.generateStrategy({factors:p,style:a,platform:t,risk_params:r});if(e.report({increment:30}),!m.ok||!m.data)return void i.window.showErrorMessage(`ç”Ÿæˆç­–ç•¥å¤±è´¥: ${m.error||"æœªçŸ¥é”™è¯¯"}`);const u=m.data;d.logger.info(`ç­–ç•¥ç”ŸæˆæˆåŠŸ: ${u.name}`,l),e.report({message:"å®Œæˆ",increment:20}),await async function(n,e,t){const a=await i.workspace.openTextDocument({content:e.code,language:"python"});switch(await i.window.showTextDocument(a,i.ViewColumn.One),await i.window.showInformationMessage(`${t.toUpperCase()} ç­–ç•¥ "${e.name}" å·²ç”Ÿæˆ`,"ä¿å­˜æ–‡ä»¶","å¤åˆ¶ä»£ç ","æŸ¥çœ‹è¯´æ˜")){case"ä¿å­˜æ–‡ä»¶":await async function(n,e){const t=`${n.name}.py`,a=await i.window.showSaveDialog({defaultUri:i.Uri.file(t),filters:{Pythonæ–‡ä»¶:["py"]},title:`ä¿å­˜${e.toUpperCase()}ç­–ç•¥`});if(a){await i.workspace.fs.writeFile(a,Buffer.from(n.code,"utf-8"));const e=i.Uri.file(a.fsPath.replace(".py","_meta.json")),t={name:n.name,platform:n.platform,style:n.style,factors:n.factors,risk_params:n.risk_params,created_at:(new Date).toISOString()};await i.workspace.fs.writeFile(e,Buffer.from(JSON.stringify(t,null,2),"utf-8")),i.window.showInformationMessage(`ç­–ç•¥å·²ä¿å­˜: ${a.fsPath}`),d.logger.info(`ç­–ç•¥ä¿å­˜åˆ°: ${a.fsPath}`,l)}}(e,t);break;case"å¤åˆ¶ä»£ç ":await i.env.clipboard.writeText(e.code),i.window.showInformationMessage("ç­–ç•¥ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿");break;case"æŸ¥çœ‹è¯´æ˜":!function(n){const e=`\n# ç­–ç•¥è¯´æ˜\n\n## åŸºæœ¬ä¿¡æ¯\n- **ç­–ç•¥åç§°**: ${n.name}\n- **ç›®æ ‡å¹³å°**: ${n.platform.toUpperCase()}\n- **ç­–ç•¥é£æ ¼**: ${{multi_factor:"å¤šå› å­é€‰è‚¡",momentum_growth:"åŠ¨é‡æˆé•¿",value:"ä»·å€¼æŠ•èµ„",market_neutral:"å¸‚åœºä¸­æ€§"}[n.style]}\n\n## ä½¿ç”¨å› å­\n${n.factors.map(n=>`- ${n}`).join("\n")}\n\n## é£æ§å‚æ•°\n- **å•ç¥¨æœ€å¤§ä»“ä½**: ${(100*n.risk_params.max_position).toFixed(0)}%\n- **æ­¢æŸçº¿**: ${(100*n.risk_params.stop_loss).toFixed(0)}%\n- **æ­¢ç›ˆçº¿**: ${(100*n.risk_params.take_profit).toFixed(0)}%\n\n## ç­–ç•¥æè¿°\n${n.description}\n\n## ä½¿ç”¨è¯´æ˜\n1. å°†ä»£ç å¤åˆ¶åˆ°${n.platform.toUpperCase()}å®¢æˆ·ç«¯\n2. æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´è‚¡ç¥¨æ± å’Œå‚æ•°\n3. è¿›è¡Œå›æµ‹éªŒè¯åå†å®ç›˜ä½¿ç”¨\n4. æ³¨æ„é£é™©æ§åˆ¶ï¼Œä¸è¦è¶…è¿‡æ‰¿å—èƒ½åŠ›\n    `;i.workspace.openTextDocument({content:e,language:"markdown"}).then(n=>{i.window.showTextDocument(n,i.ViewColumn.Beside)})}(e)}}(0,u,t)}catch(n){c.ErrorHandler.handle(n,l)}})}(n,0,e,t,a)}catch(n){c.ErrorHandler.handle(n,l)}};const i=o(t(398)),d=t(628),c=t(799),l="GenerateStrategy",p=[{label:"ğŸ“Š PTrade (æ’ç”Ÿ)",value:"ptrade",description:"æ’ç”ŸPTradeå¹³å°ï¼Œæ”¯æŒAè‚¡ã€ETFäº¤æ˜“",detail:"å‡½æ•°: initialize(), handle_data()"},{label:"ğŸ“ˆ QMT (è¿…æŠ•)",value:"qmt",description:"è¿…æŠ•QMTå¹³å°ï¼Œæ”¯æŒè‚¡ç¥¨ã€æœŸè´§äº¤æ˜“",detail:"å‡½æ•°: init(), handlebar()"}],m=[{label:"ğŸ“ˆ å¤šå› å­é€‰è‚¡",value:"multi_factor",description:"ç»¼åˆå¤šä¸ªå› å­è¯„åˆ†é€‰è‚¡",detail:"é€‚åˆ: å„ç§å¸‚åœºç¯å¢ƒ"},{label:"ğŸš€ åŠ¨é‡æˆé•¿",value:"momentum_growth",description:"è¿½é€å¼ºåŠ¿æˆé•¿è‚¡",detail:"é€‚åˆ: ç‰›å¸‚ã€é£é™©åå¥½ä¸Šå‡"},{label:"ğŸ’° ä»·å€¼æŠ•èµ„",value:"value",description:"ä½ä¼°å€¼é«˜åˆ†çº¢æ ‡çš„",detail:"é€‚åˆ: ç†Šå¸‚ã€é£é™©åå¥½ä¸‹é™"},{label:"âš–ï¸ å¸‚åœºä¸­æ€§",value:"market_neutral",description:"å¤šç©ºå¯¹å†²ç­–ç•¥",detail:"é€‚åˆ: éœ‡è¡å¸‚ã€ä¸ç¡®å®šç¯å¢ƒ"}]},263:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.StrategyManagerPanel=void 0;const i=o(t(398)),d=o(t(928)),c=o(t(896));class l{static currentPanel;_panel;_disposables=[];_extensionUri;static viewType="trquant.strategyManager";static createOrShow(n){const e=i.window.activeTextEditor?i.window.activeTextEditor.viewColumn:void 0;if(l.currentPanel)return void l.currentPanel._panel.reveal(e);const t=i.window.createWebviewPanel(l.viewType,"ğŸ“Š ç­–ç•¥ç®¡ç†",e||i.ViewColumn.One,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[n]});l.currentPanel=new l(t,n)}constructor(n,e){this._panel=n,this._extensionUri=e,this._update(),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.onDidReceiveMessage(async n=>{switch(n.command){case"loadStrategies":await this._loadStrategies();break;case"loadBacktestHistory":await this._loadBacktestHistory();break;case"openStrategy":await this._openStrategy(n.path);break;case"runBacktest":await this._runBacktest(n.strategyPath);break;case"viewBacktestResult":await this._viewBacktestResult(n.resultId);break;case"refresh":await this._refresh()}},null,this._disposables)}async _loadStrategies(){const n=i.workspace.workspaceFolders;if(!n)return;const e=n[0].uri.fsPath,t=d.join(e,"strategies"),a=[],r=["bullettrade","ptrade","qmt","unified"];for(const n of r){const e=d.join(t,n);if(c.existsSync(e)){const t=c.readdirSync(e).filter(n=>n.endsWith(".py"));for(const r of t){const t=d.join(e,r),s=c.statSync(t);a.push({name:r.replace(".py",""),path:t,category:n,modified:s.mtime.toISOString(),size:s.size})}}}this._panel.webview.postMessage({command:"strategiesLoaded",strategies:a})}async _loadBacktestHistory(){const n=[{id:"1",strategyName:"TRQuant_momentum_v3",startDate:"2024-01-01",endDate:"2024-06-30",totalReturn:.25,sharpeRatio:1.8,maxDrawdown:.08,timestamp:(new Date).toISOString()},{id:"2",strategyName:"TRQuant_value_strategy",startDate:"2024-01-01",endDate:"2024-06-30",totalReturn:.15,sharpeRatio:1.2,maxDrawdown:.12,timestamp:(new Date).toISOString()}];this._panel.webview.postMessage({command:"backtestHistoryLoaded",history:n})}async _openStrategy(n){const e=await i.workspace.openTextDocument(n);await i.window.showTextDocument(e)}async _runBacktest(n){i.window.showInformationMessage(`å¼€å§‹å›æµ‹: ${d.basename(n)}`)}async _viewBacktestResult(n){i.window.showInformationMessage(`æŸ¥çœ‹å›æµ‹ç»“æœ: ${n}`)}async _refresh(){await this._loadStrategies(),await this._loadBacktestHistory()}_update(){this._panel.webview.html=this._getHtmlContent(),this._loadStrategies(),this._loadBacktestHistory()}_getHtmlContent(){return'<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>ç­–ç•¥ç®¡ç†</title>\n    <style>\n        :root {\n            --bg-primary: #1e1e2e;\n            --bg-secondary: #2d2d3d;\n            --bg-card: #363646;\n            --text-primary: #e0e0e0;\n            --text-secondary: #a0a0a0;\n            --accent: #00d9ff;\n            --accent-green: #00ff88;\n            --accent-red: #ff4444;\n            --border: #404050;\n        }\n        \n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: \'Segoe UI\', \'PingFang SC\', sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 1rem;\n        }\n        \n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 1.5rem;\n            padding-bottom: 1rem;\n            border-bottom: 1px solid var(--border);\n        }\n        \n        .header h1 {\n            font-size: 1.5rem;\n            background: linear-gradient(90deg, var(--accent), var(--accent-green));\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n        }\n        \n        .tabs {\n            display: flex;\n            gap: 0.5rem;\n            margin-bottom: 1rem;\n        }\n        \n        .tab {\n            padding: 0.75rem 1.5rem;\n            background: var(--bg-secondary);\n            border: none;\n            border-radius: 8px;\n            color: var(--text-secondary);\n            cursor: pointer;\n            transition: all 0.3s;\n        }\n        \n        .tab.active {\n            background: var(--accent);\n            color: var(--bg-primary);\n        }\n        \n        .tab:hover:not(.active) {\n            background: var(--bg-card);\n        }\n        \n        .tab-content {\n            display: none;\n        }\n        \n        .tab-content.active {\n            display: block;\n        }\n        \n        .card {\n            background: var(--bg-card);\n            border-radius: 12px;\n            padding: 1rem;\n            margin-bottom: 1rem;\n            border: 1px solid var(--border);\n        }\n        \n        .strategy-list {\n            display: grid;\n            gap: 0.75rem;\n        }\n        \n        .strategy-item {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 1rem;\n            background: var(--bg-secondary);\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.3s;\n        }\n        \n        .strategy-item:hover {\n            background: var(--bg-card);\n            transform: translateX(5px);\n        }\n        \n        .strategy-name {\n            font-weight: 600;\n            color: var(--text-primary);\n        }\n        \n        .strategy-meta {\n            font-size: 0.85rem;\n            color: var(--text-secondary);\n        }\n        \n        .category-badge {\n            padding: 0.25rem 0.75rem;\n            border-radius: 20px;\n            font-size: 0.75rem;\n            font-weight: 600;\n        }\n        \n        .category-bullettrade { background: rgba(0, 217, 255, 0.2); color: var(--accent); }\n        .category-ptrade { background: rgba(0, 255, 136, 0.2); color: var(--accent-green); }\n        .category-qmt { background: rgba(255, 170, 0, 0.2); color: #ffaa00; }\n        .category-unified { background: rgba(136, 136, 255, 0.2); color: #8888ff; }\n        \n        .btn {\n            padding: 0.5rem 1rem;\n            border: none;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 0.85rem;\n            transition: all 0.3s;\n        }\n        \n        .btn-primary {\n            background: var(--accent);\n            color: var(--bg-primary);\n        }\n        \n        .btn-primary:hover {\n            opacity: 0.8;\n        }\n        \n        .btn-outline {\n            background: transparent;\n            border: 1px solid var(--accent);\n            color: var(--accent);\n        }\n        \n        .btn-outline:hover {\n            background: var(--accent);\n            color: var(--bg-primary);\n        }\n        \n        .backtest-table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n        \n        .backtest-table th,\n        .backtest-table td {\n            padding: 0.75rem;\n            text-align: left;\n            border-bottom: 1px solid var(--border);\n        }\n        \n        .backtest-table th {\n            color: var(--text-secondary);\n            font-weight: 500;\n        }\n        \n        .positive { color: var(--accent-green); }\n        .negative { color: var(--accent-red); }\n        \n        .stats-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n            gap: 1rem;\n        }\n        \n        .stat-card {\n            background: var(--bg-secondary);\n            padding: 1rem;\n            border-radius: 8px;\n            text-align: center;\n        }\n        \n        .stat-value {\n            font-size: 1.5rem;\n            font-weight: bold;\n            color: var(--accent);\n        }\n        \n        .stat-label {\n            font-size: 0.85rem;\n            color: var(--text-secondary);\n            margin-top: 0.25rem;\n        }\n        \n        .actions {\n            display: flex;\n            gap: 0.5rem;\n        }\n        \n        .empty-state {\n            text-align: center;\n            padding: 3rem;\n            color: var(--text-secondary);\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <h1>ğŸ“Š ç­–ç•¥ç®¡ç†ä¸­å¿ƒ</h1>\n        <button class="btn btn-outline" onclick="refresh()">ğŸ”„ åˆ·æ–°</button>\n    </div>\n    \n    <div class="tabs">\n        <button class="tab active" onclick="switchTab(\'strategies\')">ğŸ“ ç­–ç•¥åº“</button>\n        <button class="tab" onclick="switchTab(\'backtest\')">ğŸ“ˆ å›æµ‹å†å²</button>\n        <button class="tab" onclick="switchTab(\'performance\')">ğŸ¯ ç»©æ•ˆè·Ÿè¸ª</button>\n    </div>\n    \n    <div id="strategies" class="tab-content active">\n        <div class="card">\n            <h3 style="margin-bottom: 1rem;">ç­–ç•¥åˆ—è¡¨</h3>\n            <div id="strategyList" class="strategy-list">\n                <div class="empty-state">åŠ è½½ä¸­...</div>\n            </div>\n        </div>\n    </div>\n    \n    <div id="backtest" class="tab-content">\n        <div class="card">\n            <h3 style="margin-bottom: 1rem;">å›æµ‹å†å²è®°å½•</h3>\n            <table class="backtest-table">\n                <thead>\n                    <tr>\n                        <th>ç­–ç•¥åç§°</th>\n                        <th>å›æµ‹åŒºé—´</th>\n                        <th>æ€»æ”¶ç›Š</th>\n                        <th>å¤æ™®æ¯”ç‡</th>\n                        <th>æœ€å¤§å›æ’¤</th>\n                        <th>æ“ä½œ</th>\n                    </tr>\n                </thead>\n                <tbody id="backtestHistory">\n                </tbody>\n            </table>\n        </div>\n    </div>\n    \n    <div id="performance" class="tab-content">\n        <div class="stats-grid">\n            <div class="stat-card">\n                <div class="stat-value" id="totalStrategies">0</div>\n                <div class="stat-label">ç­–ç•¥æ€»æ•°</div>\n            </div>\n            <div class="stat-card">\n                <div class="stat-value" id="totalBacktests">0</div>\n                <div class="stat-label">å›æµ‹æ¬¡æ•°</div>\n            </div>\n            <div class="stat-card">\n                <div class="stat-value positive" id="avgReturn">0%</div>\n                <div class="stat-label">å¹³å‡æ”¶ç›Š</div>\n            </div>\n            <div class="stat-card">\n                <div class="stat-value" id="avgSharpe">0</div>\n                <div class="stat-label">å¹³å‡å¤æ™®</div>\n            </div>\n        </div>\n    </div>\n    \n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        let strategies = [];\n        let backtestHistory = [];\n        \n        function switchTab(tabId) {\n            document.querySelectorAll(\'.tab\').forEach(t => t.classList.remove(\'active\'));\n            document.querySelectorAll(\'.tab-content\').forEach(c => c.classList.remove(\'active\'));\n            \n            event.target.classList.add(\'active\');\n            document.getElementById(tabId).classList.add(\'active\');\n        }\n        \n        function renderStrategies() {\n            const container = document.getElementById(\'strategyList\');\n            \n            if (strategies.length === 0) {\n                container.innerHTML = \'<div class="empty-state">æš‚æ— ç­–ç•¥</div>\';\n                return;\n            }\n            \n            container.innerHTML = strategies.map(s => `\n                <div class="strategy-item" onclick="openStrategy(\'${s.path}\')">\n                    <div>\n                        <div class="strategy-name">${s.name}</div>\n                        <div class="strategy-meta">ä¿®æ”¹æ—¶é—´: ${new Date(s.modified).toLocaleString()}</div>\n                    </div>\n                    <div class="actions">\n                        <span class="category-badge category-${s.category}">${s.category}</span>\n                        <button class="btn btn-primary" onclick="event.stopPropagation(); runBacktest(\'${s.path}\')">å›æµ‹</button>\n                    </div>\n                </div>\n            `).join(\'\');\n            \n            document.getElementById(\'totalStrategies\').textContent = strategies.length;\n        }\n        \n        function renderBacktestHistory() {\n            const tbody = document.getElementById(\'backtestHistory\');\n            \n            tbody.innerHTML = backtestHistory.map(h => `\n                <tr>\n                    <td>${h.strategyName}</td>\n                    <td>${h.startDate} ~ ${h.endDate}</td>\n                    <td class="${h.totalReturn >= 0 ? \'positive\' : \'negative\'}">${(h.totalReturn * 100).toFixed(2)}%</td>\n                    <td>${h.sharpeRatio.toFixed(2)}</td>\n                    <td class="negative">${(h.maxDrawdown * 100).toFixed(2)}%</td>\n                    <td>\n                        <button class="btn btn-outline" onclick="viewResult(\'${h.id}\')">æŸ¥çœ‹</button>\n                    </td>\n                </tr>\n            `).join(\'\');\n            \n            document.getElementById(\'totalBacktests\').textContent = backtestHistory.length;\n            \n            if (backtestHistory.length > 0) {\n                const avgReturn = backtestHistory.reduce((sum, h) => sum + h.totalReturn, 0) / backtestHistory.length;\n                const avgSharpe = backtestHistory.reduce((sum, h) => sum + h.sharpeRatio, 0) / backtestHistory.length;\n                document.getElementById(\'avgReturn\').textContent = (avgReturn * 100).toFixed(2) + \'%\';\n                document.getElementById(\'avgSharpe\').textContent = avgSharpe.toFixed(2);\n            }\n        }\n        \n        function openStrategy(path) {\n            vscode.postMessage({ command: \'openStrategy\', path: path });\n        }\n        \n        function runBacktest(path) {\n            vscode.postMessage({ command: \'runBacktest\', strategyPath: path });\n        }\n        \n        function viewResult(id) {\n            vscode.postMessage({ command: \'viewBacktestResult\', resultId: id });\n        }\n        \n        function refresh() {\n            vscode.postMessage({ command: \'refresh\' });\n        }\n        \n        window.addEventListener(\'message\', event => {\n            const message = event.data;\n            switch (message.command) {\n                case \'strategiesLoaded\':\n                    strategies = message.strategies;\n                    renderStrategies();\n                    break;\n                case \'backtestHistoryLoaded\':\n                    backtestHistory = message.history;\n                    renderBacktestHistory();\n                    break;\n            }\n        });\n        \n        // åˆå§‹åŠ è½½\n        vscode.postMessage({ command: \'loadStrategies\' });\n        vscode.postMessage({ command: \'loadBacktestHistory\' });\n    <\/script>\n</body>\n</html>'}dispose(){for(l.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const n=this._disposables.pop();n&&n.dispose()}}}e.StrategyManagerPanel=l},265:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.activate=async function(n){M.logger.info("TRQuant Extension æ­£åœ¨æ¿€æ´»...",E);const e=Date.now();try{const t=S.ConfigManager.getInstance();n.subscriptions.push({dispose:()=>t.dispose()}),I=new d.TRQuantClient(n),n.subscriptions.push({dispose:()=>I.dispose()}),$=function(){const n=i.window.createStatusBarItem(i.StatusBarAlignment.Right,100);return n.text="$(graph) TRQuant",n.tooltip="TRQuant é‡åŒ–åŠ©æ‰‹ - ç‚¹å‡»æ‰“å¼€æ§åˆ¶é¢æ¿",n.command="trquant.showPanel",n.show(),n}(),n.subscriptions.push($),function(n){const e=[{id:"trquant.getMarketStatus",handler:()=>(0,m.getMarketStatus)(I,n)},{id:"trquant.getMainlines",handler:()=>(0,u.getMainlines)(I,n)},{id:"trquant.recommendFactors",handler:()=>(0,g.recommendFactors)(I,n)},{id:"trquant.generateStrategy",handler:()=>(0,f.generateStrategy)(I,n)},{id:"trquant.analyzeBacktest",handler:()=>(0,v.analyzeBacktest)(I,n)},{id:"trquant.createProject",handler:()=>(0,h.createProject)(n)},{id:"trquant.runBacktest",handler:()=>(0,b.runBacktest)(I,n)},{id:"trquant.enableMCP",handler:async()=>{await R(n),i.window.showInformationMessage("TRQuant MCP Server å·²å¯ç”¨")}},{id:"trquant.showPanel",handler:async()=>{y.MarketPanel.createOrShow(n.extensionUri,I)}},{id:"trquant.showDashboard",handler:async()=>{}},{id:"trquant.openDashboard",handler:async()=>{w.MainDashboard.createOrShow(n.extensionUri,I,n.extensionPath)}},{id:"trquant.showWelcome",handler:async()=>{}},{id:"trquant.showLogs",handler:async()=>{M.logger.show()}},{id:"trquant.refreshStatus",handler:async()=>{await T(),i.window.showInformationMessage("çŠ¶æ€å·²åˆ·æ–°")}},{id:"trquant.showStrategyManager",handler:async()=>{x.StrategyManagerPanel.createOrShow(n.extensionUri)}}];for(const{id:t,handler:a}of e){const e=i.commands.registerCommand(t,async()=>{await O.ErrorHandler.wrap(a,t)});n.subscriptions.push(e)}M.logger.info(`å·²æ³¨å†Œ ${e.length} ä¸ªå‘½ä»¤`,E)}(n),(0,C.registerPanels)(n,I),(0,k.registerWorkflowProvider)(n),(0,l.registerConfigCommands)(n),(0,p.registerBacktestManager)(n,I),(0,_.registerStrategyCompletionProvider)(n),(0,P.registerStrategyDiagnosticProvider)(n),(0,w.registerMainDashboard)(n,I),S.config.get("mcpEnabled")&&await R(n),T();const a=Date.now()-e;M.logger.info(`TRQuant Extension æ¿€æ´»å®Œæˆ (${a}ms)`,E),setTimeout(()=>{w.MainDashboard.createOrShow(n.extensionUri,I,n.extensionPath)},500)}catch(n){throw O.ErrorHandler.handle(n,E),n}},e.deactivate=function(){M.logger.info("TRQuant Extension æ­£åœ¨åœç”¨...",E),I&&I.dispose(),M.logger.dispose()};const i=o(t(398)),d=t(3),c=t(334),l=t(898),p=t(235),m=t(501),u=t(327),g=t(405),f=t(238),v=t(900),h=t(274),b=t(357),y=t(395),w=t(126),x=t(263),_=t(735),k=t(485),P=t(570),M=t(628),S=t(478),O=t(799),C=t(939),E="Extension";let I,$;async function R(n){try{await c.MCPRegistrar.registerServer(n),M.logger.info("MCP Server å·²æ³¨å†Œ",E)}catch(n){M.logger.warn(`MCPæ³¨å†Œå¤±è´¥: ${n instanceof Error?n.message:String(n)}`,E)}}async function T(){try{const n=await I.getMarketStatus();if(n.ok&&n.data){const e=n.data.regime,t={risk_on:"ğŸ“ˆ",risk_off:"ğŸ“‰",neutral:"â¡ï¸"}[e]||"ğŸ“Š";$.text=`$(graph) ${t} TRQuant`,$.tooltip=`TRQuant | å¸‚åœº: ${e.toUpperCase()}\nç‚¹å‡»æ‰“å¼€æ§åˆ¶é¢æ¿`}}catch(n){M.logger.debug("æ›´æ–°çŠ¶æ€æ å¤±è´¥",E,{error:n})}}},274:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.createProject=async function(n){i.window.showInformationMessage("åˆ›å»ºé¡¹ç›®åŠŸèƒ½å¼€å‘ä¸­")};const i=o(t(398))},290:(n,e)=>{function t(){return`tr-${Date.now().toString(36)}-${Math.random().toString(36).substring(2,8)}`}function a(n){try{const e=JSON.parse(n);return"success"in e&&"metadata"in e?e:{success:!0,data:e,metadata:{server_name:"unknown",tool_name:"unknown",version:"2.0.0",timestamp:(new Date).toISOString()}}}catch(n){return{success:!1,error:{code:"PARSE_ERROR",message:"è§£æå“åº”å¤±è´¥"},metadata:{server_name:"unknown",tool_name:"unknown",version:"2.0.0",timestamp:(new Date).toISOString()}}}}function r(n){const t=e.WORKFLOW_9STEPS.find(e=>e.id===n);return t?.mcp_tool}function s(n){return e.WORKFLOW_9STEPS.findIndex(e=>e.id===n)}Object.defineProperty(e,"__esModule",{value:!0}),e.mcpClientV2=e.MCP_TOOLS_V2=e.WORKFLOW_9STEPS=void 0,e.generateTraceId=t,e.parseMCPResponse=a,e.getStepMCPTool=r,e.getStepIndex=s,e.formatPercent=function(n){return(100*n).toFixed(2)+"%"},e.formatDuration=function(n){return n<60?n.toFixed(1)+"ç§’":n<3600?(n/60).toFixed(1)+"åˆ†é’Ÿ":(n/3600).toFixed(1)+"å°æ—¶"},e.WORKFLOW_9STEPS=[{id:"data_source",name:"ä¿¡æ¯è·å–",icon:"ğŸ“¡",color:"#58a6ff",mcp_tool:"data_source.check",description:"æ£€æŸ¥æ•°æ®æºè¿æ¥çŠ¶æ€ï¼Œç¡®ä¿æ•°æ®è·å–æ­£å¸¸"},{id:"market_trend",name:"å¸‚åœºè¶‹åŠ¿",icon:"ğŸ“ˆ",color:"#667eea",mcp_tool:"market.status",description:"åˆ†æå½“å‰å¸‚åœºçŠ¶æ€ã€è¶‹åŠ¿å’Œé£æ ¼è½®åŠ¨"},{id:"mainline",name:"æŠ•èµ„ä¸»çº¿",icon:"ğŸ”¥",color:"#F59E0B",mcp_tool:"market.mainlines",description:"è¯†åˆ«å½“å‰å¸‚åœºæŠ•èµ„ä¸»çº¿å’Œçƒ­ç‚¹æ¿å—"},{id:"candidate_pool",name:"å€™é€‰æ± æ„å»º",icon:"ğŸ“¦",color:"#a371f7",mcp_tool:"data_source.candidate_pool",description:"æ ¹æ®æŠ•èµ„ä¸»çº¿æ„å»ºå€™é€‰è‚¡ç¥¨æ± "},{id:"factor",name:"å› å­æ„å»º",icon:"ğŸ§®",color:"#3fb950",mcp_tool:"factor.recommend",description:"åŸºäºå¸‚åœºçŠ¶æ€æ¨èé‡åŒ–å› å­ç»„åˆ"},{id:"strategy",name:"ç­–ç•¥ç”Ÿæˆ",icon:"ğŸ’»",color:"#d29922",mcp_tool:"strategy_template.generate",description:"ç”Ÿæˆå¤šå¹³å°é‡åŒ–ç­–ç•¥ä»£ç "},{id:"backtest",name:"å›æµ‹éªŒè¯",icon:"ğŸ”„",color:"#1E3A5F",mcp_tool:"backtest.fast",description:"æ‰§è¡Œç­–ç•¥å›æµ‹ï¼ŒéªŒè¯ç­–ç•¥æœ‰æ•ˆæ€§"},{id:"optimization",name:"ç­–ç•¥ä¼˜åŒ–",icon:"âš™ï¸",color:"#7C3AED",mcp_tool:"optimizer.grid_search",description:"å‚æ•°ä¼˜åŒ–ï¼Œå¯»æ‰¾æœ€ä¼˜ç­–ç•¥é…ç½®"},{id:"report",name:"æŠ¥å‘Šç”Ÿæˆ",icon:"ğŸ“„",color:"#EC4899",mcp_tool:"report.generate",description:"ç”Ÿæˆå®Œæ•´çš„æŠ•èµ„ç ”ç©¶æŠ¥å‘Š"}],e.MCP_TOOLS_V2={data_source:{check:{name:"data_source.check",description:"æ£€æŸ¥æ‰€æœ‰æ•°æ®æºè¿æ¥çŠ¶æ€",params:{}},switch:{name:"data_source.switch",description:"åˆ‡æ¢æ´»è·ƒæ•°æ®æº",params:{source:{type:"string",enum:["jqdata","akshare","mock"],required:!0}}},candidate_pool:{name:"data_source.candidate_pool",description:"æ„å»ºå€™é€‰è‚¡ç¥¨æ± ",params:{mainline:{type:"string",description:"æŠ•èµ„ä¸»çº¿åç§°"},filters:{type:"object",description:"ç­›é€‰æ¡ä»¶"},limit:{type:"number",default:100}}}},market:{status:{name:"market.status",description:"è·å–å¸‚åœºå½“å‰çŠ¶æ€å’Œé£æ ¼åˆ†æ",params:{universe:{type:"string",default:"CN_EQ"}}},trend:{name:"market.trend",description:"åˆ†æå¸‚åœºè¶‹åŠ¿",params:{period:{type:"string",enum:["short","medium","long"],default:"short"}}},mainlines:{name:"market.mainlines",description:"è·å–æŠ•èµ„ä¸»çº¿TOP N",params:{top_n:{type:"number",default:10},time_horizon:{type:"string",enum:["short","medium","long"],default:"short"}}},score_mainline:{name:"market.score_mainline",description:"å¯¹æŠ•èµ„ä¸»çº¿è¿›è¡Œäº”ç»´è¯„åˆ†",params:{mainline_name:{type:"string",required:!0}}}},factor:{recommend:{name:"factor.recommend",description:"åŸºäºå¸‚åœºçŠ¶æ€æ¨èå› å­",params:{market_regime:{type:"string",enum:["risk_on","risk_off","neutral"]},top_n:{type:"number",default:10}}},build:{name:"factor.build",description:"æ„å»ºè‡ªå®šä¹‰å› å­",params:{expression:{type:"string",required:!0},name:{type:"string",required:!0}}},backtest:{name:"factor.backtest",description:"å›æµ‹å› å­è¡¨ç°",params:{factor_name:{type:"string",required:!0},start_date:{type:"string"},end_date:{type:"string"}}}},strategy:{template_list:{name:"strategy_template.list",description:"åˆ—å‡ºæ‰€æœ‰ç­–ç•¥æ¨¡æ¿",params:{category:{type:"string",description:"è¿‡æ»¤åˆ†ç±»"}}},template_info:{name:"strategy_template.info",description:"è·å–ç­–ç•¥æ¨¡æ¿è¯¦æƒ…",params:{name:{type:"string",required:!0}}},generate:{name:"strategy_template.generate",description:"ç”Ÿæˆç­–ç•¥ä»£ç ",params:{strategy_type:{type:"string",required:!0,enum:["momentum","mean_reversion","rotation"]},params:{type:"object",description:"ç­–ç•¥å‚æ•°"},platform:{type:"string",enum:["joinquant","bullettrade","ptrade","qmt"],default:"joinquant"}}},validate:{name:"strategy.validate",description:"éªŒè¯ç­–ç•¥ä»£ç ",params:{code:{type:"string",required:!0},platform:{type:"string",default:"joinquant"}}},convert:{name:"strategy.convert",description:"è½¬æ¢ç­–ç•¥åˆ°å…¶ä»–å¹³å°",params:{code:{type:"string",required:!0},from_platform:{type:"string",default:"joinquant"},to_platform:{type:"string",required:!0}}}},backtest:{fast:{name:"backtest.fast",description:"å¿«é€Ÿå›æµ‹ (<5ç§’)",params:{securities:{type:"array",required:!0},start_date:{type:"string",required:!0},end_date:{type:"string",required:!0},strategy:{type:"string",default:"momentum"},lookback:{type:"number",default:20},top_n:{type:"number",default:10}}},standard:{name:"backtest.standard",description:"æ ‡å‡†å›æµ‹ (<30ç§’)",params:{securities:{type:"array",required:!0},start_date:{type:"string",required:!0},end_date:{type:"string",required:!0},strategy:{type:"string",default:"momentum"},initial_capital:{type:"number",default:1e6}}},bullettrade:{name:"backtest.bullettrade",description:"BulletTradeç²¾ç¡®å›æµ‹",params:{strategy_code:{type:"string"},strategy_file:{type:"string"},start_date:{type:"string",required:!0},end_date:{type:"string",required:!0},initial_capital:{type:"number",default:1e6}}},qmt:{name:"backtest.qmt",description:"QMTå›æµ‹",params:{strategy_code:{type:"string"},stock_pool:{type:"array"},start_date:{type:"string",required:!0},end_date:{type:"string",required:!0}}}},optimizer:{grid_search:{name:"optimizer.grid_search",description:"å‚æ•°ç½‘æ ¼æœç´¢",params:{strategy_type:{type:"string",required:!0},param_ranges:{type:"object",required:!0},securities:{type:"array",required:!0},start_date:{type:"string",required:!0},end_date:{type:"string",required:!0}}},optuna:{name:"optimizer.optuna",description:"Optunaæ™ºèƒ½ä¼˜åŒ–",params:{strategy_type:{type:"string",required:!0},param_space:{type:"object",required:!0},n_trials:{type:"number",default:100}}},walk_forward:{name:"optimizer.walk_forward",description:"æ»šåŠ¨ä¼˜åŒ–éªŒè¯",params:{strategy_type:{type:"string",required:!0},window_size:{type:"number",default:252}}}},report:{generate:{name:"report.generate",description:"ç”Ÿæˆå›æµ‹æŠ¥å‘Š",params:{result:{type:"object",required:!0},format:{type:"string",enum:["html","pdf","markdown"],default:"html"},title:{type:"string"},strategy_name:{type:"string"}}},compare:{name:"report.compare",description:"ç”Ÿæˆç­–ç•¥å¯¹æ¯”æŠ¥å‘Š",params:{results:{type:"array",required:!0}}},diagnosis:{name:"report.diagnosis",description:"ç”Ÿæˆç­–ç•¥è¯Šæ–­æŠ¥å‘Š",params:{result:{type:"object",required:!0}}}},workflow:{create:{name:"workflow.create",description:"åˆ›å»ºæ–°å·¥ä½œæµ",params:{name:{type:"string",default:"æŠ•èµ„å·¥ä½œæµ"}}},status:{name:"workflow.status",description:"è·å–å·¥ä½œæµçŠ¶æ€",params:{workflow_id:{type:"string",required:!0}}},run_step:{name:"workflow.run_step",description:"æ‰§è¡ŒæŒ‡å®šæ­¥éª¤",params:{workflow_id:{type:"string",required:!0},step_index:{type:"number",required:!0},step_args:{type:"object"}}},steps:{name:"workflow.steps",description:"è·å–9æ­¥éª¤å®šä¹‰",params:{}}}},e.default={WORKFLOW_9STEPS:e.WORKFLOW_9STEPS,MCP_TOOLS_V2:e.MCP_TOOLS_V2,generateTraceId:t,parseMCPResponse:a,getStepMCPTool:r,getStepIndex:s},e.mcpClientV2={generateTraceId:t,parseMCPResponse:a,getStepMCPTool:r,getStepIndex:s,WORKFLOW_9STEPS:e.WORKFLOW_9STEPS,MCP_TOOLS_V2:e.MCP_TOOLS_V2}},317:n=>{n.exports=require("child_process")},327:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.getMainlines=async function(n,e){d.logger.info("æ‰§è¡Œè·å–æŠ•èµ„ä¸»çº¿å‘½ä»¤",l);const t=await i.window.showQuickPick([{label:"ğŸ“… çŸ­æœŸ (1-5å¤©)",value:"short",description:"é€‚åˆçŸ­çº¿äº¤æ˜“"},{label:"ğŸ“† ä¸­æœŸ (1-4å‘¨)",value:"medium",description:"é€‚åˆæ³¢æ®µæ“ä½œ"},{label:"ğŸ“† é•¿æœŸ (1æœˆ+)",value:"long",description:"é€‚åˆä»·å€¼æŠ•èµ„"}],{placeHolder:"é€‰æ‹©æŠ•èµ„å‘¨æœŸ"});t&&await i.window.withProgress({location:i.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(a,r)=>{try{if(a.report({message:"æ­£åœ¨è·å–æŠ•èµ„ä¸»çº¿...",increment:0}),r.isCancellationRequested)return void d.logger.info("ç”¨æˆ·å–æ¶ˆæ“ä½œ",l);const s=await n.getMainlines({top_n:20,time_horizon:t.value});if(a.report({increment:60}),!s.ok||!s.data)return void i.window.showErrorMessage(`è·å–æŠ•èµ„ä¸»çº¿å¤±è´¥: ${s.error||"æœªçŸ¥é”™è¯¯"}`);const o=s.data;d.logger.info(`è·å–åˆ° ${o.length} æ¡æŠ•èµ„ä¸»çº¿`,l),a.report({message:"æ¸²æŸ“ç»“æœ...",increment:20}),function(n,e,t){const a=i.window.createWebviewPanel("trquantMainlines","ğŸ¯ æŠ•èµ„ä¸»çº¿",i.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0});a.webview.html=function(n,e){const t=n.length>0?n.map((n,e)=>function(n,e){const t=e<3?`rank-${e+1}`:"rank-default",a=Math.min(100*n.score,100);return`\n        <div class="mainline-card" onclick="selectMainline('${n.name}')">\n            <div class="mainline-header">\n                <div class="mainline-rank">\n                    <div class="rank-badge ${t}">${e+1}</div>\n                    <span class="mainline-name">${n.name}</span>\n                </div>\n                <div class="mainline-score">\n                    <div class="score-bar">\n                        <div class="score-fill" style="width: ${a}%"></div>\n                    </div>\n                    <span class="score-value">${n.score.toFixed(2)}</span>\n                </div>\n            </div>\n            <div class="mainline-industries">\n                ${n.industries.map(n=>`<span class="industry-tag">${n}</span>`).join("")}\n            </div>\n            <div class="mainline-logic">\n                ğŸ’¡ ${n.logic||"æš‚æ— è¯¦ç»†è¯´æ˜"}\n            </div>\n        </div>\n    `}(n,e)).join(""):'<div class="empty-state">æš‚æ— æŠ•èµ„ä¸»çº¿æ•°æ®</div>';return`<!DOCTYPE html>\n<html lang="zh">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>æŠ•èµ„ä¸»çº¿</title>\n    <style>\n        :root {\n            --bg-primary: #1a1a2e;\n            --bg-secondary: #252540;\n            --bg-tertiary: #2d2d4a;\n            --text-primary: #ffffff;\n            --text-secondary: #9ca3af;\n            --text-muted: #6b7280;\n            --primary: #667eea;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --border: #3d3d5c;\n            --gold: #fbbf24;\n            --silver: #94a3b8;\n            --bronze: #b45309;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n            line-height: 1.6;\n        }\n\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border);\n        }\n\n        .header-left {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n\n        .header-icon { font-size: 36px; }\n\n        .header-title {\n            font-size: 24px;\n            font-weight: 600;\n        }\n\n        .header-subtitle {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .time-badge {\n            background: var(--primary);\n            color: white;\n            padding: 6px 16px;\n            border-radius: 20px;\n            font-size: 13px;\n        }\n\n        .stats-row {\n            display: grid;\n            grid-template-columns: repeat(3, 1fr);\n            gap: 16px;\n            margin-bottom: 24px;\n        }\n\n        .stat-card {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            text-align: center;\n            border: 1px solid var(--border);\n        }\n\n        .stat-value {\n            font-size: 28px;\n            font-weight: 700;\n            color: var(--primary);\n        }\n\n        .stat-label {\n            color: var(--text-secondary);\n            font-size: 13px;\n            margin-top: 4px;\n        }\n\n        .mainlines-list {\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n        }\n\n        .mainline-card {\n            background: var(--bg-secondary);\n            border-radius: 16px;\n            padding: 20px;\n            border: 1px solid var(--border);\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n\n        .mainline-card:hover {\n            border-color: var(--primary);\n            transform: translateY(-2px);\n        }\n\n        .mainline-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 12px;\n        }\n\n        .mainline-rank {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n        }\n\n        .rank-badge {\n            width: 32px;\n            height: 32px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 700;\n            font-size: 14px;\n        }\n\n        .rank-1 { background: var(--gold); color: #1a1a2e; }\n        .rank-2 { background: var(--silver); color: #1a1a2e; }\n        .rank-3 { background: var(--bronze); color: white; }\n        .rank-default { background: var(--bg-tertiary); color: var(--text-secondary); }\n\n        .mainline-name {\n            font-size: 18px;\n            font-weight: 600;\n        }\n\n        .mainline-score {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .score-bar {\n            width: 100px;\n            height: 8px;\n            background: var(--bg-tertiary);\n            border-radius: 4px;\n            overflow: hidden;\n        }\n\n        .score-fill {\n            height: 100%;\n            background: linear-gradient(90deg, var(--primary), var(--success));\n            border-radius: 4px;\n        }\n\n        .score-value {\n            font-weight: 600;\n            color: var(--success);\n            min-width: 50px;\n            text-align: right;\n        }\n\n        .mainline-industries {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 8px;\n            margin-bottom: 12px;\n        }\n\n        .industry-tag {\n            background: var(--bg-tertiary);\n            color: var(--text-secondary);\n            padding: 4px 12px;\n            border-radius: 16px;\n            font-size: 12px;\n        }\n\n        .mainline-logic {\n            color: var(--text-secondary);\n            font-size: 14px;\n            line-height: 1.6;\n            padding-left: 16px;\n            border-left: 3px solid var(--primary);\n        }\n\n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 24px;\n            padding-top: 24px;\n            border-top: 1px solid var(--border);\n        }\n\n        .btn {\n            padding: 12px 24px;\n            border-radius: 10px;\n            border: none;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s;\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n        }\n\n        .btn-primary:hover { background: #5a6fd6; }\n\n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n        }\n\n        .btn-secondary:hover { background: #3d3d5c; }\n\n        .empty-state {\n            text-align: center;\n            padding: 60px 20px;\n            color: var(--text-muted);\n        }\n\n        .timestamp {\n            text-align: center;\n            color: var(--text-muted);\n            font-size: 12px;\n            margin-top: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="header-left">\n            <span class="header-icon">ğŸ¯</span>\n            <div>\n                <div class="header-title">æŠ•èµ„ä¸»çº¿ TOP ${n.length}</div>\n                <div class="header-subtitle">åŸºäºå¸‚åœºçƒ­åº¦ã€èµ„é‡‘æµå‘ã€è¡Œä¸šæ™¯æ°”åº¦ç»¼åˆè¯„ä¼°</div>\n            </div>\n        </div>\n        <span class="time-badge">${{short:"çŸ­æœŸ (1-5å¤©)",medium:"ä¸­æœŸ (1-4å‘¨)",long:"é•¿æœŸ (1æœˆ+)"}[e]||e}</span>\n    </div>\n\n    <div class="stats-row">\n        <div class="stat-card">\n            <div class="stat-value">${n.length}</div>\n            <div class="stat-label">ä¸»çº¿æ•°é‡</div>\n        </div>\n        <div class="stat-card">\n            <div class="stat-value">${n.length>0?n[0].score.toFixed(2):"-"}</div>\n            <div class="stat-label">æœ€é«˜è¯„åˆ†</div>\n        </div>\n        <div class="stat-card">\n            <div class="stat-value">${function(n){const e=new Set;return n.forEach(n=>n.industries.forEach(n=>e.add(n))),e.size}(n)}</div>\n            <div class="stat-label">æ¶‰åŠè¡Œä¸š</div>\n        </div>\n    </div>\n\n    <div class="mainlines-list">\n        ${t}\n    </div>\n\n    <div class="actions">\n        <button class="btn btn-primary" onclick="generateStrategy()">\n            ğŸš€ åŸºäºä¸»çº¿ç”Ÿæˆç­–ç•¥\n        </button>\n        <button class="btn btn-secondary" onclick="copyPrompt()">\n            ğŸ“‹ å¤åˆ¶ä¸ºAI Prompt\n        </button>\n    </div>\n\n    <div class="timestamp">\n        æ›´æ–°æ—¶é—´: ${(new Date).toLocaleString("zh-CN")}\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        function selectMainline(mainline) {\n            vscode.postMessage({ command: 'selectMainline', mainline });\n        }\n        \n        function generateStrategy() {\n            vscode.postMessage({ command: 'generateStrategy' });\n        }\n        \n        function copyPrompt() {\n            vscode.postMessage({ command: 'copyPrompt' });\n        }\n    <\/script>\n</body>\n</html>`}(e,t),a.webview.onDidReceiveMessage(async n=>{switch(n.command){case"selectMainline":a=n.mainline,i.window.showInformationMessage(`å·²é€‰æ‹©ä¸»çº¿: ${a}`,"æŸ¥çœ‹è¯¦æƒ…","ç­›é€‰è‚¡ç¥¨").then(n=>{"æŸ¥çœ‹è¯¦æƒ…"===n?d.logger.info(`æŸ¥çœ‹ä¸»çº¿è¯¦æƒ…: ${a}`,l):"ç­›é€‰è‚¡ç¥¨"===n&&d.logger.info(`åŸºäºä¸»çº¿ç­›é€‰è‚¡ç¥¨: ${a}`,l)});break;case"generateStrategy":i.commands.executeCommand("trquant.generateStrategy");break;case"copyPrompt":const r=p(e,t);await i.env.clipboard.writeText(r),i.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}var a},void 0,n.subscriptions)}(e,o,t.value),a.report({increment:20}),async function(n){if(0!==n.length)switch(await i.window.showInformationMessage(`è·å–åˆ° ${n.length} æ¡æŠ•èµ„ä¸»çº¿`,"ç”Ÿæˆç­–ç•¥","æ¨èå› å­","å¤åˆ¶Prompt")){case"ç”Ÿæˆç­–ç•¥":i.commands.executeCommand("trquant.generateStrategy");break;case"æ¨èå› å­":i.commands.executeCommand("trquant.recommendFactors");break;case"å¤åˆ¶Prompt":const e=p(n,"short");await i.env.clipboard.writeText(e),i.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}}(o)}catch(n){c.ErrorHandler.handle(n,l)}})};const i=o(t(398)),d=t(628),c=t(799),l="GetMainlines";function p(n,e){return`# Aè‚¡æŠ•èµ„ä¸»çº¿åˆ†æ\n\n## åˆ†æå‘¨æœŸ: ${{short:"çŸ­æœŸ (1-5å¤©)",medium:"ä¸­æœŸ (1-4å‘¨)",long:"é•¿æœŸ (1æœˆ+)"}[e]||e}\n\n## TOP ${n.length} æŠ•èµ„ä¸»çº¿\n\n${n.map((n,e)=>`\n### ${e+1}. ${n.name} (è¯„åˆ†: ${n.score.toFixed(2)})\n- **ç›¸å…³è¡Œä¸š**: ${n.industries.join(", ")}\n- **æŠ•èµ„é€»è¾‘**: ${n.logic||"æš‚æ— "}\n`).join("\n")}\n\n---\n\nè¯·åŸºäºä»¥ä¸ŠæŠ•èµ„ä¸»çº¿ï¼Œå¸®æˆ‘ï¼š\n1. åˆ†æå½“å‰æœ€å€¼å¾—å…³æ³¨çš„ä¸»çº¿åŠå…¶åŸå› \n2. æ¨èé€‚åˆè¿™äº›ä¸»çº¿çš„é‡åŒ–å› å­\n3. ç”Ÿæˆé’ˆå¯¹TOP3ä¸»çº¿çš„PTradeé‡åŒ–ç­–ç•¥ä»£ç \n\nè¦æ±‚ï¼š\n- ç­–ç•¥åº”è¯¥èšç„¦äºä¸»çº¿ç›¸å…³çš„è‚¡ç¥¨æ± \n- åŒ…å«å®Œæ•´çš„é£æ§é€»è¾‘\n- æ·»åŠ è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š\n`}},334:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.MCPRegistrar=void 0;const i=o(t(398)),d=o(t(928)),c=o(t(896)),l=o(t(857)),p=t(628),m=t(478),u="MCPRegistrar";e.MCPRegistrar=class{static async registerServer(n){p.logger.info("å¼€å§‹æ³¨å†ŒMCP Server...",u);try{const e=this.getMCPConfigPath();p.logger.info(`MCPé…ç½®è·¯å¾„: ${e}`,u);const t=this.loadMCPConfig(e),a=m.config.getPythonPath(n.extensionPath),r=d.join(n.extensionPath,"python","mcp_server.py");t.mcpServers.trquant={command:a,args:[r],env:{PYTHONIOENCODING:"utf-8",TRQUANT_ROOT:d.dirname(n.extensionPath)}},this.saveMCPConfig(e,t),p.logger.info("MCP Server æ³¨å†ŒæˆåŠŸ",u),i.window.showInformationMessage("TRQuant MCP Server å·²æ³¨å†Œã€‚é‡å¯Cursoråç”Ÿæ•ˆã€‚","æŸ¥çœ‹é…ç½®","äº†è§£æ›´å¤š").then(n=>{"æŸ¥çœ‹é…ç½®"===n?this.openMCPConfig(e):"äº†è§£æ›´å¤š"===n&&i.env.openExternal(i.Uri.parse("https://docs.cursor.com/context/model-context-protocol"))})}catch(n){throw p.logger.error(`MCPæ³¨å†Œå¤±è´¥: ${n instanceof Error?n.message:String(n)}`,u),n}}static getMCPConfigPath(){const n=l.homedir(),e=[d.join(n,".cursor","mcp.json"),d.join(n,"Library","Application Support","Cursor","mcp.json"),d.join(n,"AppData","Roaming","Cursor","mcp.json")];for(const n of e)if(c.existsSync(n))return n;switch(l.platform()){case"darwin":return e[1];case"win32":return e[2];default:return e[0]}}static loadMCPConfig(n){try{if(c.existsSync(n)){const e=c.readFileSync(n,"utf-8");return JSON.parse(e)}}catch(n){p.logger.warn(`è¯»å–MCPé…ç½®å¤±è´¥: ${n}`,u)}return{mcpServers:{}}}static saveMCPConfig(n,e){const t=d.dirname(n);c.existsSync(t)||c.mkdirSync(t,{recursive:!0});const a=JSON.stringify(e,null,2);c.writeFileSync(n,a,"utf-8"),p.logger.info(`MCPé…ç½®å·²ä¿å­˜: ${n}`,u)}static async openMCPConfig(n){const e=await i.workspace.openTextDocument(n);await i.window.showTextDocument(e)}static isRegistered(){try{const n=this.getMCPConfigPath();return"trquant"in this.loadMCPConfig(n).mcpServers}catch{return!1}}static async unregisterServer(){p.logger.info("ç§»é™¤MCP Serveræ³¨å†Œ...",u);try{const n=this.getMCPConfigPath(),e=this.loadMCPConfig(n);"trquant"in e.mcpServers&&(delete e.mcpServers.trquant,this.saveMCPConfig(n,e),p.logger.info("MCP Server å·²ç§»é™¤",u))}catch(n){p.logger.error(`ç§»é™¤MCPæ³¨å†Œå¤±è´¥: ${n instanceof Error?n.message:String(n)}`,u)}}}},357:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.runBacktest=async function(n,e){i.window.showInformationMessage("è¿è¡Œå›æµ‹åŠŸèƒ½å¼€å‘ä¸­")};const i=o(t(398))},360:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.WorkflowPanel=void 0;const i=o(t(398)),d=o(t(928)),c=o(t(896)),l=o(t(317)),p=t(628),m=t(478),u="WorkflowPanel",g=[{id:"data_source",name:"ä¿¡æ¯è·å–",icon:"ğŸ“¡",color:"#58a6ff",description:"æ£€æŸ¥æ•°æ®æºè¿æ¥çŠ¶æ€"},{id:"market_trend",name:"å¸‚åœºè¶‹åŠ¿",icon:"ğŸ“ˆ",color:"#667eea",description:"åˆ†æå¸‚åœºçŠ¶æ€å’Œé£æ ¼è½®åŠ¨"},{id:"mainline",name:"æŠ•èµ„ä¸»çº¿",icon:"ğŸ”¥",color:"#F59E0B",description:"è¯†åˆ«çƒ­ç‚¹ä¸»çº¿å’Œæ¿å—"},{id:"candidate_pool",name:"å€™é€‰æ± æ„å»º",icon:"ğŸ“¦",color:"#a371f7",description:"æ„å»ºå€™é€‰è‚¡ç¥¨æ± "},{id:"factor",name:"å› å­æ„å»º",icon:"ğŸ§®",color:"#3fb950",description:"æ¨èé‡åŒ–å› å­ç»„åˆ"},{id:"strategy",name:"ç­–ç•¥ç”Ÿæˆ",icon:"ğŸ’»",color:"#d29922",description:"ç”Ÿæˆç­–ç•¥ä»£ç "},{id:"backtest",name:"å›æµ‹éªŒè¯",icon:"ğŸ”„",color:"#1E3A5F",description:"æ‰§è¡Œç­–ç•¥å›æµ‹"},{id:"optimization",name:"ç­–ç•¥ä¼˜åŒ–",icon:"âš™ï¸",color:"#7C3AED",description:"å‚æ•°ä¼˜åŒ–"},{id:"report",name:"æŠ¥å‘Šç”Ÿæˆ",icon:"ğŸ“„",color:"#EC4899",description:"ç”Ÿæˆç ”ç©¶æŠ¥å‘Š"}];class f{static currentPanel;_panel;_extensionUri;_extensionPath;_disposables=[];_state={workflowId:null,steps:g.map(n=>({...n,status:"pending"})),context:{},isRunning:!1};constructor(n,e,t){this._panel=n,this._extensionUri=e,this._extensionPath=t,this._panel.webview.html=this._getHtmlContent(),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.onDidReceiveMessage(n=>this._handleMessage(n),null,this._disposables),p.logger.info("WorkflowPanel åˆ›å»ºå®Œæˆ",u)}static createOrShow(n,e){const t=i.ViewColumn.One;if(f.currentPanel)return f.currentPanel._panel.reveal(t),f.currentPanel;let a=e;if(!a){const e=i.workspace.workspaceFolders;if(e&&e.length>0){const n=e[0].uri.fsPath,t=d.join(n,"extension");c.existsSync(t)&&(a=t)}a||(a=n.fsPath)}p.logger.info(`åˆ›å»ºWorkflowPanel, extensionPath: ${a}`,u);const r=i.window.createWebviewPanel("trquantWorkflowV3","ğŸ‰ éŸ¬ç¿é‡åŒ– - 9æ­¥æŠ•èµ„å·¥ä½œæµ",t,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[n]});return f.currentPanel=new f(r,n,a),f.currentPanel}dispose(){for(f.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const n=this._disposables.pop();n&&n.dispose()}}_getPythonPath(){const n=m.ConfigManager.getInstance().getPythonPath(this._extensionPath);return p.logger.debug(`è·å–Pythonè·¯å¾„: ${n}`,u),n}_getProjectRoot(){const n="/home/taotao/dev/QuantTest/TRQuant";if(c.existsSync(n))return n;const e=i.workspace.workspaceFolders;return e&&e.length>0?e[0].uri.fsPath:this._extensionPath.endsWith("extension")?d.dirname(this._extensionPath):process.env.TRQUANT_ROOT||this._extensionPath}async _callMCP(n,e){const t=this._getPythonPath(),a=this._getProjectRoot(),r=d.join(a,"mcp_servers","workflow_9steps_server.py");if(p.logger.info(`è°ƒç”¨MCP: ${n}`,u,{pythonPath:t,serverPath:r}),!c.existsSync(r))throw new Error(`MCPæœåŠ¡å™¨æ–‡ä»¶ä¸å­˜åœ¨: ${r}`);const s=d.join(a,"extension","python","bridge.py");return new Promise((r,o)=>{const i={action:"call_mcp_tool",params:{tool_name:n,arguments:e,trace_id:`wf3_${Date.now()}`}},c={...process.env,PYTHONIOENCODING:"utf-8",TRQUANT_ROOT:a,PYTHONPATH:[d.join(a,"extension","python"),d.join(a,"mcp_servers"),a].join(d.delimiter)},m=l.spawn(t,[s],{cwd:a,env:c,stdio:["pipe","pipe","pipe"]});let g="",f="";m.stdin.write(JSON.stringify(i)),m.stdin.end(),m.stdout.on("data",n=>{g+=n.toString()}),m.stderr.on("data",n=>{f+=n.toString()}),m.on("close",n=>{if(0!==n)return p.logger.error(`MCPè°ƒç”¨å¤±è´¥: ${f}`,u),void o(new Error(f||`è¿›ç¨‹é€€å‡ºç : ${n}`));try{const n=JSON.parse(g.trim());n.ok?r(n.data):o(new Error(n.error||"è°ƒç”¨å¤±è´¥"))}catch(n){const e=g.trim().split("\n");for(let n=e.length-1;n>=0;n--)try{const t=JSON.parse(e[n]);if(t.ok)return void r(t.data)}catch{}o(new Error(`è§£æå“åº”å¤±è´¥: ${g.slice(0,200)}`))}}),m.stdin.write(JSON.stringify(i)),m.stdin.end(),setTimeout(()=>{m.kill(),o(new Error("MCPè°ƒç”¨è¶…æ—¶ (60s)"))},6e4)})}async _executeStepDirect(n,e){const t=this._getPythonPath(),a=this._getProjectRoot(),r=d.join(a,"extension","python","bridge.py");return p.logger.info(`ç›´æ¥æ‰§è¡Œæ­¥éª¤: ${n}`,u,{pythonPath:t}),new Promise((s,o)=>{const i={action:"run_workflow_step",params:{step_id:n,args:e}},c={...process.env,PYTHONIOENCODING:"utf-8",TRQUANT_ROOT:a,PYTHONPATH:[d.join(a,"extension","python"),d.join(a,"mcp_servers"),a].join(d.delimiter)},m=l.spawn(t,[r],{cwd:a,env:c,stdio:["pipe","pipe","pipe"]});let g="",f="";m.stdin.write(JSON.stringify(i)),m.stdin.end(),m.stdout.on("data",n=>{g+=n.toString()}),m.stderr.on("data",n=>{f+=n.toString()}),m.on("close",n=>{if(0!==n)return p.logger.error(`æ­¥éª¤æ‰§è¡Œå¤±è´¥: ${f}`,u),void o(new Error(f||`è¿›ç¨‹é€€å‡ºç : ${n}`));try{const n=JSON.parse(g.trim());n.ok?s(n.data):o(new Error(n.error||"æ­¥éª¤æ‰§è¡Œå¤±è´¥"))}catch(n){p.logger.error(`è§£æå¤±è´¥: ${g.slice(0,500)}`,u),o(new Error(`è§£æå¤±è´¥: ${n}`))}}),setTimeout(()=>{m.kill(),o(new Error("æ‰§è¡Œè¶…æ—¶ (60s)"))},6e4)})}async _handleMessage(n){switch(p.logger.info(`æ”¶åˆ°æ¶ˆæ¯: ${n.command}`,u),n.command){case"init":await this._initWorkflow();break;case"runStep":await this._runStep(n.stepId,n.args);break;case"runAll":await this._runAllSteps();break;case"reset":this._resetWorkflow();break;case"openReport":this._openReport(n.filePath)}}async _initWorkflow(){try{const n=await this._callMCP("workflow9.create",{name:"9æ­¥æŠ•èµ„å·¥ä½œæµ"});n.success&&n.workflow_id?this._state.workflowId=n.workflow_id:(this._state.workflowId=`wf_${Date.now().toString(36)}`,p.logger.warn(`MCPåˆ›å»ºå·¥ä½œæµå¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°ID: ${this._state.workflowId}`,u)),this._state.context={},this._state.steps=g.map(n=>({...n,status:"pending"})),this._postMessage({command:"initialized",workflowId:this._state.workflowId,steps:this._state.steps,pythonPath:this._getPythonPath()}),p.logger.info(`å·¥ä½œæµåˆå§‹åŒ–: ${this._state.workflowId}`,u)}catch(n){p.logger.error(`åˆå§‹åŒ–å¤±è´¥: ${n.message}`,u),this._state.workflowId=`wf_${Date.now().toString(36)}`,this._state.steps=g.map(n=>({...n,status:"pending"})),this._postMessage({command:"initialized",workflowId:this._state.workflowId,steps:this._state.steps,pythonPath:this._getPythonPath()})}}async _runStep(n,e={}){if(this._state.isRunning)return void i.window.showWarningMessage("å·¥ä½œæµæ­£åœ¨æ‰§è¡Œä¸­");const t=this._state.steps.findIndex(e=>e.id===n);if(-1===t)return void i.window.showErrorMessage(`æœªçŸ¥æ­¥éª¤: ${n}`);const a=this._state.steps[t];this._state.isRunning=!0,a.status="running",this._postMessage({command:"stepStarted",stepId:n,stepIndex:t});const r=Date.now();try{const s=await this._executeStepDirect(n,e),o=Date.now()-r;if(!s.success)throw new Error(s.error||"æ­¥éª¤æ‰§è¡Œå¤±è´¥");a.status="completed",a.result=s,a.duration=o,this._state.context[n]=s,this._postMessage({command:"stepCompleted",stepId:n,stepIndex:t,result:s,summary:s.summary||"æ­¥éª¤å®Œæˆ",duration:o}),p.logger.info(`æ­¥éª¤å®Œæˆ: ${a.name}, è€—æ—¶: ${o}ms`,u)}catch(e){a.status="failed",a.result={error:e.message},a.duration=Date.now()-r,this._postMessage({command:"stepFailed",stepId:n,stepIndex:t,error:e.message}),p.logger.error(`æ­¥éª¤å¤±è´¥: ${a.name} - ${e.message}`,u),i.window.showErrorMessage(`æ­¥éª¤ ${a.name} æ‰§è¡Œå¤±è´¥: ${e.message}`)}this._state.isRunning=!1}async _runAllSteps(){if(this._state.isRunning)i.window.showWarningMessage("å·¥ä½œæµæ­£åœ¨æ‰§è¡Œä¸­");else{this._state.workflowId||await this._initWorkflow(),this._postMessage({command:"workflowStarted",totalSteps:9});try{const n=await this._callMCP("workflow9.run_all",{workflow_id:this._state.workflowId});if(!n.success)throw new Error(n.error||"å·¥ä½œæµæ‰§è¡Œå¤±è´¥");n.steps&&(this._state.steps=n.steps),n.context&&(this._state.context=n.context),this._postMessage({command:"workflowCompleted",context:this._state.context,steps:this._state.steps}),p.logger.info("æ‰€æœ‰æ­¥éª¤æ‰§è¡Œå®Œæˆ",u)}catch(n){p.logger.error(`ä¸€é”®æ‰§è¡Œå¤±è´¥ï¼Œå›é€€åˆ°é€æ­¥æ‰§è¡Œ: ${n.message}`,u);for(let n=0;n<this._state.steps.length;n++){const e=this._state.steps[n];if(await this._runStep(e.id),"failed"===e.status&&"ç»§ç»­"!==await i.window.showWarningMessage(`æ­¥éª¤ ${e.name} å¤±è´¥ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ`,"ç»§ç»­","åœæ­¢"))break}this._postMessage({command:"workflowCompleted",context:this._state.context,steps:this._state.steps})}}}_resetWorkflow(){this._state.workflowId=null,this._state.context={},this._state.steps=g.map(n=>({...n,status:"pending"})),this._state.isRunning=!1,this._postMessage({command:"reset"})}_openReport(n){n&&c.existsSync(n)?i.env.openExternal(i.Uri.file(n)):i.window.showErrorMessage("æŠ¥å‘Šæ–‡ä»¶ä¸å­˜åœ¨")}_postMessage(n){this._panel.webview.postMessage(n)}_getHtmlContent(){return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"><\/script>\n    <title>9æ­¥æŠ•èµ„å·¥ä½œæµ</title>\n    <style>\n        :root {\n            --bg-primary: #0a0e14;\n            --bg-secondary: #0f141a;\n            --bg-card: #151c24;\n            --bg-hover: #1c2530;\n            --border: #253040;\n            --text: #e6edf3;\n            --text-secondary: #7d8590;\n            --accent: #2f81f7;\n            --accent-light: #58a6ff;\n            --success: #2ea043;\n            --success-bg: rgba(46, 160, 67, 0.15);\n            --warning: #d29922;\n            --warning-bg: rgba(210, 153, 34, 0.15);\n            --error: #f85149;\n            --error-bg: rgba(248, 81, 73, 0.15);\n            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);\n        }\n        \n        * { box-sizing: border-box; margin: 0; padding: 0; }\n        \n        body {\n            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            background: var(--bg-primary);\n            color: var(--text);\n            padding: 24px;\n            line-height: 1.6;\n            min-height: 100vh;\n        }\n        \n        /* å¤´éƒ¨ */\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            padding: 20px 24px;\n            background: var(--bg-card);\n            border: 1px solid var(--border);\n            border-radius: 16px;\n        }\n        \n        .header-title {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n        \n        .header-title h1 {\n            font-size: 24px;\n            font-weight: 600;\n            background: linear-gradient(135deg, var(--accent-light), #a371f7);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n        }\n        \n        .header-title .subtitle {\n            font-size: 14px;\n            color: var(--text-secondary);\n        }\n        \n        .header-actions {\n            display: flex;\n            gap: 12px;\n        }\n        \n        /* æŒ‰é’® */\n        .btn {\n            padding: 10px 20px;\n            border: none;\n            border-radius: 8px;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            display: inline-flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s ease;\n        }\n        \n        .btn-icon { font-size: 12px; }\n        \n        .btn-primary {\n            background: var(--accent);\n            color: white;\n        }\n        \n        .btn-primary:hover {\n            background: var(--accent-light);\n            transform: translateY(-1px);\n        }\n        \n        .btn-secondary {\n            background: var(--bg-hover);\n            color: var(--text);\n            border: 1px solid var(--border);\n        }\n        \n        .btn-secondary:hover {\n            background: var(--border);\n        }\n        \n        .btn-run {\n            background: var(--success);\n            color: white;\n            padding: 8px 16px;\n            font-size: 13px;\n        }\n        \n        .btn-run:hover {\n            filter: brightness(1.1);\n        }\n        \n        .btn-view {\n            background: var(--bg-hover);\n            color: var(--text-secondary);\n            padding: 8px 16px;\n            font-size: 13px;\n            border: 1px solid var(--border);\n        }\n        \n        .btn-view:not(:disabled):hover {\n            background: var(--border);\n            color: var(--text);\n        }\n        \n        .btn:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n        }\n        \n        /* è¿›åº¦æ¡ */\n        .progress-container {\n            margin-bottom: 24px;\n        }\n        \n        .progress-info {\n            display: flex;\n            justify-content: space-between;\n            margin-bottom: 8px;\n            font-size: 14px;\n            color: var(--text-secondary);\n        }\n        \n        .progress-bar {\n            height: 6px;\n            background: var(--bg-hover);\n            border-radius: 3px;\n            overflow: hidden;\n        }\n        \n        .progress-bar .progress {\n            height: 100%;\n            background: linear-gradient(90deg, var(--accent), var(--success));\n            width: 0%;\n            transition: width 0.5s ease;\n            border-radius: 3px;\n        }\n        \n        /* æ­¥éª¤å¡ç‰‡ */\n        .steps-container {\n            display: grid;\n            gap: 16px;\n        }\n        \n        .step-card {\n            background: var(--bg-card);\n            border: 1px solid var(--border);\n            border-radius: 12px;\n            padding: 20px;\n            transition: all 0.3s ease;\n        }\n        \n        .step-card:hover {\n            border-color: var(--accent);\n            box-shadow: 0 4px 20px rgba(47, 129, 247, 0.1);\n        }\n        \n        .step-card.running {\n            border-color: var(--accent);\n            background: linear-gradient(135deg, rgba(47, 129, 247, 0.05) 0%, rgba(47, 129, 247, 0.02) 100%);\n            animation: pulse 2s infinite;\n        }\n        \n        @keyframes pulse {\n            0%, 100% { box-shadow: 0 0 0 0 rgba(47, 129, 247, 0.3); }\n            50% { box-shadow: 0 0 20px 5px rgba(47, 129, 247, 0.2); }\n        }\n        \n        .step-card.completed {\n            border-color: var(--success);\n            background: var(--success-bg);\n        }\n        \n        .step-card.failed {\n            border-color: var(--error);\n            background: var(--error-bg);\n        }\n        \n        .step-header {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n        \n        .step-number {\n            width: 36px;\n            height: 36px;\n            border-radius: 10px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 700;\n            font-size: 16px;\n            color: white;\n        }\n        \n        .step-icon {\n            font-size: 28px;\n        }\n        \n        .step-info {\n            flex: 1;\n        }\n        \n        .step-name {\n            font-size: 16px;\n            font-weight: 600;\n            margin-bottom: 2px;\n        }\n        \n        .step-desc {\n            font-size: 13px;\n            color: var(--text-secondary);\n        }\n        \n        .step-status {\n            min-width: 100px;\n            text-align: right;\n        }\n        \n        .status-badge {\n            display: inline-block;\n            padding: 4px 12px;\n            border-radius: 20px;\n            font-size: 12px;\n            font-weight: 500;\n        }\n        \n        .status-badge.pending {\n            background: var(--bg-hover);\n            color: var(--text-secondary);\n        }\n        \n        .status-badge.running {\n            background: var(--accent);\n            color: white;\n            animation: blink 1s infinite;\n        }\n        \n        @keyframes blink {\n            0%, 100% { opacity: 1; }\n            50% { opacity: 0.7; }\n        }\n        \n        .status-badge.completed {\n            background: var(--success);\n            color: white;\n        }\n        \n        .status-badge.failed {\n            background: var(--error);\n            color: white;\n        }\n        \n        .step-actions {\n            display: flex;\n            gap: 8px;\n            margin-top: 16px;\n            padding-top: 16px;\n            border-top: 1px solid var(--border);\n        }\n        \n        /* ç»“æœå±•ç¤º */\n        .step-result {\n            margin-top: 16px;\n            display: none;\n        }\n        \n        .step-result.visible {\n            display: block;\n        }\n        \n        .result-card {\n            background: var(--bg-primary);\n            border: 1px solid var(--border);\n            border-radius: 8px;\n            overflow: hidden;\n        }\n        \n        .result-header {\n            padding: 12px 16px;\n            background: var(--bg-hover);\n            border-bottom: 1px solid var(--border);\n            font-size: 13px;\n            font-weight: 500;\n            color: var(--text-secondary);\n        }\n        \n        .result-content {\n            padding: 16px;\n            max-height: 400px;\n            overflow-y: auto;\n        }\n        \n        .result-content pre {\n            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;\n            font-size: 12px;\n            line-height: 1.5;\n            white-space: pre-wrap;\n            word-break: break-all;\n        }\n        \n        /* æŒ‡æ ‡å¡ç‰‡ */\n        .metrics-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\n            gap: 12px;\n            margin-bottom: 16px;\n        }\n        \n        .metric-item {\n            background: var(--bg-hover);\n            padding: 12px;\n            border-radius: 8px;\n            text-align: center;\n        }\n        \n        .metric-value {\n            font-size: 20px;\n            font-weight: 700;\n            color: var(--accent-light);\n        }\n        \n        .metric-value.positive { color: var(--success); }\n        .metric-value.negative { color: var(--error); }\n        \n        .metric-label {\n            font-size: 12px;\n            color: var(--text-secondary);\n            margin-top: 4px;\n        }\n        \n        /* ä¸Šä¸‹æ–‡é¢æ¿ */\n        .context-panel {\n            margin-top: 24px;\n            padding: 20px;\n            background: var(--bg-card);\n            border: 1px solid var(--border);\n            border-radius: 12px;\n        }\n        \n        .context-panel h3 {\n            font-size: 16px;\n            margin-bottom: 16px;\n            color: var(--text-secondary);\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n        \n        .context-content {\n            max-height: 300px;\n            overflow-y: auto;\n        }\n        \n        /* Pythonè·¯å¾„æ˜¾ç¤º */\n        .python-info {\n            margin-top: 24px;\n            padding: 12px 16px;\n            background: var(--bg-secondary);\n            border: 1px solid var(--border);\n            border-radius: 8px;\n            font-size: 12px;\n            color: var(--text-secondary);\n            font-family: monospace;\n        }\n        \n        .python-info .label {\n            color: var(--accent-light);\n            margin-right: 8px;\n        }\n        \n        /* æ»šåŠ¨æ¡ */\n        ::-webkit-scrollbar {\n            width: 8px;\n            height: 8px;\n        }\n        \n        ::-webkit-scrollbar-track {\n            background: var(--bg-primary);\n        }\n        \n        ::-webkit-scrollbar-thumb {\n            background: var(--border);\n            border-radius: 4px;\n        }\n        \n        ::-webkit-scrollbar-thumb:hover {\n            background: var(--text-secondary);\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="header-title">\n            <div>\n                <h1>ğŸ‰ éŸ¬ç¿é‡åŒ– - 9æ­¥æŠ•èµ„å·¥ä½œæµ</h1>\n                <p class="subtitle">ä¸“ä¸šAè‚¡é‡åŒ–æŠ•èµ„å·¥å…·</p>\n            </div>\n        </div>\n        <div class="header-actions">\n            <button class="btn btn-primary" onclick="runAll()">\n                <span class="btn-icon">ğŸš€</span> ä¸€é”®æ‰§è¡Œå…¨éƒ¨\n            </button>\n            <button class="btn btn-secondary" onclick="reset()">\n                <span class="btn-icon">ğŸ”„</span> é‡ç½®\n            </button>\n        </div>\n    </div>\n    \n    <div class="progress-container">\n        <div class="progress-info">\n            <span id="progress-text">å‡†å¤‡å°±ç»ª</span>\n            <span id="progress-percent">0 / 9</span>\n        </div>\n        <div class="progress-bar">\n            <div class="progress" id="progress"></div>\n        </div>\n    </div>\n    \n    <div class="steps-container">\n        ${g.map((n,e)=>`\n            <div class="step-card" id="step-${n.id}" data-step-id="${n.id}">\n                <div class="step-header">\n                    <div class="step-number" style="background: ${n.color};">${e+1}</div>\n                    <div class="step-icon">${n.icon}</div>\n                    <div class="step-info">\n                        <div class="step-name">${n.name}</div>\n                        <div class="step-desc">${n.description}</div>\n                    </div>\n                    <div class="step-status" id="status-${n.id}">\n                        <span class="status-badge pending">ç­‰å¾…ä¸­</span>\n                    </div>\n                </div>\n                <div class="step-actions">\n                    <button class="btn btn-run" onclick="runStep('${n.id}')">\n                        <span class="btn-icon">â–¶</span> æ‰§è¡Œ\n                    </button>\n                    <button class="btn btn-view" id="view-${n.id}" onclick="toggleResult('${n.id}')" disabled>\n                        <span class="btn-icon">ğŸ“Š</span> æŸ¥çœ‹ç»“æœ\n                    </button>\n                </div>\n                <div class="step-result" id="result-${n.id}"></div>\n            </div>\n        `).join("")}\n    </div>\n    \n    <div class="context-panel">\n        <h3>ğŸ“‹ æ‰§è¡Œä¸Šä¸‹æ–‡</h3>\n        <div class="context-content" id="context">\n            <p style="color: var(--text-secondary);">æ‰§è¡Œæ­¥éª¤åï¼Œç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</p>\n        </div>\n    </div>\n    \n    <div class="python-info" id="python-info">\n        <span class="label">Python:</span>\n        <span id="python-path">æ­£åœ¨æ£€æµ‹...</span>\n    </div>\n    \n    <script>\n        const vscode = acquireVsCodeApi();\n        let completedSteps = 0;\n        const totalSteps = 9;\n        let workflowContext = {};\n        \n        // åˆå§‹åŒ–\n        window.addEventListener('load', () => {\n            vscode.postMessage({ command: 'init' });\n        });\n        \n        function runStep(stepId) {\n            vscode.postMessage({ command: 'runStep', stepId, args: {} });\n        }\n        \n        function runAll() {\n            vscode.postMessage({ command: 'runAll' });\n        }\n        \n        function reset() {\n            vscode.postMessage({ command: 'reset' });\n            completedSteps = 0;\n            workflowContext = {};\n            updateProgress(0, 'å‡†å¤‡å°±ç»ª');\n            document.getElementById('context').innerHTML = '<p style="color: var(--text-secondary);">æ‰§è¡Œæ­¥éª¤åï¼Œç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</p>';\n            \n            document.querySelectorAll('.step-card').forEach(card => {\n                card.classList.remove('running', 'completed', 'failed');\n            });\n            document.querySelectorAll('[id^="status-"]').forEach(el => {\n                el.innerHTML = '<span class="status-badge pending">ç­‰å¾…ä¸­</span>';\n            });\n            document.querySelectorAll('[id^="result-"]').forEach(el => {\n                el.innerHTML = '';\n                el.classList.remove('visible');\n            });\n            document.querySelectorAll('[id^="view-"]').forEach(btn => {\n                btn.disabled = true;\n            });\n        }\n        \n        function toggleResult(stepId) {\n            const resultEl = document.getElementById('result-' + stepId);\n            resultEl.classList.toggle('visible');\n        }\n        \n        function updateProgress(count, text) {\n            completedSteps = count;\n            const percent = (count / totalSteps * 100);\n            document.getElementById('progress').style.width = percent + '%';\n            document.getElementById('progress-text').textContent = text;\n            document.getElementById('progress-percent').textContent = count + ' / ' + totalSteps;\n        }\n        \n        function formatValue(value) {\n            if (typeof value === 'number') {\n                if (Math.abs(value) < 1) {\n                    return (value * 100).toFixed(2) + '%';\n                }\n                return value.toFixed(2);\n            }\n            return value;\n        }\n        \n        function renderMetrics(result) {\n            if (!result || !result.metrics) return '';\n            \n            const metrics = result.metrics;\n            let html = '<div class="metrics-grid">';\n            \n            const metricDefs = [\n                { key: 'total_return', label: 'æ€»æ”¶ç›Š', isPercent: true },\n                { key: 'sharpe_ratio', label: 'å¤æ™®æ¯”ç‡' },\n                { key: 'max_drawdown', label: 'æœ€å¤§å›æ’¤', isPercent: true, isNegative: true },\n                { key: 'win_rate', label: 'èƒœç‡', isPercent: true },\n                { key: 'total_trades', label: 'äº¤æ˜“æ¬¡æ•°' }\n            ];\n            \n            metricDefs.forEach(def => {\n                if (metrics[def.key] !== undefined) {\n                    const value = metrics[def.key];\n                    const displayValue = def.isPercent ? (value * 100).toFixed(2) + '%' : value.toFixed ? value.toFixed(2) : value;\n                    const colorClass = def.isNegative ? 'negative' : (value > 0 ? 'positive' : '');\n                    \n                    html += '<div class="metric-item">';\n                    html += '<div class="metric-value ' + colorClass + '">' + displayValue + '</div>';\n                    html += '<div class="metric-label">' + def.label + '</div>';\n                    html += '</div>';\n                }\n            });\n            \n            html += '</div>';\n            return html;\n        }\n        \n        function renderResultContent(stepId, result) {\n            const chartId = 'chart-' + stepId + '-' + Date.now();\n            let html = '<div class="result-card">';\n            html += '<div class="result-header">' + (result.summary || 'æ‰§è¡Œç»“æœ') + '</div>';\n            html += '<div class="result-content">';\n            \n            // å¸‚åœºè¶‹åŠ¿ - é›·è¾¾å›¾\n            if (stepId === 'market_trend') {\n                html += '<div id="' + chartId + '" style="width:100%;height:300px;"></div>';\n                html += '</div></div>';\n                setTimeout(() => {\n                    const chart = echarts.init(document.getElementById(chartId));\n                    const short = result.short_term || result.indicators || {};\n                    const medium = result.medium_term || {};\n                    const long = result.long_term || {};\n                    chart.setOption({\n                        title: { text: 'å¸‚åœºè¶‹åŠ¿åˆ†æ', left: 'center', textStyle: { color: '#e6edf3' } },\n                        backgroundColor: 'transparent',\n                        radar: {\n                            indicator: [\n                                { name: 'çŸ­æœŸè¶‹åŠ¿', max: 100 },\n                                { name: 'ä¸­æœŸè¶‹åŠ¿', max: 100 },\n                                { name: 'é•¿æœŸè¶‹åŠ¿', max: 100 },\n                                { name: 'åŠ¨é‡', max: 100 },\n                                { name: 'æ³¢åŠ¨ç‡', max: 100 }\n                            ],\n                            axisLine: { lineStyle: { color: 'rgba(255,255,255,0.3)' } },\n                            splitLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } }\n                        },\n                        series: [{\n                            type: 'radar',\n                            data: [{\n                                value: [\n                                    (short.score || 50) + 50,\n                                    (medium.score || 50) + 50,\n                                    (long.score || 50) + 50,\n                                    Math.min(100, Math.abs(result.indicators?.momentum_20d || 0) * 5 + 50),\n                                    100 - Math.min(100, (result.indicators?.volatility_annual || 20))\n                                ],\n                                name: 'å¸‚åœºæŒ‡æ ‡',\n                                areaStyle: { color: 'rgba(47, 129, 247, 0.3)' },\n                                lineStyle: { color: '#2f81f7' }\n                            }]\n                        }]\n                    });\n                }, 100);\n                return html;\n            }\n            \n            // æŠ•èµ„ä¸»çº¿ - æŸ±çŠ¶å›¾\n            if (stepId === 'mainline') {\n                const mainlines = result.mainlines || [];\n                html += '<div id="' + chartId + '" style="width:100%;height:300px;"></div>';\n                html += '</div></div>';\n                setTimeout(() => {\n                    const chart = echarts.init(document.getElementById(chartId));\n                    chart.setOption({\n                        title: { text: 'æŠ•èµ„ä¸»çº¿è¯„åˆ†', left: 'center', textStyle: { color: '#e6edf3' } },\n                        backgroundColor: 'transparent',\n                        xAxis: {\n                            type: 'category',\n                            data: mainlines.slice(0, 8).map(m => m.name || ''),\n                            axisLabel: { color: '#7d8590', rotate: 30 },\n                            axisLine: { lineStyle: { color: '#253040' } }\n                        },\n                        yAxis: {\n                            type: 'value',\n                            max: 100,\n                            axisLabel: { color: '#7d8590' },\n                            splitLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } }\n                        },\n                        series: [{\n                            type: 'bar',\n                            data: mainlines.slice(0, 8).map((m, i) => ({\n                                value: m.score || 0,\n                                itemStyle: {\n                                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [\n                                        { offset: 0, color: i < 3 ? '#f5576c' : '#667eea' },\n                                        { offset: 1, color: i < 3 ? '#f093fb' : '#764ba2' }\n                                    ])\n                                }\n                            })),\n                            barWidth: '50%'\n                        }]\n                    });\n                }, 100);\n                return html;\n            }\n            \n            // å›æµ‹ç»“æœ - æŒ‡æ ‡å¡ç‰‡ + æŠ˜çº¿å›¾\n            if (stepId === 'backtest' || stepId === 'optimization') {\n                html += renderMetrics(result);\n                if (result.equity_curve || result.returns) {\n                    html += '<div id="' + chartId + '" style="width:100%;height:250px;margin-top:16px;"></div>';\n                    html += '</div></div>';\n                    setTimeout(() => {\n                        const chart = echarts.init(document.getElementById(chartId));\n                        const curve = result.equity_curve || result.returns || [];\n                        chart.setOption({\n                            title: { text: 'æ”¶ç›Šæ›²çº¿', left: 'center', textStyle: { color: '#e6edf3', fontSize: 14 } },\n                            backgroundColor: 'transparent',\n                            xAxis: {\n                                type: 'category',\n                                data: curve.map((_, i) => 'D' + (i + 1)),\n                                axisLabel: { color: '#7d8590' },\n                                axisLine: { lineStyle: { color: '#253040' } }\n                            },\n                            yAxis: {\n                                type: 'value',\n                                axisLabel: { color: '#7d8590', formatter: '{value}%' },\n                                splitLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } }\n                            },\n                            series: [{\n                                type: 'line',\n                                data: curve.map(v => (v * 100).toFixed(2)),\n                                smooth: true,\n                                areaStyle: { color: 'rgba(46, 160, 67, 0.2)' },\n                                lineStyle: { color: '#2ea043', width: 2 }\n                            }]\n                        });\n                    }, 100);\n                    return html;\n                }\n            }\n            \n            // äº”ç»´è¯„åˆ† - é›·è¾¾å›¾\n            if (result.five_dimension || result.radar_data) {\n                const dims = result.five_dimension || result.radar_data || {};\n                html += '<div id="' + chartId + '" style="width:100%;height:280px;"></div>';\n                const radarData = result.radar_data || {\n                    'åŸºæœ¬é¢': dims.fundamental || 0,\n                    'æŠ€æœ¯é¢': dims.technical || 0,\n                    'èµ„é‡‘é¢': dims.capital || 0,\n                    'æ¶ˆæ¯é¢': dims.news || 0,\n                    'è¡Œä¸šåœ°ä½': dims.position || 0\n                };\n                html += '</div></div>';\n                setTimeout(() => {\n                    const chart = echarts.init(document.getElementById(chartId));\n                    const labels = Object.keys(radarData);\n                    const values = Object.values(radarData);\n                    chart.setOption({\n                        title: { text: 'äº”ç»´è¯„åˆ†', left: 'center', textStyle: { color: '#e6edf3' } },\n                        backgroundColor: 'transparent',\n                        radar: {\n                            indicator: labels.map(l => ({ name: l, max: 20 })),\n                            axisLine: { lineStyle: { color: 'rgba(255,255,255,0.3)' } },\n                            splitLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } }\n                        },\n                        series: [{\n                            type: 'radar',\n                            data: [{\n                                value: values,\n                                name: 'è¯„åˆ†',\n                                areaStyle: { color: 'rgba(245, 87, 108, 0.3)' },\n                                lineStyle: { color: '#f5576c' }\n                            }]\n                        }]\n                    });\n                }, 100);\n                return html;\n            }\n            \n            // é€šç”¨JSONå±•ç¤º\n            html += '<pre style="max-height:400px;overflow:auto;">' + JSON.stringify(result, null, 2) + '</pre>';\n            \n            html += '</div></div>';\n            return html;\n        }\n        \n        // æ¶ˆæ¯å¤„ç†\n        window.addEventListener('message', event => {\n            const message = event.data;\n            \n            switch (message.command) {\n                case 'initialized': {\n                    document.getElementById('python-path').textContent = message.pythonPath;\n                    break;\n                }\n                \n                case 'stepStarted': {\n                    const card = document.getElementById('step-' + message.stepId);\n                    const status = document.getElementById('status-' + message.stepId);\n                    \n                    card.classList.remove('completed', 'failed');\n                    card.classList.add('running');\n                    status.innerHTML = '<span class="status-badge running">æ‰§è¡Œä¸­...</span>';\n                    updateProgress(completedSteps, 'æ­£åœ¨æ‰§è¡Œ: ' + STEP_NAMES[message.stepId]);\n                    break;\n                }\n                \n                case 'stepCompleted': {\n                    const card = document.getElementById('step-' + message.stepId);\n                    const status = document.getElementById('status-' + message.stepId);\n                    const result = document.getElementById('result-' + message.stepId);\n                    const viewBtn = document.getElementById('view-' + message.stepId);\n                    \n                    card.classList.remove('running');\n                    card.classList.add('completed');\n                    \n                    const duration = (message.duration / 1000).toFixed(1);\n                    status.innerHTML = '<span class="status-badge completed">âœ… å®Œæˆ (' + duration + 's)</span>';\n                    \n                    result.innerHTML = renderResultContent(message.stepId, message.result);\n                    viewBtn.disabled = false;\n                    \n                    completedSteps++;\n                    workflowContext[message.stepId] = message.result;\n                    updateProgress(completedSteps, 'å®Œæˆ: ' + STEP_NAMES[message.stepId]);\n                    break;\n                }\n                \n                case 'stepFailed': {\n                    const card = document.getElementById('step-' + message.stepId);\n                    const status = document.getElementById('status-' + message.stepId);\n                    const result = document.getElementById('result-' + message.stepId);\n                    \n                    card.classList.remove('running');\n                    card.classList.add('failed');\n                    status.innerHTML = '<span class="status-badge failed">âŒ å¤±è´¥</span>';\n                    \n                    result.innerHTML = '<div class="result-card"><div class="result-header" style="color: var(--error);">é”™è¯¯</div><div class="result-content"><pre style="color: var(--error);">' + message.error + '</pre></div></div>';\n                    result.classList.add('visible');\n                    \n                    updateProgress(completedSteps, 'å¤±è´¥: ' + STEP_NAMES[message.stepId]);\n                    break;\n                }\n                \n                case 'workflowCompleted': {\n                    document.getElementById('context').innerHTML = '<pre>' + JSON.stringify(message.context, null, 2) + '</pre>';\n                    updateProgress(completedSteps, 'å·¥ä½œæµå®Œæˆ');\n                    break;\n                }\n                \n                case 'reset': {\n                    // å·²åœ¨resetå‡½æ•°ä¸­å¤„ç†\n                    break;\n                }\n                \n                case 'error': {\n                    alert('é”™è¯¯: ' + message.error);\n                    break;\n                }\n            }\n        });\n        \n        // æ­¥éª¤åç§°æ˜ å°„\n        const STEP_NAMES = {\n            'data_source': 'ä¿¡æ¯è·å–',\n            'market_trend': 'å¸‚åœºè¶‹åŠ¿',\n            'mainline': 'æŠ•èµ„ä¸»çº¿',\n            'candidate_pool': 'å€™é€‰æ± æ„å»º',\n            'factor': 'å› å­æ„å»º',\n            'strategy': 'ç­–ç•¥ç”Ÿæˆ',\n            'backtest': 'å›æµ‹éªŒè¯',\n            'optimization': 'ç­–ç•¥ä¼˜åŒ–',\n            'report': 'æŠ¥å‘Šç”Ÿæˆ'\n        };\n    <\/script>\n</body>\n</html>`}}e.WorkflowPanel=f},395:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.MarketPanel=void 0;const i=o(t(398));class d{static currentPanel;_panel;_extensionUri;_client;_disposables=[];constructor(n,e,t){this._panel=n,this._extensionUri=e,this._client=t,this._update(),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.onDidReceiveMessage(async n=>{switch(n.command){case"refresh":await this._update();break;case"getMarketStatus":await i.commands.executeCommand("trquant.getMarketStatus");break;case"getMainlines":await i.commands.executeCommand("trquant.getMainlines");break;case"generateStrategy":await i.commands.executeCommand("trquant.generateStrategy")}},null,this._disposables)}static createOrShow(n,e){const t=i.ViewColumn.Beside;if(d.currentPanel)return void d.currentPanel._panel.reveal(t);const a=i.window.createWebviewPanel("trquantPanel","TRQuant æ§åˆ¶å°",t,{enableScripts:!0,retainContextWhenHidden:!0});d.currentPanel=new d(a,n,e)}async _update(){this._panel.webview.html=await this._getHtmlContent()}async _getHtmlContent(){let n=null,e=null;try{const t=await this._client.getMarketStatus();t.ok&&(n=t.data);const a=await this._client.getMainlines({top_n:5});a.ok&&(e=a.data)}catch(n){}const t="risk_on"===n?.regime?"#10b981":"risk_off"===n?.regime?"#ef4444":"#f59e0b";return`<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="UTF-8">\n    <style>\n        body {\n            font-family: 'Segoe UI', sans-serif;\n            background: #1a1a2e;\n            color: #fff;\n            padding: 20px;\n            margin: 0;\n        }\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid #333;\n        }\n        .logo {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n        }\n        .logo-icon { font-size: 32px; }\n        .logo-text {\n            font-size: 20px;\n            font-weight: bold;\n        }\n        .refresh-btn {\n            background: #333;\n            border: none;\n            color: #fff;\n            padding: 8px 16px;\n            border-radius: 8px;\n            cursor: pointer;\n        }\n        .refresh-btn:hover { background: #444; }\n\n        .status-card {\n            background: linear-gradient(135deg, ${t}22, ${t}11);\n            border: 1px solid ${t}44;\n            border-radius: 16px;\n            padding: 20px;\n            margin-bottom: 20px;\n        }\n        .status-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        .status-regime {\n            font-size: 24px;\n            font-weight: bold;\n        }\n        .status-badge {\n            background: ${t};\n            padding: 6px 16px;\n            border-radius: 20px;\n            font-size: 13px;\n        }\n        .status-summary {\n            margin-top: 12px;\n            color: #d1d5db;\n            line-height: 1.6;\n        }\n\n        .section {\n            background: #252540;\n            border-radius: 12px;\n            padding: 16px;\n            margin-bottom: 16px;\n        }\n        .section-title {\n            font-size: 14px;\n            color: #9ca3af;\n            margin-bottom: 12px;\n        }\n\n        .mainline-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 10px 0;\n            border-bottom: 1px solid #333;\n        }\n        .mainline-item:last-child { border: none; }\n\n        .actions {\n            display: grid;\n            grid-template-columns: repeat(2, 1fr);\n            gap: 12px;\n            margin-top: 20px;\n        }\n        .action-btn {\n            background: #667eea;\n            border: none;\n            color: #fff;\n            padding: 14px;\n            border-radius: 10px;\n            cursor: pointer;\n            font-size: 14px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 8px;\n        }\n        .action-btn:hover { background: #5a6fd6; }\n        .action-btn.primary { background: #10b981; }\n        .action-btn.primary:hover { background: #059669; }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="logo">\n            <span class="logo-icon">ğŸ“Š</span>\n            <span class="logo-text">TRQuant æ§åˆ¶å°</span>\n        </div>\n        <button class="refresh-btn" onclick="refresh()">ğŸ”„ åˆ·æ–°</button>\n    </div>\n\n    <div class="status-card">\n        <div class="status-header">\n            <span class="status-regime">\n                ${"risk_on"===n?.regime?"ğŸ“ˆ é£é™©åå¥½ä¸Šå‡":"risk_off"===n?.regime?"ğŸ“‰ é£é™©åå¥½ä¸‹é™":"â¡ï¸ éœ‡è¡å¸‚åœº"}\n            </span>\n            <span class="status-badge">${(n?.regime||"UNKNOWN").toUpperCase()}</span>\n        </div>\n        <div class="status-summary">\n            ${n?.summary||"æ­£åœ¨è·å–å¸‚åœºçŠ¶æ€..."}\n        </div>\n    </div>\n\n    ${e?`\n    <div class="section">\n        <div class="section-title">ğŸ¯ çƒ­é—¨ä¸»çº¿ TOP 5</div>\n        ${e.slice(0,5).map((n,e)=>`\n            <div class="mainline-item">\n                <span>${e+1}. ${n.name}</span>\n                <span style="color: #667eea">${n.score?.toFixed(2)}</span>\n            </div>\n        `).join("")}\n    </div>\n    `:""}\n\n    <div class="actions">\n        <button class="action-btn" onclick="getMarketStatus()">\n            ğŸ“Š å¸‚åœºçŠ¶æ€\n        </button>\n        <button class="action-btn" onclick="getMainlines()">\n            ğŸ¯ æŠ•èµ„ä¸»çº¿\n        </button>\n        <button class="action-btn" onclick="recommendFactors()">\n            ğŸ“ˆ å› å­æ¨è\n        </button>\n        <button class="action-btn primary" onclick="generateStrategy()">\n            ğŸš€ ç”Ÿæˆç­–ç•¥\n        </button>\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        function refresh() { vscode.postMessage({ command: 'refresh' }); }\n        function getMarketStatus() { vscode.postMessage({ command: 'getMarketStatus' }); }\n        function getMainlines() { vscode.postMessage({ command: 'getMainlines' }); }\n        function recommendFactors() { vscode.postMessage({ command: 'recommendFactors' }); }\n        function generateStrategy() { vscode.postMessage({ command: 'generateStrategy' }); }\n    <\/script>\n</body>\n</html>`}dispose(){for(d.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const n=this._disposables.pop();n&&n.dispose()}}}e.MarketPanel=d},398:n=>{n.exports=require("vscode")},405:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.recommendFactors=async function(n,e){d.logger.info("æ‰§è¡Œæ¨èå› å­å‘½ä»¤",l),await i.window.withProgress({location:i.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(t,a)=>{try{t.report({message:"è·å–å¸‚åœºçŠ¶æ€...",increment:0});const r=await n.getMarketStatus(),s=r.data?.regime||"neutral";if(a.isCancellationRequested)return;t.report({message:"æ¨èå› å­...",increment:30});const o=await n.recommendFactors({market_regime:s,top_n:15});if(t.report({increment:40}),!o.ok||!o.data)return void i.window.showErrorMessage(`è·å–å› å­æ¨èå¤±è´¥: ${o.error||"æœªçŸ¥é”™è¯¯"}`);const c=o.data;d.logger.info(`æ¨è ${c.length} ä¸ªå› å­`,l),t.report({message:"æ¸²æŸ“ç»“æœ...",increment:20}),function(n,e,t){const a=i.window.createWebviewPanel("trquantFactors","ğŸ“ˆ å› å­æ¨è",i.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0});a.webview.html=function(n,e){const t=m(e),a=p(n),r=Object.entries(a).map(([n,e])=>function(n,e){const t=e.map(n=>function(n){const e=n.weight>.7?"weight-high":n.weight>.4?"weight-medium":"weight-low";return`\n        <div class="factor-card" data-factor="${n.name}" onclick="toggleFactor('${n.name}', this)">\n            <div class="factor-header">\n                <span class="factor-name">${n.name}</span>\n                <span class="factor-weight ${e}">${(100*n.weight).toFixed(0)}%</span>\n            </div>\n            <div class="factor-reason">${n.reason||"åŸºäºå†å²è¡¨ç°æ¨è"}</div>\n        </div>\n    `}(n)).join("");return`\n        <div class="category-section">\n            <div class="category-title">${function(n){return{ç›ˆåˆ©èƒ½åŠ›:"ğŸ’°",æˆé•¿æ€§:"ğŸš€",ä¼°å€¼:"ğŸ“Š",åŠ¨é‡:"âš¡",æµåŠ¨æ€§:"ğŸ’§",æ³¢åŠ¨ç‡:"ğŸ“ˆ",è´¨é‡:"âœ¨",å…¶ä»–:"ğŸ“‹"}[n]||"ğŸ“‹"}(n)} ${n}</div>\n            <div class="factors-grid">\n                ${t}\n            </div>\n        </div>\n    `}(n,e)).join("");return`<!DOCTYPE html>\n<html lang="zh">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>å› å­æ¨è</title>\n    <style>\n        :root {\n            --bg-primary: #1a1a2e;\n            --bg-secondary: #252540;\n            --bg-tertiary: #2d2d4a;\n            --text-primary: #ffffff;\n            --text-secondary: #9ca3af;\n            --text-muted: #6b7280;\n            --primary: #667eea;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --border: #3d3d5c;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n            line-height: 1.6;\n        }\n\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border);\n        }\n\n        .header-left {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n\n        .header-icon { font-size: 36px; }\n\n        .header-title {\n            font-size: 24px;\n            font-weight: 600;\n        }\n\n        .header-subtitle {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .regime-badge {\n            background: ${t.color};\n            color: white;\n            padding: 6px 16px;\n            border-radius: 20px;\n            font-size: 13px;\n        }\n\n        .info-card {\n            background: linear-gradient(135deg, ${t.color}22, ${t.color}11);\n            border-left: 4px solid ${t.color};\n            border-radius: 12px;\n            padding: 16px 20px;\n            margin-bottom: 24px;\n        }\n\n        .info-card p {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .category-section {\n            margin-bottom: 24px;\n        }\n\n        .category-title {\n            font-size: 15px;\n            font-weight: 600;\n            color: var(--text-secondary);\n            margin-bottom: 12px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .category-title::before {\n            content: '';\n            width: 4px;\n            height: 16px;\n            background: var(--primary);\n            border-radius: 2px;\n        }\n\n        .factors-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));\n            gap: 12px;\n        }\n\n        .factor-card {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            border: 1px solid var(--border);\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n\n        .factor-card:hover {\n            border-color: var(--primary);\n        }\n\n        .factor-card.selected {\n            border-color: var(--success);\n            background: var(--success)11;\n        }\n\n        .factor-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 8px;\n        }\n\n        .factor-name {\n            font-weight: 600;\n            font-size: 15px;\n        }\n\n        .factor-weight {\n            background: var(--bg-tertiary);\n            padding: 4px 12px;\n            border-radius: 12px;\n            font-size: 13px;\n            font-weight: 600;\n        }\n\n        .weight-high { background: var(--success); color: white; }\n        .weight-medium { background: var(--warning); color: #1a1a2e; }\n        .weight-low { background: var(--bg-tertiary); color: var(--text-secondary); }\n\n        .factor-reason {\n            color: var(--text-secondary);\n            font-size: 13px;\n            line-height: 1.5;\n        }\n\n        .selected-factors {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            margin-bottom: 24px;\n            border: 1px solid var(--border);\n        }\n\n        .selected-title {\n            font-size: 14px;\n            color: var(--text-secondary);\n            margin-bottom: 12px;\n        }\n\n        .selected-list {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 8px;\n        }\n\n        .selected-tag {\n            background: var(--primary);\n            color: white;\n            padding: 6px 12px;\n            border-radius: 16px;\n            font-size: 13px;\n            display: flex;\n            align-items: center;\n            gap: 6px;\n        }\n\n        .selected-tag .remove {\n            cursor: pointer;\n            opacity: 0.7;\n        }\n\n        .selected-tag .remove:hover { opacity: 1; }\n\n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 24px;\n        }\n\n        .btn {\n            padding: 12px 24px;\n            border-radius: 10px;\n            border: none;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s;\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n        }\n\n        .btn-primary:hover { background: #5a6fd6; }\n\n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n        }\n\n        .btn-secondary:hover { background: #3d3d5c; }\n\n        .timestamp {\n            text-align: center;\n            color: var(--text-muted);\n            font-size: 12px;\n            margin-top: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="header-left">\n            <span class="header-icon">ğŸ“ˆ</span>\n            <div>\n                <div class="header-title">å› å­æ¨è</div>\n                <div class="header-subtitle">åŸºäºå½“å‰å¸‚åœºçŠ¶æ€çš„æ™ºèƒ½å› å­æ¨è</div>\n            </div>\n        </div>\n        <span class="regime-badge">å¸‚åœº: ${e.toUpperCase()}</span>\n    </div>\n\n    <div class="info-card">\n        <p>${t.factorAdvice}</p>\n    </div>\n\n    <div class="selected-factors" id="selectedFactors">\n        <div class="selected-title">å·²é€‰å› å­ (ç‚¹å‡»å¡ç‰‡æ·»åŠ /ç§»é™¤)</div>\n        <div class="selected-list" id="selectedList"></div>\n    </div>\n\n    ${r}\n\n    <div class="actions">\n        <button class="btn btn-primary" onclick="generateStrategy()">\n            ğŸš€ ä½¿ç”¨é€‰ä¸­å› å­ç”Ÿæˆç­–ç•¥\n        </button>\n        <button class="btn btn-secondary" onclick="copyPrompt()">\n            ğŸ“‹ å¤åˆ¶ä¸ºAI Prompt\n        </button>\n    </div>\n\n    <div class="timestamp">\n        æ›´æ–°æ—¶é—´: ${(new Date).toLocaleString("zh-CN")}\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        const selectedFactors = new Set();\n        \n        // é»˜è®¤é€‰ä¸­å‰5ä¸ªå› å­\n        const defaultFactors = ${JSON.stringify(n.slice(0,5).map(n=>n.name))};\n        defaultFactors.forEach(f => selectedFactors.add(f));\n        updateSelectedDisplay();\n        \n        function toggleFactor(name, element) {\n            if (selectedFactors.has(name)) {\n                selectedFactors.delete(name);\n                element.classList.remove('selected');\n            } else {\n                selectedFactors.add(name);\n                element.classList.add('selected');\n            }\n            updateSelectedDisplay();\n        }\n        \n        function removeFactor(name) {\n            selectedFactors.delete(name);\n            const card = document.querySelector(\`[data-factor="\${name}"]\`);\n            if (card) card.classList.remove('selected');\n            updateSelectedDisplay();\n        }\n        \n        function updateSelectedDisplay() {\n            const list = document.getElementById('selectedList');\n            list.innerHTML = Array.from(selectedFactors).map(f => \n                \`<span class="selected-tag">\n                    \${f}\n                    <span class="remove" onclick="removeFactor('\${f}')">Ã—</span>\n                </span>\`\n            ).join('');\n            \n            // æ›´æ–°å¡ç‰‡çŠ¶æ€\n            document.querySelectorAll('.factor-card').forEach(card => {\n                const factorName = card.getAttribute('data-factor');\n                if (selectedFactors.has(factorName)) {\n                    card.classList.add('selected');\n                }\n            });\n        }\n        \n        function generateStrategy() {\n            vscode.postMessage({ \n                command: 'generateStrategy',\n                factors: Array.from(selectedFactors)\n            });\n        }\n        \n        function copyPrompt() {\n            vscode.postMessage({ command: 'copyPrompt' });\n        }\n    <\/script>\n</body>\n</html>`}(e,t),a.webview.onDidReceiveMessage(async n=>{switch(n.command){case"generateStrategy":!function(n){d.logger.info(`ä½¿ç”¨å› å­ç”Ÿæˆç­–ç•¥: ${n.join(", ")}`,l),i.commands.executeCommand("trquant.generateStrategy")}(n.factors||e.slice(0,5).map(n=>n.name));break;case"copyPrompt":const a=u(e,t);await i.env.clipboard.writeText(a),i.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}},void 0,n.subscriptions)}(e,c,s),t.report({increment:10}),async function(n){if(0!==n.length)switch(await i.window.showInformationMessage(`æ¨è ${n.length} ä¸ªå› å­`,"ç”Ÿæˆç­–ç•¥","å¤åˆ¶Prompt")){case"ç”Ÿæˆç­–ç•¥":i.commands.executeCommand("trquant.generateStrategy");break;case"å¤åˆ¶Prompt":const e=u(n,"neutral");await i.env.clipboard.writeText(e),i.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}}(c)}catch(n){c.ErrorHandler.handle(n,l)}})};const i=o(t(398)),d=t(628),c=t(799),l="RecommendFactors";function p(n){const e={};for(const t of n){const n=t.category||"å…¶ä»–";e[n]||(e[n]=[]),e[n].push(t)}return e}function m(n){const e={risk_on:{color:"#10b981",factorAdvice:"å½“å‰å¸‚åœºé£é™©åå¥½ä¸Šå‡ï¼Œå»ºè®®ä¾§é‡æˆé•¿æ€§å’ŒåŠ¨é‡å› å­ã€‚é«˜Betaã€é«˜æˆé•¿çš„è‚¡ç¥¨å¯èƒ½è¡¨ç°æ›´å¥½ã€‚"},risk_off:{color:"#ef4444",factorAdvice:"å½“å‰å¸‚åœºé£é™©åå¥½ä¸‹é™ï¼Œå»ºè®®ä¾§é‡ä»·å€¼å’Œè´¨é‡å› å­ã€‚ä½æ³¢åŠ¨ã€é«˜åˆ†çº¢çš„è‚¡ç¥¨å¯èƒ½æ›´ç¨³å¥ã€‚"},neutral:{color:"#f59e0b",factorAdvice:"å½“å‰å¸‚åœºå¤„äºéœ‡è¡æ ¼å±€ï¼Œå»ºè®®å‡è¡¡é…ç½®å„ç±»å› å­ã€‚å¯ä»¥è€ƒè™‘å¸‚åœºä¸­æ€§ç­–ç•¥é™ä½æ–¹å‘æ€§é£é™©ã€‚"}};return e[n]||e.neutral}function u(n,e){const t=p(n);return`# é‡åŒ–å› å­æ¨è\n\n## å¸‚åœºçŠ¶æ€: ${e.toUpperCase()}\n\n${m(e).factorAdvice}\n\n## æ¨èå› å­åˆ—è¡¨\n\n${Object.entries(t).map(([n,e])=>`\n### ${n}\n${e.map(n=>`- **${n.name}** (æƒé‡: ${(100*n.weight).toFixed(0)}%): ${n.reason||""}`).join("\n")}\n`).join("\n")}\n\n---\n\nè¯·åŸºäºä»¥ä¸Šå› å­æ¨èï¼Œå¸®æˆ‘ï¼š\n1. åˆ†æå„å› å­åœ¨å½“å‰å¸‚åœºç¯å¢ƒä¸‹çš„æœ‰æ•ˆæ€§\n2. è®¾è®¡å› å­åˆæˆæ–¹æ¡ˆï¼ˆæƒé‡åˆ†é…ï¼‰\n3. ç”Ÿæˆä½¿ç”¨è¿™äº›å› å­çš„PTradeå¤šå› å­ç­–ç•¥ä»£ç \n\nè¦æ±‚ï¼š\n- å› å­éœ€è¦è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ï¼ˆZ-scoreï¼‰\n- è€ƒè™‘å› å­é—´çš„ç›¸å…³æ€§\n- åŒ…å«å®Œæ•´çš„é£æ§é€»è¾‘\n`}},478:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.config=e.ConfigManager=void 0;const i=o(t(398)),d=o(t(928)),c=o(t(857)),l=o(t(896)),p=t(628),m={pythonPath:"win32"===c.platform()?"python":"python3",serverHost:"127.0.0.1",serverPort:5e3,timeout:6e4,mcpEnabled:!0,mcpPort:5001,autoRefresh:!1,refreshInterval:3e5,defaultPlatform:"ptrade",defaultStyle:"multi_factor",defaultRiskParams:{maxPosition:.1,stopLoss:.08,takeProfit:.2}};class u{static instance;config;disposables=[];constructor(){this.config=this.loadConfig(),this.disposables.push(i.workspace.onDidChangeConfiguration(n=>{n.affectsConfiguration("trquant")&&(this.config=this.loadConfig())}))}static getInstance(){return u.instance||(u.instance=new u),u.instance}loadConfig(){const n=i.workspace.getConfiguration("trquant");return{pythonPath:n.get("pythonPath")||m.pythonPath,serverHost:n.get("serverHost")||m.serverHost,serverPort:n.get("serverPort")||m.serverPort,timeout:n.get("timeout")||m.timeout,mcpEnabled:n.get("mcpEnabled")??m.mcpEnabled,mcpPort:n.get("mcpPort")||m.mcpPort,autoRefresh:n.get("autoRefresh")??m.autoRefresh,refreshInterval:n.get("refreshInterval")||m.refreshInterval,defaultPlatform:n.get("defaultPlatform")||m.defaultPlatform,defaultStyle:n.get("defaultStyle")||m.defaultStyle,defaultRiskParams:{maxPosition:n.get("defaultMaxPosition")||m.defaultRiskParams.maxPosition,stopLoss:n.get("defaultStopLoss")||m.defaultRiskParams.stopLoss,takeProfit:n.get("defaultTakeProfit")||m.defaultRiskParams.takeProfit}}}getConfig(){return{...this.config}}get(n){return this.config[n]}async set(n,e,t=i.ConfigurationTarget.Global){const a=i.workspace.getConfiguration("trquant");await a.update(n,e,t)}getPythonPath(n){const e=this.config.pythonPath,t="win32"===c.platform(),a=n=>t?d.join(n,"Scripts","python.exe"):d.join(n,"bin","python"),r="/home/taotao/dev/QuantTest/TRQuant/venv/bin/python";if(!t)try{return l.existsSync(r)?(p.logger.debug(`ä½¿ç”¨ç¡¬ç¼–ç æ ‡å‡†Pythonè·¯å¾„: ${r}`,"ConfigManager"),r):(p.logger.warn(`ç¡¬ç¼–ç è·¯å¾„ä¸å­˜åœ¨ï¼Œä½†ç»§ç»­å°è¯•: ${r}`,"ConfigManager"),r)}catch(n){return p.logger.warn(`æ£€æŸ¥ç¡¬ç¼–ç è·¯å¾„æ—¶å‡ºé”™: ${n}`,"ConfigManager"),r}if(d.isAbsolute(e)&&l.existsSync(e))return e;const s=i.workspace.workspaceFolders;if(s&&s.length>0){const n=s[0].uri.fsPath,e=a(d.join(n,"venv"));if(l.existsSync(e))return p.logger.debug(`ä½¿ç”¨å·¥ä½œåŒºPythonè·¯å¾„: ${e}`,"ConfigManager"),e}const o=process.env.TRQUANT_ROOT;if(o){const n=a(d.join(o,"venv"));if(l.existsSync(n))return p.logger.debug(`ä½¿ç”¨TRQUANT_ROOT Pythonè·¯å¾„: ${n}`,"ConfigManager"),n}const m=a(d.join(n,"venv"));if(l.existsSync(m))return p.logger.debug(`ä½¿ç”¨æ‰©å±•è·¯å¾„Python: ${m}`,"ConfigManager"),m;if(n.endsWith("extension")||n.endsWith("extension/")||n.endsWith("extension\\")){const e=d.dirname(n),t=a(d.join(e,"venv"));if(l.existsSync(t))return p.logger.debug(`ä½¿ç”¨æ¨æ–­çš„Pythonè·¯å¾„: ${t}`,"ConfigManager"),t}return p.logger.warn(`æœªæ‰¾åˆ°venv Pythonï¼Œå›é€€åˆ°: ${e}`,"ConfigManager"),e}dispose(){this.disposables.forEach(n=>n.dispose())}}e.ConfigManager=u,e.config=u.getInstance()},482:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.BacktestPanel=void 0;const i=o(t(398)),d=t(628),c=t(290),l="BacktestPanel",p=[{id:"fast",name:"å¿«é€Ÿå›æµ‹",icon:"âš¡",color:"#3fb950",tool:"backtest.fast",description:"å‘é‡åŒ–è®¡ç®—ï¼Œ<5ç§’å®Œæˆï¼Œç”¨äºç­–ç•¥åˆç­›",features:["å‘é‡åŒ–è®¡ç®—","æ— æ»‘ç‚¹æ¨¡æ‹Ÿ","ç§’çº§å“åº”"]},{id:"standard",name:"æ ‡å‡†å›æµ‹",icon:"ğŸ“Š",color:"#58a6ff",tool:"backtest.standard",description:"äº‹ä»¶é©±åŠ¨ï¼Œå®Œæ•´äº¤æ˜“æˆæœ¬æ¨¡æ‹Ÿ",features:["äº‹ä»¶é©±åŠ¨","äº¤æ˜“æˆæœ¬","æŒä»“ç®¡ç†"]},{id:"bullettrade",name:"BulletTrade",icon:"ğŸ¯",color:"#d29922",tool:"backtest.bullettrade",description:"BulletTradeå¼•æ“ï¼Œæ”¯æŒå¤æ‚ç­–ç•¥",features:["å®Œæ•´æ¨¡æ‹Ÿ","HTMLæŠ¥å‘Š","åˆ†é’Ÿçº§æ•°æ®"]},{id:"qmt",name:"QMTå›æµ‹",icon:"ğŸ“ˆ",color:"#a371f7",tool:"backtest.qmt",description:"xtquantå¼•æ“ï¼Œç”Ÿäº§çº§å›æµ‹",features:["ç”Ÿäº§çº§å¼•æ“","Tickæ•°æ®","å®ç›˜ä¸€è‡´"]}];class m{static currentPanel;_panel;_extensionUri;_client;_disposables=[];_lastResult=null;_strategyCode="";constructor(n,e,t,a){this._panel=n,this._extensionUri=e,this._client=t,this._strategyCode=a?.code||"",this._panel.webview.html=this._getHtmlContent(),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.onDidReceiveMessage(n=>this._handleMessage(n),null,this._disposables)}static createOrShow(n,e,t){d.logger.info("åˆ›å»ºå›æµ‹é¢æ¿V2",l);const a=i.ViewColumn.One;if(m.currentPanel)return m.currentPanel._panel.reveal(a),t?.code&&(m.currentPanel._strategyCode=t.code),m.currentPanel;const r=i.window.createWebviewPanel("trquantBacktestV2","ğŸ”„ å›æµ‹éªŒè¯",a,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[n]});return m.currentPanel=new m(r,n,e,t),m.currentPanel}dispose(){for(m.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const n=this._disposables.pop();n&&n.dispose()}}async _handleMessage(n){switch(d.logger.info(`[BacktestPanel] æ”¶åˆ°æ¶ˆæ¯: ${n.command}`,l),n.command){case"runBacktest":await this._runBacktest(n.level,n.config);break;case"generateReport":await this._generateReport();break;case"openReport":await this._openReport();break;case"optimize":await this._openOptimizer()}}async _runBacktest(n,e){const t=p.find(e=>e.id===n);if(t){this._postMessage({command:"backtestStarted",level:n});try{const a=Date.now(),r={start_date:e.startDate,end_date:e.endDate,initial_capital:e.initialCapital||1e6};"fast"!==n&&"standard"!==n||(r.securities=e.securities||["000001.XSHE","600000.XSHG","000002.XSHE"],r.strategy=e.strategy||"momentum",r.lookback=e.lookback||20,r.top_n=e.topN||10),"bullettrade"!==n&&"qmt"!==n||(r.strategy_code=this._strategyCode||e.strategyCode,r.strategy_file=e.strategyFile),d.logger.info(`æ‰§è¡Œå›æµ‹: ${t.tool}`,l,r);const s=await this._client.callBridge("call_mcp_tool",{tool_name:t.tool,arguments:r,trace_id:(0,c.generateTraceId)()}),o=(Date.now()-a)/1e3;if(!s.ok||!s.data)throw new Error(s.error||"å›æµ‹å¤±è´¥");this._lastResult=s.data,this._postMessage({command:"backtestCompleted",level:n,result:s.data,duration:o}),d.logger.info(`å›æµ‹å®Œæˆ: ${n}, è€—æ—¶ ${o.toFixed(2)}s`,l)}catch(e){d.logger.error(`å›æµ‹å¤±è´¥: ${e.message}`,l),this._postMessage({command:"backtestFailed",level:n,error:e.message}),i.window.showErrorMessage(`å›æµ‹å¤±è´¥: ${e.message}`)}}else i.window.showErrorMessage(`æœªçŸ¥å›æµ‹å±‚çº§: ${n}`)}async _generateReport(){if(this._lastResult)try{const n=await this._client.callBridge("call_mcp_tool",{tool_name:"report.generate",arguments:{result:this._lastResult,format:"html",title:"å›æµ‹æŠ¥å‘Š"},trace_id:(0,c.generateTraceId)()});n.ok&&n.data&&(i.window.showInformationMessage(`æŠ¥å‘Šå·²ç”Ÿæˆ: ${n.data.file_path}`),n.data.file_path&&i.env.openExternal(i.Uri.file(n.data.file_path)))}catch(n){i.window.showErrorMessage(`æŠ¥å‘Šç”Ÿæˆå¤±è´¥: ${n.message}`)}else i.window.showWarningMessage("è¯·å…ˆè¿è¡Œå›æµ‹")}async _openReport(){await i.commands.executeCommand("trquant.openReportPanel",{result:this._lastResult})}async _openOptimizer(){await i.commands.executeCommand("trquant.openOptimizerPanel",{code:this._strategyCode,baseResult:this._lastResult})}_postMessage(n){this._panel.webview.postMessage(n)}_getHtmlContent(){const n=p.map(n=>`\n            <div class="level-card" data-level="${n.id}">\n                <div class="level-header">\n                    <span class="level-icon" style="color: ${n.color}">${n.icon}</span>\n                    <span class="level-name">${n.name}</span>\n                </div>\n                <div class="level-desc">${n.description}</div>\n                <div class="level-features">\n                    ${n.features.map(n=>`<span class="feature-tag">${n}</span>`).join("")}\n                </div>\n                <button class="btn btn-run" onclick="runBacktest('${n.id}')">â–¶ æ‰§è¡Œ</button>\n            </div>\n        `).join(""),e=new Date;return e.setMonth(e.getMonth()-3),`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>å›æµ‹éªŒè¯</title>\n    <style>\n        :root {\n            --bg-primary: #0d1117;\n            --bg-secondary: #161b22;\n            --bg-tertiary: #21262d;\n            --text-primary: #f0f6fc;\n            --text-secondary: #8b949e;\n            --border-primary: #30363d;\n            --accent: #58a6ff;\n            --success: #3fb950;\n            --warning: #d29922;\n            --error: #f85149;\n        }\n        \n        * { box-sizing: border-box; margin: 0; padding: 0; }\n        \n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n        }\n        \n        .header {\n            margin-bottom: 24px;\n        }\n        \n        .header h1 {\n            font-size: 24px;\n            margin-bottom: 8px;\n        }\n        \n        .main-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 24px;\n        }\n        \n        .config-section, .result-section {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-primary);\n            border-radius: 12px;\n            padding: 20px;\n        }\n        \n        .section-title {\n            font-size: 16px;\n            font-weight: 600;\n            margin-bottom: 16px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n        \n        .config-form {\n            display: flex;\n            flex-direction: column;\n            gap: 16px;\n            margin-bottom: 24px;\n        }\n        \n        .form-row {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 12px;\n        }\n        \n        .form-group {\n            display: flex;\n            flex-direction: column;\n            gap: 4px;\n        }\n        \n        .form-group label {\n            font-size: 12px;\n            color: var(--text-secondary);\n        }\n        \n        .form-group input, .form-group select {\n            padding: 8px 12px;\n            background: var(--bg-tertiary);\n            border: 1px solid var(--border-primary);\n            border-radius: 6px;\n            color: var(--text-primary);\n            font-size: 14px;\n        }\n        \n        .levels-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 12px;\n        }\n        \n        .level-card {\n            background: var(--bg-tertiary);\n            border: 2px solid transparent;\n            border-radius: 10px;\n            padding: 16px;\n            transition: all 0.2s;\n        }\n        \n        .level-card:hover {\n            border-color: var(--accent);\n        }\n        \n        .level-card.running {\n            border-color: var(--warning);\n            animation: pulse 1.5s infinite;\n        }\n        \n        .level-card.completed {\n            border-color: var(--success);\n        }\n        \n        @keyframes pulse {\n            0%, 100% { opacity: 1; }\n            50% { opacity: 0.7; }\n        }\n        \n        .level-header {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            margin-bottom: 8px;\n        }\n        \n        .level-icon {\n            font-size: 20px;\n        }\n        \n        .level-name {\n            font-weight: 600;\n        }\n        \n        .level-desc {\n            font-size: 12px;\n            color: var(--text-secondary);\n            margin-bottom: 12px;\n        }\n        \n        .level-features {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 4px;\n            margin-bottom: 12px;\n        }\n        \n        .feature-tag {\n            font-size: 10px;\n            padding: 2px 6px;\n            background: rgba(88, 166, 255, 0.1);\n            color: var(--accent);\n            border-radius: 4px;\n        }\n        \n        .btn {\n            padding: 8px 16px;\n            border: none;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 13px;\n            font-weight: 500;\n            transition: all 0.2s;\n        }\n        \n        .btn-run {\n            width: 100%;\n            background: var(--success);\n            color: white;\n        }\n        \n        .btn-run:hover {\n            opacity: 0.9;\n        }\n        \n        .btn-run:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n        }\n        \n        .metrics-grid {\n            display: grid;\n            grid-template-columns: repeat(3, 1fr);\n            gap: 12px;\n            margin-bottom: 24px;\n        }\n        \n        .metric-card {\n            background: var(--bg-tertiary);\n            border-radius: 8px;\n            padding: 16px;\n            text-align: center;\n        }\n        \n        .metric-value {\n            font-size: 24px;\n            font-weight: 700;\n            margin-bottom: 4px;\n        }\n        \n        .metric-value.positive { color: var(--success); }\n        .metric-value.negative { color: var(--error); }\n        \n        .metric-label {\n            font-size: 12px;\n            color: var(--text-secondary);\n        }\n        \n        .result-actions {\n            display: flex;\n            gap: 12px;\n        }\n        \n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n            border: 1px solid var(--border-primary);\n        }\n        \n        .placeholder {\n            text-align: center;\n            padding: 40px;\n            color: var(--text-secondary);\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <h1>ğŸ”„ å›æµ‹éªŒè¯</h1>\n        <p style="color: var(--text-secondary);">ä¸‰å±‚å›æµ‹æ¶æ„ï¼šå¿«é€Ÿç­›é€‰ â†’ æ ‡å‡†éªŒè¯ â†’ ç²¾ç¡®æ¨¡æ‹Ÿ</p>\n    </div>\n    \n    <div class="main-grid">\n        <div class="config-section">\n            <div class="section-title">âš™ï¸ å›æµ‹é…ç½®</div>\n            \n            <div class="config-form">\n                <div class="form-row">\n                    <div class="form-group">\n                        <label>å¼€å§‹æ—¥æœŸ</label>\n                        <input type="date" id="start-date" value="${e.toISOString().split("T")[0]}">\n                    </div>\n                    <div class="form-group">\n                        <label>ç»“æŸæ—¥æœŸ</label>\n                        <input type="date" id="end-date" value="${(new Date).toISOString().split("T")[0]}">\n                    </div>\n                </div>\n                <div class="form-row">\n                    <div class="form-group">\n                        <label>åˆå§‹èµ„é‡‘</label>\n                        <input type="number" id="initial-capital" value="1000000">\n                    </div>\n                    <div class="form-group">\n                        <label>ç­–ç•¥ç±»å‹</label>\n                        <select id="strategy">\n                            <option value="momentum">åŠ¨é‡ç­–ç•¥</option>\n                            <option value="mean_reversion">å‡å€¼å›å½’</option>\n                        </select>\n                    </div>\n                </div>\n                <div class="form-group">\n                    <label>è‚¡ç¥¨ä»£ç  (é€—å·åˆ†éš”)</label>\n                    <input type="text" id="securities" value="000001.XSHE, 600000.XSHG, 000002.XSHE, 600036.XSHG">\n                </div>\n            </div>\n            \n            <div class="section-title">ğŸ“Š å›æµ‹å±‚çº§</div>\n            <div class="levels-grid">\n                ${n}\n            </div>\n        </div>\n        \n        <div class="result-section">\n            <div class="section-title">ğŸ“ˆ å›æµ‹ç»“æœ</div>\n            \n            <div id="result-content">\n                <div class="placeholder">é€‰æ‹©å›æµ‹å±‚çº§å¹¶æ‰§è¡Œ</div>\n            </div>\n        </div>\n    </div>\n    \n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        function getConfig() {\n            return {\n                startDate: document.getElementById('start-date').value,\n                endDate: document.getElementById('end-date').value,\n                initialCapital: parseInt(document.getElementById('initial-capital').value),\n                strategy: document.getElementById('strategy').value,\n                securities: document.getElementById('securities').value.split(',').map(s => s.trim())\n            };\n        }\n        \n        function runBacktest(level) {\n            const card = document.querySelector('[data-level="' + level + '"]');\n            const btn = card.querySelector('.btn-run');\n            \n            btn.disabled = true;\n            btn.textContent = 'æ‰§è¡Œä¸­...';\n            card.classList.add('running');\n            \n            vscode.postMessage({\n                command: 'runBacktest',\n                level,\n                config: getConfig()\n            });\n        }\n        \n        function formatPercent(value) {\n            return (value * 100).toFixed(2) + '%';\n        }\n        \n        function renderResult(result) {\n            const metrics = result.metrics || result;\n            const content = document.getElementById('result-content');\n            \n            const totalReturn = metrics.total_return || 0;\n            const annualReturn = metrics.annual_return || 0;\n            const sharpe = metrics.sharpe_ratio || 0;\n            const maxDrawdown = metrics.max_drawdown || 0;\n            const winRate = metrics.win_rate || 0;\n            const trades = metrics.total_trades || 0;\n            \n            content.innerHTML = \`\n                <div class="metrics-grid">\n                    <div class="metric-card">\n                        <div class="metric-value \${totalReturn >= 0 ? 'positive' : 'negative'}">\${formatPercent(totalReturn)}</div>\n                        <div class="metric-label">æ€»æ”¶ç›Š</div>\n                    </div>\n                    <div class="metric-card">\n                        <div class="metric-value \${annualReturn >= 0 ? 'positive' : 'negative'}">\${formatPercent(annualReturn)}</div>\n                        <div class="metric-label">å¹´åŒ–æ”¶ç›Š</div>\n                    </div>\n                    <div class="metric-card">\n                        <div class="metric-value \${sharpe >= 1 ? 'positive' : ''}">\${sharpe.toFixed(2)}</div>\n                        <div class="metric-label">å¤æ™®æ¯”ç‡</div>\n                    </div>\n                    <div class="metric-card">\n                        <div class="metric-value negative">\${formatPercent(Math.abs(maxDrawdown))}</div>\n                        <div class="metric-label">æœ€å¤§å›æ’¤</div>\n                    </div>\n                    <div class="metric-card">\n                        <div class="metric-value \${winRate >= 0.5 ? 'positive' : ''}">\${formatPercent(winRate)}</div>\n                        <div class="metric-label">èƒœç‡</div>\n                    </div>\n                    <div class="metric-card">\n                        <div class="metric-value">\${trades}</div>\n                        <div class="metric-label">äº¤æ˜“æ¬¡æ•°</div>\n                    </div>\n                </div>\n                <div class="result-actions">\n                    <button class="btn btn-secondary" onclick="generateReport()">ğŸ“„ ç”ŸæˆæŠ¥å‘Š</button>\n                    <button class="btn btn-secondary" onclick="optimize()">âš™ï¸ å‚æ•°ä¼˜åŒ–</button>\n                </div>\n            \`;\n        }\n        \n        function generateReport() {\n            vscode.postMessage({ command: 'generateReport' });\n        }\n        \n        function optimize() {\n            vscode.postMessage({ command: 'optimize' });\n        }\n        \n        window.addEventListener('message', event => {\n            const message = event.data;\n            \n            switch (message.command) {\n                case 'backtestStarted': {\n                    // å·²åœ¨runBacktestä¸­å¤„ç†\n                    break;\n                }\n                \n                case 'backtestCompleted': {\n                    const card = document.querySelector('[data-level="' + message.level + '"]');\n                    const btn = card.querySelector('.btn-run');\n                    \n                    btn.disabled = false;\n                    btn.textContent = 'âœ… å®Œæˆ (' + message.duration.toFixed(1) + 's)';\n                    card.classList.remove('running');\n                    card.classList.add('completed');\n                    \n                    renderResult(message.result);\n                    break;\n                }\n                \n                case 'backtestFailed': {\n                    const card = document.querySelector('[data-level="' + message.level + '"]');\n                    const btn = card.querySelector('.btn-run');\n                    \n                    btn.disabled = false;\n                    btn.textContent = 'âŒ é‡è¯•';\n                    card.classList.remove('running');\n                    \n                    document.getElementById('result-content').innerHTML = \n                        '<div class="placeholder" style="color: var(--error);">å›æµ‹å¤±è´¥: ' + message.error + '</div>';\n                    break;\n                }\n            }\n        });\n    <\/script>\n</body>\n</html>`}}e.BacktestPanel=m},485:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.WorkflowItem=e.WorkflowProvider=void 0,e.registerWorkflowProvider=function(n){const e=new d(n),t=i.window.createTreeView("trquant-workflow",{treeDataProvider:e,showCollapseAll:!0});return n.subscriptions.push(t),console.log("[TRQuant] 9æ­¥å·¥ä½œæµæä¾›è€…å·²æ³¨å†Œ"),e};const i=o(t(398));class d{context;_onDidChangeTreeData=new i.EventEmitter;onDidChangeTreeData=this._onDidChangeTreeData.event;constructor(n){this.context=n}refresh(){this._onDidChangeTreeData.fire()}getTreeItem(n){return n}getChildren(n){if(n)return Promise.resolve(n.children||[]);const e=[new c("ğŸ‰ éŸ¬ç¿é‡åŒ–æŠ•èµ„æµç¨‹","æ‰“å¼€å®Œæ•´9æ­¥å·¥ä½œæµé¢æ¿",i.TreeItemCollapsibleState.None,"trquant.openWorkflowPanel"),new c("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”","9æ­¥æŠ•èµ„å·¥ä½œæµ",i.TreeItemCollapsibleState.None),new c("ğŸ“¡ 1. ä¿¡æ¯è·å–","æ•°æ®æºæ£€æµ‹ã€æ•°æ®æ›´æ–°",i.TreeItemCollapsibleState.Collapsed,"trquant.openWorkflowPanel",[new c("æ•°æ®æºé…ç½®","é…ç½®è¡Œæƒ…ã€è´¢åŠ¡æ•°æ®æº",i.TreeItemCollapsibleState.None,"trquant.openWorkflowPanel"),new c("æ•°æ®æ›´æ–°","å¢é‡æ›´æ–°å†å²æ•°æ®",i.TreeItemCollapsibleState.None,"trquant.openWorkflowPanel"),new c("çŸ¥è¯†åº“","ç®¡ç†ç­–ç•¥çŸ¥è¯†åº“",i.TreeItemCollapsibleState.None,"trquant.openWorkflowPanel"),new c("è´¨é‡æŠ¥å‘Š","æŸ¥çœ‹æ•°æ®å®Œæ•´æ€§",i.TreeItemCollapsibleState.None,"trquant.openWorkflowPanel")]),new c("ğŸ“ˆ 2. å¸‚åœºè¶‹åŠ¿","å¸‚åœºçŠ¶æ€åˆ¤æ–­ã€è¶‹åŠ¿åˆ†æ",i.TreeItemCollapsibleState.Collapsed,"trquant.getMarketStatus",[new c("å¸‚åœºçŠ¶æ€","å½“å‰ Regime åˆ¤æ–­",i.TreeItemCollapsibleState.None,"trquant.getMarketStatus"),new c("æŒ‡æ•°è¶‹åŠ¿","ä¸»è¦æŒ‡æ•°èµ°åŠ¿åˆ†æ",i.TreeItemCollapsibleState.None,"trquant.getMarketStatus"),new c("æ¿å—è½®åŠ¨","è¡Œä¸šæ¿å—å¼ºå¼±",i.TreeItemCollapsibleState.None,"trquant.getMarketStatus"),new c("æƒ…ç»ªæŒ‡æ ‡","å¸‚åœºæƒ…ç»ªç›‘æ§",i.TreeItemCollapsibleState.None,"trquant.getMarketStatus")]),new c("ğŸ”¥ 3. æŠ•èµ„ä¸»çº¿","ä¸»çº¿è¯†åˆ«ã€ä¸»çº¿è¯„åˆ†",i.TreeItemCollapsibleState.Collapsed,"trquant.getMainlines",[new c("çƒ­ç‚¹ä¸»çº¿","å½“å‰çƒ­é—¨æŠ•èµ„ä¸»çº¿",i.TreeItemCollapsibleState.None,"trquant.getMainlines"),new c("å†å²ä¸»çº¿","å†å²ä¸»çº¿å›é¡¾",i.TreeItemCollapsibleState.None,"trquant.getMainlines"),new c("LLM åˆ†æ","AI è¾…åŠ©ä¸»çº¿è§£è¯»",i.TreeItemCollapsibleState.None,"trquant.getMainlines")]),new c("ğŸ“¦ 4. å€™é€‰æ± æ„å»º","è‚¡ç¥¨ç­›é€‰ã€å€™é€‰æ± ç®¡ç†",i.TreeItemCollapsibleState.Collapsed,"trquant.openWorkflowPanel",[new c("å€™é€‰è‚¡ç¥¨","æŸ¥çœ‹å€™é€‰æ± è‚¡ç¥¨",i.TreeItemCollapsibleState.None,"trquant.openWorkflowPanel"),new c("ç­›é€‰è§„åˆ™","é…ç½®ç­›é€‰æ¡ä»¶",i.TreeItemCollapsibleState.None,"trquant.openWorkflowPanel"),new c("å…³æ³¨åˆ—è¡¨","ä¸ªäººå…³æ³¨è‚¡ç¥¨",i.TreeItemCollapsibleState.None,"trquant.openWorkflowPanel")]),new c("ğŸ“Š 5. å› å­æ„å»º","å› å­æ¨èã€å› å­é…ç½®",i.TreeItemCollapsibleState.Collapsed,"trquant.recommendFactors",[new c("å› å­åº“","æŸ¥çœ‹å¯ç”¨å› å­",i.TreeItemCollapsibleState.None,"trquant.recommendFactors"),new c("å› å­æ£€éªŒ","IC/IR åˆ†æ",i.TreeItemCollapsibleState.None,"trquant.recommendFactors"),new c("å› å­æ¨è","åŸºäºå¸‚åœºçŠ¶æ€æ¨è",i.TreeItemCollapsibleState.None,"trquant.recommendFactors")]),new c("ğŸ› ï¸ 6. ç­–ç•¥ç”Ÿæˆ","ç­–ç•¥ä»£ç ç”Ÿæˆã€ç­–ç•¥ä¼˜åŒ–",i.TreeItemCollapsibleState.Collapsed,"trquant.openStrategyGenerator",[new c("åˆ›å»ºé¡¹ç›®","æ–°å»ºé‡åŒ–ç­–ç•¥é¡¹ç›®",i.TreeItemCollapsibleState.None,"trquant.createProject"),new c("ç­–ç•¥ç¼–è¾‘å™¨","ç¼–è¾‘ç­–ç•¥ä»£ç ",i.TreeItemCollapsibleState.None,"trquant.openStrategyGenerator"),new c("AI ç”Ÿæˆ","LLM è¾…åŠ©ç”Ÿæˆç­–ç•¥",i.TreeItemCollapsibleState.None,"trquant.generateStrategy")]),new c("ğŸ”„ 7. å›æµ‹éªŒè¯","å›æµ‹æ‰§è¡Œã€ç»“æœåˆ†æ",i.TreeItemCollapsibleState.Collapsed,"trquant.openBacktestPanel",[new c("è¿è¡Œå›æµ‹","é…ç½®å¹¶æ‰§è¡Œå›æµ‹",i.TreeItemCollapsibleState.None,"trquant.openBacktestPanel"),new c("å†å²å›æµ‹","æŸ¥çœ‹å†å²å›æµ‹è®°å½•",i.TreeItemCollapsibleState.None,"trquant.openBacktestPanel"),new c("ç»“æœåˆ†æ","æ·±å…¥åˆ†æå›æµ‹ç»“æœ",i.TreeItemCollapsibleState.None,"trquant.analyzeBacktest")]),new c("âš¡ 8. ç­–ç•¥ä¼˜åŒ–","å‚æ•°ä¼˜åŒ–ã€å¤šç›®æ ‡ä¼˜åŒ–",i.TreeItemCollapsibleState.Collapsed,"trquant.openOptimizerPanel",[new c("å‚æ•°æœç´¢","ç½‘æ ¼/è´å¶æ–¯ä¼˜åŒ–",i.TreeItemCollapsibleState.None,"trquant.openOptimizerPanel"),new c("å¤šç›®æ ‡ä¼˜åŒ–","æ”¶ç›Šé£é™©å¹³è¡¡",i.TreeItemCollapsibleState.None,"trquant.openOptimizerPanel"),new c("å¯¹æ¯”åˆ†æ","å¤šç­–ç•¥å¯¹æ¯”",i.TreeItemCollapsibleState.None,"trquant.compareBacktests")]),new c("ğŸ“„ 9. æŠ¥å‘Šç”Ÿæˆ","æŠ¥å‘Šç”Ÿæˆã€ç»“æœå½’æ¡£",i.TreeItemCollapsibleState.Collapsed,"trquant.openReportPanel",[new c("ç”ŸæˆæŠ¥å‘Š","ç”Ÿæˆç­–ç•¥æŠ¥å‘Š",i.TreeItemCollapsibleState.None,"trquant.openReportPanel"),new c("ç»“æœå½’æ¡£","ä¿å­˜åˆ°çŸ¥è¯†åº“",i.TreeItemCollapsibleState.None,"trquant.openReportPanel"),new c("å¯¼å‡ºåˆ†äº«","å¯¼å‡ºPDF/HTML",i.TreeItemCollapsibleState.None,"trquant.openReportPanel")])];return Promise.resolve(e)}}e.WorkflowProvider=d;class c extends i.TreeItem{label;description;collapsibleState;commandId;children;constructor(n,e,t,a,r){super(n,t),this.label=n,this.description=e,this.collapsibleState=t,this.commandId=a,this.description=e,this.children=r,a&&(this.command={command:a,title:n,arguments:[]}),this.iconPath=this.getIcon(),this.contextValue="workflowItem"}getIcon(){const n={"ğŸ‰ éŸ¬ç¿é‡åŒ–æŠ•èµ„æµç¨‹":"symbol-event","ğŸ“¡ 1. ä¿¡æ¯è·å–":"database","ğŸ“ˆ 2. å¸‚åœºè¶‹åŠ¿":"graph-line","ğŸ”¥ 3. æŠ•èµ„ä¸»çº¿":"flame","ğŸ“¦ 4. å€™é€‰æ± æ„å»º":"package","ğŸ“Š 5. å› å­æ„å»º":"symbol-variable","ğŸ› ï¸ 6. ç­–ç•¥ç”Ÿæˆ":"tools","ğŸ”„ 7. å›æµ‹éªŒè¯":"history","âš¡ 8. ç­–ç•¥ä¼˜åŒ–":"zap","ğŸ“„ 9. æŠ¥å‘Šç”Ÿæˆ":"file-text"}[this.label];return n?new i.ThemeIcon(n):this.collapsibleState===i.TreeItemCollapsibleState.None&&this.commandId?new i.ThemeIcon("circle-small-filled"):void 0}}e.WorkflowItem=c},501:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.getMarketStatus=async function(n,e){d.logger.info("æ‰§è¡Œè·å–å¸‚åœºçŠ¶æ€å‘½ä»¤",l),await i.window.withProgress({location:i.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(t,a)=>{try{if(t.report({message:"æ­£åœ¨è·å–å¸‚åœºçŠ¶æ€...",increment:0}),a.isCancellationRequested)return void d.logger.info("ç”¨æˆ·å–æ¶ˆæ“ä½œ",l);const r=await n.getMarketStatus({universe:"CN_EQ",as_of:(new Date).toISOString().split("T")[0]});if(t.report({increment:50}),!r.ok||!r.data)return void i.window.showErrorMessage(`è·å–å¸‚åœºçŠ¶æ€å¤±è´¥: ${r.error||"æœªçŸ¥é”™è¯¯"}`);const s=r.data;d.logger.info(`å¸‚åœºçŠ¶æ€: ${s.regime}`,l),t.report({message:"æ¸²æŸ“ç»“æœ...",increment:30}),function(n,e){const t=i.window.createWebviewPanel("trquantMarketStatus","ğŸ“Š å¸‚åœºçŠ¶æ€",i.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0});t.webview.html=function(n){const e=p(n.regime),t=function(n){const e={SH000300:"æ²ªæ·±300",SZ399006:"åˆ›ä¸šæ¿æŒ‡",SH000016:"ä¸Šè¯50",SZ399905:"ä¸­è¯500"};return Object.entries(n).map(([n,t])=>{const a=e[n]||n,r="up"===t.trend?"â†‘":"down"===t.trend?"â†“":"â†’";return`\n                <div class="trend-item">\n                    <span class="trend-name">${a}</span>\n                    <div class="trend-value">\n                        <span class="trend-direction ${t.zscore>0?"positive":t.zscore<0?"negative":"neutral"}">${r}</span>\n                        <span class="zscore">(${t.zscore>=0?"+":""}${t.zscore.toFixed(2)})</span>\n                    </div>\n                </div>\n            `}).join("")}(n.index_trend),a=function(n){const e={growth:"æˆé•¿",value:"ä»·å€¼",momentum:"åŠ¨é‡",quality:"è´¨é‡",size:"å¸‚å€¼"};return n.map(n=>`\n                <div class="style-item">\n                    <span class="style-name">${e[n.style]||n.style}</span>\n                    <span class="style-score ${n.score>0?"positive":n.score<0?"negative":"neutral"}">${n.score>0?"+":""}${n.score.toFixed(2)}</span>\n                </div>\n            `).join("")}(n.style_rotation);return`<!DOCTYPE html>\n<html lang="zh">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>å¸‚åœºçŠ¶æ€</title>\n    <style>\n        :root {\n            --bg-primary: #1a1a2e;\n            --bg-secondary: #252540;\n            --bg-tertiary: #2d2d4a;\n            --text-primary: #ffffff;\n            --text-secondary: #9ca3af;\n            --text-muted: #6b7280;\n            --primary: #667eea;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --border: #3d3d5c;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n            line-height: 1.6;\n        }\n\n        .header {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border);\n        }\n\n        .header-icon { font-size: 36px; }\n\n        .header-content { flex: 1; }\n\n        .header-title {\n            font-size: 24px;\n            font-weight: 600;\n            margin-bottom: 4px;\n        }\n\n        .header-subtitle {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .regime-badge {\n            background: ${e.color};\n            color: white;\n            padding: 8px 20px;\n            border-radius: 24px;\n            font-weight: 600;\n            font-size: 14px;\n            text-transform: uppercase;\n        }\n\n        .card {\n            background: var(--bg-secondary);\n            border-radius: 16px;\n            padding: 20px;\n            margin-bottom: 16px;\n            border: 1px solid var(--border);\n        }\n\n        .card-title {\n            font-size: 14px;\n            color: var(--text-secondary);\n            margin-bottom: 16px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .card-title::before {\n            content: '';\n            width: 4px;\n            height: 16px;\n            background: var(--primary);\n            border-radius: 2px;\n        }\n\n        .trend-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 12px;\n        }\n\n        .trend-item {\n            background: var(--bg-tertiary);\n            border-radius: 12px;\n            padding: 16px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n\n        .trend-name {\n            font-weight: 500;\n            font-size: 14px;\n        }\n\n        .trend-value {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .trend-direction {\n            font-size: 18px;\n        }\n\n        .zscore {\n            font-size: 13px;\n            color: var(--text-secondary);\n        }\n\n        .positive { color: var(--success); }\n        .negative { color: var(--danger); }\n        .neutral { color: var(--warning); }\n\n        .style-list {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 12px;\n        }\n\n        .style-item {\n            background: var(--bg-tertiary);\n            border-radius: 12px;\n            padding: 12px 20px;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            flex: 1;\n            min-width: 150px;\n        }\n\n        .style-name { font-weight: 500; }\n\n        .style-score {\n            margin-left: auto;\n            font-weight: 600;\n            font-size: 18px;\n        }\n\n        .summary-card {\n            background: linear-gradient(135deg, ${e.color}22, ${e.color}11);\n            border-left: 4px solid ${e.color};\n        }\n\n        .summary-text {\n            color: var(--text-primary);\n            font-size: 15px;\n            line-height: 1.8;\n        }\n\n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 24px;\n        }\n\n        .btn {\n            padding: 12px 24px;\n            border-radius: 10px;\n            border: none;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s;\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n        }\n\n        .btn-primary:hover {\n            background: #5a6fd6;\n        }\n\n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n        }\n\n        .btn-secondary:hover {\n            background: #3d3d5c;\n        }\n\n        .timestamp {\n            text-align: center;\n            color: var(--text-muted);\n            font-size: 12px;\n            margin-top: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <span class="header-icon">${e.icon}</span>\n        <div class="header-content">\n            <div class="header-title">Aè‚¡å¸‚åœºçŠ¶æ€</div>\n            <div class="header-subtitle">åŸºäºå¤šç»´åº¦æŒ‡æ ‡ç»¼åˆåˆ†æ</div>\n        </div>\n        <span class="regime-badge">${n.regime}</span>\n    </div>\n\n    <div class="card summary-card">\n        <div class="card-title">åˆ†æç»“è®º</div>\n        <div class="summary-text">${n.summary||e.description}</div>\n    </div>\n\n    <div class="card">\n        <div class="card-title">æŒ‡æ•°è¶‹åŠ¿</div>\n        <div class="trend-grid">\n            ${t}\n        </div>\n    </div>\n\n    <div class="card">\n        <div class="card-title">é£æ ¼è½®åŠ¨</div>\n        <div class="style-list">\n            ${a}\n        </div>\n    </div>\n\n    <div class="actions">\n        <button class="btn btn-primary" onclick="copyPrompt()">\n            ğŸ“‹ å¤åˆ¶ä¸ºAI Prompt\n        </button>\n        <button class="btn btn-secondary" onclick="refresh()">\n            ğŸ”„ åˆ·æ–°æ•°æ®\n        </button>\n    </div>\n\n    <div class="timestamp">\n        æ›´æ–°æ—¶é—´: ${(new Date).toLocaleString("zh-CN")}\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        function copyPrompt() {\n            vscode.postMessage({ command: 'copyPrompt' });\n        }\n        \n        function refresh() {\n            vscode.postMessage({ command: 'refresh' });\n        }\n    <\/script>\n</body>\n</html>`}(e),t.webview.onDidReceiveMessage(async n=>{switch(n.command){case"copyPrompt":const n=m(e);await i.env.clipboard.writeText(n),i.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿");break;case"refresh":i.commands.executeCommand("trquant.getMarketStatus"),t.dispose()}},void 0,n.subscriptions)}(e,s),t.report({increment:20}),async function(n){switch(await i.window.showInformationMessage(`å¸‚åœºçŠ¶æ€: ${n.regime.toUpperCase()}`,"å¤åˆ¶Prompt","ç”Ÿæˆç­–ç•¥","æŸ¥çœ‹ä¸»çº¿")){case"å¤åˆ¶Prompt":const e=m(n);await i.env.clipboard.writeText(e),i.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿");break;case"ç”Ÿæˆç­–ç•¥":i.commands.executeCommand("trquant.generateStrategy");break;case"æŸ¥çœ‹ä¸»çº¿":i.commands.executeCommand("trquant.getMainlines")}}(s)}catch(n){c.ErrorHandler.handle(n,l)}})};const i=o(t(398)),d=t(628),c=t(799),l="GetMarketStatus";function p(n){const e={risk_on:{icon:"ğŸ“ˆ",color:"#10b981",description:"å½“å‰å¸‚åœºé£é™©åå¥½ä¸Šå‡ï¼Œé€‚åˆç§¯æé…ç½®æˆé•¿è‚¡å’Œé«˜Betaèµ„äº§ã€‚å»ºè®®å…³æ³¨ç§‘æŠ€ã€æ–°èƒ½æºç­‰é«˜æˆé•¿æ¿å—ã€‚"},risk_off:{icon:"ğŸ“‰",color:"#ef4444",description:"å½“å‰å¸‚åœºé£é™©åå¥½ä¸‹é™ï¼Œå»ºè®®é˜²å¾¡æ€§é…ç½®ã€‚å¯å…³æ³¨é«˜åˆ†çº¢ã€ä½æ³¢åŠ¨çš„ä»·å€¼è‚¡ï¼Œé€‚å½“é™ä½ä»“ä½ã€‚"},neutral:{icon:"â¡ï¸",color:"#f59e0b",description:"å½“å‰å¸‚åœºå¤„äºéœ‡è¡æ ¼å±€ï¼Œå»ºè®®å‡è¡¡é…ç½®ã€‚å¯é‡‡ç”¨å¸‚åœºä¸­æ€§ç­–ç•¥ï¼Œæ§åˆ¶é£é™©æ•å£ã€‚"}};return e[n]||e.neutral}function m(n){const e=p(n.regime);return`# Aè‚¡å¸‚åœºçŠ¶æ€åˆ†æ\n\n## å¸‚åœºRegime: ${n.regime.toUpperCase()}\n${e.description}\n\n## æŒ‡æ•°è¶‹åŠ¿\n${Object.entries(n.index_trend).map(([n,e])=>`- ${n}: ${e.trend} (åŠ¨é‡: ${e.zscore>=0?"+":""}${e.zscore.toFixed(2)})`).join("\n")}\n\n## é£æ ¼è½®åŠ¨\n${n.style_rotation.map(n=>`- ${n.style}: ${n.score>0?"å ä¼˜":"å¼±åŠ¿"} (${n.score>=0?"+":""}${n.score.toFixed(2)})`).join("\n")}\n\n## åˆ†ææ€»ç»“\n${n.summary||e.description}\n\n---\nè¯·åŸºäºä»¥ä¸Šå¸‚åœºçŠ¶æ€ï¼Œå¸®æˆ‘ç”Ÿæˆé€‚åˆå½“å‰å¸‚åœºç¯å¢ƒçš„PTradeé‡åŒ–ç­–ç•¥ä»£ç ã€‚è¦æ±‚ï¼š\n1. æ ¹æ®å¸‚åœºRegimeé€‰æ‹©åˆé€‚çš„ç­–ç•¥é£æ ¼\n2. åŒ…å«å®Œæ•´çš„é£æ§é€»è¾‘ï¼ˆæ­¢æŸ8%ï¼Œæ­¢ç›ˆ20%ï¼‰\n3. å•ç¥¨æœ€å¤§ä»“ä½10%\n4. æ·»åŠ è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š\n`}},570:(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.registerStrategyDiagnosticProvider=function(n){}},628:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.logger=e.Logger=e.LogLevel=void 0;const i=o(t(398));var d;!function(n){n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.WARN=2]="WARN",n[n.ERROR=3]="ERROR"}(d||(e.LogLevel=d={}));class c{static instance;outputChannel;minLevel=d.INFO;logs=[];maxLogs=1e3;constructor(){this.outputChannel=i.window.createOutputChannel("TRQuant")}static getInstance(){return c.instance||(c.instance=new c),c.instance}setLevel(n){this.minLevel=n}show(){this.outputChannel.show()}debug(n,e,t){this.log(d.DEBUG,n,e,t)}info(n,e,t){this.log(d.INFO,n,e,t)}warn(n,e,t){this.log(d.WARN,n,e,t)}error(n,e,t){this.log(d.ERROR,n,e,t)}log(n,e,t,a){if(n<this.minLevel)return;const r={level:n,message:e,timestamp:new Date,module:t,data:a};this.logs.push(r),this.logs.length>this.maxLogs&&this.logs.shift();const s=d[n].padEnd(5),o=`${r.timestamp.toISOString().substring(11,23)} ${s} ${t?`[${t}]`:""} ${e}${a?` | ${JSON.stringify(a)}`:""}`;this.outputChannel.appendLine(o),n===d.ERROR&&i.window.showErrorMessage(`TRQuant: ${e}`)}getRecentLogs(n=100){return this.logs.slice(-n)}clear(){this.logs=[],this.outputChannel.clear()}dispose(){this.outputChannel.dispose()}}e.Logger=c,e.logger=c.getInstance()},735:(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.registerStrategyCompletionProvider=function(n){}},799:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorHandler=e.ConfigError=e.DataError=e.PythonError=e.TRQuantError=e.ErrorCode=void 0;const i=o(t(398)),d=t(628);var c;!function(n){n[n.UNKNOWN=1e3]="UNKNOWN",n[n.TIMEOUT=1001]="TIMEOUT",n[n.CANCELLED=1002]="CANCELLED",n[n.PYTHON_NOT_FOUND=2e3]="PYTHON_NOT_FOUND",n[n.PYTHON_EXECUTION_ERROR=2001]="PYTHON_EXECUTION_ERROR",n[n.BRIDGE_CONNECTION_ERROR=2002]="BRIDGE_CONNECTION_ERROR",n[n.BRIDGE_RESPONSE_PARSE_ERROR=2003]="BRIDGE_RESPONSE_PARSE_ERROR",n[n.DATA_NOT_AVAILABLE=3e3]="DATA_NOT_AVAILABLE",n[n.DATA_PARSE_ERROR=3001]="DATA_PARSE_ERROR",n[n.DATA_VALIDATION_ERROR=3002]="DATA_VALIDATION_ERROR",n[n.CONFIG_INVALID=4e3]="CONFIG_INVALID",n[n.CONFIG_MISSING=4001]="CONFIG_MISSING",n[n.MCP_CONNECTION_ERROR=5e3]="MCP_CONNECTION_ERROR",n[n.MCP_TOOL_NOT_FOUND=5001]="MCP_TOOL_NOT_FOUND",n[n.MCP_EXECUTION_ERROR=5002]="MCP_EXECUTION_ERROR"}(c||(e.ErrorCode=c={}));class l extends Error{code;details;timestamp;constructor(n,e,t){super(e),this.name="TRQuantError",this.code=n,this.details=t,this.timestamp=new Date,Object.setPrototypeOf(this,l.prototype)}toUserMessage(){return{[c.UNKNOWN]:"å‘ç”ŸæœªçŸ¥é”™è¯¯",[c.TIMEOUT]:"æ“ä½œè¶…æ—¶ï¼Œè¯·é‡è¯•",[c.CANCELLED]:"æ“ä½œå·²å–æ¶ˆ",[c.PYTHON_NOT_FOUND]:"Pythonè§£é‡Šå™¨æœªæ‰¾åˆ°ï¼Œè¯·æ£€æŸ¥é…ç½®",[c.PYTHON_EXECUTION_ERROR]:"Pythonæ‰§è¡Œé”™è¯¯",[c.BRIDGE_CONNECTION_ERROR]:"æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡",[c.BRIDGE_RESPONSE_PARSE_ERROR]:"åç«¯å“åº”è§£æå¤±è´¥",[c.DATA_NOT_AVAILABLE]:"æ•°æ®ä¸å¯ç”¨",[c.DATA_PARSE_ERROR]:"æ•°æ®è§£æå¤±è´¥",[c.DATA_VALIDATION_ERROR]:"æ•°æ®éªŒè¯å¤±è´¥",[c.CONFIG_INVALID]:"é…ç½®æ— æ•ˆ",[c.CONFIG_MISSING]:"ç¼ºå°‘å¿…è¦é…ç½®",[c.MCP_CONNECTION_ERROR]:"MCPæœåŠ¡è¿æ¥å¤±è´¥",[c.MCP_TOOL_NOT_FOUND]:"MCPå·¥å…·æœªæ‰¾åˆ°",[c.MCP_EXECUTION_ERROR]:"MCPå·¥å…·æ‰§è¡Œå¤±è´¥"}[this.code]||this.message}toLogString(){return`[${c[this.code]}] ${this.message}${this.details?` | Details: ${JSON.stringify(this.details)}`:""}`}}e.TRQuantError=l,e.PythonError=class extends l{constructor(n,e){super(c.PYTHON_EXECUTION_ERROR,n,e),this.name="PythonError"}},e.DataError=class extends l{constructor(n,e,t){super(n,e,t),this.name="DataError"}},e.ConfigError=class extends l{constructor(n,e){super(c.CONFIG_INVALID,n,e),this.name="ConfigError"}};class p{static handle(n,e){const t=e||"ErrorHandler";n instanceof l?(d.logger.error(n.toLogString(),t),i.window.showErrorMessage(n.toUserMessage())):n instanceof Error?(d.logger.error(n.message,t,{stack:n.stack}),i.window.showErrorMessage(`TRQuant: ${n.message}`)):(d.logger.error(String(n),t),i.window.showErrorMessage("TRQuant: å‘ç”ŸæœªçŸ¥é”™è¯¯"))}static async wrap(n,e){try{return await n()}catch(n){return void p.handle(n,e)}}static async withRetry(n,e=3,t=1e3,a){let r;for(let s=0;s<e;s++)try{return await n()}catch(n){r=n,d.logger.warn(`æ“ä½œå¤±è´¥ï¼Œç¬¬${s+1}æ¬¡é‡è¯•...`,a,{error:n instanceof Error?n.message:String(n)}),s<e-1&&await new Promise(n=>setTimeout(n,t))}throw r}static validateRequired(n,e){const t=e.filter(e=>void 0===n[e]||null===n[e]);if(t.length>0)throw new l(c.DATA_VALIDATION_ERROR,`ç¼ºå°‘å¿…éœ€å‚æ•°: ${t.join(", ")}`,{missing:t,provided:Object.keys(n)})}}e.ErrorHandler=p},857:n=>{n.exports=require("os")},896:n=>{n.exports=require("fs")},898:(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.registerConfigCommands=function(n){}},900:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.analyzeBacktest=async function(n,e){i.window.showInformationMessage("å›æµ‹åˆ†æåŠŸèƒ½å¼€å‘ä¸­")};const i=o(t(398))},917:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.ReportPanel=void 0;const i=o(t(398)),d=t(628),c=t(290),l="ReportPanel",p=[{id:"backtest",name:"å›æµ‹æŠ¥å‘Š",icon:"ğŸ“Š",tool:"report.generate",description:"è¯¦ç»†çš„å›æµ‹ç»“æœåˆ†ææŠ¥å‘Š"},{id:"compare",name:"å¯¹æ¯”æŠ¥å‘Š",icon:"âš–ï¸",tool:"report.compare",description:"å¤šç­–ç•¥/å¤šå‚æ•°å¯¹æ¯”åˆ†æ"},{id:"diagnosis",name:"è¯Šæ–­æŠ¥å‘Š",icon:"ğŸ”",tool:"report.diagnosis",description:"ç­–ç•¥é—®é¢˜è¯Šæ–­å’Œä¼˜åŒ–å»ºè®®"}],m=[{id:"html",name:"HTML",icon:"ğŸŒ"},{id:"pdf",name:"PDF",icon:"ğŸ“„"},{id:"markdown",name:"Markdown",icon:"ğŸ“"}];class u{static currentPanel;_panel;_extensionUri;_client;_disposables=[];_backtestResult=null;_reports=[];constructor(n,e,t,a){this._panel=n,this._extensionUri=e,this._client=t,this._backtestResult=a?.result||null,this._panel.webview.html=this._getHtmlContent(),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.onDidReceiveMessage(n=>this._handleMessage(n),null,this._disposables),this._loadReports()}static createOrShow(n,e,t){d.logger.info("åˆ›å»ºæŠ¥å‘Šé¢æ¿V2",l);const a=i.ViewColumn.One;if(u.currentPanel)return u.currentPanel._panel.reveal(a),t?.result&&(u.currentPanel._backtestResult=t.result),u.currentPanel;const r=i.window.createWebviewPanel("trquantReportV2","ğŸ“„ æŠ¥å‘Šä¸­å¿ƒ",a,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[n]});return u.currentPanel=new u(r,n,e,t),u.currentPanel}dispose(){for(u.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const n=this._disposables.pop();n&&n.dispose()}}async _handleMessage(n){switch(d.logger.info(`[ReportPanel] æ”¶åˆ°æ¶ˆæ¯: ${n.command}`,l),n.command){case"generateReport":await this._generateReport(n.type,n.format,n.options);break;case"openReport":await this._openReport(n.reportId);break;case"deleteReport":await this._deleteReport(n.reportId);break;case"refreshReports":await this._loadReports()}}async _loadReports(){try{const n=await this._client.callBridge("call_mcp_tool",{tool_name:"report.list",arguments:{limit:20},trace_id:(0,c.generateTraceId)()});n.ok&&n.data&&(this._reports=n.data.reports||[],this._postMessage({command:"reportsLoaded",reports:this._reports}))}catch(n){d.logger.error(`åŠ è½½æŠ¥å‘Šåˆ—è¡¨å¤±è´¥: ${n.message}`,l)}}async _generateReport(n,e,t){const a=p.find(e=>e.id===n);if(a){this._postMessage({command:"generating"});try{const r={format:e,title:t.title||"éŸ¬ç¿é‡åŒ–æŠ¥å‘Š",strategy_name:t.strategyName||"ç­–ç•¥"};"backtest"===n?r.result=this._backtestResult||t.result:"compare"===n?r.results=t.results||[]:"diagnosis"===n&&(r.result=this._backtestResult||t.result),d.logger.info(`ç”ŸæˆæŠ¥å‘Š: ${a.tool}`,l);const s=await this._client.callBridge("call_mcp_tool",{tool_name:a.tool,arguments:r,trace_id:(0,c.generateTraceId)()});if(!s.ok||!s.data)throw new Error(s.error||"ç”Ÿæˆå¤±è´¥");this._postMessage({command:"generated",report:s.data}),i.window.showInformationMessage(`æŠ¥å‘Šå·²ç”Ÿæˆ: ${s.data.title}`,"æ‰“å¼€æŠ¥å‘Š").then(n=>{"æ‰“å¼€æŠ¥å‘Š"===n&&s.data.file_path&&i.env.openExternal(i.Uri.file(s.data.file_path))}),await this._loadReports()}catch(n){d.logger.error(`æŠ¥å‘Šç”Ÿæˆå¤±è´¥: ${n.message}`,l),this._postMessage({command:"error",message:n.message}),i.window.showErrorMessage(`æŠ¥å‘Šç”Ÿæˆå¤±è´¥: ${n.message}`)}}else i.window.showErrorMessage(`æœªçŸ¥æŠ¥å‘Šç±»å‹: ${n}`)}async _openReport(n){try{const e=await this._client.callBridge("call_mcp_tool",{tool_name:"report.get",arguments:{report_id:n},trace_id:(0,c.generateTraceId)()});e.ok&&e.data&&e.data.file_path&&i.env.openExternal(i.Uri.file(e.data.file_path))}catch(n){i.window.showErrorMessage(`æ‰“å¼€æŠ¥å‘Šå¤±è´¥: ${n.message}`)}}async _deleteReport(n){if("åˆ é™¤"===await i.window.showWarningMessage("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæŠ¥å‘Šå—ï¼Ÿ","åˆ é™¤","å–æ¶ˆ"))try{await this._client.callBridge("call_mcp_tool",{tool_name:"report.delete",arguments:{report_id:n},trace_id:(0,c.generateTraceId)()}),i.window.showInformationMessage("æŠ¥å‘Šå·²åˆ é™¤"),await this._loadReports()}catch(n){i.window.showErrorMessage(`åˆ é™¤å¤±è´¥: ${n.message}`)}}_postMessage(n){this._panel.webview.postMessage(n)}_getHtmlContent(){return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>æŠ¥å‘Šä¸­å¿ƒ</title>\n    <style>\n        :root {\n            --bg-primary: #0d1117;\n            --bg-secondary: #161b22;\n            --bg-tertiary: #21262d;\n            --text-primary: #f0f6fc;\n            --text-secondary: #8b949e;\n            --border-primary: #30363d;\n            --accent: #58a6ff;\n            --success: #3fb950;\n            --warning: #d29922;\n            --error: #f85149;\n        }\n        \n        * { box-sizing: border-box; margin: 0; padding: 0; }\n        \n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n        }\n        \n        .header h1 { font-size: 24px; margin-bottom: 8px; }\n        .header { margin-bottom: 24px; }\n        \n        .main-grid {\n            display: grid;\n            grid-template-columns: 350px 1fr;\n            gap: 24px;\n        }\n        \n        .generate-panel, .reports-panel {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-primary);\n            border-radius: 12px;\n            padding: 20px;\n        }\n        \n        .section-title {\n            font-size: 14px;\n            font-weight: 600;\n            color: var(--text-secondary);\n            margin-bottom: 12px;\n        }\n        \n        .types-list {\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n            margin-bottom: 24px;\n        }\n        \n        .type-card {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            padding: 12px;\n            background: var(--bg-tertiary);\n            border: 2px solid transparent;\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n        \n        .type-card:hover,\n        .type-card.selected {\n            border-color: var(--accent);\n        }\n        \n        .type-icon { font-size: 24px; }\n        .type-name { font-weight: 600; }\n        .type-desc { font-size: 12px; color: var(--text-secondary); }\n        \n        .formats-list {\n            display: flex;\n            gap: 8px;\n            margin-bottom: 24px;\n        }\n        \n        .format-option {\n            cursor: pointer;\n        }\n        \n        .format-option input {\n            display: none;\n        }\n        \n        .format-label {\n            display: inline-block;\n            padding: 8px 16px;\n            background: var(--bg-tertiary);\n            border: 2px solid transparent;\n            border-radius: 6px;\n            transition: all 0.2s;\n        }\n        \n        .format-option input:checked + .format-label {\n            border-color: var(--accent);\n            background: rgba(88, 166, 255, 0.1);\n        }\n        \n        .form-group {\n            margin-bottom: 16px;\n        }\n        \n        .form-group label {\n            display: block;\n            font-size: 12px;\n            color: var(--text-secondary);\n            margin-bottom: 4px;\n        }\n        \n        .form-group input {\n            width: 100%;\n            padding: 8px 12px;\n            background: var(--bg-tertiary);\n            border: 1px solid var(--border-primary);\n            border-radius: 6px;\n            color: var(--text-primary);\n        }\n        \n        .btn {\n            width: 100%;\n            padding: 12px;\n            border: none;\n            border-radius: 8px;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 600;\n            transition: all 0.2s;\n        }\n        \n        .btn-primary {\n            background: var(--accent);\n            color: white;\n        }\n        \n        .btn-primary:hover { opacity: 0.9; }\n        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }\n        \n        .reports-list {\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n        }\n        \n        .report-card {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            padding: 16px;\n            background: var(--bg-tertiary);\n            border-radius: 8px;\n            transition: all 0.2s;\n        }\n        \n        .report-card:hover {\n            background: rgba(88, 166, 255, 0.1);\n        }\n        \n        .report-icon {\n            font-size: 28px;\n        }\n        \n        .report-info {\n            flex: 1;\n        }\n        \n        .report-title {\n            font-weight: 600;\n            margin-bottom: 4px;\n        }\n        \n        .report-meta {\n            font-size: 12px;\n            color: var(--text-secondary);\n        }\n        \n        .report-actions {\n            display: flex;\n            gap: 8px;\n        }\n        \n        .btn-small {\n            padding: 6px 12px;\n            font-size: 12px;\n            border-radius: 4px;\n            background: var(--bg-secondary);\n            color: var(--text-primary);\n            border: 1px solid var(--border-primary);\n        }\n        \n        .btn-small:hover {\n            background: var(--accent);\n            border-color: var(--accent);\n        }\n        \n        .btn-danger:hover {\n            background: var(--error);\n            border-color: var(--error);\n        }\n        \n        .placeholder {\n            text-align: center;\n            padding: 40px;\n            color: var(--text-secondary);\n        }\n        \n        .loading {\n            text-align: center;\n            padding: 20px;\n            color: var(--accent);\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <h1>ğŸ“„ æŠ¥å‘Šä¸­å¿ƒ</h1>\n        <p style="color: var(--text-secondary);">ç”Ÿæˆå’Œç®¡ç†æŠ•èµ„ç ”ç©¶æŠ¥å‘Š</p>\n    </div>\n    \n    <div class="main-grid">\n        <div class="generate-panel">\n            <div class="section-title">ğŸ“‹ æŠ¥å‘Šç±»å‹</div>\n            <div class="types-list">\n                ${p.map(n=>`\n            <div class="type-card" data-type="${n.id}" onclick="selectType('${n.id}')">\n                <span class="type-icon">${n.icon}</span>\n                <div class="type-info">\n                    <div class="type-name">${n.name}</div>\n                    <div class="type-desc">${n.description}</div>\n                </div>\n            </div>\n        `).join("")}\n            </div>\n            \n            <div class="section-title">ğŸ“ è¾“å‡ºæ ¼å¼</div>\n            <div class="formats-list">\n                ${m.map(n=>`\n            <label class="format-option">\n                <input type="radio" name="format" value="${n.id}" ${"html"===n.id?"checked":""}>\n                <span class="format-label">${n.icon} ${n.name}</span>\n            </label>\n        `).join("")}\n            </div>\n            \n            <div class="form-group">\n                <label>æŠ¥å‘Šæ ‡é¢˜</label>\n                <input type="text" id="report-title" value="éŸ¬ç¿é‡åŒ–ç ”ç©¶æŠ¥å‘Š">\n            </div>\n            \n            <div class="form-group">\n                <label>ç­–ç•¥åç§°</label>\n                <input type="text" id="strategy-name" value="åŠ¨é‡ç­–ç•¥">\n            </div>\n            \n            <button class="btn btn-primary" id="generate-btn" onclick="generateReport()">\n                ğŸš€ ç”ŸæˆæŠ¥å‘Š\n            </button>\n        </div>\n        \n        <div class="reports-panel">\n            <div class="section-title">ğŸ“š å†å²æŠ¥å‘Š</div>\n            <div class="reports-list" id="reports-list">\n                <div class="placeholder">åŠ è½½ä¸­...</div>\n            </div>\n        </div>\n    </div>\n    \n    <script>\n        const vscode = acquireVsCodeApi();\n        let selectedType = 'backtest';\n        \n        function selectType(type) {\n            selectedType = type;\n            document.querySelectorAll('.type-card').forEach(card => {\n                card.classList.toggle('selected', card.dataset.type === type);\n            });\n        }\n        \n        function getSelectedFormat() {\n            const checked = document.querySelector('input[name="format"]:checked');\n            return checked ? checked.value : 'html';\n        }\n        \n        function generateReport() {\n            const btn = document.getElementById('generate-btn');\n            btn.disabled = true;\n            btn.textContent = 'ç”Ÿæˆä¸­...';\n            \n            vscode.postMessage({\n                command: 'generateReport',\n                type: selectedType,\n                format: getSelectedFormat(),\n                options: {\n                    title: document.getElementById('report-title').value,\n                    strategyName: document.getElementById('strategy-name').value\n                }\n            });\n        }\n        \n        function openReport(reportId) {\n            vscode.postMessage({ command: 'openReport', reportId });\n        }\n        \n        function deleteReport(reportId) {\n            vscode.postMessage({ command: 'deleteReport', reportId });\n        }\n        \n        function renderReports(reports) {\n            const list = document.getElementById('reports-list');\n            \n            if (!reports || reports.length === 0) {\n                list.innerHTML = '<div class="placeholder">æš‚æ— æŠ¥å‘Š</div>';\n                return;\n            }\n            \n            list.innerHTML = reports.map(r => \`\n                <div class="report-card">\n                    <span class="report-icon">\n                        \${r.format === 'html' ? 'ğŸŒ' : r.format === 'pdf' ? 'ğŸ“„' : 'ğŸ“'}\n                    </span>\n                    <div class="report-info">\n                        <div class="report-title">\${r.title || 'æŠ¥å‘Š'}</div>\n                        <div class="report-meta">\n                            \${r.type || 'backtest'} Â· \${r.format || 'html'} Â· \${new Date(r.created_at).toLocaleDateString()}\n                        </div>\n                    </div>\n                    <div class="report-actions">\n                        <button class="btn-small" onclick="openReport('\${r.report_id}')">æ‰“å¼€</button>\n                        <button class="btn-small btn-danger" onclick="deleteReport('\${r.report_id}')">åˆ é™¤</button>\n                    </div>\n                </div>\n            \`).join('');\n        }\n        \n        // åˆå§‹åŒ–é€‰ä¸­\n        selectType('backtest');\n        \n        window.addEventListener('message', event => {\n            const message = event.data;\n            const btn = document.getElementById('generate-btn');\n            \n            switch (message.command) {\n                case 'reportsLoaded':\n                    renderReports(message.reports);\n                    break;\n                    \n                case 'generating':\n                    // å·²åœ¨æŒ‰é’®ä¸Šå¤„ç†\n                    break;\n                    \n                case 'generated':\n                    btn.disabled = false;\n                    btn.textContent = 'ğŸš€ ç”ŸæˆæŠ¥å‘Š';\n                    break;\n                    \n                case 'error':\n                    btn.disabled = false;\n                    btn.textContent = 'ğŸš€ ç”ŸæˆæŠ¥å‘Š';\n                    break;\n            }\n        });\n    <\/script>\n</body>\n</html>`}}e.ReportPanel=u},928:n=>{n.exports=require("path")},939:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),o=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),o=0;o<t.length;o++)"default"!==t[o]&&r(e,n,t[o]);return s(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.ReportPanel=e.OptimizerPanel=e.BacktestPanel=e.StrategyGeneratorPanel=e.WorkflowPanel=void 0,e.registerPanels=function(n,e){n.subscriptions.push(i.commands.registerCommand("trquant.openWorkflowPanel",()=>{d.WorkflowPanel.createOrShow(n.extensionUri,n.extensionPath)})),n.subscriptions.push(i.commands.registerCommand("trquant.openStrategyGenerator",()=>{c.StrategyGeneratorPanel.createOrShow(n.extensionUri,e)})),n.subscriptions.push(i.commands.registerCommand("trquant.openBacktestPanel",()=>{l.BacktestPanel.createOrShow(n.extensionUri,e)})),n.subscriptions.push(i.commands.registerCommand("trquant.openOptimizerPanel",()=>{p.OptimizerPanel.createOrShow(n.extensionUri,e)})),n.subscriptions.push(i.commands.registerCommand("trquant.openReportPanel",()=>{m.ReportPanel.createOrShow(n.extensionUri,e)}))};const i=o(t(398)),d=t(360);Object.defineProperty(e,"WorkflowPanel",{enumerable:!0,get:function(){return d.WorkflowPanel}});const c=t(133);Object.defineProperty(e,"StrategyGeneratorPanel",{enumerable:!0,get:function(){return c.StrategyGeneratorPanel}});const l=t(482);Object.defineProperty(e,"BacktestPanel",{enumerable:!0,get:function(){return l.BacktestPanel}});const p=t(82);Object.defineProperty(e,"OptimizerPanel",{enumerable:!0,get:function(){return p.OptimizerPanel}});const m=t(917);Object.defineProperty(e,"ReportPanel",{enumerable:!0,get:function(){return m.ReportPanel}})}},e={},t=function t(a){var r=e[a];if(void 0!==r)return r.exports;var s=e[a]={exports:{}};return n[a].call(s.exports,s,s.exports,t),s.exports}(265);module.exports=t})();
//# sourceMappingURL=extension.js.map