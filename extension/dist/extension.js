(()=>{"use strict";var n={3:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.TRQuantClient=void 0;const o=s(t(317)),c=s(t(928)),d=t(628),l=t(478),p=t(799);e.TRQuantClient=class{MODULE="TRQuantClient";extensionPath;configManager;constructor(n){this.extensionPath=n.extensionPath,this.configManager=l.ConfigManager.getInstance(),d.logger.info("TRQuantClientåˆå§‹åŒ–å®Œæˆ",this.MODULE)}async getMarketStatus(n){return this.callBridge("get_market_status",{universe:n?.universe||"CN_EQ",as_of:n?.as_of||this.getTodayDate(),lookback_days:n?.lookback_days||60})}async getMainlines(n){return this.callBridge("get_mainlines",{top_n:n?.top_n||20,time_horizon:n?.time_horizon||"short"})}async recommendFactors(n){return this.callBridge("recommend_factors",{market_regime:n?.market_regime,mainlines:n?.mainlines,top_n:n?.top_n||10})}async generateStrategy(n){p.ErrorHandler.validateRequired(n,["factors"]);const e={max_position:n.risk_params?.max_position||this.configManager.get("defaultRiskParams").maxPosition,stop_loss:n.risk_params?.stop_loss||this.configManager.get("defaultRiskParams").stopLoss,take_profit:n.risk_params?.take_profit||this.configManager.get("defaultRiskParams").takeProfit};return this.callBridge("generate_strategy",{factors:n.factors,style:n.style||this.configManager.get("defaultStyle"),platform:n.platform||this.configManager.get("defaultPlatform"),risk_params:e})}async analyzeBacktest(n){return this.callBridge("analyze_backtest",n)}async runBacktest(n){return p.ErrorHandler.validateRequired(n,["strategy_code","config"]),this.callBridge("run_backtest",{strategy_code:n.strategy_code,config:n.config,data_source:n.data_source||"akshare"})}async assessRisk(n){return p.ErrorHandler.validateRequired(n,["portfolio"]),this.callBridge("risk_assessment",n)}async healthCheck(){try{return(await this.callBridge("health_check",{})).ok}catch{return!1}}async callBridge(n,e){const t=Date.now();d.logger.debug(`è°ƒç”¨Bridge: ${n}`,this.MODULE,{params:e});try{const a=await this.executeSubprocess(n,e),r=Date.now()-t;return d.logger.info(`Bridgeè°ƒç”¨å®Œæˆ: ${n}`,this.MODULE,{duration:`${r}ms`,ok:a.ok}),a}catch(e){const a=Date.now()-t;throw d.logger.error(`Bridgeè°ƒç”¨å¤±è´¥: ${n}`,this.MODULE,{duration:`${a}ms`,error:e instanceof Error?e.message:String(e)}),e}}executeSubprocess(n,e){return new Promise((t,a)=>{const r=this.configManager.getPythonPath(this.extensionPath),i=c.join(this.extensionPath,"python","bridge.py"),s=this.configManager.get("timeout"),l={action:n,params:e},g=JSON.stringify(l);d.logger.debug(`æ‰§è¡ŒPython: ${r}`,this.MODULE,{bridgePath:i});const m={...process.env,PYTHONIOENCODING:"utf-8",TRQUANT_ROOT:c.dirname(this.extensionPath),PYTHONPATH:c.join(this.extensionPath,"python")},u=o.spawn(r,[i],{cwd:c.join(this.extensionPath,"python"),env:m,stdio:["pipe","pipe","pipe"]});let h="",v="";u.stdout?.on("data",n=>{h+=n.toString()}),u.stderr?.on("data",n=>{v+=n.toString()});const f=setTimeout(()=>{u.kill("SIGTERM"),a(new p.TRQuantError(p.ErrorCode.TIMEOUT,`æ“ä½œè¶…æ—¶ (${s}ms)`,{action:n}))},s);u.on("close",e=>{if(clearTimeout(f),0!==e)return d.logger.error(`Pythonè¿›ç¨‹é€€å‡º: ${e}`,this.MODULE,{stderr:v}),void a(new p.PythonError(v||`è¿›ç¨‹é€€å‡ºç : ${e}`,{action:n,code:e,stderr:v}));try{const n=JSON.parse(h.trim());t(n)}catch(n){d.logger.error("å“åº”è§£æå¤±è´¥",this.MODULE,{stdout:h}),a(new p.TRQuantError(p.ErrorCode.BRIDGE_RESPONSE_PARSE_ERROR,"æ— æ³•è§£æåç«¯å“åº”",{stdout:h,parseError:n instanceof Error?n.message:String(n)}))}}),u.on("error",n=>{clearTimeout(f),d.logger.error("è¿›ç¨‹å¯åŠ¨å¤±è´¥",this.MODULE,{error:n.message}),n.message.includes("ENOENT")?a(new p.TRQuantError(p.ErrorCode.PYTHON_NOT_FOUND,`Pythonè§£é‡Šå™¨æœªæ‰¾åˆ°: ${r}`,{pythonPath:r})):a(new p.PythonError(n.message,{error:n}))}),u.stdin?.write(g),u.stdin?.end()})}getTodayDate(){return(new Date).toISOString().split("T")[0]}dispose(){d.logger.info("TRQuantClientå·²é‡Šæ”¾",this.MODULE)}}},46:(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createStrategyLearner=function(n){return{learnFromDocuments:async()=>({learned:0,patterns:[],practices:[]}),learnFromHistory:async()=>({analyzed:0,successPatterns:[],failurePatterns:[]}),recordFeedback:()=>{},recommendPatterns:()=>[],recommendBestPractices:()=>[],getStats:()=>({patterns:0,apiMappings:0,bestPractices:0,feedback:{total:0,resolved:0,pending:0},documents:0,strategies:0}),save:async()=>{}}}},56:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.BacktestConfigPanel=void 0,e.showBacktestConfigPanel=function(n,e,t){g.createOrShow(n,e)};const o=s(t(398)),c=s(t(896)),d=s(t(928)),l=t(628),p="BacktestConfigPanel";class g{static currentPanel;_panel;_extensionUri;_client;_disposables=[];_isRunning=!1;constructor(n,e,t){this._panel=n,this._extensionUri=e,this._client=t,this._panel.webview.onDidReceiveMessage(n=>this.handleMessage(n),null,this._disposables),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this.updateContent()}static createOrShow(n,e){const t=o.ViewColumn.One;if(g.currentPanel)return g.currentPanel._panel.reveal(t),g.currentPanel;const a=o.window.createWebviewPanel("backtestConfig","ğŸ§ª å›æµ‹é…ç½®",t,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[n]});return g.currentPanel=new g(a,n,e),g.currentPanel}async handleMessage(n){switch(n.command){case"loadStrategyFile":await this.loadStrategyFile();break;case"runBacktest":n.config&&n.strategyCode&&await this.runBacktest(n.config,n.strategyCode);break;case"saveConfig":n.config&&await this.saveConfig(n.config);break;case"loadConfig":await this.loadConfig()}}async loadStrategyFile(){const n=await o.window.showOpenDialog({canSelectFiles:!0,canSelectFolders:!1,canSelectMany:!1,filters:{Pythonæ–‡ä»¶:["py"],æ‰€æœ‰æ–‡ä»¶:["*"]}});if(n&&n[0])try{const e=c.readFileSync(n[0].fsPath,"utf-8");this._panel.webview.postMessage({command:"strategyLoaded",code:e,fileName:d.basename(n[0].fsPath)})}catch(n){o.window.showErrorMessage(`è¯»å–ç­–ç•¥æ–‡ä»¶å¤±è´¥: ${n}`)}}async runBacktest(n,e){if(this._isRunning)o.window.showWarningMessage("å›æµ‹æ­£åœ¨è¿è¡Œä¸­ï¼Œè¯·ç¨å€™...");else if(e&&0!==e.trim().length){this._isRunning=!0,this._panel.webview.postMessage({command:"backtestRunning",running:!0});try{l.logger.info("å¼€å§‹è¿è¡Œå›æµ‹",p,{config:n});const t=await this._client.runBacktest({strategy_code:e,config:n,data_source:"akshare"});if(this._isRunning=!1,this._panel.webview.postMessage({command:"backtestRunning",running:!1}),t.ok&&t.data)this._panel.webview.postMessage({command:"backtestResult",result:t.data}),o.window.showInformationMessage("âœ… å›æµ‹å®Œæˆï¼");else{const n=t.error||"å›æµ‹æ‰§è¡Œå¤±è´¥";this._panel.webview.postMessage({command:"backtestError",error:n}),o.window.showErrorMessage(`å›æµ‹å¤±è´¥: ${n}`)}}catch(n){this._isRunning=!1,this._panel.webview.postMessage({command:"backtestRunning",running:!1});const e=n instanceof Error?n.message:String(n);this._panel.webview.postMessage({command:"backtestError",error:e}),l.logger.error(`å›æµ‹æ‰§è¡Œå¤±è´¥: ${e}`,p),o.window.showErrorMessage(`å›æµ‹å¤±è´¥: ${e}`)}}else o.window.showErrorMessage("è¯·å…ˆåŠ è½½æˆ–è¾“å…¥ç­–ç•¥ä»£ç ")}async saveConfig(n){const e=o.workspace.workspaceFolders;if(!e||0===e.length)return void o.window.showWarningMessage("è¯·å…ˆæ‰“å¼€ä¸€ä¸ªå·¥ä½œåŒº");const t=d.join(e[0].uri.fsPath,"backtest_config.json");try{c.writeFileSync(t,JSON.stringify(n,null,2),"utf-8"),o.window.showInformationMessage(`é…ç½®å·²ä¿å­˜åˆ°: ${t}`)}catch(n){o.window.showErrorMessage(`ä¿å­˜é…ç½®å¤±è´¥: ${n}`)}}async loadConfig(){const n=o.workspace.workspaceFolders;if(!n||0===n.length)return void o.window.showWarningMessage("è¯·å…ˆæ‰“å¼€ä¸€ä¸ªå·¥ä½œåŒº");const e=d.join(n[0].uri.fsPath,"backtest_config.json");if(c.existsSync(e))try{const n=JSON.parse(c.readFileSync(e,"utf-8"));this._panel.webview.postMessage({command:"configLoaded",config:n})}catch(n){o.window.showErrorMessage(`åŠ è½½é…ç½®å¤±è´¥: ${n}`)}else o.window.showWarningMessage("æœªæ‰¾åˆ°é…ç½®æ–‡ä»¶")}updateContent(){this._panel.webview.html=this.getHtmlContent()}getHtmlContent(){return'<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>å›æµ‹é…ç½®</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: \'Segoe UI\', \'Microsoft YaHei\', sans-serif;\n            background: var(--vscode-editor-background);\n            color: var(--vscode-editor-foreground);\n            padding: 20px;\n            line-height: 1.6;\n        }\n        \n        .container {\n            max-width: 1200px;\n            margin: 0 auto;\n        }\n        \n        h1 {\n            color: var(--vscode-textLink-foreground);\n            margin-bottom: 20px;\n            font-size: 24px;\n        }\n        \n        .section {\n            background: var(--vscode-editor-background);\n            border: 1px solid var(--vscode-panel-border);\n            border-radius: 6px;\n            padding: 20px;\n            margin-bottom: 20px;\n        }\n        \n        .section-title {\n            font-size: 18px;\n            font-weight: 600;\n            margin-bottom: 15px;\n            color: var(--vscode-textLink-foreground);\n        }\n        \n        .form-group {\n            margin-bottom: 15px;\n        }\n        \n        label {\n            display: block;\n            margin-bottom: 5px;\n            font-weight: 500;\n            color: var(--vscode-descriptionForeground);\n        }\n        \n        input, select, textarea {\n            width: 100%;\n            padding: 8px 12px;\n            background: var(--vscode-input-background);\n            color: var(--vscode-input-foreground);\n            border: 1px solid var(--vscode-input-border);\n            border-radius: 4px;\n            font-size: 14px;\n            font-family: inherit;\n        }\n        \n        input:focus, select:focus, textarea:focus {\n            outline: none;\n            border-color: var(--vscode-focusBorder);\n        }\n        \n        textarea {\n            min-height: 200px;\n            font-family: \'Consolas\', \'Monaco\', monospace;\n            resize: vertical;\n        }\n        \n        .form-row {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 15px;\n        }\n        \n        .btn {\n            padding: 10px 20px;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            transition: all 0.2s;\n        }\n        \n        .btn-primary {\n            background: var(--vscode-button-background);\n            color: var(--vscode-button-foreground);\n        }\n        \n        .btn-primary:hover {\n            background: var(--vscode-button-hoverBackground);\n        }\n        \n        .btn-secondary {\n            background: var(--vscode-button-secondaryBackground);\n            color: var(--vscode-button-secondaryForeground);\n        }\n        \n        .btn-secondary:hover {\n            background: var(--vscode-button-secondaryHoverBackground);\n        }\n        \n        .btn:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n        }\n        \n        .button-group {\n            display: flex;\n            gap: 10px;\n            margin-top: 20px;\n        }\n        \n        .status {\n            padding: 10px;\n            border-radius: 4px;\n            margin-bottom: 15px;\n            display: none;\n        }\n        \n        .status.success {\n            background: var(--vscode-testing-iconPassed);\n            color: white;\n        }\n        \n        .status.error {\n            background: var(--vscode-testing-iconFailed);\n            color: white;\n        }\n        \n        .status.info {\n            background: var(--vscode-notificationsInfoIcon-foreground);\n            color: white;\n        }\n        \n        .result-section {\n            margin-top: 20px;\n        }\n        \n        .result-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-top: 15px;\n        }\n        \n        .result-table th,\n        .result-table td {\n            padding: 10px;\n            text-align: left;\n            border-bottom: 1px solid var(--vscode-panel-border);\n        }\n        \n        .result-table th {\n            background: var(--vscode-editor-lineHighlightBackground);\n            font-weight: 600;\n        }\n        \n        .loading {\n            display: inline-block;\n            width: 16px;\n            height: 16px;\n            border: 2px solid var(--vscode-progressBar-background);\n            border-top-color: transparent;\n            border-radius: 50%;\n            animation: spin 0.8s linear infinite;\n            margin-right: 8px;\n            vertical-align: middle;\n        }\n        \n        @keyframes spin {\n            to { transform: rotate(360deg); }\n        }\n    </style>\n</head>\n<body>\n    <div class="container">\n        <h1>ğŸ§ª å›æµ‹é…ç½®</h1>\n        \n        <div id="status" class="status"></div>\n        \n        \x3c!-- å›æµ‹å‚æ•°é…ç½® --\x3e\n        <div class="section">\n            <div class="section-title">ğŸ“Š å›æµ‹å‚æ•°</div>\n            <div class="form-row">\n                <div class="form-group">\n                    <label>å¼€å§‹æ—¥æœŸ</label>\n                    <input type="date" id="startDate" value="2023-01-01">\n                </div>\n                <div class="form-group">\n                    <label>ç»“æŸæ—¥æœŸ</label>\n                    <input type="date" id="endDate" value="2024-01-01">\n                </div>\n            </div>\n            <div class="form-row">\n                <div class="form-group">\n                    <label>åˆå§‹èµ„é‡‘ï¼ˆå…ƒï¼‰</label>\n                    <input type="number" id="initialCapital" value="1000000" min="10000" step="10000">\n                </div>\n                <div class="form-group">\n                    <label>åŸºå‡†æŒ‡æ•°</label>\n                    <select id="benchmark">\n                        <option value="000300.XSHG">æ²ªæ·±300 (000300.XSHG)</option>\n                        <option value="000905.XSHG">ä¸­è¯500 (000905.XSHG)</option>\n                        <option value="000001.XSHG">ä¸Šè¯æŒ‡æ•° (000001.XSHG)</option>\n                    </select>\n                </div>\n            </div>\n            <div class="form-row">\n                <div class="form-group">\n                    <label>æ‰‹ç»­è´¹ç‡</label>\n                    <input type="number" id="commission" value="0.0003" min="0" max="0.01" step="0.0001">\n                </div>\n                <div class="form-group">\n                    <label>æ»‘ç‚¹</label>\n                    <input type="number" id="slippage" value="0.002" min="0" max="0.01" step="0.0001">\n                </div>\n            </div>\n            <div class="form-row">\n                <div class="form-group">\n                    <label>æœ€å¤§ä»“ä½æ¯”ä¾‹</label>\n                    <input type="number" id="maxPosition" value="0.8" min="0" max="1" step="0.1">\n                </div>\n                <div class="form-group">\n                    <label>å•è‚¡æœ€å¤§ä»“ä½</label>\n                    <input type="number" id="singleStockMax" value="0.1" min="0" max="1" step="0.05">\n                </div>\n            </div>\n            <div class="form-row">\n                <div class="form-group">\n                    <label>æ­¢æŸçº¿</label>\n                    <input type="number" id="stopLoss" value="0.08" min="0" max="0.5" step="0.01">\n                </div>\n                <div class="form-group">\n                    <label>æ­¢ç›ˆçº¿</label>\n                    <input type="number" id="takeProfit" value="0.2" min="0" max="1" step="0.05">\n                </div>\n            </div>\n            <div class="form-group">\n                <label>æ•°æ®æº</label>\n                <select id="dataSource">\n                    <option value="akshare">AKShare (å…è´¹)</option>\n                    <option value="jqdata">JQData (éœ€è®¤è¯)</option>\n                </select>\n            </div>\n            <div class="form-group">\n                <label>è‚¡ç¥¨æ± ï¼ˆä»£ç ï¼Œç”¨é€—å·åˆ†éš”ï¼‰</label>\n                <input type="text" id="symbols" placeholder="ä¾‹å¦‚: 000001.XSHE,000002.XSHE" value="000001.XSHE">\n            </div>\n        </div>\n        \n        \x3c!-- ç­–ç•¥ä»£ç  --\x3e\n        <div class="section">\n            <div class="section-title">ğŸ“ ç­–ç•¥ä»£ç </div>\n            <div class="button-group">\n                <button class="btn btn-secondary" onclick="loadStrategyFile()">ğŸ“‚ åŠ è½½ç­–ç•¥æ–‡ä»¶</button>\n                <button class="btn btn-secondary" onclick="loadConfig()">ğŸ“¥ åŠ è½½é…ç½®</button>\n                <button class="btn btn-secondary" onclick="saveConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>\n            </div>\n            <div class="form-group" style="margin-top: 15px;">\n                <label>ç­–ç•¥ä»£ç ï¼ˆå¿…é¡»å®šä¹‰ on_bar(engine, bars) å‡½æ•°ï¼‰</label>\n                <textarea id="strategyCode" placeholder="def on_bar(engine, bars):\n    # ç­–ç•¥é€»è¾‘\n    for symbol, bar in bars.items():\n        # ç¤ºä¾‹ï¼šç®€å•ä¹°å…¥æŒæœ‰\n        if engine.portfolio.get_position(symbol) == 0:\n            engine.buy(symbol, 100)"></textarea>\n            </div>\n        </div>\n        \n        \x3c!-- æ“ä½œæŒ‰é’® --\x3e\n        <div class="button-group">\n            <button class="btn btn-primary" id="runBtn" onclick="runBacktest()">\n                â–¶ï¸ è¿è¡Œå›æµ‹\n            </button>\n        </div>\n        \n        \x3c!-- å›æµ‹ç»“æœ --\x3e\n        <div class="section result-section" id="resultSection" style="display: none;">\n            <div class="section-title">ğŸ“ˆ å›æµ‹ç»“æœ</div>\n            <div id="resultContent"></div>\n        </div>\n    </div>\n    \n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        function showStatus(message, type = \'info\') {\n            const statusEl = document.getElementById(\'status\');\n            statusEl.textContent = message;\n            statusEl.className = \'status \' + type;\n            statusEl.style.display = \'block\';\n            if (type !== \'error\') {\n                setTimeout(() => {\n                    statusEl.style.display = \'none\';\n                }, 3000);\n            }\n        }\n        \n        function getConfig() {\n            return {\n                start_date: document.getElementById(\'startDate\').value,\n                end_date: document.getElementById(\'endDate\').value,\n                initial_capital: parseFloat(document.getElementById(\'initialCapital\').value),\n                benchmark: document.getElementById(\'benchmark\').value,\n                commission: parseFloat(document.getElementById(\'commission\').value),\n                slippage: parseFloat(document.getElementById(\'slippage\').value),\n                max_position: parseFloat(document.getElementById(\'maxPosition\').value),\n                single_stock_max: parseFloat(document.getElementById(\'singleStockMax\').value),\n                stop_loss: parseFloat(document.getElementById(\'stopLoss\').value),\n                take_profit: parseFloat(document.getElementById(\'takeProfit\').value),\n                data_source: document.getElementById(\'dataSource\').value,\n                symbols: document.getElementById(\'symbols\').value.split(\',\').map(s => s.trim()).filter(s => s)\n            };\n        }\n        \n        function getStrategyCode() {\n            return document.getElementById(\'strategyCode\').value;\n        }\n        \n        function loadStrategyFile() {\n            vscode.postMessage({ command: \'loadStrategyFile\' });\n        }\n        \n        function loadConfig() {\n            vscode.postMessage({ command: \'loadConfig\' });\n        }\n        \n        function saveConfig() {\n            const config = getConfig();\n            vscode.postMessage({ command: \'saveConfig\', config: config });\n        }\n        \n        function runBacktest() {\n            const config = getConfig();\n            const strategyCode = getStrategyCode();\n            \n            if (!strategyCode || strategyCode.trim().length === 0) {\n                showStatus(\'è¯·å…ˆè¾“å…¥ç­–ç•¥ä»£ç \', \'error\');\n                return;\n            }\n            \n            vscode.postMessage({\n                command: \'runBacktest\',\n                config: config,\n                strategyCode: strategyCode\n            });\n        }\n        \n        // ç›‘å¬æ¥è‡ªæ‰©å±•çš„æ¶ˆæ¯\n        window.addEventListener(\'message\', event => {\n            const message = event.data;\n            \n            switch (message.command) {\n                case \'strategyLoaded\':\n                    document.getElementById(\'strategyCode\').value = message.code;\n                    showStatus(\'ç­–ç•¥æ–‡ä»¶åŠ è½½æˆåŠŸ: \' + message.fileName, \'success\');\n                    break;\n                    \n                case \'configLoaded\':\n                    const config = message.config;\n                    if (config.start_date) document.getElementById(\'startDate\').value = config.start_date;\n                    if (config.end_date) document.getElementById(\'endDate\').value = config.end_date;\n                    if (config.initial_capital) document.getElementById(\'initialCapital\').value = config.initial_capital;\n                    if (config.benchmark) document.getElementById(\'benchmark\').value = config.benchmark;\n                    if (config.commission) document.getElementById(\'commission\').value = config.commission;\n                    if (config.slippage) document.getElementById(\'slippage\').value = config.slippage;\n                    if (config.max_position) document.getElementById(\'maxPosition\').value = config.max_position;\n                    if (config.single_stock_max) document.getElementById(\'singleStockMax\').value = config.single_stock_max;\n                    if (config.stop_loss) document.getElementById(\'stopLoss\').value = config.stop_loss;\n                    if (config.take_profit) document.getElementById(\'takeProfit\').value = config.take_profit;\n                    if (config.data_source) document.getElementById(\'dataSource\').value = config.data_source;\n                    if (config.symbols) document.getElementById(\'symbols\').value = config.symbols.join(\',\');\n                    showStatus(\'é…ç½®åŠ è½½æˆåŠŸ\', \'success\');\n                    break;\n                    \n                case \'backtestRunning\':\n                    const runBtn = document.getElementById(\'runBtn\');\n                    if (message.running) {\n                        runBtn.disabled = true;\n                        runBtn.innerHTML = \'<span class="loading"></span> å›æµ‹è¿è¡Œä¸­...\';\n                    } else {\n                        runBtn.disabled = false;\n                        runBtn.innerHTML = \'â–¶ï¸ è¿è¡Œå›æµ‹\';\n                    }\n                    break;\n                    \n                case \'backtestResult\':\n                    displayResult(message.result);\n                    showStatus(\'å›æµ‹å®Œæˆï¼\', \'success\');\n                    break;\n                    \n                case \'backtestError\':\n                    showStatus(\'å›æµ‹å¤±è´¥: \' + message.error, \'error\');\n                    document.getElementById(\'resultSection\').style.display = \'none\';\n                    break;\n            }\n        });\n        \n        function displayResult(result) {\n            const resultSection = document.getElementById(\'resultSection\');\n            const resultContent = document.getElementById(\'resultContent\');\n            \n            if (!result || !result.success) {\n                resultContent.innerHTML = \'<p style="color: var(--vscode-errorForeground);">å›æµ‹æ‰§è¡Œå¤±è´¥</p>\';\n                resultSection.style.display = \'block\';\n                return;\n            }\n            \n            const data = result.result || result;\n            let html = \'<table class="result-table">\';\n            \n            // åŸºæœ¬æŒ‡æ ‡\n            if (data.total_return !== undefined) {\n                html += \'<tr><th>æ€»æ”¶ç›Šç‡</th><td>\' + (data.total_return * 100).toFixed(2) + \'%</td></tr>\';\n            }\n            if (data.annual_return !== undefined) {\n                html += \'<tr><th>å¹´åŒ–æ”¶ç›Šç‡</th><td>\' + (data.annual_return * 100).toFixed(2) + \'%</td></tr>\';\n            }\n            if (data.sharpe_ratio !== undefined) {\n                html += \'<tr><th>å¤æ™®æ¯”ç‡</th><td>\' + data.sharpe_ratio.toFixed(3) + \'</td></tr>\';\n            }\n            if (data.max_drawdown !== undefined) {\n                html += \'<tr><th>æœ€å¤§å›æ’¤</th><td>\' + (data.max_drawdown * 100).toFixed(2) + \'%</td></tr>\';\n            }\n            if (data.win_rate !== undefined) {\n                html += \'<tr><th>èƒœç‡</th><td>\' + (data.win_rate * 100).toFixed(2) + \'%</td></tr>\';\n            }\n            if (data.total_trades !== undefined) {\n                html += \'<tr><th>æ€»äº¤æ˜“æ¬¡æ•°</th><td>\' + data.total_trades + \'</td></tr>\';\n            }\n            if (data.final_value !== undefined) {\n                html += \'<tr><th>æœ€ç»ˆèµ„äº§</th><td>\' + data.final_value.toFixed(2) + \' å…ƒ</td></tr>\';\n            }\n            \n            html += \'</table>\';\n            resultContent.innerHTML = html;\n            resultSection.style.display = \'block\';\n        }\n    <\/script>\n</body>\n</html>'}dispose(){g.currentPanel=void 0,this._disposables.forEach(n=>n.dispose())}}e.BacktestConfigPanel=g},64:(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PLATFORMS=void 0,e.PLATFORMS={joinquant:{name:"joinquant",displayName:"èšå®½ JoinQuant",description:"é‡åŒ–ç ”ç©¶å’Œå›æµ‹å¹³å°",apiVersion:"2.0",features:["å›æµ‹","æ¨¡æ‹Ÿäº¤æ˜“","ç ”ç©¶ç¯å¢ƒ"]},ptrade:{name:"ptrade",displayName:"PTrade",description:"æ’ç”Ÿå®ç›˜äº¤æ˜“ç³»ç»Ÿ",apiVersion:"1.0",features:["å®ç›˜äº¤æ˜“","ç¨‹åºåŒ–äº¤æ˜“","å¤šè´¦æˆ·"]},qmt:{name:"qmt",displayName:"QMTè¿…æŠ•",description:"è¿…æŠ•é‡åŒ–äº¤æ˜“å¹³å°",apiVersion:"2.0",features:["å®ç›˜äº¤æ˜“","é«˜é¢‘äº¤æ˜“","ç­–ç•¥å›æµ‹"]},universal:{name:"universal",displayName:"é€šç”¨æ ¼å¼",description:"TRQuantç»Ÿä¸€æ ¼å¼",apiVersion:"1.0",features:["è·¨å¹³å°","æ ‡å‡†åŒ–","å¯ç§»æ¤"]}}},126:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.MainDashboard=void 0,e.registerMainDashboard=function(n,e){l.logger.info("æŠ•èµ„å·¥ä½œæµä»ªè¡¨ç›˜å·²æ³¨å†Œ",p)},e.showMainDashboard=function(n,e){g.createOrShow(n,e)};const o=s(t(398)),c=s(t(896)),d=s(t(928)),l=t(628),p="MainDashboard";class g{static currentPanel;_panel;_extensionUri;_client;_disposables=[];_marketStatus=null;_mainlines=[];_factors=[];constructor(n,e,t){this._panel=n,this._extensionUri=e,this._client=t,this._panel.webview.onDidReceiveMessage(n=>this.handleMessage(n),null,this._disposables),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this.updateContent(),this.refreshAllData()}static createOrShow(n,e){const t=o.ViewColumn.One;if(g.currentPanel)return g.currentPanel._panel.reveal(t),g.currentPanel;const a=o.window.createWebviewPanel("trquantDashboard","ğŸ‰ éŸ¬ç¿é‡åŒ–å·¥ä½œå°",t,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[n]});return g.currentPanel=new g(a,n,e),g.currentPanel}async handleMessage(n){switch(console.log("[MainDashboard] æ”¶åˆ°æ¶ˆæ¯:",n.command),n.command){case"openStep":const e=n.step;if(void 0!==e?.index)await this.openWorkflowStep(e.index);else if(e?.id){const n=[{id:"data_source"},{id:"market_trend"},{id:"mainline"},{id:"candidate_pool"},{id:"factor"},{id:"strategy"}].findIndex(n=>n.id===e.id);n>=0&&await this.openWorkflowStep(n)}break;case"refreshAll":await this.refreshAllData();break;case"refreshMarket":await this.refreshMarketStatus();break;case"refreshMainlines":await this.refreshMainlines();break;case"refreshFactors":await this.refreshFactors();break;case"createProject":console.log("[MainDashboard] æ‰§è¡Œ createProject å‘½ä»¤"),await o.commands.executeCommand("trquant.createProject");break;case"openProject":o.commands.executeCommand("trquant.openProject");break;case"openBacktestConfig":o.commands.executeCommand("trquant.openBacktestConfig");break;case"generateStrategy":o.commands.executeCommand("trquant.generateStrategy");break;case"showLogs":o.commands.executeCommand("trquant.showLogs");break;case"openSettings":o.commands.executeCommand("trquant.openSettings");break;case"openFileManager":o.commands.executeCommand("trquant.openFileManager");break;case"launchFileDashboard":await this.launchFileDashboard();break;case"openKnowledgeBase":o.commands.executeCommand("trquant.openKnowledgeBase");break;case"openAShareManual":o.commands.executeCommand("trquant.openAShareManual");break;case"launchAShareManual":await this.launchAShareManual();break;case"runFullWorkflow":await this.runFullWorkflow();break;case"openWorkflowPanel":console.log("[MainDashboard] å‡†å¤‡å¯åŠ¨æ¡Œé¢ç³»ç»Ÿ");try{await o.commands.executeCommand("trquant.launchDesktopSystem"),console.log("[MainDashboard] æ¡Œé¢ç³»ç»Ÿå¯åŠ¨å‘½ä»¤å·²æ‰§è¡Œ"),o.window.showInformationMessage("ğŸ–¥ï¸ æ¡Œé¢ç³»ç»Ÿæ­£åœ¨å¯åŠ¨...")}catch(n){console.error("[MainDashboard] å¯åŠ¨æ¡Œé¢ç³»ç»Ÿå¤±è´¥:",n);const e=n instanceof Error?n.message:String(n);o.window.showErrorMessage(`å¯åŠ¨æ¡Œé¢ç³»ç»Ÿå¤±è´¥: ${e}`)}break;case"generateInvestmentReport":await this.generateInvestmentReport();break;case"syncFileChanges":await this.syncFileChanges();break;case"exportDatabase":await this.exportDatabase();break;case"openFile":await this.openFile(n.path||"");break;case"optimizeStrategy":o.commands.executeCommand("trquant.optimizeStrategy")}}async openWorkflowStep(n){const e={1:{id:"data_source",name:"ä¿¡æ¯è·å–"},2:{id:"market_trend",name:"å¸‚åœºè¶‹åŠ¿"},3:{id:"mainline",name:"æŠ•èµ„ä¸»çº¿"},4:{id:"candidate_pool",name:"å€™é€‰æ± æ„å»º"},5:{id:"factor",name:"å› å­æ„å»º"},6:{id:"strategy",name:"ç­–ç•¥ç”Ÿæˆ"},7:{id:"backtest",name:"å›æµ‹éªŒè¯"},8:{id:"trading",name:"å®ç›˜äº¤æ˜“"}}[n];if(e)if(7!==n)if(8!==n){this._panel.webview.postMessage({command:"stepStarted",step:n,stepId:e.id,stepName:e.name});try{const t=await this._client.callBridge("run_workflow_step",{step_id:e.id}),a=t.data,r=a?.summary||(t.ok?"æ‰§è¡ŒæˆåŠŸ":"æ‰§è¡Œå¤±è´¥"),i=t.data||{};this._panel.webview.postMessage({command:"stepResult",step:n,stepId:e.id,stepName:e.name,success:t.ok,summary:r,details:i,error:t.error})}catch(t){l.logger.error(`æ­¥éª¤${n}æ‰§è¡Œå¤±è´¥: ${t}`,p),this._panel.webview.postMessage({command:"stepResult",step:n,stepId:e.id,stepName:e.name,success:!1,summary:`æ‰§è¡Œå¤±è´¥: ${t}`,details:{},error:String(t)})}}else o.commands.executeCommand("trquant.openTrading");else o.commands.executeCommand("trquant.openBacktestConfig")}async refreshAllData(){this._panel.webview.postMessage({command:"loadingStart"}),await Promise.all([this.refreshMarketStatus(),this.refreshMainlines(),this.refreshFactors()]),this._panel.webview.postMessage({command:"loadingEnd"})}async refreshMarketStatus(){try{const n=await this._client.getMarketStatus();if(n.ok&&n.data){this._marketStatus=n.data;const e={regime:this._marketStatus.regime,regime_cn:this.getRegimeCN(this._marketStatus.regime),indices:this.formatIndices(this._marketStatus.index_trend),style_rotation:this._marketStatus.style_rotation?.[0]?.style||"å‡è¡¡"};this._panel.webview.postMessage({command:"marketStatusUpdated",data:e})}}catch(n){l.logger.error(`è·å–å¸‚åœºçŠ¶æ€å¤±è´¥: ${n}`,p)}}getRegimeCN(n){return{risk_on:"é£é™©åå¥½",risk_off:"é£é™©è§„é¿",neutral:"ä¸­æ€§"}[n]||n}formatIndices(n){const e=[],t={sh_index:"ä¸Šè¯æŒ‡æ•°",sz_index:"æ·±è¯æˆæŒ‡",cy_index:"åˆ›ä¸šæ¿æŒ‡"};for(const[a,r]of Object.entries(n||{}))e.push({name:t[a]||a,value:r?.zscore||0,change:r?.change_pct||0});return e}async refreshMainlines(){try{const n=await this._client.getMainlines({time_horizon:"short",top_n:5});n.ok&&n.data&&(this._mainlines=n.data,this._panel.webview.postMessage({command:"mainlinesUpdated",data:this._mainlines}))}catch(n){l.logger.error(`è·å–æŠ•èµ„ä¸»çº¿å¤±è´¥: ${n}`,p)}}async refreshFactors(){try{const n=this._marketStatus?.regime||"neutral",e=await this._client.recommendFactors({market_regime:n,top_n:5});e.ok&&e.data&&(this._factors=e.data,this._panel.webview.postMessage({command:"factorsUpdated",data:this._factors}))}catch(n){l.logger.error(`è·å–æ¨èå› å­å¤±è´¥: ${n}`,p)}}async runFullWorkflow(){l.logger.info("=== ä¸€é”®æ‰§è¡Œå®Œæ•´æŠ•èµ„å·¥ä½œæµ ===",p);const n=[{id:"step1",name:"ğŸ“¡ ä¿¡æ¯è·å–",action:"check_data_sources"},{id:"step2",name:"ğŸ“ˆ å¸‚åœºè¶‹åŠ¿",action:"analyze_market_trend"},{id:"step3",name:"ğŸ”¥ æŠ•èµ„ä¸»çº¿",action:"identify_mainlines"},{id:"step4",name:"ğŸ“¦ å€™é€‰æ± æ„å»º",action:"build_candidate_pool"},{id:"step5",name:"ğŸ“Š å› å­æ¨è",action:"recommend_factors"},{id:"step6",name:"ğŸ› ï¸ ç­–ç•¥ç”Ÿæˆ",action:"generate_strategy"},{id:"step7",name:"ğŸ”„ å›æµ‹éªŒè¯",action:"run_backtest"},{id:"step8",name:"ğŸš€ äº¤æ˜“æ£€æŸ¥",action:"check_broker"}];await o.window.withProgress({location:o.ProgressLocation.Notification,title:"ğŸ‰ æ‰§è¡Œå®Œæ•´æŠ•èµ„å·¥ä½œæµ",cancellable:!0},async(e,t)=>{const a=[];let r=!1;for(let i=0;i<n.length;i++){if(t.isCancellationRequested){o.window.showWarningMessage("å·¥ä½œæµå·²å–æ¶ˆ");break}const s=n[i];e.report({message:`(${i+1}/${n.length}) ${s.name}`,increment:100/n.length});try{l.logger.info(`æ‰§è¡Œæ­¥éª¤: ${s.name}`,p),this._panel.webview.postMessage({command:"workflowProgress",data:{currentStep:s.id,stepName:s.name,progress:(i+1)/n.length*100,status:"running"}});const e=await this._client.callBridge("run_workflow_step",{step_id:s.action});e.ok?(a.push({step:s.name,success:!0}),this._panel.webview.postMessage({command:"workflowStepResult",data:{stepId:s.id,stepName:s.name,result:e.data,success:!0}})):(r=!0,a.push({step:s.name,success:!1,error:e.error})),await new Promise(n=>setTimeout(n,500))}catch(n){r=!0;const e=n instanceof Error?n.message:String(n);l.logger.error(`æ­¥éª¤ ${s.name} å¤±è´¥: ${e}`,p),a.push({step:s.name,success:!1,error:e})}}this._panel.webview.postMessage({command:"workflowComplete",data:{results:a,hasError:r}}),r?o.window.showWarningMessage("âš ï¸ å·¥ä½œæµå®Œæˆï¼Œéƒ¨åˆ†æ­¥éª¤æœ‰é”™è¯¯"):o.window.showInformationMessage("âœ… å®Œæ•´æŠ•èµ„å·¥ä½œæµæ‰§è¡Œå®Œæˆï¼"),await this.refreshAllData()})}async launchAShareManual(){l.logger.info("=== å¯åŠ¨Aè‚¡å®æ“æ‰‹å†Œ ===",p);try{const n=o.workspace.workspaceFolders?.[0];if(!n)return void o.window.showErrorMessage("è¯·å…ˆæ‰“å¼€TRQuantå·¥ä½œåŒº");const e=d.join(n.uri.fsPath,"extension","AShare-manual");if(l.logger.info(`æ‰‹å†Œè·¯å¾„: ${e}`,p),!c.existsSync(e))return o.window.showErrorMessage(`Aè‚¡æ‰‹å†Œç›®å½•ä¸å­˜åœ¨: ${e}`),void l.logger.error(`ç›®å½•ä¸å­˜åœ¨: ${e}`,p);if(!c.existsSync(d.join(e,"package.json")))return void o.window.showErrorMessage("Aè‚¡æ‰‹å†Œé…ç½®æ–‡ä»¶ç¼ºå¤±");if(!c.existsSync(d.join(e,"node_modules"))){if("å®‰è£…"===await o.window.showWarningMessage("Aè‚¡æ‰‹å†Œéœ€è¦å®‰è£…ä¾èµ–ï¼Œæ˜¯å¦å®‰è£…ï¼Ÿ","å®‰è£…","å–æ¶ˆ")){const n=o.window.createTerminal({name:"Aè‚¡æ‰‹å†Œä¾èµ–å®‰è£…",cwd:e});n.show(),n.sendText('npm install && echo "ä¾èµ–å®‰è£…å®Œæˆï¼Œè¯·é‡æ–°ç‚¹å‡»Aè‚¡å®æ“æ‰‹å†Œ"')}return}const t=o.window.terminals.find(n=>"Aè‚¡æ‰‹å†ŒæœåŠ¡"===n.name);if(t)return l.logger.info("å‘ç°å·²å­˜åœ¨çš„æ‰‹å†ŒæœåŠ¡ç»ˆç«¯",p),t.show(),o.window.showInformationMessage("æ­£åœ¨æ‰“å¼€Aè‚¡æ‰‹å†Œ..."),void setTimeout(()=>{o.env.openExternal(o.Uri.parse("http://localhost:4321"))},500);l.logger.info("åˆ›å»ºæ–°ç»ˆç«¯å¯åŠ¨AstroæœåŠ¡",p);const a=o.window.createTerminal({name:"Aè‚¡æ‰‹å†ŒæœåŠ¡",cwd:e,env:{...process.env}});a.show(),a.sendText("npm run dev"),o.window.showInformationMessage("ğŸ“š æ­£åœ¨å¯åŠ¨Aè‚¡æ‰‹å†ŒæœåŠ¡å™¨..."),setTimeout(()=>{l.logger.info("å°è¯•æ‰“å¼€æµè§ˆå™¨",p),o.env.openExternal(o.Uri.parse("http://localhost:4321")),o.window.showInformationMessage("âœ… Aè‚¡é«˜å€è‚¡å®æ“æ‰‹å†Œå·²å¯åŠ¨")},3e3)}catch(n){const e=n instanceof Error?n.message:String(n);l.logger.error(`å¯åŠ¨å¤±è´¥: ${e}`,p),o.window.showErrorMessage(`å¯åŠ¨Aè‚¡æ‰‹å†Œå¤±è´¥: ${e}`)}}async launchFileDashboard(){l.logger.info("=== å¯åŠ¨Extension Dashboard ===",p);try{const n=o.workspace.workspaceFolders?.[0];if(!n)return void o.window.showErrorMessage("è¯·å…ˆæ‰“å¼€å·¥ä½œåŒº");const e=o.window.terminals.find(n=>"TRQuant Dashboard"===n.name);if(e)return l.logger.info("DashboardæœåŠ¡å·²åœ¨è¿è¡Œ",p),e.show(),o.window.showInformationMessage("ğŸ“ æ­£åœ¨æ‰“å¼€æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ..."),void setTimeout(()=>{o.env.openExternal(o.Uri.parse("http://localhost:5000"))},500);const t=d.join(n.uri.fsPath,"extension"),a=d.join(t,"start_dashboard.py");if(!c.existsSync(a))return void o.window.showErrorMessage(`Dashboardå¯åŠ¨è„šæœ¬ä¸å­˜åœ¨: ${a}`);l.logger.info(`Dashboardè„šæœ¬: ${a}`,p);const r=o.window.createTerminal({name:"TRQuant Dashboard",cwd:t});r.show();const i="win32"===process.platform,s=i?d.join(t,"venv","Scripts","activate.bat"):d.join(t,"venv","bin","activate"),g=i?d.join(n.uri.fsPath,"venv","Scripts","activate.bat"):d.join(n.uri.fsPath,"venv","bin","activate");let m="";c.existsSync(s)?(m=i?`"${s}" && python start_dashboard.py`:`source "${s}" && python start_dashboard.py`,l.logger.info("ä½¿ç”¨extension venv",p)):c.existsSync(g)?(m=i?`"${g}" && python start_dashboard.py`:`source "${g}" && python start_dashboard.py`,l.logger.info("ä½¿ç”¨å·¥ä½œåŒºæ ¹ç›®å½•venv",p)):(m=(i?"python":"python3")+" start_dashboard.py",l.logger.info("ä½¿ç”¨ç³»ç»ŸPython",p)),r.sendText(m),o.window.showInformationMessage("ğŸ“ æ­£åœ¨å¯åŠ¨Extension Dashboard..."),setTimeout(()=>{o.env.openExternal(o.Uri.parse("http://localhost:5000")),o.window.showInformationMessage("âœ… Extension Dashboardå·²å¯åŠ¨ - http://localhost:5000")},3e3)}catch(n){const e=n instanceof Error?n.message:String(n);l.logger.error(`å¯åŠ¨Dashboardå¤±è´¥: ${e}`,p),o.window.showErrorMessage(`å¯åŠ¨æ–‡ä»¶ç®¡ç†ç³»ç»Ÿå¤±è´¥: ${e}`)}}async generateInvestmentReport(){l.logger.info("ç”ŸæˆæŠ•èµ„æŠ¥å‘Š...",p);try{o.window.showInformationMessage("ğŸ“Š æ­£åœ¨ç”ŸæˆæŠ•èµ„æŠ¥å‘Š...");const n=await this._client.callBridge("generate_investment_report",{type:"full"});if(n.ok&&n.data){const e=n.data,t=e.path||e.file||"";o.window.showInformationMessage(`âœ… æŠ¥å‘Šå·²ç”Ÿæˆ: ${d.basename(t)}`,"æ‰“å¼€æŠ¥å‘Š").then(n=>{if("æ‰“å¼€æŠ¥å‘Š"===n){const n=o.workspace.workspaceFolders?.[0];if(n&&t){const e=d.join(n.uri.fsPath,t);o.env.openExternal(o.Uri.file(e))}}})}else o.window.showErrorMessage(`ç”ŸæˆæŠ¥å‘Šå¤±è´¥: ${n.error||"æœªçŸ¥é”™è¯¯"}`)}catch(n){const e=n instanceof Error?n.message:String(n);l.logger.error(`ç”ŸæˆæŠ¥å‘Šå¤±è´¥: ${e}`,p),o.window.showErrorMessage(`ç”ŸæˆæŠ¥å‘Šå¤±è´¥: ${e}`)}}async syncFileChanges(){l.logger.info("åŒæ­¥æ–‡ä»¶å˜åŒ–...",p);try{const n=await this._client.callBridge("sync_file_changes",{});if(n.ok&&n.data){const e=n.data,t=e.total_count||0,a=e.recent_files||[];if(t>0){const n=a.slice(0,3).map(n=>n.name).join(", ");o.window.showInformationMessage(`ğŸ”„ æ£€æµ‹åˆ° ${t} ä¸ªæ›´æ–°æ–‡ä»¶: ${n}${t>3?"...":""}`)}else o.window.showInformationMessage("âœ… æ–‡ä»¶å·²æ˜¯æœ€æ–°çŠ¶æ€")}}catch(n){const e=n instanceof Error?n.message:String(n);l.logger.error(`åŒæ­¥å¤±è´¥: ${e}`,p)}}async exportDatabase(){l.logger.info("å¯¼å‡ºæ•°æ®åº“...",p);try{o.window.showInformationMessage("ğŸ—„ï¸ æ­£åœ¨å¯¼å‡ºæ•°æ®åº“...");const n=await this._client.callBridge("export_database",{});if(n.ok&&n.data){const e=n.data;o.window.showInformationMessage(`âœ… æ•°æ®åº“å·²å¯¼å‡º: ${e.collections||0}ä¸ªé›†åˆ, ${e.total_docs||0}æ¡è®°å½•`,"æ‰“å¼€æ–‡ä»¶").then(n=>{if("æ‰“å¼€æ–‡ä»¶"===n){const n=o.workspace.workspaceFolders?.[0];n&&e.file&&o.env.openExternal(o.Uri.file(e.file))}})}else o.window.showErrorMessage(`å¯¼å‡ºå¤±è´¥: ${n.error||"è¯·ç¡®ä¿MongoDBå·²å¯åŠ¨"}`)}catch(n){const e=n instanceof Error?n.message:String(n);l.logger.error(`å¯¼å‡ºæ•°æ®åº“å¤±è´¥: ${e}`,p),o.window.showErrorMessage(`å¯¼å‡ºæ•°æ®åº“å¤±è´¥: ${e}`)}}async openFile(n){if(!n)return;const e=o.workspace.workspaceFolders?.[0];if(!e)return;const t=d.join(e.uri.fsPath,n),a=d.extname(n).toLowerCase();if([".py",".json",".yaml",".yml",".md",".txt"].includes(a)){const n=await o.workspace.openTextDocument(t);await o.window.showTextDocument(n)}else o.env.openExternal(o.Uri.file(t))}updateContent(){this._panel.webview.html=this.generateHtml()}generateHtml(){return'<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>éŸ¬ç¿é‡åŒ–å·¥ä½œå°</title>\n    <style>\n        :root {\n            --bg-dark: #0a0e14;\n            --bg-primary: #0d1117;\n            --bg-secondary: #161b22;\n            --bg-card: #1c2128;\n            --bg-hover: #262c36;\n            --text-primary: #e6edf3;\n            --text-secondary: #8b949e;\n            --text-muted: #6e7681;\n            --accent-gold: #f0b429;\n            --accent-green: #3fb950;\n            --accent-blue: #58a6ff;\n            --accent-purple: #a371f7;\n            --accent-red: #f85149;\n            --accent-orange: #f0883e;\n            --border-color: #30363d;\n            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            --gradient-gold: linear-gradient(135deg, #f0b429 0%, #e85d04 100%);\n        }\n        \n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body {\n            font-family: \'SF Pro Display\', -apple-system, BlinkMacSystemFont, \'Segoe UI\', sans-serif;\n            background: var(--bg-dark);\n            color: var(--text-primary);\n            min-height: 100vh;\n            overflow-x: hidden;\n        }\n        \n        /* é¡¶éƒ¨æ ‡é¢˜æ  */\n        .header {\n            background: linear-gradient(135deg, #1a1f2e 0%, #0d1117 100%);\n            padding: 24px 32px;\n            border-bottom: 1px solid var(--border-color);\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        \n        .header-left {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n        \n        .logo {\n            width: 48px;\n            height: 48px;\n            background: var(--gradient-gold);\n            border-radius: 12px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 24px;\n            font-weight: bold;\n            color: #fff;\n            box-shadow: 0 4px 12px rgba(240, 180, 41, 0.3);\n        }\n        \n        .header-title h1 {\n            font-size: 24px;\n            font-weight: 700;\n            background: linear-gradient(90deg, var(--accent-gold), #fff);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            letter-spacing: 1px;\n        }\n        \n        .header-title .subtitle {\n            font-size: 13px;\n            color: var(--text-muted);\n            margin-top: 4px;\n        }\n        \n        .header-right {\n            display: flex;\n            gap: 12px;\n        }\n        \n        .header-btn {\n            padding: 10px 20px;\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            color: var(--text-secondary);\n            font-size: 13px;\n            cursor: pointer;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n        \n        .header-btn:hover {\n            background: var(--bg-hover);\n            border-color: var(--accent-blue);\n            color: var(--text-primary);\n        }\n        \n        .header-btn.primary {\n            background: var(--gradient-primary);\n            border: none;\n            color: #fff;\n        }\n        \n        .header-btn.primary:hover {\n            transform: translateY(-1px);\n            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n        }\n        \n        /* ä¸»å®¹å™¨ */\n        .main-container {\n            padding: 24px 32px;\n            max-width: 1600px;\n            margin: 0 auto;\n        }\n        \n        /* å¸‚åœºçŠ¶æ€å¡ç‰‡ */\n        .market-section {\n            margin-bottom: 24px;\n        }\n        \n        .market-grid {\n            display: grid;\n            grid-template-columns: repeat(5, 1fr);\n            gap: 16px;\n        }\n        \n        .market-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 20px;\n            text-align: center;\n            transition: all 0.2s;\n        }\n        \n        .market-card:hover {\n            transform: translateY(-2px);\n            border-color: var(--accent-blue);\n        }\n        \n        .market-card.regime {\n            background: linear-gradient(135deg, rgba(63, 185, 80, 0.1), rgba(88, 166, 255, 0.1));\n            border-color: var(--accent-green);\n        }\n        \n        .market-card .label {\n            font-size: 12px;\n            color: var(--text-muted);\n            margin-bottom: 8px;\n            text-transform: uppercase;\n            letter-spacing: 1px;\n        }\n        \n        .market-card .value {\n            font-size: 24px;\n            font-weight: 700;\n        }\n        \n        .market-card .change {\n            font-size: 14px;\n            margin-top: 4px;\n        }\n        \n        .market-card .change.up { color: var(--accent-red); }\n        .market-card .change.down { color: var(--accent-green); }\n        \n        .market-card.regime .value {\n            color: var(--accent-green);\n        }\n        \n        /* åŒæ å¸ƒå±€ */\n        .content-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 24px;\n            margin-bottom: 24px;\n        }\n        \n        .card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            overflow: hidden;\n        }\n        \n        .card-header {\n            padding: 16px 20px;\n            background: rgba(0, 0, 0, 0.2);\n            border-bottom: 1px solid var(--border-color);\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        \n        .card-header h3 {\n            font-size: 15px;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n        \n        .card-header .actions {\n            display: flex;\n            gap: 8px;\n        }\n        \n        .card-header .btn-small {\n            padding: 6px 12px;\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 6px;\n            color: var(--text-secondary);\n            font-size: 12px;\n            cursor: pointer;\n        }\n        \n        .card-header .btn-small:hover {\n            background: var(--accent-blue);\n            border-color: var(--accent-blue);\n            color: #fff;\n        }\n        \n        .card-body {\n            padding: 20px;\n        }\n        \n        /* æŠ•èµ„ä¸»çº¿åˆ—è¡¨ */\n        .mainline-list {\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n        }\n        \n        .mainline-item {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n            padding: 14px 16px;\n            background: var(--bg-card);\n            border-radius: 8px;\n            transition: all 0.2s;\n            cursor: pointer;\n        }\n        \n        .mainline-item:hover {\n            background: var(--bg-hover);\n            transform: translateX(4px);\n        }\n        \n        .mainline-rank {\n            width: 28px;\n            height: 28px;\n            background: var(--gradient-gold);\n            border-radius: 6px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 14px;\n            font-weight: 700;\n            color: #fff;\n        }\n        \n        .mainline-rank.silver { background: linear-gradient(135deg, #9ca3af, #6b7280); }\n        .mainline-rank.bronze { background: linear-gradient(135deg, #d97706, #92400e); }\n        \n        .mainline-info {\n            flex: 1;\n        }\n        \n        .mainline-name {\n            font-size: 15px;\n            font-weight: 600;\n            margin-bottom: 4px;\n        }\n        \n        .mainline-industries {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        .mainline-score {\n            font-size: 20px;\n            font-weight: 700;\n            color: var(--accent-gold);\n        }\n        \n        /* å› å­åˆ—è¡¨ */\n        .factor-list {\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n        }\n        \n        .factor-item {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            padding: 14px 16px;\n            background: var(--bg-card);\n            border-radius: 8px;\n        }\n        \n        .factor-icon {\n            width: 36px;\n            height: 36px;\n            background: var(--gradient-primary);\n            border-radius: 8px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 16px;\n        }\n        \n        .factor-info {\n            flex: 1;\n        }\n        \n        .factor-name {\n            font-size: 14px;\n            font-weight: 600;\n            margin-bottom: 2px;\n        }\n        \n        .factor-category {\n            font-size: 11px;\n            color: var(--text-muted);\n        }\n        \n        .factor-weight {\n            font-size: 16px;\n            font-weight: 700;\n            color: var(--accent-purple);\n        }\n        \n        /* 8æ­¥éª¤å·¥ä½œæµ */\n        .workflow-section {\n            margin-bottom: 24px;\n        }\n        \n        .section-title {\n            font-size: 13px;\n            font-weight: 600;\n            color: var(--text-muted);\n            text-transform: uppercase;\n            letter-spacing: 2px;\n            margin-bottom: 16px;\n            padding-left: 4px;\n        }\n        \n        .section-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 16px;\n        }\n        \n        .run-all-btn {\n            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);\n            color: white;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 8px;\n            cursor: pointer;\n            font-weight: 600;\n            font-size: 14px;\n            transition: all 0.3s;\n        }\n        .run-all-btn:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);\n        }\n        \n        .workflow-container {\n            display: flex;\n            gap: 20px;\n        }\n        \n        .workflow-grid {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 12px;\n            flex: 1;\n        }\n        \n        .workflow-step {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 16px 12px;\n            text-align: center;\n            cursor: pointer;\n            transition: all 0.3s;\n            position: relative;\n        }\n        \n        .workflow-step::after {\n            display: none;\n        }\n        \n        .workflow-step:last-child::after {\n            display: none;\n        }\n        \n        .workflow-step:hover {\n            transform: translateY(-4px);\n            border-color: var(--accent-blue);\n            box-shadow: 0 8px 24px rgba(88, 166, 255, 0.15);\n        }\n        \n        .workflow-step.active {\n            background: linear-gradient(135deg, rgba(88, 166, 255, 0.15), rgba(163, 113, 247, 0.15));\n            border-color: var(--accent-blue);\n        }\n        \n        .step-number {\n            width: 24px;\n            height: 24px;\n            background: var(--bg-card);\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 11px;\n            font-weight: 600;\n            color: var(--text-muted);\n            margin: 0 auto 12px;\n        }\n        \n        .workflow-step:hover .step-number {\n            background: var(--accent-blue);\n            color: #fff;\n        }\n        \n        .step-icon {\n            font-size: 28px;\n            margin-bottom: 10px;\n        }\n        \n        .step-name {\n            font-size: 13px;\n            font-weight: 600;\n            color: var(--text-secondary);\n        }\n        \n        .workflow-step:hover .step-name {\n            color: var(--text-primary);\n        }\n        \n        .step-status {\n            position: absolute;\n            top: 8px;\n            right: 8px;\n            font-size: 14px;\n        }\n        \n        .workflow-step.running {\n            border-color: #f59e0b;\n            animation: pulse 1.5s infinite;\n        }\n        \n        .workflow-step.completed {\n            border-color: #10b981;\n        }\n        \n        .workflow-step.failed {\n            border-color: #ef4444;\n        }\n        \n        @keyframes pulse {\n            0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }\n            50% { box-shadow: 0 0 0 8px rgba(245, 158, 11, 0); }\n        }\n        \n        /* ç»“æœé¢æ¿ */\n        .result-panel {\n            flex: 1;\n            min-width: 400px;\n            max-width: 500px;\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 16px;\n            display: none;\n        }\n        \n        .result-panel.visible {\n            display: block;\n        }\n        \n        .result-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 12px;\n        }\n        \n        .result-title {\n            font-size: 16px;\n            font-weight: 600;\n            color: var(--text-primary);\n        }\n        \n        .close-btn {\n            background: transparent;\n            border: none;\n            color: var(--text-muted);\n            cursor: pointer;\n            font-size: 16px;\n            padding: 4px 8px;\n            border-radius: 4px;\n        }\n        .close-btn:hover {\n            background: var(--bg-hover);\n            color: var(--text-primary);\n        }\n        \n        .result-summary {\n            background: var(--bg-card);\n            padding: 12px;\n            border-radius: 8px;\n            color: var(--text-secondary);\n            font-size: 14px;\n            margin-bottom: 12px;\n        }\n        \n        .result-progress {\n            margin-bottom: 12px;\n        }\n        \n        .progress-bar {\n            height: 6px;\n            background: var(--bg-card);\n            border-radius: 3px;\n            overflow: hidden;\n            margin-bottom: 8px;\n        }\n        \n        .progress-fill {\n            height: 100%;\n            background: linear-gradient(90deg, #6366f1, #8b5cf6);\n            width: 0%;\n            transition: width 0.3s;\n        }\n        \n        .progress-text {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        .result-details {\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            padding: 12px;\n            max-height: 300px;\n            overflow-y: auto;\n            font-size: 13px;\n            margin-bottom: 12px;\n        }\n        \n        .result-details table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n        \n        .result-details th, .result-details td {\n            padding: 8px;\n            text-align: left;\n            border-bottom: 1px solid var(--border-color);\n        }\n        \n        .result-details th {\n            background: var(--bg-secondary);\n            font-weight: 600;\n            color: var(--text-secondary);\n        }\n        \n        .result-files {\n            max-height: 100px;\n            overflow-y: auto;\n        }\n        \n        .file-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 8px;\n            background: var(--bg-card);\n            border-radius: 6px;\n            margin-bottom: 4px;\n            cursor: pointer;\n            font-size: 12px;\n        }\n        .file-item:hover {\n            background: var(--bg-hover);\n        }\n        \n        /* å¿«æ·æ“ä½œåŒº */\n        .quick-section {\n            margin-bottom: 24px;\n        }\n        \n        .quick-grid {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 16px;\n        }\n        \n        .quick-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 24px;\n            cursor: pointer;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n        \n        .quick-card:hover {\n            transform: translateY(-2px);\n            border-color: var(--accent-blue);\n        }\n        \n        .quick-card.highlight {\n            background: linear-gradient(135deg, rgba(240, 180, 41, 0.1), rgba(232, 93, 4, 0.1));\n            border-color: var(--accent-gold);\n        }\n        \n        .quick-icon {\n            width: 48px;\n            height: 48px;\n            background: var(--bg-card);\n            border-radius: 12px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 24px;\n        }\n        \n        .quick-card.highlight .quick-icon {\n            background: var(--gradient-gold);\n        }\n        \n        .quick-info h4 {\n            font-size: 15px;\n            font-weight: 600;\n            margin-bottom: 4px;\n        }\n        \n        .quick-info p {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        /* åº•éƒ¨åŒæ  */\n        .bottom-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 24px;\n        }\n        \n        .project-list, .backtest-list {\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n        }\n        \n        .project-item, .backtest-item {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 12px 16px;\n            background: var(--bg-card);\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n        \n        .project-item:hover, .backtest-item:hover {\n            background: var(--bg-hover);\n        }\n        \n        .item-name {\n            font-size: 14px;\n            font-weight: 500;\n        }\n        \n        .item-date {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        .item-return {\n            font-size: 14px;\n            font-weight: 600;\n        }\n        \n        .item-return.positive { color: var(--accent-red); }\n        .item-return.negative { color: var(--accent-green); }\n        \n        /* åŠ è½½çŠ¶æ€ */\n        .loading-overlay {\n            display: none;\n            position: fixed;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background: rgba(10, 14, 20, 0.8);\n            justify-content: center;\n            align-items: center;\n            z-index: 1000;\n        }\n        \n        .loading-overlay.active {\n            display: flex;\n        }\n        \n        .loading-spinner {\n            width: 48px;\n            height: 48px;\n            border: 3px solid var(--border-color);\n            border-top-color: var(--accent-gold);\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n        }\n        \n        @keyframes spin {\n            to { transform: rotate(360deg); }\n        }\n        \n        /* ç©ºçŠ¶æ€ */\n        .empty-state {\n            text-align: center;\n            padding: 32px;\n            color: var(--text-muted);\n        }\n        \n        .empty-state .icon {\n            font-size: 48px;\n            margin-bottom: 12px;\n            opacity: 0.5;\n        }\n        \n        /* å“åº”å¼ */\n        @media (max-width: 1400px) {\n            .workflow-grid {\n                grid-template-columns: repeat(4, 1fr);\n            }\n            .workflow-step::after {\n                display: none;\n            }\n        }\n        \n        @media (max-width: 1000px) {\n            .content-grid, .bottom-grid {\n                grid-template-columns: 1fr;\n            }\n            .market-grid {\n                grid-template-columns: repeat(3, 1fr);\n            }\n            .quick-grid {\n                grid-template-columns: repeat(2, 1fr);\n            }\n        }\n    </style>\n</head>\n<body>\n    \x3c!-- é¡¶éƒ¨æ ‡é¢˜æ  --\x3e\n    <div class="header">\n        <div class="header-left">\n            <div class="logo">TR</div>\n            <div class="header-title">\n                <h1>éŸ¬ç¿é‡åŒ–å·¥ä½œå°</h1>\n                <div class="subtitle">TRQuant Professional - Aè‚¡å®Œæ•´æŠ•èµ„æµç¨‹ç³»ç»Ÿ</div>\n            </div>\n        </div>\n        <div class="header-right">\n            <button class="header-btn" onclick="vscode.postMessage({command: \'refreshAll\'})">\n                ğŸ”„ åˆ·æ–°æ•°æ®\n            </button>\n            <button class="header-btn" onclick="vscode.postMessage({command: \'openSettings\'})">\n                âš™ï¸ è®¾ç½®\n            </button>\n            <button class="header-btn primary" onclick="openWorkflowPanel()">\n                ğŸ–¥ï¸ æ‰“å¼€æ¡Œé¢ç³»ç»Ÿ\n            </button>\n        </div>\n    </div>\n    \n    <div class="main-container">\n        \x3c!-- å¿«æ·æ“ä½œï¼ˆç½®é¡¶ï¼‰ --\x3e\n        <div class="quick-section">\n            <div class="section-title">âš¡ å¿«æ·æ“ä½œ</div>\n            <div class="quick-grid">\n                <div class="quick-card highlight" onclick="console.log(\'ç‚¹å‡»æ–°å»ºé¡¹ç›®\'); vscode.postMessage({command: \'createProject\'})">\n                    <div class="quick-icon">ğŸ“</div>\n                    <div class="quick-info">\n                        <h4>æ–°å»ºé¡¹ç›®</h4>\n                        <p>ä¸€é”®ç”Ÿæˆä¸­å›½é£ç­–ç•¥</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'launchFileDashboard\'})">\n                    <div class="quick-icon">ğŸ“‚</div>\n                    <div class="quick-info">\n                        <h4>æ–‡ä»¶ç³»ç»Ÿ</h4>\n                        <p>ç­–ç•¥/æŠ¥å‘Š/æ•°æ®ç®¡ç†</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="openWorkflowPanel()">\n                    <div class="quick-icon">ğŸ–¥ï¸</div>\n                    <div class="quick-info">\n                        <h4>æ¡Œé¢ç³»ç»Ÿ</h4>\n                        <p>æŸ¥çœ‹å®Œæ•´æŠ•èµ„æµç¨‹</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'runBacktest\'})">\n                    <div class="quick-icon">ğŸ§ª</div>\n                    <div class="quick-info">\n                        <h4>è¿è¡Œå›æµ‹</h4>\n                        <p>é…ç½®å¹¶æ‰§è¡Œç­–ç•¥å›æµ‹</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'launchAShareManual\'})">\n                    <div class="quick-icon">ğŸ“š</div>\n                    <div class="quick-info">\n                        <h4>å®æ“æ‰‹å†Œ</h4>\n                        <p>Aè‚¡æŠ•èµ„æŒ‡å—</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'generateInvestmentReport\'})">\n                    <div class="quick-icon">ğŸ“Š</div>\n                    <div class="quick-info">\n                        <h4>ç”ŸæˆæŠ¥å‘Š</h4>\n                        <p>AIæŠ•èµ„åˆ†ææŠ¥å‘Š</p>\n                    </div>\n                </div>\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'optimizeStrategy\'})">\n                    <div class="quick-icon">ğŸ”</div>\n                    <div class="quick-info">\n                        <h4>ç­–ç•¥ä¼˜åŒ–</h4>\n                        <p>åˆ†æå¹¶ä¼˜åŒ–ç­–ç•¥ä»£ç </p>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- å¸‚åœºçŠ¶æ€ --\x3e\n        <div class="market-section">\n            <div class="market-grid" id="marketGrid">\n                <div class="market-card regime">\n                    <div class="label">å¸‚åœºçŠ¶æ€</div>\n                    <div class="value" id="marketRegime">åŠ è½½ä¸­...</div>\n                    <div class="change" id="marketStyle">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">ä¸Šè¯æŒ‡æ•°</div>\n                    <div class="value" id="shIndex">-</div>\n                    <div class="change" id="shChange">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">æ·±è¯æˆæŒ‡</div>\n                    <div class="value" id="szIndex">-</div>\n                    <div class="change" id="szChange">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">åˆ›ä¸šæ¿æŒ‡</div>\n                    <div class="value" id="cyIndex">-</div>\n                    <div class="change" id="cyChange">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">åŒ—å‘èµ„é‡‘</div>\n                    <div class="value" id="northFlow">-</div>\n                    <div class="change" id="northChange">-</div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- æŠ•èµ„ä¸»çº¿ & æ¨èå› å­ --\x3e\n        <div class="content-grid">\n            \x3c!-- æŠ•èµ„ä¸»çº¿ --\x3e\n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ”¥ å½“å‰æŠ•èµ„ä¸»çº¿ TOP5</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'refreshMainlines\'})">åˆ·æ–°</button>\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'openStep\', step: 3})">æŸ¥çœ‹å…¨éƒ¨</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="mainline-list" id="mainlineList">\n                        <div class="empty-state">\n                            <div class="icon">ğŸ”¥</div>\n                            <div>ç‚¹å‡»åˆ·æ–°è·å–æŠ•èµ„ä¸»çº¿</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            \x3c!-- æ¨èå› å­ --\x3e\n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ“Š æ™ºèƒ½æ¨èå› å­</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'refreshFactors\'})">åˆ·æ–°</button>\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'generateStrategy\'})">ç”Ÿæˆç­–ç•¥</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="factor-list" id="factorList">\n                        <div class="empty-state">\n                            <div class="icon">ğŸ“Š</div>\n                            <div>ç‚¹å‡»åˆ·æ–°è·å–å› å­æ¨è</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- 8æ­¥éª¤å·¥ä½œæµ --\x3e\n        <div class="workflow-section">\n            <div class="section-header">\n                <div class="section-title">ğŸ“‹ 8æ­¥éª¤æŠ•èµ„å·¥ä½œæµ</div>\n                <button class="run-all-btn" onclick="vscode.postMessage({command: \'runFullWorkflow\'})">\n                    â–¶ï¸ ä¸€é”®æ‰§è¡Œå…¨éƒ¨\n                </button>\n            </div>\n            <div class="workflow-container">\n                <div class="workflow-grid">\n                    <div class="workflow-step" id="step-1" onclick="runStep(1)">\n                        <div class="step-number">1</div>\n                        <div class="step-icon">ğŸ“¡</div>\n                        <div class="step-name">ä¿¡æ¯è·å–</div>\n                        <div class="step-status" id="status-1">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-2" onclick="runStep(2)">\n                        <div class="step-number">2</div>\n                        <div class="step-icon">ğŸ“ˆ</div>\n                        <div class="step-name">å¸‚åœºè¶‹åŠ¿</div>\n                        <div class="step-status" id="status-2">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-3" onclick="runStep(3)">\n                        <div class="step-number">3</div>\n                        <div class="step-icon">ğŸ”¥</div>\n                        <div class="step-name">æŠ•èµ„ä¸»çº¿</div>\n                        <div class="step-status" id="status-3">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-4" onclick="runStep(4)">\n                        <div class="step-number">4</div>\n                        <div class="step-icon">ğŸ“¦</div>\n                        <div class="step-name">å€™é€‰æ± </div>\n                        <div class="step-status" id="status-4">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-5" onclick="runStep(5)">\n                        <div class="step-number">5</div>\n                        <div class="step-icon">ğŸ“Š</div>\n                        <div class="step-name">å› å­æ„å»º</div>\n                        <div class="step-status" id="status-5">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-6" onclick="runStep(6)">\n                        <div class="step-number">6</div>\n                        <div class="step-icon">ğŸ› ï¸</div>\n                        <div class="step-name">ç­–ç•¥å¼€å‘</div>\n                        <div class="step-status" id="status-6">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-7" onclick="runStep(7)">\n                        <div class="step-number">7</div>\n                        <div class="step-icon">ğŸ”„</div>\n                        <div class="step-name">å›æµ‹éªŒè¯</div>\n                        <div class="step-status" id="status-7">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-8" onclick="runStep(8)">\n                        <div class="step-number">8</div>\n                        <div class="step-icon">ğŸš€</div>\n                        <div class="step-name">å®ç›˜äº¤æ˜“</div>\n                        <div class="step-status" id="status-8">â–¶ï¸</div>\n                    </div>\n                </div>\n                \n                \x3c!-- æ‰§è¡Œç»“æœåŒºåŸŸ --\x3e\n                <div class="result-panel" id="result-panel">\n                    <div class="result-header">\n                        <span class="result-title" id="result-title">ğŸ“‹ æ‰§è¡Œç»“æœ</span>\n                        <button class="close-btn" onclick="hideResultPanel()">âœ•</button>\n                    </div>\n                    <div class="result-summary" id="result-summary">\n                        ç‚¹å‡»å·¦ä¾§æ­¥éª¤å¼€å§‹æ‰§è¡Œ...\n                    </div>\n                    <div class="result-progress" id="result-progress" style="display:none;">\n                        <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>\n                        <span class="progress-text" id="progress-text">æ‰§è¡Œä¸­...</span>\n                    </div>\n                    <div class="result-details" id="result-details"></div>\n                    <div class="result-files" id="result-files"></div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- å¿«æ·æ“ä½œ --\x3e\n        <div class="quick-section">\n            <div class="section-title">âš¡ å¿«æ·æ“ä½œ</div>\n            <div class="quick-grid">\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'openBacktestConfig\'})">\n                    <div class="quick-icon">ğŸ§ª</div>\n                    <div class="quick-info">\n                        <h4>å›æµ‹é…ç½®</h4>\n                        <p>é…ç½®å¹¶è¿è¡Œç­–ç•¥å›æµ‹</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'createProject\'})">\n                    <div class="quick-icon">ğŸ“</div>\n                    <div class="quick-info">\n                        <h4>æ–°å»ºé¡¹ç›®</h4>\n                        <p>åˆ›å»ºæ–°çš„é‡åŒ–é¡¹ç›®</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'generateStrategy\'})">\n                    <div class="quick-icon">ğŸ¤–</div>\n                    <div class="quick-info">\n                        <h4>AIç”Ÿæˆç­–ç•¥</h4>\n                        <p>æ™ºèƒ½ç”ŸæˆPTradeä»£ç </p>\n                    </div>\n                </div>\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'optimizeStrategy\'})">\n                    <div class="quick-icon">ğŸ”</div>\n                    <div class="quick-info">\n                        <h4>ç­–ç•¥ä¼˜åŒ–</h4>\n                        <p>åˆ†æå¹¶ä¼˜åŒ–ç­–ç•¥ä»£ç </p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'showLogs\'})">\n                    <div class="quick-icon">ğŸ“‹</div>\n                    <div class="quick-info">\n                        <h4>æŸ¥çœ‹æ—¥å¿—</h4>\n                        <p>ç³»ç»Ÿè¿è¡Œæ—¥å¿—</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- ç³»ç»Ÿç®¡ç† --\x3e\n        <div class="quick-section">\n            <div class="section-title">ğŸ”§ ç³»ç»Ÿç®¡ç†ä¸æ–‡ä»¶ä¸­å¿ƒ</div>\n            <div class="quick-grid">\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'launchFileDashboard\'})">\n                    <div class="quick-icon">ğŸ“</div>\n                    <div class="quick-info">\n                        <h4>æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ</h4>\n                        <p>Webä»ªè¡¨ç›˜(ç­–ç•¥/æŠ¥å‘Š/æ•°æ®åº“)</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'generateInvestmentReport\'})">\n                    <div class="quick-icon">ğŸ“Š</div>\n                    <div class="quick-info">\n                        <h4>ç”ŸæˆæŠ•èµ„æŠ¥å‘Š</h4>\n                        <p>AIç»¼åˆåˆ†ææŠ¥å‘Š</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'syncFileChanges\'})">\n                    <div class="quick-icon">ğŸ”„</div>\n                    <div class="quick-info">\n                        <h4>æ™ºèƒ½åŒæ­¥</h4>\n                        <p>æ£€æµ‹æ›´æ–°çš„æ–‡ä»¶</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'exportDatabase\'})">\n                    <div class="quick-icon">ğŸ—„ï¸</div>\n                    <div class="quick-info">\n                        <h4>æ•°æ®åº“ç®¡ç†</h4>\n                        <p>å¯¼å‡º/å¤‡ä»½MongoDB</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'openSettings\'})">\n                    <div class="quick-icon">âš™ï¸</div>\n                    <div class="quick-info">\n                        <h4>ç³»ç»Ÿè®¾ç½®</h4>\n                        <p>é…ç½®å‚æ•°ç®¡ç†</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'showLogs\'})">\n                    <div class="quick-icon">ğŸ“‹</div>\n                    <div class="quick-info">\n                        <h4>è¿è¡Œæ—¥å¿—</h4>\n                        <p>ç³»ç»Ÿè¿è¡Œæ—¥å¿—</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- æœ€è¿‘é¡¹ç›® & å›æµ‹ --\x3e\n        <div class="bottom-grid">\n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ“ æœ€è¿‘é¡¹ç›®</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'openProject\'})">æ‰“å¼€é¡¹ç›®</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="project-list" id="projectList">\n                        <div class="project-item">\n                            <div>\n                                <div class="item-name">ğŸ‰ ç¿æ™ºé‡‘é¾™</div>\n                                <div class="item-date">2024-12-03</div>\n                            </div>\n                            <span style="color: var(--text-muted)">â†’</span>\n                        </div>\n                        <div class="project-item">\n                            <div>\n                                <div class="item-name">ğŸ¦… çµåŠ¨ç¢§é¹¤</div>\n                                <div class="item-date">2024-12-02</div>\n                            </div>\n                            <span style="color: var(--text-muted)">â†’</span>\n                        </div>\n                        <div class="project-item">\n                            <div>\n                                <div class="item-name">ğŸ‹ é£˜é€¸ç´«ç«¹</div>\n                                <div class="item-date">2024-12-01</div>\n                            </div>\n                            <span style="color: var(--text-muted)">â†’</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ“Š æœ€è¿‘å›æµ‹</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'openStep\', step: 7})">æŸ¥çœ‹å…¨éƒ¨</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="backtest-list" id="backtestList">\n                        <div class="backtest-item">\n                            <div>\n                                <div class="item-name">test1 åŠ¨é‡æˆé•¿ç­–ç•¥</div>\n                                <div class="item-date">2024-12-03 15:30</div>\n                            </div>\n                            <div class="item-return positive">+15.2%</div>\n                        </div>\n                        <div class="backtest-item">\n                            <div>\n                                <div class="item-name">momentum ç­–ç•¥</div>\n                                <div class="item-date">2024-12-02 10:15</div>\n                            </div>\n                            <div class="item-return positive">+8.5%</div>\n                        </div>\n                        <div class="backtest-item">\n                            <div>\n                                <div class="item-name">multi_factor å¤šå› å­</div>\n                                <div class="item-date">2024-12-01 14:20</div>\n                            </div>\n                            <div class="item-return negative">-2.1%</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    \x3c!-- åŠ è½½é®ç½© --\x3e\n    <div class="loading-overlay" id="loadingOverlay">\n        <div class="loading-spinner"></div>\n    </div>\n    \n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        // æ‰“å¼€æ¡Œé¢ç³»ç»Ÿï¼ˆå®Œæ•´å·¥ä½œæµï¼‰\n        function openWorkflowPanel() {\n            console.log(\'[MainDashboard HTML] ç‚¹å‡»æ‰“å¼€æ¡Œé¢ç³»ç»ŸæŒ‰é’®\');\n            try {\n                vscode.postMessage({command: \'openWorkflowPanel\'});\n                console.log(\'[MainDashboard HTML] å¯åŠ¨æ¡Œé¢ç³»ç»Ÿæ¶ˆæ¯å·²å‘é€\');\n            } catch (error) {\n                console.error(\'[MainDashboard HTML] å‘é€æ¶ˆæ¯å¤±è´¥:\', error);\n            }\n        }\n        \n        // æ›´æ–°å¸‚åœºçŠ¶æ€\n        function updateMarketStatus(data) {\n            if (!data) return;\n            \n            // å¸‚åœºRegime\n            document.getElementById(\'marketRegime\').textContent = data.regime_cn || data.regime || \'ä¸­æ€§\';\n            document.getElementById(\'marketStyle\').textContent = data.style_rotation || \'å‡è¡¡\';\n            \n            // æŒ‡æ•°æ•°æ®\n            if (data.indices && data.indices.length >= 3) {\n                const [sh, sz, cy] = data.indices;\n                \n                document.getElementById(\'shIndex\').textContent = sh.value?.toFixed(2) || \'-\';\n                document.getElementById(\'shChange\').textContent = (sh.change >= 0 ? \'+\' : \'\') + (sh.change * 100)?.toFixed(2) + \'%\';\n                document.getElementById(\'shChange\').className = \'change \' + (sh.change >= 0 ? \'up\' : \'down\');\n                \n                document.getElementById(\'szIndex\').textContent = sz.value?.toFixed(2) || \'-\';\n                document.getElementById(\'szChange\').textContent = (sz.change >= 0 ? \'+\' : \'\') + (sz.change * 100)?.toFixed(2) + \'%\';\n                document.getElementById(\'szChange\').className = \'change \' + (sz.change >= 0 ? \'up\' : \'down\');\n                \n                document.getElementById(\'cyIndex\').textContent = cy.value?.toFixed(2) || \'-\';\n                document.getElementById(\'cyChange\').textContent = (cy.change >= 0 ? \'+\' : \'\') + (cy.change * 100)?.toFixed(2) + \'%\';\n                document.getElementById(\'cyChange\').className = \'change \' + (cy.change >= 0 ? \'up\' : \'down\');\n            }\n        }\n        \n        // æ›´æ–°æŠ•èµ„ä¸»çº¿\n        function updateMainlines(data) {\n            const container = document.getElementById(\'mainlineList\');\n            if (!data || data.length === 0) {\n                container.innerHTML = \'<div class="empty-state"><div class="icon">ğŸ”¥</div><div>æš‚æ— æŠ•èµ„ä¸»çº¿æ•°æ®</div></div>\';\n                return;\n            }\n            \n            container.innerHTML = data.map((m, i) => {\n                const rankClass = i === 0 ? \'\' : i === 1 ? \'silver\' : i === 2 ? \'bronze\' : \'\';\n                return `\n                    <div class="mainline-item">\n                        <div class="mainline-rank ${rankClass}">${i + 1}</div>\n                        <div class="mainline-info">\n                            <div class="mainline-name">${m.name}</div>\n                            <div class="mainline-industries">${m.industries?.slice(0, 3).join(\' Â· \') || \'\'}</div>\n                        </div>\n                        <div class="mainline-score">â­${m.score}</div>\n                    </div>\n                `;\n            }).join(\'\');\n        }\n        \n        // æ›´æ–°å› å­\n        function updateFactors(data) {\n            const container = document.getElementById(\'factorList\');\n            if (!data || data.length === 0) {\n                container.innerHTML = \'<div class="empty-state"><div class="icon">ğŸ“Š</div><div>æš‚æ— å› å­æ¨è</div></div>\';\n                return;\n            }\n            \n            const icons = [\'ğŸ“ˆ\', \'ğŸ’¹\', \'ğŸ’°\', \'âš¡\', \'ğŸ¯\'];\n            container.innerHTML = data.map((f, i) => `\n                <div class="factor-item">\n                    <div class="factor-icon">${icons[i % icons.length]}</div>\n                    <div class="factor-info">\n                        <div class="factor-name">${f.name}</div>\n                        <div class="factor-category">${f.category || \'é‡åŒ–å› å­\'}</div>\n                    </div>\n                    <div class="factor-weight">${(f.weight * 100).toFixed(0)}%</div>\n                </div>\n            `).join(\'\');\n        }\n        \n        // =====================\n        // å·¥ä½œæµæ­¥éª¤æ‰§è¡Œ\n        // =====================\n        \n        function runStep(step) {\n            vscode.postMessage({command: \'openStep\', step: step});\n        }\n        \n        function showResultPanel() {\n            document.getElementById(\'result-panel\').classList.add(\'visible\');\n        }\n        \n        function hideResultPanel() {\n            document.getElementById(\'result-panel\').classList.remove(\'visible\');\n        }\n        \n        function setStepStatus(step, status) {\n            const stepEl = document.getElementById(\'step-\' + step);\n            const statusEl = document.getElementById(\'status-\' + step);\n            \n            // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»\n            stepEl.classList.remove(\'running\', \'completed\', \'failed\');\n            \n            switch(status) {\n                case \'running\':\n                    stepEl.classList.add(\'running\');\n                    statusEl.textContent = \'â³\';\n                    break;\n                case \'completed\':\n                    stepEl.classList.add(\'completed\');\n                    statusEl.textContent = \'âœ…\';\n                    break;\n                case \'failed\':\n                    stepEl.classList.add(\'failed\');\n                    statusEl.textContent = \'âŒ\';\n                    break;\n                default:\n                    statusEl.textContent = \'â–¶ï¸\';\n            }\n        }\n        \n        function showProgress(show, value, text) {\n            const el = document.getElementById(\'result-progress\');\n            el.style.display = show ? \'block\' : \'none\';\n            if (show) {\n                document.getElementById(\'progress-fill\').style.width = value + \'%\';\n                document.getElementById(\'progress-text\').textContent = text || \'æ‰§è¡Œä¸­...\';\n            }\n        }\n        \n        function formatDetails(details) {\n            if (!details || Object.keys(details).length === 0) {\n                return \'<div style="color:var(--text-muted);">æ— è¯¦ç»†æ•°æ®</div>\';\n            }\n            \n            let html = \'\';\n            \n            // æŠ•èµ„ä¸»çº¿\n            if (details.top_mainlines) {\n                const mainlines = details.top_mainlines;\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#f59e0b;">ğŸ”¥ æŠ•èµ„ä¸»çº¿ TOP\' + mainlines.length + \'</strong></div>\';\n                html += \'<table><tr><th>æ’å</th><th>åç§°</th><th>è¯„åˆ†</th></tr>\';\n                mainlines.slice(0, 10).forEach(ml => {\n                    html += \'<tr><td>#\' + (ml.rank || \'-\') + \'</td><td>\' + (ml.name || \'-\') + \'</td><td style="color:#10b981;">\' + ((ml.composite_score || ml.score || 0).toFixed?.(1) || ml.composite_score || ml.score || \'-\') + \'</td></tr>\';\n                });\n                if (mainlines.length > 10) {\n                    html += \'<tr><td colspan="3" style="color:var(--text-muted);">... å…±\' + mainlines.length + \'ä¸ªä¸»çº¿</td></tr>\';\n                }\n                html += \'</table>\';\n            }\n            \n            // å€™é€‰æ± è‚¡ç¥¨\n            else if (details.stocks) {\n                const stocks = details.stocks;\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#8b5cf6;">ğŸ“¦ å€™é€‰æ± è‚¡ç¥¨ (\' + stocks.length + \'åª)</strong></div>\';\n                html += \'<table><tr><th>ä»£ç </th><th>åç§°</th><th>æ¥æº</th><th>è¯„åˆ†</th></tr>\';\n                stocks.slice(0, 15).forEach(s => {\n                    html += \'<tr><td>\' + (s.code || \'-\') + \'</td><td>\' + (s.name || \'-\') + \'</td><td style="color:var(--text-muted);">\' + (s.source || \'-\') + \'</td><td style="color:#10b981;">\' + ((s.score || 0).toFixed?.(1) || \'-\') + \'</td></tr>\';\n                });\n                html += \'</table>\';\n            }\n            \n            // æ¨èå› å­\n            else if (details.recommended_factors) {\n                const factors = details.recommended_factors;\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#10b981;">ğŸ§® æ¨èå› å­</strong></div>\';\n                html += \'<ul style="margin:0;padding-left:20px;">\';\n                factors.forEach(f => {\n                    const weight = ((f.weight || 0) * 100).toFixed(0);\n                    html += \'<li style="margin:6px 0;"><strong>\' + (f.name || \'-\') + \'</strong> (æƒé‡\' + weight + \'%) - \' + (f.reason || \'\') + \'</li>\';\n                });\n                html += \'</ul>\';\n            }\n            \n            // æ•°æ®æºæ£€æµ‹\n            else if (details.jqdata !== undefined || details.akshare !== undefined) {\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#6366f1;">ğŸ“¡ æ•°æ®æºçŠ¶æ€</strong></div>\';\n                html += \'<table><tr><th>æ•°æ®æº</th><th>çŠ¶æ€</th></tr>\';\n                if (details.jqdata !== undefined) {\n                    html += \'<tr><td>JQData</td><td style="color:\' + (details.jqdata ? \'#10b981\' : \'#ef4444\') + \';">\' + (details.jqdata ? \'âœ… å¯ç”¨\' : \'âŒ ä¸å¯ç”¨\') + \'</td></tr>\';\n                }\n                if (details.akshare !== undefined) {\n                    html += \'<tr><td>AKShare</td><td style="color:\' + (details.akshare ? \'#10b981\' : \'#ef4444\') + \';">\' + (details.akshare ? \'âœ… å¯ç”¨\' : \'âŒ ä¸å¯ç”¨\') + \'</td></tr>\';\n                }\n                html += \'</table>\';\n            }\n            \n            // å¸‚åœºè¶‹åŠ¿\n            else if (details.regime || details.trend_strength !== undefined) {\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#6366f1;">ğŸ“ˆ å¸‚åœºè¶‹åŠ¿åˆ†æ</strong></div>\';\n                html += \'<table><tr><th>æŒ‡æ ‡</th><th>æ•°å€¼</th></tr>\';\n                if (details.regime) html += \'<tr><td>å¸‚åœºRegime</td><td>\' + details.regime + \'</td></tr>\';\n                if (details.trend_strength !== undefined) html += \'<tr><td>è¶‹åŠ¿å¼ºåº¦</td><td>\' + details.trend_strength + \'</td></tr>\';\n                if (details.volatility !== undefined) html += \'<tr><td>æ³¢åŠ¨ç‡</td><td>\' + details.volatility + \'</td></tr>\';\n                if (details.style_rotation) html += \'<tr><td>é£æ ¼è½®åŠ¨</td><td>\' + details.style_rotation + \'</td></tr>\';\n                html += \'</table>\';\n            }\n            \n            // ç­–ç•¥æ–‡ä»¶\n            else if (details.strategy_file) {\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#10b981;">ğŸ’» ç­–ç•¥ç”Ÿæˆå®Œæˆ</strong></div>\';\n                html += \'<div style="background:var(--bg-card);padding:12px;border-radius:8px;">\';\n                html += \'<div>ğŸ“„ ç­–ç•¥æ–‡ä»¶: <strong>\' + details.strategy_file.split(\'/\').pop() + \'</strong></div>\';\n                if (details.platform) html += \'<div>ğŸ¯ ç›®æ ‡å¹³å°: \' + details.platform + \'</div>\';\n                if (details.style) html += \'<div>ğŸ“Š ç­–ç•¥é£æ ¼: \' + details.style + \'</div>\';\n                html += \'</div>\';\n            }\n            \n            // é»˜è®¤JSONæ˜¾ç¤º\n            else {\n                html += \'<pre style="font-size:11px;overflow-x:auto;">\' + JSON.stringify(details, null, 2) + \'</pre>\';\n            }\n            \n            return html;\n        }\n        \n        // å¤„ç†æ¶ˆæ¯\n        window.addEventListener(\'message\', event => {\n            const message = event.data;\n            \n            switch (message.command) {\n                case \'loadingStart\':\n                    document.getElementById(\'loadingOverlay\').classList.add(\'active\');\n                    break;\n                case \'loadingEnd\':\n                    document.getElementById(\'loadingOverlay\').classList.remove(\'active\');\n                    break;\n                case \'marketStatusUpdated\':\n                    updateMarketStatus(message.data);\n                    break;\n                case \'mainlinesUpdated\':\n                    updateMainlines(message.data);\n                    break;\n                case \'factorsUpdated\':\n                    updateFactors(message.data);\n                    break;\n                    \n                // å·¥ä½œæµæ­¥éª¤æ‰§è¡Œ\n                case \'stepStarted\':\n                    setStepStatus(message.step, \'running\');\n                    showResultPanel();\n                    document.getElementById(\'result-title\').textContent = \'ğŸ“‹ \' + message.stepName + \' - æ‰§è¡Œä¸­\';\n                    document.getElementById(\'result-summary\').textContent = \'æ­£åœ¨æ‰§è¡Œ \' + message.stepName + \'...\';\n                    document.getElementById(\'result-details\').innerHTML = \'\';\n                    showProgress(true, 30, \'æ‰§è¡Œä¸­...\');\n                    break;\n                    \n                case \'stepResult\':\n                    setStepStatus(message.step, message.success ? \'completed\' : \'failed\');\n                    showProgress(false);\n                    document.getElementById(\'result-title\').textContent = \'ğŸ“‹ \' + message.stepName + \' - \' + (message.success ? \'âœ… å®Œæˆ\' : \'âŒ å¤±è´¥\');\n                    document.getElementById(\'result-summary\').textContent = message.summary || (message.success ? \'æ‰§è¡ŒæˆåŠŸ\' : \'æ‰§è¡Œå¤±è´¥\');\n                    document.getElementById(\'result-details\').innerHTML = formatDetails(message.details);\n                    break;\n                \n                // ä¸€é”®æ‰§è¡Œå…¨éƒ¨å·¥ä½œæµçš„æ¶ˆæ¯å¤„ç†\n                case \'workflowProgress\':\n                    var data = message.data;\n                    if (data.currentStep) {\n                        setStepStatus(data.currentStep, \'running\');\n                    }\n                    showResultPanel();\n                    document.getElementById(\'result-title\').textContent = \'ğŸ”„ æ‰§è¡Œå·¥ä½œæµ - \' + data.stepName;\n                    document.getElementById(\'result-summary\').textContent = \'è¿›åº¦: \' + Math.round(data.progress) + \'%\';\n                    showProgress(true, data.progress, data.stepName);\n                    break;\n                    \n                case \'workflowStepResult\':\n                    var stepData = message.data;\n                    if (stepData.stepId) {\n                        setStepStatus(stepData.stepId, stepData.success ? \'completed\' : \'failed\');\n                    }\n                    // ç´¯åŠ æ˜¾ç¤ºç»“æœ\n                    var detailsEl = document.getElementById(\'result-details\');\n                    var stepHtml = \'<div style="margin:8px 0;padding:8px;background:var(--bg-card);border-radius:6px;border-left:3px solid \' + \n                        (stepData.success ? \'#10b981\' : \'#ef4444\') + \';">\';\n                    stepHtml += \'<strong>\' + stepData.stepName + \'</strong>: \' + (stepData.success ? \'âœ…\' : \'âŒ\');\n                    stepHtml += \'</div>\';\n                    detailsEl.innerHTML += stepHtml;\n                    break;\n                    \n                case \'workflowComplete\':\n                    var completeData = message.data;\n                    showProgress(false);\n                    document.getElementById(\'result-title\').textContent = completeData.hasError ? \'âš ï¸ å·¥ä½œæµå®Œæˆï¼ˆéƒ¨åˆ†å¤±è´¥ï¼‰\' : \'âœ… å·¥ä½œæµæ‰§è¡Œå®Œæˆ\';\n                    document.getElementById(\'result-summary\').textContent = \'å…±æ‰§è¡Œ \' + completeData.results.length + \' ä¸ªæ­¥éª¤\';\n                    \n                    // æ˜¾ç¤ºæ±‡æ€»\n                    var summaryHtml = \'<div style="margin-top:16px;">\';\n                    summaryHtml += \'<h4 style="color:var(--accent-gold);margin-bottom:8px;">æ‰§è¡Œç»“æœæ±‡æ€»</h4>\';\n                    completeData.results.forEach(function(r) {\n                        summaryHtml += \'<div style="display:flex;align-items:center;gap:8px;margin:4px 0;">\';\n                        summaryHtml += \'<span>\' + (r.success ? \'âœ…\' : \'âŒ\') + \'</span>\';\n                        summaryHtml += \'<span>\' + r.step + \'</span>\';\n                        if (r.error) {\n                            summaryHtml += \'<span style="color:#ef4444;font-size:11px;">(\' + r.error + \')</span>\';\n                        }\n                        summaryHtml += \'</div>\';\n                    });\n                    summaryHtml += \'</div>\';\n                    document.getElementById(\'result-details\').innerHTML += summaryHtml;\n                    break;\n            }\n        });\n    <\/script>\n</body>\n</html>'}dispose(){for(g.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const n=this._disposables.pop();n&&n.dispose()}}}e.MainDashboard=g},144:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createManualLearner=e.ManualLearner=e.createStrategyLearner=e.getKnowledgeStore=e.KnowledgeStore=void 0;var a=t(683);Object.defineProperty(e,"KnowledgeStore",{enumerable:!0,get:function(){return a.KnowledgeStore}}),Object.defineProperty(e,"getKnowledgeStore",{enumerable:!0,get:function(){return a.getKnowledgeStore}});var r=t(46);Object.defineProperty(e,"createStrategyLearner",{enumerable:!0,get:function(){return r.createStrategyLearner}});var i=t(767);Object.defineProperty(e,"ManualLearner",{enumerable:!0,get:function(){return i.ManualLearner}}),Object.defineProperty(e,"createManualLearner",{enumerable:!0,get:function(){return i.createManualLearner}})},150:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StrategyAnalyzer=void 0,e.createStrategyAnalyzer=function(){return new c};const a=t(628),r="StrategyAnalyzer",i=[{pattern:/momentum|åŠ¨é‡|æ¶¨å¹…|æ”¶ç›Šç‡/gi,name:"åŠ¨é‡å› å­",type:"momentum"},{pattern:/rsi|ç›¸å¯¹å¼ºå¼±/gi,name:"RSI",type:"momentum"},{pattern:/macd/gi,name:"MACD",type:"momentum"},{pattern:/pe_ratio|å¸‚ç›ˆç‡|PE/gi,name:"å¸‚ç›ˆç‡",type:"value"},{pattern:/pb_ratio|å¸‚å‡€ç‡|PB/gi,name:"å¸‚å‡€ç‡",type:"value"},{pattern:/ps_ratio|å¸‚é”€ç‡/gi,name:"å¸‚é”€ç‡",type:"value"},{pattern:/roe|å‡€èµ„äº§æ”¶ç›Šç‡/gi,name:"ROE",type:"quality"},{pattern:/roa|èµ„äº§æ”¶ç›Šç‡/gi,name:"ROA",type:"quality"},{pattern:/gross_margin|æ¯›åˆ©ç‡/gi,name:"æ¯›åˆ©ç‡",type:"quality"},{pattern:/revenue_growth|è¥æ”¶å¢é•¿/gi,name:"è¥æ”¶å¢é•¿",type:"growth"},{pattern:/profit_growth|åˆ©æ¶¦å¢é•¿/gi,name:"åˆ©æ¶¦å¢é•¿",type:"growth"},{pattern:/eps_growth|EPSå¢é•¿/gi,name:"EPSå¢é•¿",type:"growth"},{pattern:/ma\d+|å‡çº¿|moving_average/gi,name:"å‡çº¿",type:"technical"},{pattern:/volatility|æ³¢åŠ¨ç‡/gi,name:"æ³¢åŠ¨ç‡",type:"technical"},{pattern:/volume|æˆäº¤é‡|æ¢æ‰‹ç‡/gi,name:"æˆäº¤é‡",type:"technical"}],s={stopLoss:/stop_loss|æ­¢æŸ|æ­¢æŸçº¿?\s*[=:]\s*([\d.]+)/gi,takeProfit:/take_profit|æ­¢ç›ˆ|æ­¢ç›ˆçº¿?\s*[=:]\s*([\d.]+)/gi,maxPosition:/max_position|æœ€å¤§ä»“ä½|æ€»ä»“ä½\s*[=:]\s*([\d.]+)/gi,singleStockMax:/single.*max|å•è‚¡.*ä»“ä½\s*[=:]\s*([\d.]+)/gi,drawdown:/drawdown|å›æ’¤|æœ€å¤§å›æ’¤/gi},o={ptrade:/PTrade|æ’ç”Ÿ|run_daily|run_weekly/i,qmt:/QMT|è¿…æŠ•|xtquant/i,joinquant:/èšå®½|jqdata|set_benchmark/i};class c{analyze(n,e){a.logger.info(`å¼€å§‹åˆ†æç­–ç•¥: ${e||"æœªå‘½å"}`,r);const t={name:this.extractName(n,e),platform:this.detectPlatform(n),factors:this.extractFactors(n),riskControl:this.extractRiskControl(n),stockSelection:this.extractStockSelection(n),trading:this.extractTradingInfo(n),issues:[]};return t.issues=this.detectIssues(t,n),a.logger.info(`ç­–ç•¥åˆ†æå®Œæˆ: ${t.factors.length}ä¸ªå› å­, ${t.issues.length}ä¸ªé—®é¢˜`,r),t}extractName(n,e){const t=n.match(/"""[\s\S]*?([^\n]+)[\s\S]*?"""/);return t?t[1].trim():e?e.replace(/\.(py|txt)$/,""):"æœªå‘½åç­–ç•¥"}detectPlatform(n){for(const[e,t]of Object.entries(o))if(t.test(n))return e;return"unknown"}extractFactors(n){const e=[],t=new Set;for(const{pattern:a,name:r,type:s}of i){const i=n.matchAll(a);for(const a of i)if(!t.has(r)){t.add(r);const i=n.lastIndexOf("\n",a.index)+1,o=n.indexOf("\n",a.index),c=n.slice(i,o>0?o:void 0).trim();e.push({name:r,type:s,code:c.slice(0,100)})}}return e}extractRiskControl(n){const e={hasDrawdownControl:s.drawdown.test(n)},t=n.match(/stop_loss\s*[=:]\s*([\d.]+)/i)||n.match(/æ­¢æŸ.*?([\d.]+)/);t&&(e.stopLoss=parseFloat(t[1]));const a=n.match(/take_profit\s*[=:]\s*([\d.]+)/i)||n.match(/æ­¢ç›ˆ.*?([\d.]+)/);a&&(e.takeProfit=parseFloat(a[1]));const r=n.match(/max_position\s*[=:]\s*([\d.]+)/i)||n.match(/æœ€å¤§ä»“ä½.*?([\d.]+)/);r&&(e.maxPosition=parseFloat(r[1]));const i=n.match(/single.*max\s*[=:]\s*([\d.]+)/i);return i&&(e.singleStockMax=parseFloat(i[1])),e}extractStockSelection(n){const e={universe:"æœªçŸ¥",filters:[]};/æ²ªæ·±300|000300/i.test(n)?e.universe="æ²ªæ·±300":/ä¸­è¯500|000905/i.test(n)?e.universe="ä¸­è¯500":/åˆ›ä¸šæ¿/i.test(n)?e.universe="åˆ›ä¸šæ¿":/å…¨å¸‚åœº|all_stocks/i.test(n)&&(e.universe="å…¨å¸‚åœº"),/ST/i.test(n)&&e.filters.push("æ’é™¤ST"),/åœç‰Œ|is_paused/i.test(n)&&e.filters.push("æ’é™¤åœç‰Œ"),/æ¶¨è·Œåœ|limit/i.test(n)&&e.filters.push("æ’é™¤æ¶¨è·Œåœ"),/å¸‚å€¼.*?äº¿|market_cap/i.test(n)&&e.filters.push("å¸‚å€¼ç­›é€‰");const t=n.match(/g\.stock_num\s*=\s*(\d+)/i)||n.match(/top.*?(\d+)/i);return t&&(e.topN=parseInt(t[1])),e}extractTradingInfo(n){const e={frequency:"daily",hasTimingLogic:!1};/run_monthly|æœˆåº¦/i.test(n)?e.frequency="monthly":/run_weekly|å‘¨åº¦|æ¯å‘¨/i.test(n)?e.frequency="weekly":/åˆ†é’Ÿ|intraday|minute/i.test(n)&&(e.frequency="intraday");const t=n.match(/rebalance_day\s*=\s*['"]?(\w+)['"]?/i);return t&&(e.rebalanceDay=t[1]),e.hasTimingLogic=/æ‹©æ—¶|timing|å¤§ç›˜.*åˆ¤æ–­|å¸‚åœº.*çŠ¶æ€/i.test(n),e}detectIssues(n,e){const t=[];return n.riskControl.stopLoss||t.push({type:"warning",category:"risk",message:"æœªè®¾ç½®æ­¢æŸçº¿",suggestion:"å»ºè®®è®¾ç½®8%-15%çš„æ­¢æŸçº¿æ§åˆ¶é£é™©"}),n.riskControl.maxPosition||t.push({type:"suggestion",category:"risk",message:"æœªæ˜ç¡®è®¾ç½®æœ€å¤§ä»“ä½",suggestion:"å»ºè®®è®¾ç½®æ€»ä»“ä½ä¸Šé™ï¼Œå¦‚80%"}),n.riskControl.stopLoss&&n.riskControl.stopLoss>.2&&t.push({type:"warning",category:"risk",message:`æ­¢æŸçº¿è¿‡å®½ (${(100*n.riskControl.stopLoss).toFixed(0)}%)`,suggestion:"å»ºè®®æ­¢æŸçº¿ä¸è¶…è¿‡15%"}),0===n.factors.length&&t.push({type:"warning",category:"factor",message:"æœªè¯†åˆ«åˆ°æ˜ç¡®çš„é€‰è‚¡å› å­",suggestion:"å»ºè®®ä½¿ç”¨é‡åŒ–å› å­ï¼ˆå¦‚åŠ¨é‡ã€ä»·å€¼ã€è´¨é‡ï¼‰è¿›è¡Œé€‰è‚¡"}),1===n.factors.length&&t.push({type:"suggestion",category:"factor",message:"ä»…ä½¿ç”¨å•ä¸€å› å­",suggestion:"å»ºè®®ç»„åˆå¤šä¸ªä½ç›¸å…³å› å­æé«˜ç¨³å®šæ€§"}),n.stockSelection.topN&&n.stockSelection.topN<5&&t.push({type:"warning",category:"risk",message:`æŒè‚¡æ•°é‡è¿‡å°‘ (${n.stockSelection.topN}åª)`,suggestion:"å»ºè®®æŒæœ‰5-20åªè‚¡ç¥¨åˆ†æ•£é£é™©"}),/def\s+initialize/i.test(e)||t.push({type:"error",category:"code",message:"ç¼ºå°‘initializeå‡½æ•°",suggestion:"éœ€è¦å®šä¹‰initialize(context)åˆå§‹åŒ–å‡½æ•°"}),t}}e.StrategyAnalyzer=c},187:(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.generateProjectName=function(){return`${t[Math.floor(Math.random()*t.length)]}${a[Math.floor(Math.random()*a.length)]}${r[Math.floor(Math.random()*r.length)]}`},e.validateProjectName=function(n){return!(!n||n.length<3)&&!/[<>:"/\\|?*]/.test(n)},e.getNamingRuleDescription=function(){return"å‘½åè§„åˆ™ï¼šå½¢å®¹è¯ + é¢œè‰² + åŠ¨ç‰©/æ¤ç‰©\nä¾‹å¦‚ï¼šç¿æ™ºé‡‘é¾™ã€é£˜é€¸ç´«ç«¹ã€çµåŠ¨ç¢§é¹¤"};const t=["ç¿æ™º","çµåŠ¨","é£˜é€¸","ç¨³å¥","å¨æ­¦","é›„æµ‘","æ¸…é›…","ä¿Šç§€","è±ªè¿ˆ","æ‚ ç„¶","å“è¶Š","ç¥é€Ÿ","æ²‰ç¨³","é”åˆ©","ç£…ç¤´","é€é¥","å‚²ç„¶","è¶…å‡¡","ç²ç‘","æµ©ç€š","æ¿€æ˜‚","ç¥ç¨","ç’€ç’¨","ç‹¬æ­¥","çµæ…§","å‚²è§†","å…´éš†","æ™ºæ…§","èªé¢–","æ˜å¯Ÿ","æ´å¯Ÿ","ç¿æ˜","æ…§çœ¼","æ™ºè°‹","æ˜ç¿","èªæ…§","æ˜æ™º","åˆšçŒ›","é›„å£®","å¨çŒ›","å¼ºæ‚","åˆšæ¯…","åšæ¯…","åˆšå¼º","é›„å¥","å¨çƒˆ","åˆšåŠ²","ä¼˜é›…","æ¸©å©‰","å¨´é™","æ·¡é›…","ç´ é›…","é›…è‡´","æ¸…ç§€","ç§€ç¾","æ¸…ä¸½","é›…ä¸½","è¿…ç–¾","ç–¾é€Ÿ","é£å¿«","ç¥è¡Œ","ç–¾é£","é—ªç”µ","æµæ˜Ÿ","é£é©°","ç–¾é©°","è¿…æ·","æ¢å¼˜","å£®é˜”","å®ä¼Ÿ","é›„ä¼Ÿ","å£®ä¸½","å®å¤§","å£®ç¾","é›„å£®","å£®ä¼Ÿ","å®é˜”","ç¥ç§˜","ç„å¦™","å¹½æ·±","æ·±é‚ƒ","ç„å¥¥","å¹½ç„","æ·±å¥¥","ç„ç§˜","å¹½ç§˜","ç„æ·±","å°Šè´µ","åè´µ","é«˜è´µ","å…¸é›…","é›å®¹","åç¾","å°Šè£","åè´µ","å…¸é›…","é›å","è‡ªç”±","æ— æ‹˜","è‡ªåœ¨","æ´’è„±","ä¸ç¾","è¶…è„±","æ”¾è¾¾","æ—·è¾¾","è¶…ç„¶","è¶…é€¸","åšéŸ§","é¡½å¼º","ä¸å±ˆ","åˆšéŸ§","åšå¿","é¡½å¼º","åšéŸ§","åˆšéŸ§","ä¸å±ˆ","åšæ¯…","è½»çµ","æ•æ·","çµæ´»","è½»å¿«","è½»å·§","çµå·§","è½»æ·","æ•æ·","è½»æ•","çµæ·","ç‹¬ç‰¹","éå‡¡","å“è¶Š","æ°å‡º","å‡ºä¼—","è¶…ç¾¤","å“è¶Š","æ°å‡º","å‡ºä¼—","è¶…ç»"],a=["é‡‘","é“¶","ç¢§","ç´«","èµ¤","é’","å¢¨","æœ±","ç¿ ","ç„","è‹","ç»¯","éœœ","ç‚","éœ“","ç™½","é»„","ç»¿","è“","çº¢","é»‘","ç°","è¤","æ©™","ç²‰","æ£•","é›","é›","é›","é›","é‡‘é»„","é‡‘æ©™","é‡‘çº¢","é‡‘æ£•","é‡‘è¤","é“¶ç™½","é“¶ç°","é“¶è“","é“¶é’","é“¶å¢¨","é’è“","é’ç»¿","é’ç™½","é’ç°","é’å¢¨","ç¢§ç»¿","ç¢§è“","ç¢§é’","ç¢§éœ„","ç¢§ç‰","ç´«çº¢","ç´«è“","ç´«é’","ç´«é»‘","ç´«ç™½","ç´«éœ","ç´«äº‘","ç´«çƒŸ","ç´«é›¾","ç´«å…‰","èµ¤çº¢","æœ±çº¢","ç»¯çº¢","å«£çº¢","ä¸¹çº¢","ç«çº¢","æ®·çº¢","ç»›çº¢","èŒœçº¢","èƒ­çº¢","ç¿ ç»¿","çŸ³ç»¿","å¢¨ç»¿","æ·±ç»¿","æµ…ç»¿","è‰ç»¿","ç«¹ç»¿","æ¾ç»¿","æŸç»¿","è·ç»¿","å¤©è“","æµ·è“","æ·±è“","æµ…è“","æ¹–è“","é›è“","å®è“","æ¹›è“","è”šè“","å†°è“","ç‰ç™½","é›ªç™½","é“¶ç™½","éœœç™½","æœˆç™½","ç´ ç™½","çº¯ç™½","ä¹³ç™½","ç±³ç™½","è±¡ç‰™ç™½","å¢¨é»‘","ç„é»‘","æ¼†é»‘","ä¹Œé»‘","æ·±é»‘","å¢¨è‰²","ç„å¢¨","å¢¨é’","å¢¨ç»¿","å¢¨è“","ç„é»„","é‡‘é»„","åœŸé»„","æ©™é»„","ç±³é»„","æ·¡é»„","æ·±é»„","æµ…é»„","é¹…é»„","æé»„","æš®éœ­","ä¸é¦™","è—•è·","çŸ³ç»¿","ç¿¡ç¿ ","ç¥ç€","ç›ç‘™","çç ","çŠç‘š","ç‰ç’ƒ","éœå…‰","äº‘å½©","é›¾éœ­","çƒŸéœ","è™¹éœ“","æ™¨æ›¦","å¤•ç…§","æœˆå","æ˜Ÿå…‰","æ—¥å…‰"],r=["é¾™","å‡¤","è™","é¹¤","é¹°","ç‹®","éºŸ","é¹","ç‡•","è±¹","è›Ÿ","é›€","ç’","éª¥","é²²","ç‹¼","ç†Š","è±¡","é¹¿","é©¬","ç‰›","ç¾Š","å…”","é¼ ","è›‡","é±¼","é¾Ÿ","èŸ¹","è™¾","è´","é›•","éš¼","é¹«","é¸¢","é¹","é›","é¹…","é¸­","é¸¡","é¸Ÿ","é¸³é¸¯","å­”é›€","å¤©é¹…","ç™½é¹­","è‹é¹­","ç†Š","è±¡","çŠ€","é³„","é²¨","é²¸","æµ·è±š","æµ·è±¹","æµ·ç‹®","æµ·è±¡","ç‹","ç‹¸","è²‚","é¼¬","ç¾","æ¾é¼ ","åˆºçŒ¬","ç©¿å±±ç”²","ç†ŠçŒ«","é‡‘ä¸çŒ´","ç«¹","æ¾","æ¢…","å…°","èŠ","è·","æŸ","æ¦•","æ¡‚","è²","æŸ³","æ¨","æ§","æ¦†","æ«","æ¡ƒ","æ","æ","æ¢¨","æ£","ç‰¡ä¸¹","èŠè¯","ç«ç‘°","æœˆå­£","èŒ‰è‰","æ €å­","æµ·æ£ ","æ¨±èŠ±","æ¢¨èŠ±","æ¡ƒèŠ±","æèŠ±","æèŠ±","æ¢…èŠ±","å…°èŠ±","èŠèŠ±","è·èŠ±","è²èŠ±","æ°´ä»™","ç™¾åˆ","éƒé‡‘é¦™","ç´«è–‡","ç´«è†","ç´«è—¤","ä¸é¦™","ç‰å…°","æ¢§æ¡","é“¶æ","æ¨Ÿæ ‘","æ¥ æœ¨","æª€æœ¨","ç´«æª€","çº¢æœ¨","æ²‰é¦™","é“æœ¨","ä¹Œæœ¨","ç™½æ¨","å‚æŸ³","ç¿ æŸ","é’æ¾","å¤æ§","çµèŠ","äººå‚","ä½•é¦–ä¹Œ","å†¬è™«å¤è‰","é›ªè²","èŒ¶","æ¡‘","éº»","æ£‰","ç¨»","ç™½æ³½","å¤”ç‰›","çšçœ¦","ä¹å¤´é¸Ÿ","ç¥é¾™","éº’éºŸ","å‡¤å‡°","ç„æ­¦","æœ±é›€","ç™½è™","é’é¾™","é¥•é¤®","è²”è²…","ç‹´çŠ´","ä»™é¹¤","åº”é¾™","çƒ›é¾™","è­é¾™","èŸ é¾™","è™¬é¾™","å›šç‰›","å˜²é£","è’²ç‰¢","ç‹»çŒŠ","éœ¸ä¸‹","è´Ÿå±ƒ","è­å»","æ¤’å›¾","èš£è®","çšçœ¦","ä¹å°¾ç‹","ä¸‰è¶³ä¹Œ","æ¯•æ–¹","é‡æ˜é¸Ÿ","é’é¸Ÿ","ç²¾å«","æ¯”ç¿¼é¸Ÿ","é²²é¹","å¤§é¹","é‡‘ç¿…é¸Ÿ","å¤©é©¬","ç‹¬è§’å…½","éº’éºŸ","è²”è²…","å¤©ç‹—","å¤©ç‹¼","å¤©ç‹","å¤©é¹°","å¤©é¹¤","å¤©é¹","é¾™é±¼","é”¦é²¤","é‡‘é±¼","ç¥é¾Ÿ","çµé¾Ÿ","ç¥é³Œ","ç¥é²¸","ç¥é²¨","ç¥è›Ÿ","ç¥é¾™","ä»™è‰","ç¥æœ¨","çµæ ¹","ä»™æœ","ç¥èŠ±","çµèŠ","äººå‚æœ","èŸ æ¡ƒ","ä»™æ¡ƒ","ç¥æ ‘"]},238:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.generateStrategy=async function(n,e){c.logger.info("æ‰§è¡Œç”Ÿæˆç­–ç•¥å‘½ä»¤",l);try{const e=await async function(){const n=await o.window.showQuickPick(p,{placeHolder:"é€‰æ‹©ç­–ç•¥å¹³å°",title:"Step 1/3: é€‰æ‹©ç›®æ ‡å¹³å°"});return n?.value}();if(!e)return;const t=await async function(){const n=await o.window.showQuickPick(g,{placeHolder:"é€‰æ‹©ç­–ç•¥é£æ ¼",title:"Step 2/3: é€‰æ‹©ç­–ç•¥é£æ ¼"});return n?.value}();if(!t)return;const a=await async function(){const n=await o.window.showQuickPick([{label:"âœ… ä½¿ç”¨é»˜è®¤å‚æ•°",value:"default",description:"æ­¢æŸ8%, æ­¢ç›ˆ20%, å•ç¥¨10%"},{label:"âš™ï¸ è‡ªå®šä¹‰å‚æ•°",value:"custom",description:"æ‰‹åŠ¨é…ç½®é£æ§å‚æ•°"}],{placeHolder:"é£æ§å‚æ•°é…ç½®",title:"Step 3/3: é…ç½®é£æ§å‚æ•°"});if(!n)return;if("default"===n.value)return{max_position:.1,stop_loss:.08,take_profit:.2};const e=await o.window.showInputBox({prompt:"å•ç¥¨æœ€å¤§ä»“ä½ (%)",value:"10",validateInput:n=>{const e=parseFloat(n);return isNaN(e)||e<=0||e>100?"è¯·è¾“å…¥1-100ä¹‹é—´çš„æ•°å­—":null}});if(!e)return;const t=await o.window.showInputBox({prompt:"æ­¢æŸçº¿ (%)",value:"8",validateInput:n=>{const e=parseFloat(n);return isNaN(e)||e<=0||e>50?"è¯·è¾“å…¥1-50ä¹‹é—´çš„æ•°å­—":null}});if(!t)return;const a=await o.window.showInputBox({prompt:"æ­¢ç›ˆçº¿ (%)",value:"20",validateInput:n=>{const e=parseFloat(n);return isNaN(e)||e<=0||e>100?"è¯·è¾“å…¥1-100ä¹‹é—´çš„æ•°å­—":null}});return a?{max_position:parseFloat(e)/100,stop_loss:parseFloat(t)/100,take_profit:parseFloat(a)/100}:void 0}();if(!a)return;await async function(n,e,t,a,r){await o.window.withProgress({location:o.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(e,i)=>{try{e.report({message:"è·å–å¸‚åœºçŠ¶æ€...",increment:0});const s=await n.getMarketStatus();if(i.isCancellationRequested)return;e.report({message:"è·å–æ¨èå› å­...",increment:20});const d=await n.recommendFactors({market_regime:s.data?.regime});if(i.isCancellationRequested)return;e.report({message:`ç”Ÿæˆ${t.toUpperCase()}ç­–ç•¥ä»£ç ...`,increment:30});const p=(d.data||[]).slice(0,5).map(n=>n.name),g=await n.generateStrategy({factors:p,style:a,platform:t,risk_params:r});if(e.report({increment:30}),!g.ok||!g.data)return void o.window.showErrorMessage(`ç”Ÿæˆç­–ç•¥å¤±è´¥: ${g.error||"æœªçŸ¥é”™è¯¯"}`);const m=g.data;c.logger.info(`ç­–ç•¥ç”ŸæˆæˆåŠŸ: ${m.name}`,l),e.report({message:"å®Œæˆ",increment:20}),await async function(n,e,t){const a=await o.workspace.openTextDocument({content:e.code,language:"python"});switch(await o.window.showTextDocument(a,o.ViewColumn.One),await o.window.showInformationMessage(`${t.toUpperCase()} ç­–ç•¥ "${e.name}" å·²ç”Ÿæˆ`,"ä¿å­˜æ–‡ä»¶","å¤åˆ¶ä»£ç ","æŸ¥çœ‹è¯´æ˜")){case"ä¿å­˜æ–‡ä»¶":await async function(n,e){const t=`${n.name}.py`,a=await o.window.showSaveDialog({defaultUri:o.Uri.file(t),filters:{Pythonæ–‡ä»¶:["py"]},title:`ä¿å­˜${e.toUpperCase()}ç­–ç•¥`});if(a){await o.workspace.fs.writeFile(a,Buffer.from(n.code,"utf-8"));const e=o.Uri.file(a.fsPath.replace(".py","_meta.json")),t={name:n.name,platform:n.platform,style:n.style,factors:n.factors,risk_params:n.risk_params,created_at:(new Date).toISOString()};await o.workspace.fs.writeFile(e,Buffer.from(JSON.stringify(t,null,2),"utf-8")),o.window.showInformationMessage(`ç­–ç•¥å·²ä¿å­˜: ${a.fsPath}`),c.logger.info(`ç­–ç•¥ä¿å­˜åˆ°: ${a.fsPath}`,l)}}(e,t);break;case"å¤åˆ¶ä»£ç ":await o.env.clipboard.writeText(e.code),o.window.showInformationMessage("ç­–ç•¥ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿");break;case"æŸ¥çœ‹è¯´æ˜":!function(n){const e=`\n# ç­–ç•¥è¯´æ˜\n\n## åŸºæœ¬ä¿¡æ¯\n- **ç­–ç•¥åç§°**: ${n.name}\n- **ç›®æ ‡å¹³å°**: ${n.platform.toUpperCase()}\n- **ç­–ç•¥é£æ ¼**: ${{multi_factor:"å¤šå› å­é€‰è‚¡",momentum_growth:"åŠ¨é‡æˆé•¿",value:"ä»·å€¼æŠ•èµ„",market_neutral:"å¸‚åœºä¸­æ€§"}[n.style]}\n\n## ä½¿ç”¨å› å­\n${n.factors.map(n=>`- ${n}`).join("\n")}\n\n## é£æ§å‚æ•°\n- **å•ç¥¨æœ€å¤§ä»“ä½**: ${(100*n.risk_params.max_position).toFixed(0)}%\n- **æ­¢æŸçº¿**: ${(100*n.risk_params.stop_loss).toFixed(0)}%\n- **æ­¢ç›ˆçº¿**: ${(100*n.risk_params.take_profit).toFixed(0)}%\n\n## ç­–ç•¥æè¿°\n${n.description}\n\n## ä½¿ç”¨è¯´æ˜\n1. å°†ä»£ç å¤åˆ¶åˆ°${n.platform.toUpperCase()}å®¢æˆ·ç«¯\n2. æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´è‚¡ç¥¨æ± å’Œå‚æ•°\n3. è¿›è¡Œå›æµ‹éªŒè¯åå†å®ç›˜ä½¿ç”¨\n4. æ³¨æ„é£é™©æ§åˆ¶ï¼Œä¸è¦è¶…è¿‡æ‰¿å—èƒ½åŠ›\n    `;o.workspace.openTextDocument({content:e,language:"markdown"}).then(n=>{o.window.showTextDocument(n,o.ViewColumn.Beside)})}(e)}}(0,m,t)}catch(n){d.ErrorHandler.handle(n,l)}})}(n,0,e,t,a)}catch(n){d.ErrorHandler.handle(n,l)}};const o=s(t(398)),c=t(628),d=t(799),l="GenerateStrategy",p=[{label:"ğŸ“Š PTrade (æ’ç”Ÿ)",value:"ptrade",description:"æ’ç”ŸPTradeå¹³å°ï¼Œæ”¯æŒAè‚¡ã€ETFäº¤æ˜“",detail:"å‡½æ•°: initialize(), handle_data()"},{label:"ğŸ“ˆ QMT (è¿…æŠ•)",value:"qmt",description:"è¿…æŠ•QMTå¹³å°ï¼Œæ”¯æŒè‚¡ç¥¨ã€æœŸè´§äº¤æ˜“",detail:"å‡½æ•°: init(), handlebar()"}],g=[{label:"ğŸ“ˆ å¤šå› å­é€‰è‚¡",value:"multi_factor",description:"ç»¼åˆå¤šä¸ªå› å­è¯„åˆ†é€‰è‚¡",detail:"é€‚åˆ: å„ç§å¸‚åœºç¯å¢ƒ"},{label:"ğŸš€ åŠ¨é‡æˆé•¿",value:"momentum_growth",description:"è¿½é€å¼ºåŠ¿æˆé•¿è‚¡",detail:"é€‚åˆ: ç‰›å¸‚ã€é£é™©åå¥½ä¸Šå‡"},{label:"ğŸ’° ä»·å€¼æŠ•èµ„",value:"value",description:"ä½ä¼°å€¼é«˜åˆ†çº¢æ ‡çš„",detail:"é€‚åˆ: ç†Šå¸‚ã€é£é™©åå¥½ä¸‹é™"},{label:"âš–ï¸ å¸‚åœºä¸­æ€§",value:"market_neutral",description:"å¤šç©ºå¯¹å†²ç­–ç•¥",detail:"é€‚åˆ: éœ‡è¡å¸‚ã€ä¸ç¡®å®šç¯å¢ƒ"}]},265:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.activate=async function(n){console.log("[TRQuant] ğŸš€ æ‰©å±•æ¿€æ´»å¼€å§‹..."),$.logger.info("TRQuant Extension æ­£åœ¨æ¿€æ´»...",O);const e=Date.now();try{console.log("[TRQuant] ğŸ“¦ æ³¨å†Œ createProject å‘½ä»¤...");const a=o.commands.registerCommand("trquant.createProject",async()=>{console.log("[TRQuant] âœ… createProject å‘½ä»¤è¢«è§¦å‘!"),o.window.setStatusBarMessage("ğŸ‰ æ­£åœ¨åˆ›å»ºé¡¹ç›®...",2e3);try{const{generateProjectName:e}=await Promise.resolve().then(()=>s(t(187))),a=e();console.log(`[TRQuant] ç”Ÿæˆé¡¹ç›®å: ${a}`);const r=o.workspace.workspaceFolders?.[0];let i;i=r?d.join(r.uri.fsPath,"Projects"):d.join(n.extensionPath,"data","Projects"),c.existsSync(i)||c.mkdirSync(i,{recursive:!0});const l=await o.window.showInputBox({title:"ğŸ‰ åˆ›å»ºé‡åŒ–é¡¹ç›®",prompt:`é¡¹ç›®å°†åˆ›å»ºåœ¨: ${i}`,value:a,valueSelection:[0,a.length],placeHolder:"è¾“å…¥é¡¹ç›®åç§°ï¼ˆå¦‚ï¼šç¿æ™ºé‡‘é¾™ã€é£˜é€¸ç´«ç«¹ã€çµåŠ¨ç¢§é¹¤ï¼‰",ignoreFocusOut:!0,validateInput:n=>n&&0!==n.trim().length?/[<>:"/\\|?*]/.test(n)?"é¡¹ç›®åç§°ä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦":null:"é¡¹ç›®åç§°ä¸èƒ½ä¸ºç©º"});if(!l)return void console.log("[TRQuant] ç”¨æˆ·å–æ¶ˆ");const p=l.trim(),g=d.join(i,p);c.existsSync(g)||c.mkdirSync(g,{recursive:!0});const m=d.join(g,"main.py"),u=new Date,h=new Date(u);h.setMonth(h.getMonth()-3);const v=new Date(h);v.setFullYear(v.getFullYear()-1);const f=n=>`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`;let b="neutral",y=[];try{const n=await(z?.getMarketStatus());n?.ok&&n?.data?.regime&&(b=n.data.regime,console.log(`[TRQuant] è·å–å¸‚åœºçŠ¶æ€: ${b}`));const e=await(z?.getMainlines({top_n:5}));e?.ok&&e?.data&&(y=e.data.slice(0,5).map(n=>({name:n.name||"",industries:n.industries||[]})),console.log(`[TRQuant] è·å–æŠ•èµ„ä¸»çº¿: ${y.map(n=>n.name).join(", ")}`))}catch(n){console.log("[TRQuant] è·å–å·¥ä½œæµæ•°æ®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼")}const x=d.join(n.extensionPath,"templates","strategies","multi_factor_template.py");let w;if(c.existsSync(x)){if(w=c.readFileSync(x,"utf-8"),console.log("[TRQuant] ä½¿ç”¨å®Œæ•´å¤–éƒ¨æ¨¡æ¿"),w=w.replace(/\{project_name\}/g,p).replace(/\{create_time\}/g,(new Date).toLocaleString("zh-CN")).replace(/\{start_date\}/g,f(v)).replace(/\{end_date\}/g,f(h)),w=w.replace(/MARKET_REGIME = 'neutral'/,`MARKET_REGIME = '${b}'`),y.length>0){const n=y.map(n=>`    ('${n.name}', ${JSON.stringify(n.industries)}),`).join("\n");w=w.replace(/HOT_MAINLINES = \[\n {4}\('äººå·¥æ™ºèƒ½'.*?\n {4}\('åŠå¯¼ä½“'.*?\n\]/s,`HOT_MAINLINES = [\n${n}\n]`)}w=w.replace(/\{\{/g,"{").replace(/\}\}/g,"}")}else console.log("[TRQuant] æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä½¿ç”¨ç®€åŒ–æ¨¡æ¿"),w=`# -*- coding: utf-8 -*-\n"""\n${p} - æ™ºèƒ½å¤šå› å­é‡åŒ–ç­–ç•¥\n=====================================\n\nåˆ›å»ºæ—¶é—´: ${(new Date).toLocaleString("zh-CN")}\nå›æµ‹åŒºé—´: ${f(v)} è‡³ ${f(h)}\nåŸºå‡†æŒ‡æ•°: 000300.XSHG (æ²ªæ·±300)\n\nå¸‚åœºçŠ¶æ€: ${b}\næŠ•èµ„ä¸»çº¿: ${y.map(n=>n.name).join(", ")||"æ²ªæ·±300æˆåˆ†è‚¡"}\n"""\n\nimport numpy as np\nimport pandas as pd\n\nMARKET_REGIME = '${b}'\nHOT_MAINLINES = ${JSON.stringify(y.map(n=>[n.name,n.industries]))}\n\ndef initialize(context):\n    set_benchmark('000300.XSHG')\n    g.stock_num = 10\n    g.market_regime = MARKET_REGIME\n    log.info('ç­–ç•¥åˆå§‹åŒ–: ${p}')\n    log.info(f'å¸‚åœºçŠ¶æ€: {g.market_regime}')\n\ndef handle_data(context, data):\n    pass\n`;c.writeFileSync(m,w,"utf-8");const _=await o.workspace.openTextDocument(m);await o.window.showTextDocument(_),o.commands.executeCommand("workbench.files.action.refreshFilesExplorer"),o.window.showInformationMessage(`âœ… é¡¹ç›® "${p}" åˆ›å»ºæˆåŠŸï¼`,"è¿è¡Œå›æµ‹").then(n=>{"è¿è¡Œå›æµ‹"===n&&o.commands.executeCommand("trquant.runBacktest")})}catch(n){console.error("[TRQuant] createProject é”™è¯¯:",n),o.window.showErrorMessage(`åˆ›å»ºé¡¹ç›®å¤±è´¥: ${n}`)}});n.subscriptions.push(a),console.log("[TRQuant] âœ… createProject å‘½ä»¤æ³¨å†ŒæˆåŠŸ");const r=M.ConfigManager.getInstance();n.subscriptions.push({dispose:()=>r.dispose()}),z=new p.TRQuantClient(n),n.subscriptions.push({dispose:()=>z.dispose()}),E=function(){const n=o.window.createStatusBarItem(o.StatusBarAlignment.Right,100);return n.text="$(graph) TRQuant",n.tooltip="TRQuant é‡åŒ–åŠ©æ‰‹ - ç‚¹å‡»æ‰“å¼€æ§åˆ¶é¢æ¿",n.command="trquant.showPanel",n.show(),n}(),n.subscriptions.push(E),function(n){const e=[{id:"trquant.getMarketStatus",handler:()=>(0,m.getMarketStatus)(z,n)},{id:"trquant.getMainlines",handler:()=>(0,u.getMainlines)(z,n)},{id:"trquant.recommendFactors",handler:()=>(0,h.recommendFactors)(z,n)},{id:"trquant.generateStrategy",handler:()=>(0,v.generateStrategy)(z,n)},{id:"trquant.analyzeBacktest",handler:()=>(0,f.analyzeBacktest)(z,n)},{id:"trquant.runBacktest",handler:async()=>{try{console.log("[TRQuant] è¿è¡Œå›æµ‹å‘½ä»¤è§¦å‘"),(0,x.showBacktestConfigPanel)(n.extensionUri,z,n)}catch(n){console.error("[TRQuant] è¿è¡Œå›æµ‹é”™è¯¯:",n),o.window.showErrorMessage(`è¿è¡Œå›æµ‹å¤±è´¥: ${n}`)}}},{id:"trquant.openBacktestConfig",handler:async()=>{(0,x.showBacktestConfigPanel)(n.extensionUri,z,n)}},{id:"trquant.enableMCP",handler:async()=>{await T(n),o.window.showInformationMessage("TRQuant MCP Server å·²å¯ç”¨")}},{id:"trquant.showPanel",handler:async()=>{b.MarketPanel.createOrShow(n.extensionUri,z)}},{id:"trquant.showDashboard",handler:async()=>{y.MainDashboard.createOrShow(n.extensionUri,z)}},{id:"trquant.openDashboard",handler:async()=>{y.MainDashboard.createOrShow(n.extensionUri,z)}},{id:"trquant.showWelcome",handler:async()=>{y.MainDashboard.createOrShow(n.extensionUri,z)}},{id:"trquant.showLogs",handler:async()=>{$.logger.show()}},{id:"trquant.refreshStatus",handler:async()=>{await I(),o.window.showInformationMessage("çŠ¶æ€å·²åˆ·æ–°")}},{id:"trquant.openWorkflowPanel",handler:async()=>{console.log("[TRQuant] æ‰“å¼€å·¥ä½œæµé¢æ¿ -> å¯åŠ¨æ¡Œé¢ç³»ç»Ÿ"),$.logger.info("æ‰“å¼€å·¥ä½œæµé¢æ¿ï¼ˆå¯åŠ¨æ¡Œé¢ç³»ç»Ÿï¼‰",O),await j()}},{id:"trquant.launchDesktopSystem",handler:async()=>{console.log("[TRQuant] å¯åŠ¨æ¡Œé¢ç³»ç»Ÿ"),$.logger.info("å¯åŠ¨æ¡Œé¢ç³»ç»Ÿ",O),await j()}},{id:"trquant.openWorkflowPanelWebview",handler:async()=>{console.log("[TRQuant] æ‰“å¼€WebViewå·¥ä½œæµé¢æ¿"),$.logger.info("æ‰“å¼€WebViewå·¥ä½œæµé¢æ¿",O);const{WorkflowPanel:e}=await Promise.resolve().then(()=>s(t(360)));e.createOrShow(n.extensionUri,z)}},{id:"trquant.localBackup",handler:async()=>{console.log("[TRQuant] æœ¬åœ°å¤‡ä»½"),$.logger.info("æœ¬åœ°å¤‡ä»½",O),await(0,k.localBackup)(n)}},{id:"trquant.gitCommit",handler:async()=>{console.log("[TRQuant] Git Commit"),$.logger.info("Git Commit",O),await(0,k.gitCommit)(n)}},{id:"trquant.refreshSystem",handler:async()=>{console.log("[TRQuant] åˆ·æ–°ç³»ç»Ÿ"),$.logger.info("åˆ·æ–°ç³»ç»Ÿ",O),await(0,k.refreshSystem)(n)}}];for(const{id:t,handler:a}of e){const e=o.commands.registerCommand(t,async()=>{$.logger.debug(`æ‰§è¡Œå‘½ä»¤: ${t}`,O),await C.ErrorHandler.wrap(a,t)});n.subscriptions.push(e)}$.logger.info(`å·²æ³¨å†Œ ${e.length} ä¸ªå‘½ä»¤`,O)}(n),console.log("[TRQuant] âœ… æ‰€æœ‰å‘½ä»¤æ³¨å†Œå®Œæˆ"),(0,y.registerMainDashboard)(n,z),(0,k.registerDeveloperProvider)(n),(0,S.registerWorkflowProvider)(n),(0,P.registerWorkflowStepPanels)(n,z),n.subscriptions.push(o.commands.registerCommand("trquant.guide.createProject",async()=>{await o.commands.executeCommand("workbench.action.quickOpen",">TRQuant: æ–°å»ºé‡åŒ–é¡¹ç›®")})),(0,_.registerStrategyOptimizer)(n,z),(0,w.registerStrategyOptimizerPanel)(n),n.subscriptions.push(o.commands.registerCommand("trquant.openAShareManual",async()=>{try{$.logger.info("=== å¼€å§‹å¯åŠ¨Aè‚¡å®æ“æ‰‹å†Œ ===",O);let e=d.join(n.extensionPath,"AShare-manual");if(c.existsSync(e))$.logger.info(`âœ“ ä½¿ç”¨æ‰©å±•è·¯å¾„: ${e}`,O);else{$.logger.info(`æ‰©å±•è·¯å¾„ä¸å­˜åœ¨ï¼Œå°è¯•å·¥ä½œåŒºè·¯å¾„: ${e}`,O);const n=o.workspace.workspaceFolders?.[0];if(n){const t=d.join(n.uri.fsPath,"extension","AShare-manual");$.logger.info(`æ£€æŸ¥å·¥ä½œåŒºè·¯å¾„: ${t}`,O),c.existsSync(t)?(e=t,$.logger.info(`âœ“ ä½¿ç”¨å·¥ä½œåŒºè·¯å¾„: ${e}`,O)):$.logger.warn(`å·¥ä½œåŒºè·¯å¾„ä¹Ÿä¸å­˜åœ¨: ${t}`,O)}}if(!c.existsSync(e)){const n=`æ‰‹å†Œç›®å½•ä¸å­˜åœ¨: ${e}\nè¯·ç¡®ä¿Aè‚¡æ‰‹å†Œå·²æ­£ç¡®å®‰è£…ã€‚`;return $.logger.error(n,O),void o.window.showErrorMessage(n)}const t=d.join(e,"package.json");if(!c.existsSync(t)){const n=`æ‰‹å†Œé…ç½®ä¸å­˜åœ¨: ${t}`;return $.logger.error(n,O),void o.window.showErrorMessage(n)}$.logger.info(`âœ“ package.jsonå­˜åœ¨: ${t}`,O);const a=d.join(e,"node_modules");if(!c.existsSync(a)){if($.logger.info("æ£€æµ‹åˆ°node_modulesä¸å­˜åœ¨ï¼Œéœ€è¦å®‰è£…ä¾èµ–",O),"å®‰è£…"===await o.window.showWarningMessage("Aè‚¡æ‰‹å†Œéœ€è¦å®‰è£…ä¾èµ–ï¼Œæ˜¯å¦ç°åœ¨å®‰è£…ï¼Ÿ","å®‰è£…","å–æ¶ˆ")){const n=o.window.createTerminal({name:"Aè‚¡æ‰‹å†Œ-å®‰è£…",cwd:e});return n.show(),n.sendText("npm install"),void o.window.showInformationMessage('æ­£åœ¨å®‰è£…ä¾èµ–ï¼Œå®‰è£…å®Œæˆåè¯·é‡æ–°ç‚¹å‡»"ğŸ“š Aè‚¡å®æ“æ‰‹å†Œ"')}return}$.logger.info("âœ“ node_moduleså­˜åœ¨",O),$.logger.info(`å¯åŠ¨npm run devè¿›ç¨‹: ${e}`,O);try{l.spawn("npm",["run","dev"],{cwd:e,stdio:"ignore",detached:!0,shell:!0}).unref(),$.logger.info("âœ“ npm run devè¿›ç¨‹å·²å¯åŠ¨",O),o.window.showInformationMessage("æ­£åœ¨å¯åŠ¨Aè‚¡æ‰‹å†ŒæœåŠ¡å™¨ï¼Œè¯·ç¨å€™..."),setTimeout(async()=>{$.logger.info("å°è¯•æ‰“å¼€æµè§ˆå™¨åˆ° http://localhost:4321",O);try{await o.env.openExternal(o.Uri.parse("http://localhost:4321")),$.logger.info("âœ… Aè‚¡æ‰‹å†Œå·²åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€",O),o.window.showInformationMessage("âœ… Aè‚¡é«˜å€è‚¡å®æ“æ‰‹å†Œå·²å¯åŠ¨ - äº”å†Œå¯¼èˆªé¦–é¡µ")}catch(n){$.logger.warn(`æ‰“å¼€æµè§ˆå™¨å¤±è´¥: ${n}`,O);const e=[4322,4323,4324];for(const n of e)try{return await o.env.openExternal(o.Uri.parse(`http://localhost:${n}`)),$.logger.info(`âœ… å·²æ‰“å¼€Aè‚¡æ‰‹å†Œ (ç«¯å£${n})`,O),void o.window.showInformationMessage(`âœ… Aè‚¡æ‰‹å†Œå·²æ‰“å¼€ (ç«¯å£${n})`)}catch(n){}o.window.showWarningMessage("æ— æ³•è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼Œè¯·æ‰‹åŠ¨è®¿é—® http://localhost:4321")}},2e3)}catch(n){$.logger.error(`å¯åŠ¨è¿›ç¨‹å¤±è´¥: ${n}`,O),o.window.showErrorMessage(`å¯åŠ¨å¤±è´¥: ${n instanceof Error?n.message:String(n)}`)}}catch(n){const e=n instanceof Error?n.message:String(n);$.logger.error(`å¯åŠ¨Aè‚¡æ‰‹å†Œå¤±è´¥: ${e}`,O),o.window.showErrorMessage(`å¯åŠ¨Aè‚¡æ‰‹å†Œå¤±è´¥: ${e}`)}})),$.logger.info("âœ“ Aè‚¡å®æ“æ‰‹å†Œå‘½ä»¤å·²æ³¨å†Œ",O),M.config.get("mcpEnabled")&&await T(n),I();const i=Date.now()-e;$.logger.info(`TRQuant Extension æ¿€æ´»å®Œæˆ (${i}ms)`,O),$.logger.info("å‡†å¤‡æ‰“å¼€ä¸»æ§åˆ¶å°...",O);try{y.MainDashboard.createOrShow(n.extensionUri,z),$.logger.info("âœ… ä¸»æ§åˆ¶å°å·²è‡ªåŠ¨æ‰“å¼€",O)}catch(n){$.logger.error(`âŒ æ‰“å¼€ä¸»æ§åˆ¶å°å¤±è´¥: ${n}`,O),o.window.showErrorMessage(`ä¸»æ§åˆ¶å°æ‰“å¼€å¤±è´¥: ${n}`,"é‡è¯•").then(n=>{"é‡è¯•"===n&&o.commands.executeCommand("trquant.openDashboard")})}o.window.showInformationMessage("ğŸ‰ éŸ¬ç¿é‡åŒ–å·²å¯åŠ¨ï¼")}catch(n){throw C.ErrorHandler.handle(n,O),n}},e.deactivate=function(){$.logger.info("TRQuant Extension æ­£åœ¨åœç”¨...",O),z&&z.dispose(),$.logger.dispose()};const o=s(t(398)),c=s(t(896)),d=s(t(928)),l=s(t(317)),p=t(3),g=t(334),m=t(501),u=t(327),h=t(405),v=t(238),f=t(900),b=t(395),y=t(126),x=t(56),w=t(279),_=t(410),k=t(974),S=t(485),P=t(266),$=t(628),M=t(478),C=t(799),O="Extension";let z,E;async function j(n){const e="/home/taotao/dev/QuantTest/TRQuant",t=d.join(e,"TRQuant.py"),a=d.join(e,"venv","bin","python");if(c.existsSync(t))if(c.existsSync(a)){$.logger.info(`å¯åŠ¨æ¡Œé¢ç³»ç»Ÿ: ${t}`,O);try{l.spawn(a,[t,"--fast"],{cwd:e,detached:!0,stdio:"ignore",env:{...process.env,QT_AUTO_SCREEN_SCALE_FACTOR:"1"}}).unref(),o.window.showInformationMessage("ğŸ–¥ï¸ éŸ¬ç¿é‡åŒ–æ¡Œé¢ç³»ç»Ÿå·²å¯åŠ¨ï¼"),$.logger.info("æ¡Œé¢ç³»ç»Ÿå¯åŠ¨æˆåŠŸ",O)}catch(n){const e=n instanceof Error?n.message:String(n);$.logger.error(`å¯åŠ¨æ¡Œé¢ç³»ç»Ÿå¤±è´¥: ${e}`,O),o.window.showErrorMessage(`å¯åŠ¨æ¡Œé¢ç³»ç»Ÿå¤±è´¥: ${e}`)}}else o.window.showErrorMessage(`Python ç¯å¢ƒä¸å­˜åœ¨: ${a}\nè¯·å…ˆè¿è¡Œ: cd ${e} && python -m venv venv`);else o.window.showErrorMessage(`æ¡Œé¢ç³»ç»Ÿä¸å­˜åœ¨: ${t}\nè¯·ç¡®ä¿ TRQuant é¡¹ç›®å·²æ­£ç¡®å®‰è£…ã€‚`)}async function T(n){try{await g.MCPRegistrar.registerServer(n),$.logger.info("MCP Server å·²æ³¨å†Œ",O)}catch(n){$.logger.warn(`MCPæ³¨å†Œå¤±è´¥: ${n instanceof Error?n.message:String(n)}`,O)}}async function I(){try{const n=await z.getMarketStatus();if(n.ok&&n.data){const e=n.data.regime,t={risk_on:"ğŸ“ˆ",risk_off:"ğŸ“‰",neutral:"â¡ï¸"}[e]||"ğŸ“Š";E.text=`$(graph) ${t} TRQuant`,E.tooltip=`TRQuant | å¸‚åœº: ${e.toUpperCase()}\nç‚¹å‡»æ‰“å¼€æ§åˆ¶é¢æ¿`}}catch(n){$.logger.debug("æ›´æ–°çŠ¶æ€æ å¤±è´¥",O,{error:n})}}},266:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.WorkflowStepPanel=void 0,e.registerWorkflowStepPanels=function(n,e){const t=[{id:"trquant.openDataCenter",step:"data-center"},{id:"trquant.openMarketAnalysis",step:"market-analysis"},{id:"trquant.openMainlines",step:"mainlines"},{id:"trquant.openCandidatePool",step:"candidate-pool"},{id:"trquant.openFactorCenter",step:"factor-center"},{id:"trquant.openStrategyDev",step:"strategy-dev"},{id:"trquant.openBacktestCenter",step:"backtest-center"},{id:"trquant.openTradingCenter",step:"trading-center"}];for(const{id:a,step:r}of t){const t=o.commands.registerCommand(a,()=>{g.createOrShow(n.extensionUri,e,r)});n.subscriptions.push(t)}console.log("[TRQuant] å·¥ä½œæµæ­¥éª¤é¢æ¿å‘½ä»¤å·²æ³¨å†Œ")};const o=s(t(398)),c=t(285),d=t(628),l="WorkflowStepPanel",p={"data-center":{id:"data-center",title:"ğŸ“¡ æ•°æ®ä¸­å¿ƒ",icon:"ğŸ“¡",description:"æ›´æ–°æ•°æ®åº“å’ŒçŸ¥è¯†åº“åˆ°æœ€æ–°çŠ¶æ€",step:1},"market-analysis":{id:"market-analysis",title:"ğŸ“ˆ å¸‚åœºåˆ†æ",icon:"ğŸ“ˆ",description:"åˆ†æå½“å‰å¸‚åœºç¯å¢ƒå’Œè¶‹åŠ¿",step:2},mainlines:{id:"mainlines",title:"ğŸ”¥ æŠ•èµ„ä¸»çº¿",icon:"ğŸ”¥",description:"è¯†åˆ«å½“å‰å¸‚åœºçƒ­ç‚¹å’ŒæŠ•èµ„ä¸»çº¿",step:3},"candidate-pool":{id:"candidate-pool",title:"ğŸ“¦ å€™é€‰æ± ",icon:"ğŸ“¦",description:"åŸºäºåˆ†ææ„å»ºè‚¡ç¥¨å€™é€‰æ± ",step:4},"factor-center":{id:"factor-center",title:"ğŸ“Š å› å­ä¸­å¿ƒ",icon:"ğŸ“Š",description:"æ„å»ºå’Œä¼˜åŒ–é‡åŒ–å› å­",step:5},"strategy-dev":{id:"strategy-dev",title:"ğŸ› ï¸ ç­–ç•¥å¼€å‘",icon:"ğŸ› ï¸",description:"å¼€å‘å’Œä¼˜åŒ–é‡åŒ–äº¤æ˜“ç­–ç•¥",step:6},"backtest-center":{id:"backtest-center",title:"ğŸ”„ å›æµ‹ä¸­å¿ƒ",icon:"ğŸ”„",description:"éªŒè¯ç­–ç•¥åœ¨å†å²æ•°æ®ä¸Šçš„è¡¨ç°",step:7},"trading-center":{id:"trading-center",title:"ğŸš€ äº¤æ˜“ä¸­å¿ƒ",icon:"ğŸš€",description:"å®ç›˜æ¨¡æ‹Ÿå’Œå®ç›˜äº¤æ˜“",step:8}};class g{static panels=new Map;_panel;_extensionUri;_client;_step;_disposables=[];_marketStatus=null;_mainlines=[];_factors=[];_candidates=[];constructor(n,e,t,a){this._panel=n,this._extensionUri=e,this._client=t,this._step=a,this._panel.webview.onDidReceiveMessage(n=>this.handleMessage(n),null,this._disposables),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this.updateContent(),this.loadData()}static createOrShow(n,e,t){const a=o.ViewColumn.One,r=p[t];if(g.panels.has(t)){const n=g.panels.get(t);return n._panel.reveal(a),n}const i=o.window.createWebviewPanel(`trquant-${t}`,`${r.icon} ${r.title}`,a,{enableScripts:!0,retainContextWhenHidden:!0}),s=new g(i,n,e,t);return g.panels.set(t,s),s}async handleMessage(n){switch(console.log(`[${l}] æ”¶åˆ°æ¶ˆæ¯:`,n.command),n.command){case"refresh":await this.loadData();break;case"navigateStep":{const e=n.step;g.createOrShow(this._extensionUri,this._client,e);break}case"executeCommand":n.commandId&&o.commands.executeCommand(n.commandId);break;case"updateData":await this.updateData(n.dataType);break;case"testJQAuth":await this.testJQAuth();break;case"filterCandidates":await this.filterCandidates(n.criteria);break;case"recommendFactors":await this.recommendFactors();break;case"runBacktest":o.commands.executeCommand("trquant.runBacktest");break;case"run_workflow_step":await this.runWorkflowStep(n.step_id||"");break;default:d.logger.warn(`æœªçŸ¥å‘½ä»¤: ${n.command}`,l)}}async loadData(){try{switch(this._step){case"market-analysis":case"data-center":{const n=await this._client.getMarketStatus({});n.ok&&n.data&&(this._marketStatus=n.data);break}case"mainlines":{const n=await this._client.getMainlines({top_n:10});n.ok&&n.data&&(this._mainlines=n.data);break}case"factor-center":{const n=this._marketStatus?.regime||"neutral",e=await this._client.recommendFactors({market_regime:n,top_n:10});e.ok&&e.data&&(this._factors=e.data);break}}this.updateContent()}catch(n){d.logger.error(`åŠ è½½æ•°æ®å¤±è´¥: ${n}`,l)}}async updateData(n){const e=c.DataUpdateService.getInstance();o.window.withProgress({location:o.ProgressLocation.Notification,title:"ğŸ”„ æ•°æ®æ›´æ–°",cancellable:!1},async t=>{try{let a;t.report({increment:0,message:"æ­£åœ¨æ›´æ–°æ•°æ®..."}),a="financial"===n?await e.updateFinancialData():await e.updateMarketData(),t.report({increment:100,message:"å®Œæˆ"}),a.success?o.window.showInformationMessage(`âœ… ${a.message}`,"æŸ¥çœ‹è¯¦æƒ…").then(n=>{if("æŸ¥çœ‹è¯¦æƒ…"===n){const n=o.window.createOutputChannel("TRQuant æ•°æ®æ›´æ–°");if(n.appendLine(a.message),a.details){n.appendLine("\nè¯¦ç»†ä¿¡æ¯:");const e="string"==typeof a.details?a.details:JSON.stringify(a.details,null,2);n.appendLine(e)}n.show()}}):o.window.showErrorMessage(`âŒ ${a.message}`,"æŸ¥çœ‹è¯¦æƒ…").then(n=>{if("æŸ¥çœ‹è¯¦æƒ…"===n){const n=o.window.createOutputChannel("TRQuant æ•°æ®æ›´æ–°");if(n.appendLine(a.message),a.details){n.appendLine("\né”™è¯¯è¯¦æƒ…:");const e="string"==typeof a.details?a.details:JSON.stringify(a.details,null,2);n.appendLine(e)}n.show()}}),await this.loadData()}catch(n){const e=n instanceof Error?n.message:String(n);o.window.showErrorMessage(`æ•°æ®æ›´æ–°å¤±è´¥: ${e}`)}})}async testJQAuth(){const n=c.DataUpdateService.getInstance();o.window.withProgress({location:o.ProgressLocation.Notification,title:"ğŸ” æµ‹è¯•èšå®½è®¤è¯",cancellable:!1},async e=>{try{e.report({increment:0,message:"æ­£åœ¨æµ‹è¯•è®¤è¯..."});const t=await n.testJQAuth();e.report({increment:100,message:"å®Œæˆ"}),t.success?o.window.showInformationMessage(`âœ… ${t.message}`,"æŸ¥çœ‹è¯¦æƒ…").then(n=>{if("æŸ¥çœ‹è¯¦æƒ…"===n){const n=o.window.createOutputChannel("TRQuant è®¤è¯æµ‹è¯•");if(n.appendLine(t.message),t.details){n.appendLine("\nè¯¦ç»†ä¿¡æ¯:");const e="string"==typeof t.details?t.details:JSON.stringify(t.details,null,2);n.appendLine(e)}n.show()}}):o.window.showErrorMessage(`âŒ ${t.message}`,"æŸ¥çœ‹è¯¦æƒ…","æ‰“å¼€é…ç½®").then(n=>{if("æŸ¥çœ‹è¯¦æƒ…"===n){const n=o.window.createOutputChannel("TRQuant è®¤è¯æµ‹è¯•");if(n.appendLine(t.message),t.details){n.appendLine("\né”™è¯¯è¯¦æƒ…:");const e="string"==typeof t.details?t.details:JSON.stringify(t.details,null,2);n.appendLine(e)}n.show()}else if("æ‰“å¼€é…ç½®"===n){const n=o.workspace.workspaceFolders?.[0];if(n){const e=o.Uri.joinPath(n.uri,"config","jqdata_config.json");o.window.showTextDocument(e)}}})}catch(n){const e=n instanceof Error?n.message:String(n);o.window.showErrorMessage(`è®¤è¯æµ‹è¯•å¤±è´¥: ${e}`)}})}async filterCandidates(n){o.window.showInformationMessage("ğŸ” æ­£åœ¨ç­›é€‰å€™é€‰è‚¡ç¥¨...")}async recommendFactors(){const n=this._marketStatus?.regime||"neutral",e=await this._client.recommendFactors({market_regime:n,top_n:10});e.ok&&e.data&&(this._factors=e.data,this.updateContent(),o.window.showInformationMessage("âœ… å› å­æ¨èå®Œæˆ"))}async runWorkflowStep(n){n?o.window.withProgress({location:o.ProgressLocation.Notification,title:`ğŸ”„ æ‰§è¡Œå·¥ä½œæµæ­¥éª¤: ${n}`,cancellable:!1},async e=>{try{e.report({increment:0,message:"æ­£åœ¨æ‰§è¡Œ..."});const t=await this._client.callBridge("run_workflow_step",{step_id:n});e.report({increment:100,message:"å®Œæˆ"});const a=t;if(t.ok){const e=a.summary||"æ‰§è¡ŒæˆåŠŸ";o.window.showInformationMessage(`âœ… ${e}`,"æŸ¥çœ‹è¯¦æƒ…").then(t=>{if("æŸ¥çœ‹è¯¦æƒ…"===t){const t=o.window.createOutputChannel("TRQuant å·¥ä½œæµ");t.appendLine(`æ­¥éª¤: ${n}`),t.appendLine(`ç»“æœ: ${e}`),a.data&&(t.appendLine("\nè¯¦ç»†ä¿¡æ¯:"),t.appendLine(JSON.stringify(a.data,null,2))),t.show()}}),await this.loadData()}else{const e=a.error||"æ‰§è¡Œå¤±è´¥";o.window.showErrorMessage(`âŒ ${e}`,"æŸ¥çœ‹è¯¦æƒ…").then(t=>{if("æŸ¥çœ‹è¯¦æƒ…"===t){const t=o.window.createOutputChannel("TRQuant å·¥ä½œæµ");t.appendLine(`æ­¥éª¤: ${n}`),t.appendLine(`é”™è¯¯: ${e}`),t.show()}})}}catch(n){const e=n instanceof Error?n.message:String(n);o.window.showErrorMessage(`å·¥ä½œæµæ­¥éª¤æ‰§è¡Œå¤±è´¥: ${e}`),d.logger.error(`å·¥ä½œæµæ­¥éª¤æ‰§è¡Œå¤±è´¥: ${n}`,l)}}):o.window.showErrorMessage("âŒ ç¼ºå°‘æ­¥éª¤ID")}updateContent(){this._panel.webview.html=this.generateHtml()}generateHtml(){const n=p[this._step];return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>${n.title}</title>\n    <style>\n        ${this.getStyles()}\n    </style>\n</head>\n<body>\n    <div class="container">\n        \x3c!-- é¡¶éƒ¨å¯¼èˆª --\x3e\n        <div class="workflow-nav">\n            ${this.renderWorkflowNav()}\n        </div>\n        \n        \x3c!-- é¡µé¢å¤´éƒ¨ --\x3e\n        <div class="page-header">\n            <div class="header-content">\n                <div class="step-badge">æ­¥éª¤ ${n.step}</div>\n                <h1>${n.title}</h1>\n                <p class="description">${n.description}</p>\n            </div>\n            <div class="header-actions">\n                <button class="btn btn-primary" onclick="refresh()">\n                    ğŸ”„ åˆ·æ–°æ•°æ®\n                </button>\n                ${n.step<8?`\n                <button class="btn btn-secondary" onclick="navigateStep('${this.getNextStep()}')">\n                    ä¸‹ä¸€æ­¥ â–¶\n                </button>`:""}\n            </div>\n        </div>\n        \n        \x3c!-- ä¸»å†…å®¹åŒº --\x3e\n        <div class="main-content">\n            ${this.renderStepContent()}\n        </div>\n        \n        \x3c!-- åº•éƒ¨æ“ä½œåŒº --\x3e\n        <div class="footer">\n            ${this.renderFooterActions()}\n        </div>\n    </div>\n    \n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        function refresh() {\n            vscode.postMessage({ command: 'refresh' });\n        }\n        \n        function navigateStep(step) {\n            vscode.postMessage({ command: 'navigateStep', step: step });\n        }\n        \n        function executeCommand(commandId) {\n            vscode.postMessage({ command: 'executeCommand', commandId: commandId });\n        }\n        \n        function updateData(dataType) {\n            vscode.postMessage({ command: 'updateData', dataType: dataType });\n        }\n        \n        function testJQAuth() {\n            vscode.postMessage({ command: 'testJQAuth' });\n        }\n        \n        function filterCandidates(criteria) {\n            vscode.postMessage({ command: 'filterCandidates', criteria: criteria });\n        }\n        \n        function recommendFactors() {\n            vscode.postMessage({ command: 'recommendFactors' });\n        }\n    <\/script>\n</body>\n</html>`}renderWorkflowNav(){const n=["data-center","market-analysis","mainlines","candidate-pool","factor-center","strategy-dev","backtest-center","trading-center"];return n.map((e,t)=>{const a=p[e];return`\n                <div class="nav-step ${e===this._step?"active":""} ${t<n.indexOf(this._step)?"past":""}" \n                     onclick="navigateStep('${e}')">\n                    <span class="step-number">${t+1}</span>\n                    <span class="step-icon">${a.icon}</span>\n                </div>\n            `}).join('<div class="nav-connector"></div>')}renderStepContent(){switch(this._step){case"data-center":return this.renderDataCenterContent();case"market-analysis":return this.renderMarketAnalysisContent();case"mainlines":return this.renderMainlinesContent();case"candidate-pool":return this.renderCandidatePoolContent();case"factor-center":return this.renderFactorCenterContent();case"strategy-dev":return this.renderStrategyDevContent();case"backtest-center":return this.renderBacktestCenterContent();case"trading-center":return this.renderTradingCenterContent();default:return'<div class="empty-state">åŠŸèƒ½å¼€å‘ä¸­...</div>'}}renderDataCenterContent(){return'\n            <div class="grid-2">\n                <div class="card">\n                    <div class="card-header">\n                        <h3>ğŸ“Š æ•°æ®æºçŠ¶æ€</h3>\n                    </div>\n                    <div class="card-body">\n                        <div class="status-list">\n                            <div class="status-item">\n                                <span class="status-icon success">âœ“</span>\n                                <span>æ—¥çº¿æ•°æ®</span>\n                                <span class="status-time">æœ€åæ›´æ–°: ä»Šå¤© 15:30</span>\n                            </div>\n                            <div class="status-item">\n                                <span class="status-icon success">âœ“</span>\n                                <span>åˆ†é’Ÿæ•°æ®</span>\n                                <span class="status-time">æœ€åæ›´æ–°: ä»Šå¤© 15:30</span>\n                            </div>\n                            <div class="status-item">\n                                <span class="status-icon warning">!</span>\n                                <span>è´¢åŠ¡æ•°æ®</span>\n                                <span class="status-time">æœ€åæ›´æ–°: æ˜¨å¤©</span>\n                            </div>\n                            <div class="status-item">\n                                <span class="status-icon success">âœ“</span>\n                                <span>åŸºç¡€ä¿¡æ¯</span>\n                                <span class="status-time">æœ€åæ›´æ–°: ä»Šå¤©</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class="card">\n                    <div class="card-header">\n                        <h3>ğŸ“š çŸ¥è¯†åº“</h3>\n                    </div>\n                    <div class="card-body">\n                        <div class="knowledge-stats">\n                            <div class="stat-item">\n                                <div class="stat-value">156</div>\n                                <div class="stat-label">ç­–ç•¥æ¨¡å¼</div>\n                            </div>\n                            <div class="stat-item">\n                                <div class="stat-value">89</div>\n                                <div class="stat-label">å› å­å®šä¹‰</div>\n                            </div>\n                            <div class="stat-item">\n                                <div class="stat-value">45</div>\n                                <div class="stat-label">å›æµ‹æ¡ˆä¾‹</div>\n                            </div>\n                        </div>\n                        <button class="btn btn-outline" onclick="executeCommand(\'trquant.openKnowledgeBase\')">\n                            ç®¡ç†çŸ¥è¯†åº“\n                        </button>\n                    </div>\n                </div>\n            </div>\n            \n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ”„ æ•°æ®æ›´æ–°æ“ä½œ</h3>\n                </div>\n                <div class="card-body">\n                    <div class="action-grid">\n                        <button class="action-btn" onclick="updateData(\'market\')">\n                            <span class="action-icon">ğŸ“ˆ</span>\n                            <span class="action-text">æ›´æ–°è¡Œæƒ…æ•°æ®</span>\n                        </button>\n                        <button class="action-btn" onclick="updateData(\'financial\')">\n                            <span class="action-icon">ğŸ“‹</span>\n                            <span class="action-text">æ›´æ–°è´¢åŠ¡æ•°æ®</span>\n                        </button>\n                        <button class="action-btn" onclick="testJQAuth()">\n                            <span class="action-icon">ğŸ”</span>\n                            <span class="action-text">æµ‹è¯•èšå®½è®¤è¯</span>\n                        </button>\n                        <button class="action-btn" onclick="executeCommand(\'trquant.openKnowledgeBase\')">\n                            <span class="action-icon">ğŸ“š</span>\n                            <span class="action-text">ç®¡ç†çŸ¥è¯†åº“</span>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        '}renderMarketAnalysisContent(){const n=this._marketStatus?.regime||"neutral",e={risk_on:"#3fb950",risk_off:"#f85149",neutral:"#f0b429"}[n]||"#f0b429";return`\n            <div class="market-overview">\n                <div class="regime-card" style="border-color: ${e}">\n                    <div class="regime-icon">${"risk_on"===n?"ğŸ“ˆ":"risk_off"===n?"ğŸ“‰":"â¡ï¸"}</div>\n                    <div class="regime-info">\n                        <div class="regime-label">å½“å‰å¸‚åœºçŠ¶æ€</div>\n                        <div class="regime-value" style="color: ${e}">${{risk_on:"é£é™©åå¥½",risk_off:"é¿é™©",neutral:"éœ‡è¡"}[n]||n}</div>\n                    </div>\n                </div>\n            </div>\n            \n            <div class="grid-3">\n                <div class="index-card">\n                    <div class="index-name">ä¸Šè¯æŒ‡æ•°</div>\n                    <div class="index-value">3,245.67</div>\n                    <div class="index-change positive">+0.85%</div>\n                </div>\n                <div class="index-card">\n                    <div class="index-name">æ·±è¯æˆæŒ‡</div>\n                    <div class="index-value">10,567.89</div>\n                    <div class="index-change positive">+1.23%</div>\n                </div>\n                <div class="index-card">\n                    <div class="index-name">åˆ›ä¸šæ¿æŒ‡</div>\n                    <div class="index-value">2,156.34</div>\n                    <div class="index-change negative">-0.45%</div>\n                </div>\n            </div>\n            \n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ“Š æ¿å—è½®åŠ¨</h3>\n                </div>\n                <div class="card-body">\n                    <div class="sector-list">\n                        <div class="sector-item">\n                            <span class="sector-rank">1</span>\n                            <span class="sector-name">äººå·¥æ™ºèƒ½</span>\n                            <span class="sector-change positive">+3.45%</span>\n                        </div>\n                        <div class="sector-item">\n                            <span class="sector-rank">2</span>\n                            <span class="sector-name">åŠå¯¼ä½“</span>\n                            <span class="sector-change positive">+2.89%</span>\n                        </div>\n                        <div class="sector-item">\n                            <span class="sector-rank">3</span>\n                            <span class="sector-name">æ–°èƒ½æºè½¦</span>\n                            <span class="sector-change positive">+1.67%</span>\n                        </div>\n                        <div class="sector-item">\n                            <span class="sector-rank">4</span>\n                            <span class="sector-name">åŒ»è¯ç”Ÿç‰©</span>\n                            <span class="sector-change positive">+0.89%</span>\n                        </div>\n                        <div class="sector-item">\n                            <span class="sector-rank">5</span>\n                            <span class="sector-name">é“¶è¡Œ</span>\n                            <span class="sector-change negative">-0.23%</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `}renderMainlinesContent(){return`\n            <div class="mainlines-grid">\n                ${(this._mainlines.length>0?this._mainlines.map(n=>({...n,reasoning:n.logic})):[{name:"äººå·¥æ™ºèƒ½",score:92,industries:["è½¯ä»¶","è®¡ç®—æœºè®¾å¤‡"],reasoning:"AIåº”ç”¨åŠ é€Ÿè½åœ°"},{name:"åä¸ºäº§ä¸šé“¾",score:88,industries:["ç”µå­","é€šä¿¡"],reasoning:"è‡ªä¸»å¯æ§æŒç»­æ¨è¿›"},{name:"æ•°æ®è¦ç´ ",score:85,industries:["è®¡ç®—æœº","ä¼ åª’"],reasoning:"æ”¿ç­–æ”¯æŒåŠ›åº¦å¤§"}]).map((n,e)=>`\n                    <div class="mainline-card ${0===e?"highlight":""}">\n                        <div class="mainline-header">\n                            <span class="mainline-rank">#${e+1}</span>\n                            <span class="mainline-score">${n.score?.toFixed(0)||80}</span>\n                        </div>\n                        <div class="mainline-name">${n.name}</div>\n                        <div class="mainline-industries">\n                            ${(n.industries||[]).map(n=>`<span class="industry-tag">${n}</span>`).join("")}\n                        </div>\n                        <div class="mainline-reasoning">${n.reasoning||"çƒ­ç‚¹æŒç»­"}</div>\n                        <button class="btn btn-sm" onclick="filterCandidates({mainline: '${n.name}'})">\n                            æŸ¥çœ‹ç›¸å…³è‚¡ç¥¨\n                        </button>\n                    </div>\n                `).join("")}\n            </div>\n            \n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ¤– LLM ä¸»çº¿åˆ†æ</h3>\n                    <button class="btn btn-sm btn-outline" onclick="executeCommand('trquant.llmMainlines')">\n                        AI åˆ†æ\n                    </button>\n                </div>\n                <div class="card-body">\n                    <div class="llm-analysis">\n                        <p>æ ¹æ®è¿‘æœŸå¸‚åœºèµ°åŠ¿å’Œèµ„é‡‘æµå‘åˆ†æï¼Œå½“å‰å¸‚åœºä¸»è¦èšç„¦äº<strong>ç§‘æŠ€æˆé•¿</strong>æ–¹å‘ï¼š</p>\n                        <ul>\n                            <li>äººå·¥æ™ºèƒ½åº”ç”¨ç«¯æŒç»­å‘é…µï¼Œå…³æ³¨ç®—åŠ›ã€åº”ç”¨è½¯ä»¶</li>\n                            <li>åä¸ºäº§ä¸šé“¾å—ç›Šäºè‡ªä¸»å¯æ§ï¼Œä¼°å€¼æœ‰æœ›ä¿®å¤</li>\n                            <li>æ•°æ®è¦ç´ æ”¿ç­–æ¨è¿›ï¼Œå…³æ³¨æ•°æ®æœåŠ¡å•†</li>\n                        </ul>\n                    </div>\n                </div>\n            </div>\n        `}renderCandidatePoolContent(){return'\n            <div class="filter-section">\n                <div class="card">\n                    <div class="card-header">\n                        <h3>ğŸ” ç­›é€‰æ¡ä»¶</h3>\n                    </div>\n                    <div class="card-body">\n                        <div class="filter-grid">\n                            <div class="filter-item">\n                                <label>å¸‚å€¼èŒƒå›´</label>\n                                <select>\n                                    <option>å…¨éƒ¨</option>\n                                    <option>30-100äº¿</option>\n                                    <option>100-500äº¿</option>\n                                    <option>500äº¿ä»¥ä¸Š</option>\n                                </select>\n                            </div>\n                            <div class="filter-item">\n                                <label>è¡Œä¸š</label>\n                                <select>\n                                    <option>å…¨éƒ¨</option>\n                                    <option>è®¡ç®—æœº</option>\n                                    <option>ç”µå­</option>\n                                    <option>é€šä¿¡</option>\n                                    <option>æ–°èƒ½æº</option>\n                                </select>\n                            </div>\n                            <div class="filter-item">\n                                <label>ROE</label>\n                                <select>\n                                    <option>å…¨éƒ¨</option>\n                                    <option>>15%</option>\n                                    <option>>10%</option>\n                                    <option>>5%</option>\n                                </select>\n                            </div>\n                            <div class="filter-item">\n                                <label>PE</label>\n                                <select>\n                                    <option>å…¨éƒ¨</option>\n                                    <option><30</option>\n                                    <option><50</option>\n                                    <option><100</option>\n                                </select>\n                            </div>\n                        </div>\n                        <div class="filter-actions">\n                            <button class="btn btn-primary" onclick="filterCandidates({})">\n                                åº”ç”¨ç­›é€‰\n                            </button>\n                            <button class="btn btn-outline">\n                                é‡ç½®æ¡ä»¶\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <div class="candidates-section">\n                <div class="card">\n                    <div class="card-header">\n                        <h3>ğŸ“‹ å€™é€‰è‚¡ç¥¨ (ç¤ºä¾‹)</h3>\n                        <span class="badge">256 åª</span>\n                    </div>\n                    <div class="card-body">\n                        <table class="data-table">\n                            <thead>\n                                <tr>\n                                    <th>ä»£ç </th>\n                                    <th>åç§°</th>\n                                    <th>è¡Œä¸š</th>\n                                    <th>å¸‚å€¼</th>\n                                    <th>PE</th>\n                                    <th>ROE</th>\n                                    <th>å…¥æ± ç†ç”±</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                <tr>\n                                    <td>002415</td>\n                                    <td>æµ·åº·å¨è§†</td>\n                                    <td>è®¡ç®—æœº</td>\n                                    <td>2500äº¿</td>\n                                    <td>18.5</td>\n                                    <td>25.3%</td>\n                                    <td>AIé¾™å¤´</td>\n                                </tr>\n                                <tr>\n                                    <td>300750</td>\n                                    <td>å®å¾·æ—¶ä»£</td>\n                                    <td>æ–°èƒ½æº</td>\n                                    <td>8500äº¿</td>\n                                    <td>22.3</td>\n                                    <td>21.5%</td>\n                                    <td>ç”µæ± é¾™å¤´</td>\n                                </tr>\n                                <tr>\n                                    <td>688981</td>\n                                    <td>ä¸­èŠ¯å›½é™…</td>\n                                    <td>åŠå¯¼ä½“</td>\n                                    <td>3200äº¿</td>\n                                    <td>45.6</td>\n                                    <td>8.9%</td>\n                                    <td>èŠ¯ç‰‡åˆ¶é€ </td>\n                                </tr>\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n        '}renderFactorCenterContent(){return`\n            <div class="grid-2">\n                <div class="card">\n                    <div class="card-header">\n                        <h3>ğŸ“Š æ¨èå› å­ç»„åˆ</h3>\n                        <button class="btn btn-sm" onclick="recommendFactors()">\n                            ğŸ”„ é‡æ–°æ¨è\n                        </button>\n                    </div>\n                    <div class="card-body">\n                        <div class="factor-list">\n                            ${(this._factors.length>0?this._factors:[{name:"åŠ¨é‡å› å­",category:"ä»·é‡",weight:.25,description:"20æ—¥åŠ¨é‡"},{name:"ä»·å€¼å› å­",category:"ä¼°å€¼",weight:.2,description:"PE/PBç»¼åˆ"},{name:"è´¨é‡å› å­",category:"åŸºæœ¬é¢",weight:.3,description:"ROE/ROIC"},{name:"æ³¢åŠ¨ç‡å› å­",category:"é£é™©",weight:.15,description:"ä½æ³¢åŠ¨æº¢ä»·"},{name:"æˆé•¿å› å­",category:"åŸºæœ¬é¢",weight:.1,description:"è¥æ”¶å¢é€Ÿ"}]).map(n=>`\n                                <div class="factor-item">\n                                    <div class="factor-info">\n                                        <span class="factor-name">${n.name}</span>\n                                        <span class="factor-category">${n.category}</span>\n                                    </div>\n                                    <div class="factor-weight">\n                                        <div class="weight-bar" style="width: ${100*(n.weight||.2)}%"></div>\n                                        <span>${(100*(n.weight||.2)).toFixed(0)}%</span>\n                                    </div>\n                                </div>\n                            `).join("")}\n                        </div>\n                    </div>\n                </div>\n                \n                <div class="card">\n                    <div class="card-header">\n                        <h3>ğŸ“ˆ å› å­æœ‰æ•ˆæ€§</h3>\n                    </div>\n                    <div class="card-body">\n                        <div class="factor-metrics">\n                            <div class="metric-row">\n                                <span>IC å‡å€¼</span>\n                                <span class="metric-value positive">0.045</span>\n                            </div>\n                            <div class="metric-row">\n                                <span>IC IR</span>\n                                <span class="metric-value positive">1.85</span>\n                            </div>\n                            <div class="metric-row">\n                                <span>å› å­æ”¶ç›Š</span>\n                                <span class="metric-value positive">+15.6%</span>\n                            </div>\n                            <div class="metric-row">\n                                <span>å¤šç©ºæ”¶ç›Š</span>\n                                <span class="metric-value positive">+22.3%</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ“š å› å­åº“</h3>\n                </div>\n                <div class="card-body">\n                    <div class="factor-categories">\n                        <div class="category-tag active">å…¨éƒ¨</div>\n                        <div class="category-tag">ä»·é‡</div>\n                        <div class="category-tag">ä¼°å€¼</div>\n                        <div class="category-tag">åŸºæœ¬é¢</div>\n                        <div class="category-tag">æŠ€æœ¯</div>\n                        <div class="category-tag">å¦ç±»</div>\n                    </div>\n                    <table class="data-table">\n                        <thead>\n                            <tr>\n                                <th>å› å­åç§°</th>\n                                <th>ç±»åˆ«</th>\n                                <th>ICå‡å€¼</th>\n                                <th>IR</th>\n                                <th>çŠ¶æ€</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <tr>\n                                <td>momentum_20d</td>\n                                <td>ä»·é‡</td>\n                                <td>0.052</td>\n                                <td>1.92</td>\n                                <td><span class="status-badge success">æœ‰æ•ˆ</span></td>\n                            </tr>\n                            <tr>\n                                <td>value_composite</td>\n                                <td>ä¼°å€¼</td>\n                                <td>0.038</td>\n                                <td>1.65</td>\n                                <td><span class="status-badge success">æœ‰æ•ˆ</span></td>\n                            </tr>\n                            <tr>\n                                <td>quality_roe</td>\n                                <td>åŸºæœ¬é¢</td>\n                                <td>0.045</td>\n                                <td>1.78</td>\n                                <td><span class="status-badge success">æœ‰æ•ˆ</span></td>\n                            </tr>\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        `}renderStrategyDevContent(){return'\n            <div class="strategy-actions">\n                <div class="action-card" onclick="executeCommand(\'trquant.createProject\')">\n                    <div class="action-icon">ğŸ“</div>\n                    <div class="action-title">æ–°å»ºé¡¹ç›®</div>\n                    <div class="action-desc">åˆ›å»ºæ–°çš„é‡åŒ–ç­–ç•¥é¡¹ç›®</div>\n                </div>\n                <div class="action-card" onclick="executeCommand(\'trquant.openStrategyOptimizer\')">\n                    <div class="action-icon">ğŸ› ï¸</div>\n                    <div class="action-title">ç­–ç•¥ç¼–è¾‘å™¨</div>\n                    <div class="action-desc">æ‰“å¼€ç­–ç•¥ä¼˜åŒ–å™¨</div>\n                </div>\n                <div class="action-card" onclick="executeCommand(\'trquant.generateStrategy\')">\n                    <div class="action-icon">ğŸ¤–</div>\n                    <div class="action-title">AI ç”Ÿæˆ</div>\n                    <div class="action-desc">LLM è¾…åŠ©ç”Ÿæˆç­–ç•¥</div>\n                </div>\n                <div class="action-card" onclick="executeCommand(\'trquant.optimizeStrategy\')">\n                    <div class="action-icon">âš¡</div>\n                    <div class="action-title">å‚æ•°ä¼˜åŒ–</div>\n                    <div class="action-desc">ç½‘æ ¼æœç´¢/éšæœºæœç´¢</div>\n                </div>\n            </div>\n            \n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ“‹ æœ€è¿‘é¡¹ç›®</h3>\n                </div>\n                <div class="card-body">\n                    <div class="project-list">\n                        <div class="project-item">\n                            <div class="project-icon">ğŸ“ˆ</div>\n                            <div class="project-info">\n                                <div class="project-name">é›åé›å…°</div>\n                                <div class="project-meta">å¤šå› å­ç­–ç•¥ | æœ€åä¿®æ”¹: 2å°æ—¶å‰</div>\n                            </div>\n                            <button class="btn btn-sm" onclick="executeCommand(\'trquant.openStrategyOptimizer\')">\n                                æ‰“å¼€\n                            </button>\n                        </div>\n                        <div class="project-item">\n                            <div class="project-icon">ğŸ“Š</div>\n                            <div class="project-info">\n                                <div class="project-name">ç¿æ™ºé‡‘é¾™</div>\n                                <div class="project-meta">åŠ¨é‡ç­–ç•¥ | æœ€åä¿®æ”¹: æ˜¨å¤©</div>\n                            </div>\n                            <button class="btn btn-sm">æ‰“å¼€</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '}renderBacktestCenterContent(){return'\n            <div class="backtest-actions">\n                <button class="btn btn-primary btn-lg" onclick="executeCommand(\'trquant.runBacktest\')">\n                    â–¶ï¸ è¿è¡Œå›æµ‹\n                </button>\n            </div>\n            \n            <div class="grid-2">\n                <div class="card">\n                    <div class="card-header">\n                        <h3>ğŸ“Š å›æµ‹é…ç½®</h3>\n                    </div>\n                    <div class="card-body">\n                        <div class="config-form">\n                            <div class="form-group">\n                                <label>å›æµ‹åŒºé—´</label>\n                                <div class="date-range">\n                                    <input type="date" value="2023-01-01">\n                                    <span>è‡³</span>\n                                    <input type="date" value="2024-12-01">\n                                </div>\n                            </div>\n                            <div class="form-group">\n                                <label>åˆå§‹èµ„é‡‘</label>\n                                <input type="number" value="1000000" step="100000">\n                            </div>\n                            <div class="form-group">\n                                <label>åŸºå‡†æŒ‡æ•°</label>\n                                <select>\n                                    <option>æ²ªæ·±300</option>\n                                    <option>ä¸­è¯500</option>\n                                    <option>åˆ›ä¸šæ¿æŒ‡</option>\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class="card">\n                    <div class="card-header">\n                        <h3>ğŸ“ˆ æœ€è¿‘å›æµ‹</h3>\n                    </div>\n                    <div class="card-body">\n                        <div class="backtest-list">\n                            <div class="backtest-item">\n                                <div class="backtest-info">\n                                    <div class="backtest-name">é›åé›å…° v1.2</div>\n                                    <div class="backtest-time">2024-12-05 14:30</div>\n                                </div>\n                                <div class="backtest-metrics">\n                                    <span class="metric positive">+23.5%</span>\n                                    <span class="metric">å¤æ™® 1.85</span>\n                                </div>\n                            </div>\n                            <div class="backtest-item">\n                                <div class="backtest-info">\n                                    <div class="backtest-name">ç¿æ™ºé‡‘é¾™ v2.0</div>\n                                    <div class="backtest-time">2024-12-04 16:20</div>\n                                </div>\n                                <div class="backtest-metrics">\n                                    <span class="metric positive">+18.2%</span>\n                                    <span class="metric">å¤æ™® 1.52</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ“Š å›æµ‹ç»“æœå¯¹æ¯”</h3>\n                </div>\n                <div class="card-body">\n                    <table class="data-table">\n                        <thead>\n                            <tr>\n                                <th>ç­–ç•¥</th>\n                                <th>å¹´åŒ–æ”¶ç›Š</th>\n                                <th>å¤æ™®æ¯”ç‡</th>\n                                <th>æœ€å¤§å›æ’¤</th>\n                                <th>èƒœç‡</th>\n                                <th>æ“ä½œ</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <tr>\n                                <td>é›åé›å…° v1.2</td>\n                                <td class="positive">+23.5%</td>\n                                <td>1.85</td>\n                                <td class="negative">-12.3%</td>\n                                <td>58%</td>\n                                <td><button class="btn btn-sm">è¯¦æƒ…</button></td>\n                            </tr>\n                            <tr>\n                                <td>ç¿æ™ºé‡‘é¾™ v2.0</td>\n                                <td class="positive">+18.2%</td>\n                                <td>1.52</td>\n                                <td class="negative">-15.6%</td>\n                                <td>54%</td>\n                                <td><button class="btn btn-sm">è¯¦æƒ…</button></td>\n                            </tr>\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        '}renderTradingCenterContent(){return'\n            <div class="trading-overview">\n                <div class="card status-card">\n                    <div class="status-indicator warning"></div>\n                    <div class="status-text">\n                        <div class="status-title">äº¤æ˜“çŠ¶æ€</div>\n                        <div class="status-value">æ¨¡æ‹Ÿè¿è¡Œä¸­</div>\n                    </div>\n                </div>\n            </div>\n            \n            <div class="grid-2">\n                <div class="card">\n                    <div class="card-header">\n                        <h3>ğŸ® æ¨¡æ‹Ÿäº¤æ˜“</h3>\n                    </div>\n                    <div class="card-body">\n                        <div class="paper-trading">\n                            <div class="trading-stat">\n                                <div class="stat-label">æ¨¡æ‹Ÿèµ„é‡‘</div>\n                                <div class="stat-value">Â¥1,000,000</div>\n                            </div>\n                            <div class="trading-stat">\n                                <div class="stat-label">å½“å‰å‡€å€¼</div>\n                                <div class="stat-value positive">Â¥1,156,890</div>\n                            </div>\n                            <div class="trading-stat">\n                                <div class="stat-label">ç´¯è®¡æ”¶ç›Š</div>\n                                <div class="stat-value positive">+15.69%</div>\n                            </div>\n                            <div class="trading-stat">\n                                <div class="stat-label">è¿è¡Œå¤©æ•°</div>\n                                <div class="stat-value">45</div>\n                            </div>\n                        </div>\n                        <div class="trading-actions">\n                            <button class="btn btn-primary">å¯åŠ¨æ¨¡æ‹Ÿ</button>\n                            <button class="btn btn-outline">æš‚åœ</button>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class="card">\n                    <div class="card-header">\n                        <h3>ğŸš€ å®ç›˜éƒ¨ç½²</h3>\n                    </div>\n                    <div class="card-body">\n                        <div class="deploy-section">\n                            <div class="deploy-option">\n                                <div class="option-icon">ğŸ“Š</div>\n                                <div class="option-info">\n                                    <div class="option-name">PTrade</div>\n                                    <div class="option-desc">æ’ç”Ÿ PTrade æ¥å£</div>\n                                </div>\n                                <button class="btn btn-sm">éƒ¨ç½²</button>\n                            </div>\n                            <div class="deploy-option">\n                                <div class="option-icon">âš¡</div>\n                                <div class="option-info">\n                                    <div class="option-name">QMT</div>\n                                    <div class="option-desc">è¿…æŠ• QMT æ¥å£</div>\n                                </div>\n                                <button class="btn btn-sm">éƒ¨ç½²</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ“‹ ä»Šæ—¥äº¤æ˜“ä¿¡å·</h3>\n                </div>\n                <div class="card-body">\n                    <table class="data-table">\n                        <thead>\n                            <tr>\n                                <th>æ—¶é—´</th>\n                                <th>ä»£ç </th>\n                                <th>åç§°</th>\n                                <th>æ–¹å‘</th>\n                                <th>æ•°é‡</th>\n                                <th>ä»·æ ¼</th>\n                                <th>çŠ¶æ€</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <tr>\n                                <td>09:35:22</td>\n                                <td>002415</td>\n                                <td>æµ·åº·å¨è§†</td>\n                                <td class="buy">ä¹°å…¥</td>\n                                <td>1000</td>\n                                <td>35.68</td>\n                                <td><span class="status-badge success">å·²æˆäº¤</span></td>\n                            </tr>\n                            <tr>\n                                <td>10:15:45</td>\n                                <td>300750</td>\n                                <td>å®å¾·æ—¶ä»£</td>\n                                <td class="sell">å–å‡º</td>\n                                <td>500</td>\n                                <td>186.50</td>\n                                <td><span class="status-badge warning">éƒ¨åˆ†æˆäº¤</span></td>\n                            </tr>\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        '}renderFooterActions(){const n=p[this._step],e=this.getPrevStep(),t=this.getNextStep();return`\n            <div class="footer-nav">\n                ${e?`\n                    <button class="btn btn-outline" onclick="navigateStep('${e}')">\n                        â—€ ä¸Šä¸€æ­¥\n                    </button>\n                `:"<div></div>"}\n                \n                <div class="step-progress">\n                    æ­¥éª¤ ${n.step} / 8\n                </div>\n                \n                ${t?`\n                    <button class="btn btn-primary" onclick="navigateStep('${t}')">\n                        ä¸‹ä¸€æ­¥ â–¶\n                    </button>\n                `:'\n                    <button class="btn btn-success">\n                        âœ… å®Œæˆå·¥ä½œæµ\n                    </button>\n                '}\n            </div>\n        `}getNextStep(){const n=["data-center","market-analysis","mainlines","candidate-pool","factor-center","strategy-dev","backtest-center","trading-center"],e=n.indexOf(this._step);return e<n.length-1?n[e+1]:null}getPrevStep(){const n=["data-center","market-analysis","mainlines","candidate-pool","factor-center","strategy-dev","backtest-center","trading-center"],e=n.indexOf(this._step);return e>0?n[e-1]:null}getStyles(){return"\n            :root {\n                --bg-dark: #0a0e14;\n                --bg-primary: #0d1117;\n                --bg-secondary: #161b22;\n                --bg-card: #1c2128;\n                --bg-hover: #262c36;\n                --text-primary: #e6edf3;\n                --text-secondary: #8b949e;\n                --text-muted: #6e7681;\n                --accent-gold: #f0b429;\n                --accent-green: #3fb950;\n                --accent-blue: #58a6ff;\n                --accent-purple: #a371f7;\n                --accent-red: #f85149;\n                --border-color: #30363d;\n            }\n            \n            * { margin: 0; padding: 0; box-sizing: border-box; }\n            \n            body {\n                font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n                background: var(--bg-dark);\n                color: var(--text-primary);\n                min-height: 100vh;\n            }\n            \n            .container {\n                max-width: 1400px;\n                margin: 0 auto;\n                padding: 20px;\n            }\n            \n            /* å·¥ä½œæµå¯¼èˆª */\n            .workflow-nav {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                padding: 16px 0;\n                margin-bottom: 24px;\n                background: var(--bg-secondary);\n                border-radius: 12px;\n                border: 1px solid var(--border-color);\n            }\n            \n            .nav-step {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                cursor: pointer;\n                padding: 8px 16px;\n                border-radius: 8px;\n                transition: all 0.2s;\n            }\n            \n            .nav-step:hover {\n                background: var(--bg-hover);\n            }\n            \n            .nav-step.active {\n                background: var(--accent-gold);\n            }\n            \n            .nav-step.active .step-number,\n            .nav-step.active .step-icon {\n                color: #000;\n            }\n            \n            .nav-step.past .step-number {\n                background: var(--accent-green);\n            }\n            \n            .step-number {\n                width: 24px;\n                height: 24px;\n                border-radius: 50%;\n                background: var(--bg-card);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 12px;\n                font-weight: 600;\n                margin-bottom: 4px;\n            }\n            \n            .step-icon {\n                font-size: 16px;\n            }\n            \n            .nav-connector {\n                width: 30px;\n                height: 2px;\n                background: var(--border-color);\n            }\n            \n            /* é¡µé¢å¤´éƒ¨ */\n            .page-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                margin-bottom: 24px;\n                padding: 20px;\n                background: linear-gradient(135deg, #1a1f2e 0%, #0d1117 100%);\n                border-radius: 12px;\n                border: 1px solid var(--border-color);\n            }\n            \n            .step-badge {\n                display: inline-block;\n                padding: 4px 12px;\n                background: var(--accent-gold);\n                color: #000;\n                border-radius: 20px;\n                font-size: 12px;\n                font-weight: 600;\n                margin-bottom: 8px;\n            }\n            \n            .page-header h1 {\n                font-size: 28px;\n                font-weight: 700;\n                margin-bottom: 8px;\n            }\n            \n            .page-header .description {\n                color: var(--text-secondary);\n                font-size: 14px;\n            }\n            \n            .header-actions {\n                display: flex;\n                gap: 12px;\n            }\n            \n            /* æŒ‰é’® */\n            .btn {\n                padding: 10px 20px;\n                border-radius: 8px;\n                font-size: 14px;\n                font-weight: 500;\n                cursor: pointer;\n                border: 1px solid transparent;\n                transition: all 0.2s;\n            }\n            \n            .btn-primary {\n                background: var(--accent-gold);\n                color: #000;\n            }\n            \n            .btn-primary:hover {\n                background: #d4a030;\n            }\n            \n            .btn-secondary {\n                background: var(--bg-card);\n                color: var(--text-primary);\n                border-color: var(--border-color);\n            }\n            \n            .btn-secondary:hover {\n                background: var(--bg-hover);\n            }\n            \n            .btn-outline {\n                background: transparent;\n                color: var(--text-secondary);\n                border-color: var(--border-color);\n            }\n            \n            .btn-outline:hover {\n                background: var(--bg-hover);\n                color: var(--text-primary);\n            }\n            \n            .btn-success {\n                background: var(--accent-green);\n                color: #fff;\n            }\n            \n            .btn-sm {\n                padding: 6px 12px;\n                font-size: 12px;\n            }\n            \n            .btn-lg {\n                padding: 14px 28px;\n                font-size: 16px;\n            }\n            \n            /* å¡ç‰‡ */\n            .card {\n                background: var(--bg-secondary);\n                border: 1px solid var(--border-color);\n                border-radius: 12px;\n                margin-bottom: 20px;\n            }\n            \n            .card-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 16px 20px;\n                border-bottom: 1px solid var(--border-color);\n            }\n            \n            .card-header h3 {\n                font-size: 16px;\n                font-weight: 600;\n            }\n            \n            .card-body {\n                padding: 20px;\n            }\n            \n            /* ç½‘æ ¼å¸ƒå±€ */\n            .grid-2 {\n                display: grid;\n                grid-template-columns: repeat(2, 1fr);\n                gap: 20px;\n            }\n            \n            .grid-3 {\n                display: grid;\n                grid-template-columns: repeat(3, 1fr);\n                gap: 16px;\n                margin-bottom: 20px;\n            }\n            \n            /* çŠ¶æ€åˆ—è¡¨ */\n            .status-list {\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n            }\n            \n            .status-item {\n                display: flex;\n                align-items: center;\n                gap: 12px;\n                padding: 12px;\n                background: var(--bg-card);\n                border-radius: 8px;\n            }\n            \n            .status-icon {\n                width: 24px;\n                height: 24px;\n                border-radius: 50%;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 12px;\n            }\n            \n            .status-icon.success {\n                background: rgba(63, 185, 80, 0.2);\n                color: var(--accent-green);\n            }\n            \n            .status-icon.warning {\n                background: rgba(240, 180, 41, 0.2);\n                color: var(--accent-gold);\n            }\n            \n            .status-time {\n                margin-left: auto;\n                font-size: 12px;\n                color: var(--text-muted);\n            }\n            \n            /* çŸ¥è¯†åº“ç»Ÿè®¡ */\n            .knowledge-stats {\n                display: grid;\n                grid-template-columns: repeat(3, 1fr);\n                gap: 16px;\n                margin-bottom: 16px;\n            }\n            \n            .stat-item {\n                text-align: center;\n                padding: 16px;\n                background: var(--bg-card);\n                border-radius: 8px;\n            }\n            \n            .stat-value {\n                font-size: 28px;\n                font-weight: 700;\n                color: var(--accent-gold);\n            }\n            \n            .stat-label {\n                font-size: 12px;\n                color: var(--text-muted);\n                margin-top: 4px;\n            }\n            \n            /* æ“ä½œç½‘æ ¼ */\n            .action-grid {\n                display: grid;\n                grid-template-columns: repeat(4, 1fr);\n                gap: 16px;\n            }\n            \n            .action-btn {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                gap: 8px;\n                padding: 20px;\n                background: var(--bg-card);\n                border: 1px solid var(--border-color);\n                border-radius: 12px;\n                cursor: pointer;\n                transition: all 0.2s;\n            }\n            \n            .action-btn:hover {\n                background: var(--bg-hover);\n                border-color: var(--accent-blue);\n                transform: translateY(-2px);\n            }\n            \n            .action-icon {\n                font-size: 32px;\n            }\n            \n            .action-text {\n                font-size: 14px;\n                color: var(--text-secondary);\n            }\n            \n            /* å¸‚åœºæ¦‚è§ˆ */\n            .market-overview {\n                margin-bottom: 20px;\n            }\n            \n            .regime-card {\n                display: flex;\n                align-items: center;\n                gap: 20px;\n                padding: 24px;\n                background: var(--bg-secondary);\n                border: 2px solid;\n                border-radius: 12px;\n            }\n            \n            .regime-icon {\n                font-size: 48px;\n            }\n            \n            .regime-label {\n                font-size: 14px;\n                color: var(--text-muted);\n            }\n            \n            .regime-value {\n                font-size: 32px;\n                font-weight: 700;\n            }\n            \n            /* æŒ‡æ•°å¡ç‰‡ */\n            .index-card {\n                background: var(--bg-secondary);\n                border: 1px solid var(--border-color);\n                border-radius: 12px;\n                padding: 20px;\n                text-align: center;\n            }\n            \n            .index-name {\n                font-size: 14px;\n                color: var(--text-muted);\n                margin-bottom: 8px;\n            }\n            \n            .index-value {\n                font-size: 24px;\n                font-weight: 700;\n                margin-bottom: 4px;\n            }\n            \n            .index-change {\n                font-size: 14px;\n                font-weight: 600;\n            }\n            \n            .index-change.positive {\n                color: var(--accent-green);\n            }\n            \n            .index-change.negative {\n                color: var(--accent-red);\n            }\n            \n            /* æ¿å—åˆ—è¡¨ */\n            .sector-list {\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n            }\n            \n            .sector-item {\n                display: flex;\n                align-items: center;\n                gap: 12px;\n                padding: 12px;\n                background: var(--bg-card);\n                border-radius: 8px;\n            }\n            \n            .sector-rank {\n                width: 24px;\n                height: 24px;\n                border-radius: 50%;\n                background: var(--accent-gold);\n                color: #000;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 12px;\n                font-weight: 600;\n            }\n            \n            .sector-name {\n                flex: 1;\n            }\n            \n            .sector-change {\n                font-weight: 600;\n            }\n            \n            .sector-change.positive {\n                color: var(--accent-green);\n            }\n            \n            .sector-change.negative {\n                color: var(--accent-red);\n            }\n            \n            /* æŠ•èµ„ä¸»çº¿ */\n            .mainlines-grid {\n                display: grid;\n                grid-template-columns: repeat(3, 1fr);\n                gap: 20px;\n                margin-bottom: 20px;\n            }\n            \n            .mainline-card {\n                background: var(--bg-secondary);\n                border: 1px solid var(--border-color);\n                border-radius: 12px;\n                padding: 20px;\n            }\n            \n            .mainline-card.highlight {\n                border-color: var(--accent-gold);\n                background: linear-gradient(135deg, rgba(240, 180, 41, 0.1) 0%, var(--bg-secondary) 100%);\n            }\n            \n            .mainline-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                margin-bottom: 12px;\n            }\n            \n            .mainline-rank {\n                font-size: 14px;\n                font-weight: 600;\n                color: var(--accent-gold);\n            }\n            \n            .mainline-score {\n                padding: 4px 12px;\n                background: var(--accent-gold);\n                color: #000;\n                border-radius: 20px;\n                font-size: 14px;\n                font-weight: 600;\n            }\n            \n            .mainline-name {\n                font-size: 20px;\n                font-weight: 700;\n                margin-bottom: 12px;\n            }\n            \n            .mainline-industries {\n                display: flex;\n                flex-wrap: wrap;\n                gap: 8px;\n                margin-bottom: 12px;\n            }\n            \n            .industry-tag {\n                padding: 4px 8px;\n                background: var(--bg-card);\n                border-radius: 4px;\n                font-size: 12px;\n                color: var(--text-secondary);\n            }\n            \n            .mainline-reasoning {\n                font-size: 14px;\n                color: var(--text-muted);\n                margin-bottom: 16px;\n            }\n            \n            /* LLM åˆ†æ */\n            .llm-analysis {\n                padding: 16px;\n                background: var(--bg-card);\n                border-radius: 8px;\n                line-height: 1.8;\n            }\n            \n            .llm-analysis strong {\n                color: var(--accent-gold);\n            }\n            \n            .llm-analysis ul {\n                margin-top: 12px;\n                padding-left: 20px;\n            }\n            \n            .llm-analysis li {\n                color: var(--text-secondary);\n                margin-bottom: 8px;\n            }\n            \n            /* ç­›é€‰åŒº */\n            .filter-grid {\n                display: grid;\n                grid-template-columns: repeat(4, 1fr);\n                gap: 16px;\n                margin-bottom: 16px;\n            }\n            \n            .filter-item label {\n                display: block;\n                font-size: 12px;\n                color: var(--text-muted);\n                margin-bottom: 6px;\n            }\n            \n            .filter-item select,\n            .filter-item input {\n                width: 100%;\n                padding: 10px;\n                background: var(--bg-card);\n                border: 1px solid var(--border-color);\n                border-radius: 6px;\n                color: var(--text-primary);\n                font-size: 14px;\n            }\n            \n            .filter-actions {\n                display: flex;\n                gap: 12px;\n            }\n            \n            /* æ•°æ®è¡¨æ ¼ */\n            .data-table {\n                width: 100%;\n                border-collapse: collapse;\n            }\n            \n            .data-table th,\n            .data-table td {\n                padding: 12px;\n                text-align: left;\n                border-bottom: 1px solid var(--border-color);\n            }\n            \n            .data-table th {\n                font-size: 12px;\n                font-weight: 600;\n                color: var(--text-muted);\n                text-transform: uppercase;\n            }\n            \n            .data-table tbody tr:hover {\n                background: var(--bg-hover);\n            }\n            \n            .positive {\n                color: var(--accent-green) !important;\n            }\n            \n            .negative {\n                color: var(--accent-red) !important;\n            }\n            \n            .buy {\n                color: var(--accent-green);\n            }\n            \n            .sell {\n                color: var(--accent-red);\n            }\n            \n            /* çŠ¶æ€å¾½ç«  */\n            .status-badge {\n                padding: 4px 8px;\n                border-radius: 4px;\n                font-size: 12px;\n            }\n            \n            .status-badge.success {\n                background: rgba(63, 185, 80, 0.2);\n                color: var(--accent-green);\n            }\n            \n            .status-badge.warning {\n                background: rgba(240, 180, 41, 0.2);\n                color: var(--accent-gold);\n            }\n            \n            .badge {\n                padding: 4px 8px;\n                background: var(--bg-card);\n                border-radius: 4px;\n                font-size: 12px;\n                color: var(--text-muted);\n            }\n            \n            /* å› å­ */\n            .factor-list {\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n            }\n            \n            .factor-item {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 12px;\n                background: var(--bg-card);\n                border-radius: 8px;\n            }\n            \n            .factor-name {\n                font-weight: 500;\n            }\n            \n            .factor-category {\n                font-size: 12px;\n                color: var(--text-muted);\n                margin-left: 8px;\n            }\n            \n            .factor-weight {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            \n            .weight-bar {\n                width: 80px;\n                height: 8px;\n                background: var(--accent-gold);\n                border-radius: 4px;\n            }\n            \n            .factor-metrics {\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n            }\n            \n            .metric-row {\n                display: flex;\n                justify-content: space-between;\n                padding: 8px 0;\n                border-bottom: 1px solid var(--border-color);\n            }\n            \n            .metric-value {\n                font-weight: 600;\n            }\n            \n            .category-tag {\n                display: inline-block;\n                padding: 6px 12px;\n                background: var(--bg-card);\n                border: 1px solid var(--border-color);\n                border-radius: 20px;\n                font-size: 12px;\n                margin-right: 8px;\n                margin-bottom: 12px;\n                cursor: pointer;\n            }\n            \n            .category-tag.active {\n                background: var(--accent-gold);\n                color: #000;\n                border-color: var(--accent-gold);\n            }\n            \n            /* ç­–ç•¥æ“ä½œ */\n            .strategy-actions {\n                display: grid;\n                grid-template-columns: repeat(4, 1fr);\n                gap: 20px;\n                margin-bottom: 20px;\n            }\n            \n            .action-card {\n                background: var(--bg-secondary);\n                border: 1px solid var(--border-color);\n                border-radius: 12px;\n                padding: 24px;\n                text-align: center;\n                cursor: pointer;\n                transition: all 0.2s;\n            }\n            \n            .action-card:hover {\n                background: var(--bg-hover);\n                border-color: var(--accent-blue);\n                transform: translateY(-2px);\n            }\n            \n            .action-card .action-icon {\n                font-size: 40px;\n                margin-bottom: 12px;\n            }\n            \n            .action-card .action-title {\n                font-size: 16px;\n                font-weight: 600;\n                margin-bottom: 8px;\n            }\n            \n            .action-card .action-desc {\n                font-size: 12px;\n                color: var(--text-muted);\n            }\n            \n            /* é¡¹ç›®åˆ—è¡¨ */\n            .project-list {\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n            }\n            \n            .project-item {\n                display: flex;\n                align-items: center;\n                gap: 16px;\n                padding: 16px;\n                background: var(--bg-card);\n                border-radius: 8px;\n            }\n            \n            .project-icon {\n                font-size: 24px;\n            }\n            \n            .project-info {\n                flex: 1;\n            }\n            \n            .project-name {\n                font-weight: 600;\n                margin-bottom: 4px;\n            }\n            \n            .project-meta {\n                font-size: 12px;\n                color: var(--text-muted);\n            }\n            \n            /* å›æµ‹ */\n            .backtest-actions {\n                text-align: center;\n                margin-bottom: 20px;\n            }\n            \n            .config-form {\n                display: flex;\n                flex-direction: column;\n                gap: 16px;\n            }\n            \n            .form-group label {\n                display: block;\n                font-size: 12px;\n                color: var(--text-muted);\n                margin-bottom: 6px;\n            }\n            \n            .form-group input,\n            .form-group select {\n                width: 100%;\n                padding: 10px;\n                background: var(--bg-card);\n                border: 1px solid var(--border-color);\n                border-radius: 6px;\n                color: var(--text-primary);\n            }\n            \n            .date-range {\n                display: flex;\n                align-items: center;\n                gap: 12px;\n            }\n            \n            .date-range input {\n                flex: 1;\n            }\n            \n            .backtest-list {\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n            }\n            \n            .backtest-item {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 12px;\n                background: var(--bg-card);\n                border-radius: 8px;\n            }\n            \n            .backtest-name {\n                font-weight: 500;\n            }\n            \n            .backtest-time {\n                font-size: 12px;\n                color: var(--text-muted);\n            }\n            \n            .backtest-metrics {\n                display: flex;\n                gap: 16px;\n            }\n            \n            .metric {\n                font-size: 14px;\n            }\n            \n            /* äº¤æ˜“ */\n            .trading-overview {\n                margin-bottom: 20px;\n            }\n            \n            .status-card {\n                display: flex;\n                align-items: center;\n                gap: 16px;\n                padding: 20px;\n            }\n            \n            .status-indicator {\n                width: 12px;\n                height: 12px;\n                border-radius: 50%;\n            }\n            \n            .status-indicator.success {\n                background: var(--accent-green);\n                box-shadow: 0 0 8px var(--accent-green);\n            }\n            \n            .status-indicator.warning {\n                background: var(--accent-gold);\n                box-shadow: 0 0 8px var(--accent-gold);\n            }\n            \n            .status-title {\n                font-size: 12px;\n                color: var(--text-muted);\n            }\n            \n            .status-value {\n                font-size: 18px;\n                font-weight: 600;\n            }\n            \n            .paper-trading {\n                display: grid;\n                grid-template-columns: repeat(2, 1fr);\n                gap: 16px;\n                margin-bottom: 16px;\n            }\n            \n            .trading-stat {\n                padding: 12px;\n                background: var(--bg-card);\n                border-radius: 8px;\n                text-align: center;\n            }\n            \n            .trading-stat .stat-label {\n                font-size: 12px;\n                color: var(--text-muted);\n            }\n            \n            .trading-stat .stat-value {\n                font-size: 20px;\n                font-weight: 700;\n                margin-top: 4px;\n            }\n            \n            .trading-actions {\n                display: flex;\n                gap: 12px;\n            }\n            \n            .deploy-section {\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n            }\n            \n            .deploy-option {\n                display: flex;\n                align-items: center;\n                gap: 16px;\n                padding: 16px;\n                background: var(--bg-card);\n                border-radius: 8px;\n            }\n            \n            .option-icon {\n                font-size: 24px;\n            }\n            \n            .option-info {\n                flex: 1;\n            }\n            \n            .option-name {\n                font-weight: 600;\n            }\n            \n            .option-desc {\n                font-size: 12px;\n                color: var(--text-muted);\n            }\n            \n            /* åº•éƒ¨ */\n            .footer {\n                margin-top: 24px;\n                padding: 20px;\n                background: var(--bg-secondary);\n                border-radius: 12px;\n                border: 1px solid var(--border-color);\n            }\n            \n            .footer-nav {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n            }\n            \n            .step-progress {\n                font-size: 14px;\n                color: var(--text-muted);\n            }\n            \n            /* ç©ºçŠ¶æ€ */\n            .empty-state {\n                text-align: center;\n                padding: 40px;\n                color: var(--text-muted);\n            }\n            \n            @media (max-width: 1200px) {\n                .grid-2, .grid-3, .strategy-actions, .action-grid, .mainlines-grid {\n                    grid-template-columns: repeat(2, 1fr);\n                }\n            }\n            \n            @media (max-width: 768px) {\n                .grid-2, .grid-3, .strategy-actions, .action-grid, .mainlines-grid, .filter-grid {\n                    grid-template-columns: 1fr;\n                }\n                \n                .workflow-nav {\n                    display: none;\n                }\n            }\n        "}dispose(){for(g.panels.delete(this._step);this._disposables.length;){const n=this._disposables.pop();n&&n.dispose()}}}e.WorkflowStepPanel=g},279:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.StrategyOptimizerPanel=void 0,e.registerStrategyOptimizerPanel=function(n){n.subscriptions.push(o.window.onDidChangeActiveTextEditor(n=>{"python"===n?.document.languageId&&(u._lastActiveEditor=n)})),o.window.activeTextEditor&&(u._lastActiveEditor=o.window.activeTextEditor),n.subscriptions.push(o.commands.registerCommand("trquant.optimizeStrategy",async()=>{const e=o.window.activeTextEditor,t=n.globalStorageUri.fsPath;if(e){u._lastActiveEditor=e;const a=e.document.getText(),r=d.basename(e.document.fileName);u.createOrShow(n.extensionUri,a,r,t)}else u.createOrShow(n.extensionUri,void 0,void 0,t)})),p.logger.info("ç­–ç•¥ä¼˜åŒ–å™¨é¢æ¿å·²æ³¨å†Œ",g)};const o=s(t(398)),c=s(t(896)),d=s(t(928)),l=s(t(857)),p=t(628),g="StrategyOptimizerPanel";let m=null;class u{static currentPanel;static _lastActiveEditor;_panel;_extensionUri;_storagePath;_disposables=[];_currentTab="editor";_strategyCode="";_strategyName="";_strategyPath="";_report=null;_parameterRanges=[];_optimizationResults=[];_versions=[];_isOptimizing=!1;_optimizationProgress=0;constructor(n,e,t){this._panel=n,this._extensionUri=e,this._storagePath=t,this._panel.webview.onDidReceiveMessage(n=>this.handleMessage(n),null,this._disposables),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this.loadData(),this.updateContent()}static createOrShow(n,e,t,a){const r=o.ViewColumn.One;if(u.currentPanel)return u.currentPanel._panel.reveal(r),e&&t&&u.currentPanel.loadStrategy(e,t),u.currentPanel;const i=o.window.createWebviewPanel("strategyOptimizer","ğŸ”¬ ç­–ç•¥ä¼˜åŒ–å™¨",r,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[n]}),s=a||(o.workspace.workspaceFolders?.[0]?.uri.fsPath?d.join(o.workspace.workspaceFolders[0].uri.fsPath,".trquant","optimizer"):d.join(l.homedir(),".trquant","optimizer"));return u.currentPanel=new u(i,n,s),e&&t&&u.currentPanel.loadStrategy(e,t),u.currentPanel}loadStrategy(n,e,t){this._strategyCode=n,this._strategyName=e,this._strategyPath=t||"",this._parameterRanges=this.extractParameters(n),this._report=null,this.updateContent()}async handleMessage(n){switch(n.command){case"switchTab":this._currentTab=n.tab||"editor",this.updateContent();break;case"selectFile":await this.selectFile();break;case"openInEditor":await this.openInEditor();break;case"analyzeStrategy":await this.analyzeStrategy();break;case"updateParameter":this.updateParameter(n.index??0,n.field??"",n.value);break;case"addParameter":this.addParameter();break;case"removeParameter":this.removeParameter(n.index??0);break;case"startOptimization":await this.startOptimization(n.config||{algorithm:"grid",maxIterations:100,target:"sharpe"});break;case"stopOptimization":this.stopOptimization();break;case"applyResult":await this.applyOptimizationResult(n.resultId||"");break;case"saveVersion":await this.saveVersion(n.description||"");break;case"loadVersion":await this.loadVersion(n.versionId||"");break;case"compareVersions":await this.compareVersions(n.v1||"",n.v2||"");break;case"deleteVersion":this.deleteVersion(n.versionId||"");break;case"exportVersion":await this.exportVersion(n.versionId||"");break;case"saveAndBacktest":await this.saveAndBacktest();break;case"saveAndTrade":await this.saveAndTrade();break;case"applyAdvice":await this.applyAdvice(n.adviceId||"");break;case"codeChanged":this._strategyCode=n.code||"",this._parameterRanges=this.extractParameters(this._strategyCode);break;case"getCodeResponse":this._strategyCode=n.code||"",this._parameterRanges=this.extractParameters(this._strategyCode),await this.analyzeStrategy();break;case"getCodeForSave":this.doSaveVersion(n.code||"",n.description||"");break;case"applyBestResult":this._optimizationResults.length>0&&await this.applyOptimizationResult(this._optimizationResults[0].id);break;case"autoDetectParams":this._parameterRanges=this.extractParameters(this._strategyCode),this.updateContent(),o.window.showInformationMessage(`æ£€æµ‹åˆ° ${this._parameterRanges.length} ä¸ªå¯è°ƒå‚æ•°`);break;case"viewResultDetail":await this.viewResultDetail(n.resultId||"");break;case"exportResults":await this.exportResults();break;case"exportAllVersions":await this.exportAllVersions();break;case"clearAllVersions":this._versions=[],this.saveData(),this.updateContent(),o.window.showInformationMessage("å·²æ¸…ç©ºæ‰€æœ‰ç‰ˆæœ¬");break;case"viewVersionCode":await this.viewVersionCode(n.versionId||"");break;case"exportVisualization":await this.exportVisualization()}}async viewResultDetail(n){const e=this._optimizationResults.find(e=>e.id===n);if(!e)return;const t=`\nä¼˜åŒ–ç»“æœè¯¦æƒ…\n============\næ—¶é—´: ${new Date(e.timestamp).toLocaleString("zh-CN")}\nè¯„åˆ†: ${e.score.toFixed(2)}\n\nå‚æ•°:\n${Object.entries(e.parameters).map(([n,e])=>`  ${n} = ${e}`).join("\n")}\n\næŒ‡æ ‡:\n  æ”¶ç›Šç‡: ${(100*e.metrics.totalReturn).toFixed(2)}%\n  å¤æ™®æ¯”ç‡: ${e.metrics.sharpeRatio.toFixed(2)}\n  æœ€å¤§å›æ’¤: ${(100*e.metrics.maxDrawdown).toFixed(2)}%\n  èƒœç‡: ${(100*e.metrics.winRate).toFixed(1)}%\n        `.trim(),a=await o.workspace.openTextDocument({content:t,language:"plaintext"});await o.window.showTextDocument(a,o.ViewColumn.Beside)}async exportResults(){const n=this._optimizationResults.map(n=>({timestamp:n.timestamp,score:n.score,parameters:n.parameters,metrics:n.metrics})),e=await o.window.showSaveDialog({defaultUri:o.Uri.file(d.join(o.workspace.workspaceFolders?.[0]?.uri.fsPath||l.homedir(),`optimization_results_${Date.now()}.json`)),filters:{JSON:["json"]}});e&&(c.writeFileSync(e.fsPath,JSON.stringify(n,null,2)),o.window.showInformationMessage(`å·²å¯¼å‡º ${n.length} ä¸ªä¼˜åŒ–ç»“æœ`))}async exportAllVersions(){const n=await o.window.showSaveDialog({defaultUri:o.Uri.file(d.join(o.workspace.workspaceFolders?.[0]?.uri.fsPath||l.homedir(),`strategy_versions_${Date.now()}.json`)),filters:{JSON:["json"]}});n&&(c.writeFileSync(n.fsPath,JSON.stringify(this._versions,null,2)),o.window.showInformationMessage(`å·²å¯¼å‡º ${this._versions.length} ä¸ªç‰ˆæœ¬`))}async viewVersionCode(n){const e=this._versions.find(e=>e.id===n);if(!e)return;const t=await o.workspace.openTextDocument({content:e.code,language:"python"});await o.window.showTextDocument(t,o.ViewColumn.Beside)}async exportVisualization(){const n={strategy:this._strategyName,timestamp:(new Date).toISOString(),results:this._optimizationResults,parameters:this._parameterRanges,report:this._report},e=await o.window.showSaveDialog({defaultUri:o.Uri.file(d.join(o.workspace.workspaceFolders?.[0]?.uri.fsPath||l.homedir(),`visualization_${Date.now()}.json`)),filters:{JSON:["json"]}});e&&(c.writeFileSync(e.fsPath,JSON.stringify(n,null,2)),o.window.showInformationMessage("å·²å¯¼å‡ºå¯è§†åŒ–æ•°æ®"))}async openInEditor(){if(!this._strategyPath)return void o.window.showWarningMessage("æ²¡æœ‰ç­–ç•¥æ–‡ä»¶");const n=o.Uri.file(this._strategyPath);await o.window.showTextDocument(n)}async selectFile(){const n=o.workspace.workspaceFolders?.[0]?.uri.fsPath,e=await o.window.showOpenDialog({canSelectFiles:!0,canSelectFolders:!1,canSelectMany:!1,defaultUri:n?o.Uri.file(d.join(n,"Projects")):void 0,filters:{Pythonç­–ç•¥:["py"],æ‰€æœ‰æ–‡ä»¶:["*"]},title:"é€‰æ‹©ç­–ç•¥æ–‡ä»¶"});if(e&&e[0])try{const n=c.readFileSync(e[0].fsPath,"utf-8"),t=d.basename(e[0].fsPath);this.loadStrategy(n,t,e[0].fsPath),this._panel.webview.postMessage({command:"updateCode",code:n,fileName:t}),o.window.showInformationMessage(`å·²åŠ è½½ç­–ç•¥: ${t}`)}catch(n){o.window.showErrorMessage(`è¯»å–æ–‡ä»¶å¤±è´¥: ${n}`)}}async analyzeStrategy(){if(this._strategyCode)try{this._panel.webview.postMessage({command:"showLoading",message:"æ­£åœ¨åˆ†æç­–ç•¥..."});const n=await async function(){if(!m){const n=await Promise.resolve().then(()=>s(t(410)));m=n.strategyOptimizer||n.StrategyOptimizerService?.getInstance()||null}return m}();if(!n)throw new Error("ç­–ç•¥ä¼˜åŒ–å™¨æœåŠ¡æœªåˆå§‹åŒ–");this._report=n.generateOptimizationReport(this._strategyCode,this._strategyName),this._currentTab="analysis",this.updateContent(),o.window.showInformationMessage(`åˆ†æå®Œæˆï¼æ•´ä½“è¯„åˆ†: ${this._report?.overallScore??"N/A"}/100`)}catch(n){p.logger.error(`ç­–ç•¥åˆ†æå¤±è´¥: ${n}`,g),o.window.showErrorMessage(`åˆ†æå¤±è´¥: ${n}`)}else this._panel.webview.postMessage({command:"getCode"})}extractParameters(n){const e=[],t=n.split("\n"),a=new Set,r={STOCK_NUM:{min:5,max:50,step:5,desc:"æŒè‚¡æ•°é‡"},stock_num:{min:5,max:50,step:5,desc:"æŒè‚¡æ•°é‡"},TOP_N:{min:5,max:50,step:5,desc:"é€‰è‚¡æ•°é‡"},top_n:{min:5,max:50,step:5,desc:"é€‰è‚¡æ•°é‡"},N:{min:5,max:50,step:5,desc:"æ•°é‡"},STOP_LOSS:{min:.03,max:.2,step:.01,desc:"æ­¢æŸçº¿"},stop_loss:{min:.03,max:.2,step:.01,desc:"æ­¢æŸçº¿"},TAKE_PROFIT:{min:.1,max:.5,step:.05,desc:"æ­¢ç›ˆçº¿"},take_profit:{min:.1,max:.5,step:.05,desc:"æ­¢ç›ˆçº¿"},MA_PERIOD:{min:5,max:60,step:5,desc:"å‡çº¿å‘¨æœŸ"},ma_period:{min:5,max:60,step:5,desc:"å‡çº¿å‘¨æœŸ"},SHORT_PERIOD:{min:5,max:30,step:5,desc:"çŸ­æœŸå‘¨æœŸ"},short_period:{min:5,max:30,step:5,desc:"çŸ­æœŸå‘¨æœŸ"},LONG_PERIOD:{min:20,max:120,step:10,desc:"é•¿æœŸå‘¨æœŸ"},long_period:{min:20,max:120,step:10,desc:"é•¿æœŸå‘¨æœŸ"},LOOKBACK:{min:5,max:60,step:5,desc:"å›çœ‹å‘¨æœŸ"},lookback:{min:5,max:60,step:5,desc:"å›çœ‹å‘¨æœŸ"},MAX_POSITION:{min:.5,max:1,step:.1,desc:"æœ€å¤§ä»“ä½"},max_position:{min:.5,max:1,step:.1,desc:"æœ€å¤§ä»“ä½"},POSITION_SIZE:{min:.05,max:.3,step:.05,desc:"å•ç¥¨ä»“ä½"},position_size:{min:.05,max:.3,step:.05,desc:"å•ç¥¨ä»“ä½"},REBALANCE_DAYS:{min:1,max:30,step:1,desc:"è°ƒä»“å‘¨æœŸ"},rebalance_days:{min:1,max:30,step:1,desc:"è°ƒä»“å‘¨æœŸ"},THRESHOLD:{min:.01,max:.1,step:.01,desc:"é˜ˆå€¼"},threshold:{min:.01,max:.1,step:.01,desc:"é˜ˆå€¼"},RSI_PERIOD:{min:6,max:24,step:2,desc:"RSIå‘¨æœŸ"},RSI_LOW:{min:20,max:40,step:5,desc:"RSIä½é˜ˆå€¼"},RSI_HIGH:{min:60,max:80,step:5,desc:"RSIé«˜é˜ˆå€¼"}},i=["NUM","PERIOD","DAYS","LOSS","PROFIT","POSITION","SIZE","THRESHOLD","RATIO","RATE","COUNT","MAX","MIN","TOP","LIMIT","num","period","days","loss","profit","position","size","threshold","ratio","rate","count","max","min","top","limit"];for(const n of t){if(n.trim().startsWith("#")||""===n.trim())continue;const t=n.match(/^\s*([A-Za-z][A-Za-z_0-9]*)\s*=\s*(\d+)\s*(?:#\s*(.*))?$/),s=n.match(/^\s*([A-Za-z][A-Za-z_0-9]*)\s*=\s*(\d+\.\d+)\s*(?:#\s*(.*))?$/),o=s||t;if(o){const n=o[1],t=parseFloat(o[2]),c=o[3]||"",d=!!s;if(a.has(n))continue;const l=r[n],p=i.some(e=>n.toUpperCase().includes(e.toUpperCase())),g=n===n.toUpperCase();if(l||p||g){let r,i,s;a.add(n),l?(r=l.min,i=l.max,s=l.step):d?(r=Math.max(0,.5*t),i=2*t,s=t<1?.01:.1):(r=Math.max(1,Math.floor(.5*t)),i=Math.ceil(2*t),s=t>=10?Math.max(1,Math.floor(.1*t)):1),e.push({name:n,type:d?"float":"int",min:r,max:i,step:s,currentValue:t,description:l?.desc||c||this.guessParamDescription(n)})}}}return e}guessParamDescription(n){const e=n.toUpperCase();return e.includes("NUM")||e.includes("COUNT")?"æ•°é‡":e.includes("PERIOD")||e.includes("DAYS")?"å‘¨æœŸ":e.includes("LOSS")?"æ­¢æŸ":e.includes("PROFIT")?"æ­¢ç›ˆ":e.includes("POSITION")||e.includes("SIZE")?"ä»“ä½":e.includes("THRESHOLD")?"é˜ˆå€¼":e.includes("RATIO")?"æ¯”ç‡":e.includes("MAX")?"æœ€å¤§å€¼":e.includes("MIN")?"æœ€å°å€¼":"å‚æ•°"}updateParameter(n,e,t){this._parameterRanges[n]&&(this._parameterRanges[n][e]="name"===e||"description"===e?"string"==typeof t?t:String(t):"number"==typeof t?t:parseFloat(String(t)))}addParameter(){this._parameterRanges.push({name:"NEW_PARAM",type:"float",min:0,max:1,step:.1,currentValue:.5,description:"æ–°å‚æ•°"}),this.updateContent()}removeParameter(n){this._parameterRanges.splice(n,1),this.updateContent()}async startOptimization(n){if(this._strategyCode)if(0!==this._parameterRanges.length)if(this._isOptimizing)o.window.showWarningMessage("ä¼˜åŒ–æ­£åœ¨è¿›è¡Œä¸­");else{this._isOptimizing=!0,this._optimizationProgress=0,this._optimizationResults=[],this.updateContent();try{const e=Math.min(n.maxIterations,200);for(let t=0;t<e&&this._isOptimizing;t++){const a={};for(const e of this._parameterRanges)if("random"===n.algorithm){const n=Math.floor((e.max-e.min)/e.step),t=Math.floor(Math.random()*(n+1));a[e.name]=e.min+t*e.step}else{let n=t;for(const e of this._parameterRanges){const t=Math.floor((e.max-e.min)/e.step)+1;a[e.name]=e.min+n%t*e.step,n=Math.floor(n/t)}}const r={totalReturn:(.15+.2*Math.random())*(1+.001*(a.MA_PERIOD||20)),sharpeRatio:1.5+1.5*Math.random(),maxDrawdown:.08+.12*Math.random(),winRate:.45+.2*Math.random()};let i=0;switch(n.target){case"sharpe":i=30*r.sharpeRatio+20*r.totalReturn-50*r.maxDrawdown;break;case"return":i=50*r.totalReturn+20*r.sharpeRatio-30*r.maxDrawdown;break;case"drawdown":i=50*(1-r.maxDrawdown)+30*r.sharpeRatio+20*r.totalReturn;break;default:i=30*r.sharpeRatio+30*r.totalReturn+20*(1-r.maxDrawdown)+20*r.winRate}this._optimizationResults.push({id:`opt_${Date.now()}_${t}`,timestamp:(new Date).toISOString(),parameters:a,metrics:r,score:i}),this._optimizationProgress=(t+1)/e*100,this._panel.webview.postMessage({command:"updateProgress",progress:this._optimizationProgress,current:t+1,total:e,bestScore:Math.max(...this._optimizationResults.map(n=>n.score))}),await new Promise(n=>setTimeout(n,50))}this._optimizationResults.sort((n,e)=>e.score-n.score),this._optimizationResults=this._optimizationResults.slice(0,20),this.saveData(),this.updateContent(),o.window.showInformationMessage(`ä¼˜åŒ–å®Œæˆï¼æœ€ä½³è¯„åˆ†: ${this._optimizationResults[0]?.score.toFixed(2)||"N/A"}`,"åº”ç”¨æœ€ä½³å‚æ•°").then(n=>{"åº”ç”¨æœ€ä½³å‚æ•°"===n&&this._optimizationResults[0]&&this.applyOptimizationResult(this._optimizationResults[0].id)})}catch(n){p.logger.error(`ä¼˜åŒ–å¤±è´¥: ${n}`,g),o.window.showErrorMessage(`ä¼˜åŒ–å¤±è´¥: ${n}`)}finally{this._isOptimizing=!1,this.updateContent()}}else o.window.showWarningMessage("æœªæ£€æµ‹åˆ°å¯è°ƒå‚æ•°ï¼Œè¯·å…ˆé…ç½®å‚æ•°");else o.window.showWarningMessage("è¯·å…ˆåŠ è½½ç­–ç•¥ä»£ç ")}stopOptimization(){this._isOptimizing=!1}async applyOptimizationResult(n){const e=this._optimizationResults.find(e=>e.id===n);if(!e)return;const t={};for(const n of this._parameterRanges)t[n.name]=n.currentValue;let a=this._strategyCode;const r=[];for(const[n,i]of Object.entries(e.parameters)){const e=new RegExp(`(${n}\\s*=\\s*)\\d+\\.?\\d*`,"g"),s="number"==typeof i?i:parseFloat(i);a=a.replace(e,`$1${s}`);const o=t[n];if(void 0!==o&&o!==s){const e=0!==o?((s-o)/o*100).toFixed(1):"N/A";r.push(`${n}: ${o} â†’ ${s} (${e}%)`)}}this._strategyCode=a,this._parameterRanges=this.extractParameters(a),this._panel.webview.postMessage({command:"updateCode",code:a});const i=r.length>0?r.join(", "):"æ— å‚æ•°å˜æ›´",s={id:`v_${Date.now()}`,version:`v${this._versions.length+1}.0-opt`,timestamp:(new Date).toISOString(),description:`åº”ç”¨ä¼˜åŒ–ç»“æœ #${this._optimizationResults.indexOf(e)+1} | å˜æ›´: ${i}`,parameters:this._parameterRanges.reduce((n,e)=>(n[e.name]=e.currentValue,n),{}),metrics:e.metrics,code:a,isOptimized:!0};this._versions.unshift(s),this.saveData(),this._currentTab="editor",this.updateContent();const c=r.length>0?`å·²åº”ç”¨ä¼˜åŒ–å‚æ•°å¹¶ä¿å­˜ç‰ˆæœ¬:\n${r.slice(0,5).join("\n")}${r.length>5?`\n...å…± ${r.length} é¡¹å˜æ›´`:""}`:"å·²åº”ç”¨ä¼˜åŒ–å‚æ•°ï¼ˆå‚æ•°å€¼æœªå˜åŒ–ï¼‰";o.window.showInformationMessage(c,"æŸ¥çœ‹ç‰ˆæœ¬å†å²").then(n=>{"æŸ¥çœ‹ç‰ˆæœ¬å†å²"===n&&(this._currentTab="versions",this.updateContent())})}async saveVersion(n){this._panel.webview.postMessage({command:"getCodeForSave",description:n})}doSaveVersion(n,e){if(!n||""===n.trim())return void o.window.showWarningMessage("æ²¡æœ‰ç­–ç•¥ä»£ç å¯ä¿å­˜");this._strategyCode=n,this._parameterRanges=this.extractParameters(n);const t={id:`v_${Date.now()}`,version:`v${this._versions.length+1}.0`,timestamp:(new Date).toISOString(),description:e||"æ‰‹åŠ¨ä¿å­˜",parameters:this._parameterRanges.reduce((n,e)=>(n[e.name]=e.currentValue,n),{}),metrics:this._optimizationResults[0]?.metrics,code:n,isOptimized:!1};this._versions.unshift(t),this.saveData(),this.updateContent(),o.window.showInformationMessage(`ç‰ˆæœ¬ ${t.version} å·²ä¿å­˜`,"æŸ¥çœ‹ç‰ˆæœ¬").then(n=>{"æŸ¥çœ‹ç‰ˆæœ¬"===n&&(this._currentTab="versions",this.updateContent())})}async loadVersion(n){const e=this._versions.find(e=>e.id===n);e&&(this._strategyCode=e.code,this._strategyName=e.version,this._parameterRanges=this.extractParameters(e.code),this._panel.webview.postMessage({command:"updateCode",code:e.code}),this._currentTab="editor",this.updateContent(),o.window.showInformationMessage(`å·²åŠ è½½ ${e.version}`))}async compareVersions(n,e){const t=this._versions.find(e=>e.id===n),a=this._versions.find(n=>n.id===e);if(!t||!a)return;const r=await o.workspace.openTextDocument({content:t.code,language:"python"}),i=await o.workspace.openTextDocument({content:a.code,language:"python"});await o.commands.executeCommand("vscode.diff",r.uri,i.uri,`${t.version} â†” ${a.version}`)}deleteVersion(n){const e=this._versions.findIndex(e=>e.id===n);e>=0&&(this._versions.splice(e,1),this.saveData(),this.updateContent())}async exportVersion(n){const e=this._versions.find(e=>e.id===n);if(!e)return;const t=await o.window.showSaveDialog({defaultUri:o.Uri.file(d.join(o.workspace.workspaceFolders?.[0]?.uri.fsPath||l.homedir(),`${this._strategyName.replace(".py","")}_${e.version}.py`)),filters:{Python:["py"]}});t&&(c.writeFileSync(t.fsPath,e.code),o.window.showInformationMessage(`å·²å¯¼å‡ºåˆ° ${t.fsPath}`))}async applyAdvice(n){const e=this._report?.advices.find(e=>e.id===n);if(!e?.codeExample)return void o.window.showWarningMessage("è¯¥å»ºè®®æ²¡æœ‰ä»£ç ç¤ºä¾‹");const t=await o.workspace.openTextDocument({content:`# ${e.title}\n# ${e.description}\n\n${e.codeExample}`,language:"python"});await o.window.showTextDocument(t,o.ViewColumn.Beside)}async saveAndBacktest(){if(this._strategyCode){if(this._strategyPath)c.writeFileSync(this._strategyPath,this._strategyCode),o.window.showInformationMessage(`å·²ä¿å­˜åˆ° ${this._strategyPath}`);else{const n=await o.window.showSaveDialog({defaultUri:o.Uri.file(d.join(o.workspace.workspaceFolders?.[0]?.uri.fsPath||l.homedir(),"Projects",this._strategyName||"strategy.py")),filters:{Python:["py"]}});if(!n)return;c.writeFileSync(n.fsPath,this._strategyCode),this._strategyPath=n.fsPath,o.window.showInformationMessage(`å·²ä¿å­˜åˆ° ${n.fsPath}`)}await o.commands.executeCommand("trquant.showBacktestConfig")}else o.window.showWarningMessage("æ²¡æœ‰ç­–ç•¥ä»£ç ")}async saveAndTrade(){await this.saveAndBacktest(),o.window.showInformationMessage("å®ç›˜äº¤æ˜“åŠŸèƒ½å¼€å‘ä¸­...")}loadData(){try{const n=d.join(this._storagePath,"optimizer_data.json");if(c.existsSync(n)){const e=JSON.parse(c.readFileSync(n,"utf-8"));this._versions=e.versions||[],this._optimizationResults=e.results||[]}}catch(n){p.logger.warn(`åŠ è½½æ•°æ®å¤±è´¥: ${n}`,g)}}saveData(){try{c.existsSync(this._storagePath)||c.mkdirSync(this._storagePath,{recursive:!0});const n=d.join(this._storagePath,"optimizer_data.json");c.writeFileSync(n,JSON.stringify({versions:this._versions.slice(0,50),results:this._optimizationResults.slice(0,100)},null,2))}catch(n){p.logger.warn(`ä¿å­˜æ•°æ®å¤±è´¥: ${n}`,g)}}updateContent(){this._panel.webview.html=this.generateHtml()}generateHtml(){return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>ç­–ç•¥ä¼˜åŒ–å™¨</title>\n    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">\n    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">\n    <style>${this.getStyles()}</style>\n</head>\n<body>\n    <div class="container">\n        ${this.renderHeader()}\n        ${this.renderTabs()}\n        <div class="content">\n            ${this.renderTabContent()}\n        </div>\n        ${this.renderFooter()}\n    </div>\n    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"><\/script>\n    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"><\/script>\n    <script>${this.getScripts()}<\/script>\n</body>\n</html>`}renderHeader(){return`\n        <div class="header">\n            <div class="header-left">\n                <h1>ğŸ”¬ ç­–ç•¥ä¼˜åŒ–å™¨</h1>\n                <p class="subtitle">${this._strategyName||"è¯·é€‰æ‹©ç­–ç•¥æ–‡ä»¶"}</p>\n            </div>\n            <div class="header-right">\n                ${this._strategyCode?`\n                    <span class="status-badge status-loaded">âœ“ å·²åŠ è½½</span>\n                    ${this._report?`<span class="score-badge">è¯„åˆ†: ${this._report.overallScore}</span>`:""}\n                `:'\n                    <span class="status-badge status-empty">â—‹ æœªåŠ è½½</span>\n                '}\n            </div>\n        </div>`}renderTabs(){return`\n        <div class="tabs">\n            ${[{id:"editor",icon:"ğŸ“",label:"ç­–ç•¥ç¼–è¾‘å™¨",disabled:!1},{id:"analysis",icon:"ğŸ“Š",label:"ç­–ç•¥åˆ†æ",disabled:!this._strategyCode},{id:"optimize",icon:"âš¡",label:"å‚æ•°ä¼˜åŒ–",disabled:!this._strategyCode},{id:"versions",icon:"ğŸ“š",label:"ç‰ˆæœ¬ç®¡ç†",disabled:!1},{id:"visualize",icon:"ğŸ“ˆ",label:"å¯è§†åŒ–",disabled:!this._optimizationResults.length}].map((n,e)=>`\n                <button class="tab ${this._currentTab===n.id?"active":""} ${n.disabled?"disabled":""}"\n                        onclick="${n.disabled?"":`switchTab('${n.id}')`}"\n                        ${n.disabled?"disabled":""}>\n                    <span class="tab-number">${e+1}</span>\n                    <span class="tab-icon">${n.icon}</span>\n                    <span class="tab-label">${n.label}</span>\n                </button>\n            `).join("")}\n        </div>`}renderTabContent(){switch(this._currentTab){case"editor":return this.renderEditorTab();case"analysis":return this.renderAnalysisTab();case"optimize":return this.renderOptimizeTab();case"versions":return this.renderVersionsTab();case"visualize":return this.renderVisualizeTab();default:return""}}renderEditorTab(){const n=this._strategyCode?this._strategyCode.split("\n").length:0,e=null!==this._report,t=this._optimizationResults.length>0;return`\n        <div class="tab-content editor-tab">\n            \x3c!-- é¡¶éƒ¨å·¥å…·æ  - å§‹ç»ˆæ˜¾ç¤º --\x3e\n            <div class="editor-top-bar">\n                <div class="editor-info">\n                    ${this._strategyCode?`\n                        <span class="file-name">ğŸ“„ ${this._strategyName||"æœªå‘½åç­–ç•¥"}</span>\n                        <span class="file-stats">ğŸ“ ${n} è¡Œ</span>\n                        <span class="file-stats">ğŸ“Š ${this._parameterRanges.length} ä¸ªå‚æ•°</span>\n                        ${e?`<span class="score-indicator" style="color: ${this.getScoreColor(this._report.overallScore)}">è¯„åˆ†: ${this._report.overallScore}/100</span>`:""}\n                    `:'<span class="file-name">æœªé€‰æ‹©ç­–ç•¥æ–‡ä»¶</span>'}\n                </div>\n                <div class="editor-top-actions">\n                    <button class="btn btn-primary" onclick="selectFile()">ğŸ“ é€‰æ‹©ç­–ç•¥æ–‡ä»¶</button>\n                    ${this._strategyCode?'\n                        <button class="btn btn-gold" onclick="analyzeStrategy()">ğŸ” å¼€å§‹åˆ†æ</button>\n                    ':""}\n                </div>\n            </div>\n            \n            ${this._strategyCode?`\n                <div class="editor-toolbar">\n                    <button class="btn btn-sm" onclick="syncFromEditor()">ğŸ”„ åŒæ­¥</button>\n                    <button class="btn btn-sm" onclick="formatCode()">âœ¨ æ ¼å¼åŒ–</button>\n                    <button class="btn btn-sm" onclick="copyCode()">ğŸ“‹ å¤åˆ¶</button>\n                    ${t?'<button class="btn btn-sm btn-gold" onclick="applyBestResult()">âš¡ åº”ç”¨æœ€ä½³å‚æ•°</button>':""}\n                    <button class="btn btn-sm" onclick="saveVersion()">ğŸ’¾ ä¿å­˜ç‰ˆæœ¬</button>\n                </div>\n            `:""}\n            \n            <div class="editor-container ${this._strategyCode?"":"empty"}">\n                ${this._strategyCode?'<div id="code-editor"></div>':'\n                    <div class="editor-placeholder">\n                        <div class="placeholder-icon">ğŸ“‚</div>\n                        <h3>é€‰æ‹©ç­–ç•¥æ–‡ä»¶å¼€å§‹</h3>\n                        <p>ç‚¹å‡»å³ä¸Šè§’"é€‰æ‹©ç­–ç•¥æ–‡ä»¶"æŒ‰é’®</p>\n                        <p class="hint">æ”¯æŒ Python (.py) æ ¼å¼çš„ç­–ç•¥æ–‡ä»¶</p>\n                    </div>\n                '}\n            </div>\n            \n            ${this._parameterRanges.length>0?`\n                <div class="params-preview">\n                    <div class="params-header">\n                        <h3>ğŸ¯ æ£€æµ‹åˆ°çš„å¯è°ƒå‚æ•° (${this._parameterRanges.length})</h3>\n                        <button class="btn btn-sm btn-gold" onclick="switchTab('optimize')">âš¡ å»ä¼˜åŒ–</button>\n                    </div>\n                    <div class="params-grid">\n                        ${this._parameterRanges.map((n,e)=>`\n                            <div class="param-card" onclick="highlightParam('${n.name}')">\n                                <div class="param-name">${n.name}</div>\n                                <div class="param-value">${n.currentValue}</div>\n                                <div class="param-range">${n.min} ~ ${n.max} (æ­¥é•¿: ${n.step})</div>\n                                ${n.description?`<div class="param-desc">${n.description}</div>`:""}\n                            </div>\n                        `).join("")}\n                    </div>\n                </div>\n            `:this._strategyCode?'\n                <div class="no-params-hint">\n                    <p>ğŸ’¡ æœªæ£€æµ‹åˆ°å¯è°ƒå‚æ•°ã€‚å‚æ•°æ ¼å¼ç¤ºä¾‹: <code>STOCK_NUM = 10  # æŒè‚¡æ•°é‡</code></p>\n                </div>\n            ':""}\n        </div>`}renderAnalysisTab(){return this._report?`\n        <div class="tab-content">\n            <div class="analysis-header">\n                <div class="main-score-card ${this._report.overallScore>=80?"excellent":this._report.overallScore>=60?"good":this._report.overallScore>=40?"fair":"poor"}">\n                    <div class="score-ring">\n                        <svg viewBox="0 0 100 100">\n                            <circle class="score-bg" cx="50" cy="50" r="45"/>\n                            <circle class="score-progress" cx="50" cy="50" r="45" \n                                stroke-dasharray="${2.83*this._report.overallScore} 283"/>\n                        </svg>\n                        <div class="score-text">\n                            <span class="score-number">${this._report.overallScore}</span>\n                            <span class="score-label">ç»¼åˆè¯„åˆ†</span>\n                        </div>\n                    </div>\n                </div>\n                <div class="score-breakdown">\n                    <div class="breakdown-item">\n                        <div class="breakdown-label">é£é™©æ§åˆ¶</div>\n                        <div class="breakdown-bar">\n                            <div class="breakdown-fill" style="width: ${this._report.scoreBreakdown.risk}%; background: ${this.getScoreColor(this._report.scoreBreakdown.risk)}"></div>\n                        </div>\n                        <div class="breakdown-value">${this._report.scoreBreakdown.risk}</div>\n                    </div>\n                    <div class="breakdown-item">\n                        <div class="breakdown-label">å› å­æ„å»º</div>\n                        <div class="breakdown-bar">\n                            <div class="breakdown-fill" style="width: ${this._report.scoreBreakdown.factor}%; background: ${this.getScoreColor(this._report.scoreBreakdown.factor)}"></div>\n                        </div>\n                        <div class="breakdown-value">${this._report.scoreBreakdown.factor}</div>\n                    </div>\n                    <div class="breakdown-item">\n                        <div class="breakdown-label">é€‰è‚¡é€»è¾‘</div>\n                        <div class="breakdown-bar">\n                            <div class="breakdown-fill" style="width: ${this._report.scoreBreakdown.selection}%; background: ${this.getScoreColor(this._report.scoreBreakdown.selection)}"></div>\n                        </div>\n                        <div class="breakdown-value">${this._report.scoreBreakdown.selection}</div>\n                    </div>\n                    <div class="breakdown-item">\n                        <div class="breakdown-label">ä»£ç è´¨é‡</div>\n                        <div class="breakdown-bar">\n                            <div class="breakdown-fill" style="width: ${this._report.scoreBreakdown.code}%; background: ${this.getScoreColor(this._report.scoreBreakdown.code)}"></div>\n                        </div>\n                        <div class="breakdown-value">${this._report.scoreBreakdown.code}</div>\n                    </div>\n                </div>\n            </div>\n            \n            <div class="summary-section">\n                <h3>ğŸ“‹ åˆ†ææ‘˜è¦</h3>\n                <div class="summary-content">${this._report.summary}</div>\n            </div>\n            \n            <div class="advices-section">\n                <div class="advices-header">\n                    <h3>ğŸ’¡ ä¼˜åŒ–å»ºè®® (${this._report.advices.length})</h3>\n                    <div class="advices-filter">\n                        <button class="filter-btn active" data-priority="all">å…¨éƒ¨</button>\n                        <button class="filter-btn" data-priority="high">ğŸ”´ é«˜</button>\n                        <button class="filter-btn" data-priority="medium">ğŸŸ¡ ä¸­</button>\n                        <button class="filter-btn" data-priority="low">ğŸŸ¢ ä½</button>\n                    </div>\n                </div>\n                <div class="advices-list">\n                    ${this._report.advices.map(n=>this.renderAdvice(n)).join("")}\n                </div>\n            </div>\n            \n            <div class="analysis-actions">\n                <button class="btn" onclick="reanalyzeStrategy()">ğŸ”„ é‡æ–°åˆ†æ</button>\n                <button class="btn btn-gold" onclick="switchTab('optimize')">âš¡ è¿›å…¥å‚æ•°ä¼˜åŒ–</button>\n                <button class="btn" onclick="switchTab('editor')">ğŸ“ è¿”å›ç¼–è¾‘å™¨</button>\n            </div>\n        </div>`:'\n            <div class="tab-content">\n                <div class="empty-state">\n                    <div class="empty-icon">ğŸ“Š</div>\n                    <h2>å°šæœªåˆ†æ</h2>\n                    <p>è¯·å…ˆåŠ è½½ç­–ç•¥æ–‡ä»¶ï¼Œç„¶åç‚¹å‡»"å¼€å§‹åˆ†æ"</p>\n                    <button class="btn btn-gold btn-lg" onclick="analyzeStrategy()">ğŸ” å¼€å§‹åˆ†æ</button>\n                </div>\n            </div>'}renderAdvice(n){return`\n        <div class="advice-card priority-${n.priority}">\n            <div class="advice-header">\n                <span class="advice-priority">${"high"===n.priority?"ğŸ”´ é«˜":"medium"===n.priority?"ğŸŸ¡ ä¸­":"ğŸŸ¢ ä½"}</span>\n                <span class="advice-title">${n.title}</span>\n                <span class="advice-category">${n.category}</span>\n            </div>\n            <div class="advice-body">\n                <p>${n.description}</p>\n                ${n.currentState?`<p><strong>å½“å‰:</strong> ${n.currentState}</p>`:""}\n                ${n.suggestedState?`<p><strong>å»ºè®®:</strong> ${n.suggestedState}</p>`:""}\n                ${n.impact?`<p><strong>é¢„æœŸå½±å“:</strong> ${n.impact}</p>`:""}\n            </div>\n            ${n.codeExample?`\n                <div class="advice-footer">\n                    <button class="btn btn-sm" onclick="applyAdvice('${n.id}')">ğŸ“ æŸ¥çœ‹ä»£ç ç¤ºä¾‹</button>\n                </div>\n            `:""}\n        </div>`}renderOptimizeTab(){const n=this._parameterRanges.reduce((n,e)=>n*(Math.floor((e.max-e.min)/e.step)+1),1);return`\n        <div class="tab-content">\n            <div class="optimize-header">\n                <div class="strategy-info">\n                    <span class="strategy-name">ğŸ“„ ${this._strategyName||"æœªé€‰æ‹©ç­–ç•¥"}</span>\n                    <span class="param-count">ğŸ“Š ${this._parameterRanges.length} ä¸ªå‚æ•°</span>\n                    <span class="combo-count">ğŸ”¢ çº¦ ${n.toLocaleString()} ä¸ªç»„åˆ</span>\n                </div>\n            </div>\n            \n            <div class="config-section">\n                <h3>âš™ï¸ ä¼˜åŒ–é…ç½®</h3>\n                <div class="config-grid">\n                    <div class="config-item">\n                        <label>ä¼˜åŒ–ç®—æ³•</label>\n                        <select id="algorithm" onchange="updateAlgorithmInfo()">\n                            <option value="grid">ç½‘æ ¼æœç´¢ (Grid Search)</option>\n                            <option value="random">éšæœºæœç´¢ (Random Search)</option>\n                        </select>\n                        <div class="config-desc" id="algorithmDesc">ç©·ä¸¾æ‰€æœ‰å‚æ•°ç»„åˆï¼Œé€‚åˆå‚æ•°ç©ºé—´è¾ƒå°æ—¶</div>\n                    </div>\n                    <div class="config-item">\n                        <label>è¿­ä»£æ¬¡æ•°</label>\n                        <input type="number" id="maxIterations" value="50" min="10" max="500">\n                        <div class="config-desc">å»ºè®®: ç½‘æ ¼æœç´¢è‡ªåŠ¨è®¡ç®—, éšæœºæœç´¢50-200æ¬¡</div>\n                    </div>\n                    <div class="config-item">\n                        <label>ä¼˜åŒ–ç›®æ ‡</label>\n                        <select id="target">\n                            <option value="combined">ç»¼åˆè¯„åˆ† (æ¨è)</option>\n                            <option value="sharpe">å¤æ™®æ¯”ç‡ä¼˜å…ˆ</option>\n                            <option value="return">æ”¶ç›Šç‡ä¼˜å…ˆ</option>\n                            <option value="drawdown">æœ€å°å›æ’¤ä¼˜å…ˆ</option>\n                            <option value="calmar">å¡ç›æ¯”ç‡ä¼˜å…ˆ</option>\n                        </select>\n                        <div class="config-desc">ç»¼åˆè¯„åˆ† = å¤æ™®Ã—30% + æ”¶ç›ŠÃ—30% + (1-å›æ’¤)Ã—20% + èƒœç‡Ã—20%</div>\n                    </div>\n                    <div class="config-item">\n                        <label>æ—©åœæ¡ä»¶</label>\n                        <select id="earlyStop">\n                            <option value="none">ä¸å¯ç”¨</option>\n                            <option value="score">è¾¾åˆ°ç›®æ ‡è¯„åˆ†</option>\n                            <option value="plateau">è¯„åˆ†ä¸å†æå‡</option>\n                        </select>\n                    </div>\n                </div>\n            </div>\n            \n            <div class="params-section">\n                <div class="section-header">\n                    <h3>ğŸ“ å‚æ•°æœç´¢èŒƒå›´</h3>\n                    <div class="section-actions">\n                        <button class="btn btn-sm" onclick="autoDetectParams()">ğŸ” è‡ªåŠ¨æ£€æµ‹</button>\n                        <button class="btn btn-sm" onclick="addParameter()">â• æ·»åŠ å‚æ•°</button>\n                    </div>\n                </div>\n                ${0===this._parameterRanges.length?'\n                    <div class="empty-params">\n                        <p>æœªæ£€æµ‹åˆ°å¯è°ƒå‚æ•°ï¼Œè¯·æ‰‹åŠ¨æ·»åŠ æˆ–æ£€æŸ¥ç­–ç•¥ä»£ç ä¸­çš„å‚æ•°å®šä¹‰</p>\n                        <p class="hint">æ”¯æŒæ ¼å¼: PARAM_NAME = 10  # å‚æ•°æè¿°</p>\n                    </div>\n                ':`\n                    <table class="params-table">\n                        <thead>\n                            <tr>\n                                <th>å‚æ•°å</th>\n                                <th>æœ€å°å€¼</th>\n                                <th>æœ€å¤§å€¼</th>\n                                <th>æ­¥é•¿</th>\n                                <th>å½“å‰å€¼</th>\n                                <th>æœç´¢ç‚¹æ•°</th>\n                                <th>æ“ä½œ</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            ${this._parameterRanges.map((n,e)=>{const t=Math.floor((n.max-n.min)/n.step)+1;return`\n                                <tr>\n                                    <td><input class="input-sm" value="${n.name}" onchange="updateParam(${e}, 'name', this.value)"></td>\n                                    <td><input class="input-sm" type="number" value="${n.min}" step="${n.step}" onchange="updateParam(${e}, 'min', this.value)"></td>\n                                    <td><input class="input-sm" type="number" value="${n.max}" step="${n.step}" onchange="updateParam(${e}, 'max', this.value)"></td>\n                                    <td><input class="input-sm" type="number" value="${n.step}" step="0.01" onchange="updateParam(${e}, 'step', this.value)"></td>\n                                    <td><strong>${n.currentValue}</strong></td>\n                                    <td class="step-count">${t}</td>\n                                    <td><button class="btn btn-danger btn-sm" onclick="removeParam(${e})">ğŸ—‘ï¸</button></td>\n                                </tr>`}).join("")}\n                        </tbody>\n                    </table>\n                `}\n            </div>\n            \n            ${this._isOptimizing?`\n                <div class="progress-section">\n                    <h3>ğŸš€ ä¼˜åŒ–è¿›åº¦</h3>\n                    <div class="progress-bar">\n                        <div class="progress-fill" style="width: ${this._optimizationProgress}%"></div>\n                    </div>\n                    <div class="progress-info">\n                        <span id="progressText">${this._optimizationProgress.toFixed(0)}%</span>\n                        <span id="progressStats">å½“å‰æœ€ä½³: ${this._optimizationResults[0]?.score.toFixed(2)||"-"}</span>\n                        <button class="btn btn-danger" onclick="stopOptimization()">â¹ï¸ åœæ­¢ä¼˜åŒ–</button>\n                    </div>\n                    <div class="progress-details">\n                        <span>å·²æµ‹è¯•: <strong id="testedCount">${this._optimizationResults.length}</strong> ç»„</span>\n                        <span>ç”¨æ—¶: <strong id="elapsedTime">-</strong></span>\n                        <span>é¢„è®¡å‰©ä½™: <strong id="remainingTime">-</strong></span>\n                    </div>\n                </div>\n            `:`\n                <div class="action-section">\n                    <button class="btn btn-gold btn-lg" onclick="startOptimization()" ${0===this._parameterRanges.length?"disabled":""}>\n                        ğŸš€ å¼€å§‹ä¼˜åŒ–\n                    </button>\n                    <p class="action-hint">${0===this._parameterRanges.length?"è¯·å…ˆæ·»åŠ å‚æ•°":`å°†æµ‹è¯•çº¦ ${Math.min(n,200).toLocaleString()} ä¸ªå‚æ•°ç»„åˆ`}</p>\n                </div>\n            `}\n            \n            ${this._optimizationResults.length>0?`\n                <div class="results-section">\n                    <div class="results-header">\n                        <h3>ğŸ† ä¼˜åŒ–ç»“æœ (Top 10)</h3>\n                        <div class="results-actions">\n                            <button class="btn btn-sm" onclick="exportResults()">ğŸ“¤ å¯¼å‡ºç»“æœ</button>\n                            <button class="btn btn-sm btn-gold" onclick="applyBestResult()">âš¡ åº”ç”¨æœ€ä½³</button>\n                        </div>\n                    </div>\n                    <table class="results-table">\n                        <thead>\n                            <tr>\n                                <th>#</th>\n                                <th>å‚æ•°</th>\n                                <th>æ”¶ç›Šç‡</th>\n                                <th>å¤æ™®</th>\n                                <th>å›æ’¤</th>\n                                <th>èƒœç‡</th>\n                                <th>è¯„åˆ†</th>\n                                <th>æ“ä½œ</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            ${this._optimizationResults.slice(0,10).map((n,e)=>`\n                                <tr class="${0===e?"best-result":""}">\n                                    <td>${0===e?"ğŸ¥‡":1===e?"ğŸ¥ˆ":2===e?"ğŸ¥‰":e+1}</td>\n                                    <td class="params-cell">${Object.entries(n.parameters).map(([n,e])=>`${n}=${"number"==typeof e?e.toFixed(2):e}`).join(", ")}</td>\n                                    <td class="${n.metrics.totalReturn>0?"positive":"negative"}">${(100*n.metrics.totalReturn).toFixed(2)}%</td>\n                                    <td>${n.metrics.sharpeRatio.toFixed(2)}</td>\n                                    <td class="negative">${(100*n.metrics.maxDrawdown).toFixed(2)}%</td>\n                                    <td>${(100*n.metrics.winRate).toFixed(1)}%</td>\n                                    <td class="score">${n.score.toFixed(2)}</td>\n                                    <td>\n                                        <button class="btn btn-sm btn-primary" onclick="applyResult('${n.id}')">åº”ç”¨</button>\n                                        <button class="btn btn-sm" onclick="viewResultDetail('${n.id}')">è¯¦æƒ…</button>\n                                    </td>\n                                </tr>\n                            `).join("")}\n                        </tbody>\n                    </table>\n                </div>\n            `:""}\n        </div>`}renderVersionsTab(){const n=this._versions.filter(n=>n.isOptimized).length;return`\n        <div class="tab-content">\n            <div class="versions-header">\n                <div class="versions-stats">\n                    <span>ğŸ“š å…± ${this._versions.length} ä¸ªç‰ˆæœ¬</span>\n                    <span>âš¡ ${n} ä¸ªå·²ä¼˜åŒ–</span>\n                </div>\n                <div class="versions-actions">\n                    <button class="btn btn-primary" onclick="saveVersion()" ${this._strategyCode?"":"disabled"}>\n                        ğŸ’¾ ä¿å­˜å½“å‰ç‰ˆæœ¬\n                    </button>\n                    ${this._versions.length>0?'\n                        <button class="btn" onclick="exportAllVersions()">ğŸ“¤ å¯¼å‡ºå…¨éƒ¨</button>\n                        <button class="btn" onclick="clearAllVersions()">ğŸ—‘ï¸ æ¸…ç©º</button>\n                    ':""}\n                </div>\n            </div>\n            \n            ${0===this._versions.length?'\n                <div class="empty-state">\n                    <div class="empty-icon">ğŸ“š</div>\n                    <h2>æš‚æ— ä¿å­˜çš„ç‰ˆæœ¬</h2>\n                    <p>ä¼˜åŒ–ç­–ç•¥åç‚¹å‡»"ä¿å­˜å½“å‰ç‰ˆæœ¬"åˆ›å»ºå¿«ç…§</p>\n                    <p class="hint">ç‰ˆæœ¬ç®¡ç†å¸®åŠ©æ‚¨è¿½è¸ªç­–ç•¥çš„æ¼”è¿›è¿‡ç¨‹</p>\n                </div>\n            ':`\n                <div class="versions-timeline">\n                    ${this._versions.map((n,e)=>`\n                        <div class="version-card ${0===e?"latest":""} ${n.isOptimized?"optimized":""}">\n                            <div class="version-indicator">\n                                <div class="version-dot ${0===e?"current":""}"></div>\n                                ${e<this._versions.length-1?'<div class="version-line"></div>':""}\n                            </div>\n                            <div class="version-content">\n                                <div class="version-header">\n                                    <span class="version-name">${n.version}</span>\n                                    ${n.isOptimized?'<span class="optimized-badge">âš¡ ä¼˜åŒ–ç‰ˆ</span>':'<span class="manual-badge">ğŸ“ æ‰‹åŠ¨</span>'}\n                                    <span class="version-time">${new Date(n.timestamp).toLocaleString("zh-CN")}</span>\n                                </div>\n                                <div class="version-desc">${n.description||"æ— æè¿°"}</div>\n                                \n                                ${n.metrics?`\n                                    <div class="version-metrics">\n                                        <div class="metric-item ${n.metrics.totalReturn>0?"positive":"negative"}">\n                                            <span class="metric-label">æ”¶ç›Š</span>\n                                            <span class="metric-value">${(100*n.metrics.totalReturn).toFixed(2)}%</span>\n                                        </div>\n                                        <div class="metric-item">\n                                            <span class="metric-label">å¤æ™®</span>\n                                            <span class="metric-value">${n.metrics.sharpeRatio.toFixed(2)}</span>\n                                        </div>\n                                        <div class="metric-item negative">\n                                            <span class="metric-label">å›æ’¤</span>\n                                            <span class="metric-value">${(100*n.metrics.maxDrawdown).toFixed(2)}%</span>\n                                        </div>\n                                        <div class="metric-item">\n                                            <span class="metric-label">èƒœç‡</span>\n                                            <span class="metric-value">${(100*n.metrics.winRate).toFixed(1)}%</span>\n                                        </div>\n                                    </div>\n                                `:""}\n                                \n                                <div class="version-params">\n                                    ${Object.entries(n.parameters).slice(0,5).map(([n,e])=>`<span class="param-tag">${n}=${e}</span>`).join("")}\n                                    ${Object.keys(n.parameters).length>5?`<span class="param-tag more">+${Object.keys(n.parameters).length-5}</span>`:""}\n                                </div>\n                                \n                                <div class="version-actions">\n                                    <button class="btn btn-sm btn-primary" onclick="loadVersion('${n.id}')">ğŸ“¥ åŠ è½½åˆ°ç¼–è¾‘å™¨</button>\n                                    ${e>0?`<button class="btn btn-sm" onclick="compareVersions('${n.id}', '${this._versions[0].id}')">ğŸ” ä¸å½“å‰å¯¹æ¯”</button>`:""}\n                                    <button class="btn btn-sm" onclick="exportVersion('${n.id}')">ğŸ“¤ å¯¼å‡º</button>\n                                    <button class="btn btn-sm" onclick="viewVersionCode('${n.id}')">ğŸ‘ï¸ æŸ¥çœ‹ä»£ç </button>\n                                    <button class="btn btn-sm btn-danger" onclick="deleteVersion('${n.id}')">ğŸ—‘ï¸</button>\n                                </div>\n                            </div>\n                        </div>\n                    `).join("")}\n                </div>\n            `}\n        </div>`}renderVisualizeTab(){if(0===this._optimizationResults.length)return'\n            <div class="tab-content">\n                <div class="empty-state">\n                    <div class="empty-icon">ğŸ“ˆ</div>\n                    <h2>æš‚æ— æ•°æ®</h2>\n                    <p>å®Œæˆå‚æ•°ä¼˜åŒ–åï¼Œè¿™é‡Œå°†æ˜¾ç¤ºå¯è§†åŒ–å›¾è¡¨</p>\n                    <button class="btn btn-gold btn-lg" onclick="switchTab(\'optimize\')">âš¡ å»ä¼˜åŒ–å‚æ•°</button>\n                </div>\n            </div>';const n=this._optimizationResults,e=Math.max(...n.map(n=>n.score)),t=Math.min(...n.map(n=>n.score)),a=n.reduce((n,e)=>n+e.score,0)/n.length,r=n.reduce((n,e)=>n+e.metrics.totalReturn,0)/n.length,i=Math.max(...n.map(n=>n.metrics.totalReturn)),s=Math.min(...n.map(n=>n.metrics.totalReturn)),o=n.reduce((n,e)=>n+e.metrics.sharpeRatio,0)/n.length,c=Math.max(...n.map(n=>n.metrics.sharpeRatio)),d=n.reduce((n,e)=>n+e.metrics.maxDrawdown,0)/n.length,l=Math.min(...n.map(n=>n.metrics.maxDrawdown)),p=n.slice(0,10).map((n,a)=>({label:`#${a+1}`,value:n.score,percent:(n.score-t)/(e-t||1)*100})),g=this.calculateParamCorrelations();return`\n        <div class="tab-content visualize-tab">\n            <div class="viz-header">\n                <h2>ğŸ“Š ä¼˜åŒ–ç»“æœå¯è§†åŒ–</h2>\n                <span class="viz-info">å…± ${n.length} ä¸ªæµ‹è¯•ç»“æœ</span>\n            </div>\n            \n            \x3c!-- æ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡ --\x3e\n            <div class="viz-metrics-grid">\n                <div class="viz-metric-card best">\n                    <div class="viz-metric-icon">ğŸ†</div>\n                    <div class="viz-metric-content">\n                        <div class="viz-metric-label">æœ€ä½³è¯„åˆ†</div>\n                        <div class="viz-metric-value">${e.toFixed(2)}</div>\n                        <div class="viz-metric-sub">æ”¶ç›Š: ${(100*n[0]?.metrics.totalReturn).toFixed(2)}%</div>\n                    </div>\n                </div>\n                <div class="viz-metric-card">\n                    <div class="viz-metric-icon">ğŸ“ˆ</div>\n                    <div class="viz-metric-content">\n                        <div class="viz-metric-label">æœ€ä½³æ”¶ç›Š</div>\n                        <div class="viz-metric-value positive">${(100*i).toFixed(2)}%</div>\n                        <div class="viz-metric-sub">å¹³å‡: ${(100*r).toFixed(2)}%</div>\n                    </div>\n                </div>\n                <div class="viz-metric-card">\n                    <div class="viz-metric-icon">âš¡</div>\n                    <div class="viz-metric-content">\n                        <div class="viz-metric-label">æœ€ä½³å¤æ™®</div>\n                        <div class="viz-metric-value">${c.toFixed(2)}</div>\n                        <div class="viz-metric-sub">å¹³å‡: ${o.toFixed(2)}</div>\n                    </div>\n                </div>\n                <div class="viz-metric-card">\n                    <div class="viz-metric-icon">ğŸ›¡ï¸</div>\n                    <div class="viz-metric-content">\n                        <div class="viz-metric-label">æœ€ä½å›æ’¤</div>\n                        <div class="viz-metric-value positive">${(100*l).toFixed(2)}%</div>\n                        <div class="viz-metric-sub">å¹³å‡: ${(100*d).toFixed(2)}%</div>\n                    </div>\n                </div>\n            </div>\n            \n            \x3c!-- è¯„åˆ†åˆ†å¸ƒå›¾ --\x3e\n            <div class="viz-section">\n                <h3>ğŸ“Š Top 10 è¯„åˆ†åˆ†å¸ƒ</h3>\n                <div class="viz-bar-chart">\n                    ${p.map((n,e)=>`\n                        <div class="viz-bar-item ${0===e?"best":""}">\n                            <span class="viz-bar-label">${n.label}</span>\n                            <div class="viz-bar-track">\n                                <div class="viz-bar-fill" style="width: ${n.percent}%">\n                                    <span class="viz-bar-value">${n.value.toFixed(2)}</span>\n                                </div>\n                            </div>\n                        </div>\n                    `).join("")}\n                </div>\n            </div>\n            \n            \x3c!-- æŒ‡æ ‡åˆ†å¸ƒç»Ÿè®¡ --\x3e\n            <div class="viz-section">\n                <h3>ğŸ“ˆ æŒ‡æ ‡åˆ†å¸ƒç»Ÿè®¡</h3>\n                <div class="viz-stats-grid">\n                    <div class="viz-stat-card">\n                        <h4>è¯„åˆ†åˆ†å¸ƒ</h4>\n                        <div class="viz-stat-range">\n                            <span class="range-min">${t.toFixed(2)}</span>\n                            <div class="range-bar">\n                                <div class="range-avg" style="left: ${(a-t)/(e-t||1)*100}%"></div>\n                            </div>\n                            <span class="range-max">${e.toFixed(2)}</span>\n                        </div>\n                        <div class="viz-stat-avg">å¹³å‡: ${a.toFixed(2)}</div>\n                    </div>\n                    <div class="viz-stat-card">\n                        <h4>æ”¶ç›Šç‡åˆ†å¸ƒ</h4>\n                        <div class="viz-stat-range">\n                            <span class="range-min">${(100*s).toFixed(1)}%</span>\n                            <div class="range-bar">\n                                <div class="range-avg" style="left: ${(r-s)/(i-s||1)*100}%"></div>\n                            </div>\n                            <span class="range-max">${(100*i).toFixed(1)}%</span>\n                        </div>\n                        <div class="viz-stat-avg">å¹³å‡: ${(100*r).toFixed(2)}%</div>\n                    </div>\n                </div>\n            </div>\n            \n            \x3c!-- å‚æ•°æ•æ„Ÿæ€§åˆ†æ --\x3e\n            ${g.length>0?`\n                <div class="viz-section">\n                    <h3>ğŸ¯ å‚æ•°æ•æ„Ÿæ€§åˆ†æ</h3>\n                    <div class="viz-sensitivity">\n                        ${g.map(n=>`\n                            <div class="sensitivity-item">\n                                <span class="sensitivity-name">${n.name}</span>\n                                <div class="sensitivity-bar-container">\n                                    <div class="sensitivity-bar ${n.correlation>0?"positive":"negative"}" \n                                         style="width: ${100*Math.abs(n.correlation)}%"></div>\n                                </div>\n                                <span class="sensitivity-value">${(100*n.correlation).toFixed(1)}%</span>\n                            </div>\n                        `).join("")}\n                        <p class="sensitivity-hint">æ­£å€¼è¡¨ç¤ºå‚æ•°å¢å¤§æœ‰åˆ©äºè¯„åˆ†ï¼Œè´Ÿå€¼è¡¨ç¤ºå‚æ•°å‡å°æœ‰åˆ©äºè¯„åˆ†</p>\n                    </div>\n                </div>\n            `:""}\n            \n            \x3c!-- æœ€ä½³å‚æ•°ç»„åˆ --\x3e\n            <div class="viz-section">\n                <h3>ğŸ† æœ€ä½³å‚æ•°ç»„åˆ</h3>\n                <div class="viz-best-params">\n                    ${n[0]?Object.entries(n[0].parameters).map(([n,e])=>`\n                        <div class="best-param-item">\n                            <span class="best-param-name">${n}</span>\n                            <span class="best-param-value">${"number"==typeof e?e.toFixed(2):e}</span>\n                        </div>\n                    `).join(""):""}\n                </div>\n                <div class="viz-actions">\n                    <button class="btn btn-gold" onclick="applyBestResult()">âš¡ åº”ç”¨æœ€ä½³å‚æ•°åˆ°ç¼–è¾‘å™¨</button>\n                    <button class="btn" onclick="exportVisualization()">ğŸ“¤ å¯¼å‡ºå›¾è¡¨</button>\n                </div>\n            </div>\n        </div>`}calculateParamCorrelations(){if(this._optimizationResults.length<5||0===this._parameterRanges.length)return[];const n=this._optimizationResults,e=[];for(const t of this._parameterRanges){const a=n.map(n=>n.parameters[t.name]||0),r=n.map(n=>n.score),i=a.length,s=a.reduce((n,e)=>n+e,0),o=r.reduce((n,e)=>n+e,0),c=a.reduce((n,e,t)=>n+e*r[t],0),d=a.reduce((n,e)=>n+e*e,0),l=r.reduce((n,e)=>n+e*e,0),p=i*c-s*o,g=Math.sqrt((i*d-s*s)*(i*l-o*o)),m=0!==g?p/g:0;e.push({name:t.name,correlation:m})}return e.sort((n,e)=>Math.abs(e.correlation)-Math.abs(n.correlation))}renderFooter(){return`\n        <div class="footer">\n            <div class="footer-left">\n                <span class="status">${this._isOptimizing?"â³ ä¼˜åŒ–ä¸­...":this._strategyCode?"âœ“ å°±ç»ª":"â—‹ æœªåŠ è½½"}</span>\n            </div>\n            <div class="footer-actions">\n                <button class="btn btn-primary" onclick="selectFile()">\n                    ğŸ“ é€‰æ‹©ç­–ç•¥æ–‡ä»¶\n                </button>\n                ${this._strategyCode?'\n                    <button class="btn btn-gold" onclick="analyzeStrategy()">\n                        ğŸ” å¼€å§‹åˆ†æ\n                    </button>\n                    <button class="btn" onclick="saveAndBacktest()">\n                        ğŸ“Š ä¿å­˜å¹¶å›æµ‹\n                    </button>\n                    <button class="btn btn-gold" onclick="saveAndTrade()">\n                        ğŸ’° ä¿å­˜å¹¶å®ç›˜\n                    </button>\n                ':""}\n            </div>\n        </div>`}highlightCode(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}getScoreColor(n){return n>=80?"#3fb950":n>=60?"#f0b429":"#f85149"}getStyles(){return"\n        :root {\n            --bg-dark: #0a0e14;\n            --bg-primary: #0d1117;\n            --bg-secondary: #161b22;\n            --bg-card: #1c2128;\n            --bg-hover: #21262d;\n            --text-primary: #e6edf3;\n            --text-secondary: #8b949e;\n            --text-muted: #6e7681;\n            --accent-gold: #f0b429;\n            --accent-green: #3fb950;\n            --accent-blue: #58a6ff;\n            --accent-red: #f85149;\n            --accent-purple: #a371f7;\n            --border-color: #30363d;\n        }\n        \n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body {\n            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;\n            background: var(--bg-dark);\n            color: var(--text-primary);\n            min-height: 100vh;\n        }\n        \n        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }\n        \n        /* Header */\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 16px 0;\n            border-bottom: 1px solid var(--border-color);\n            margin-bottom: 20px;\n        }\n        .header h1 {\n            font-size: 24px;\n            background: linear-gradient(135deg, #f0b429, #e85d04);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n        }\n        .subtitle { color: var(--text-muted); font-size: 14px; margin-top: 4px; }\n        .status-badge {\n            padding: 4px 12px;\n            border-radius: 12px;\n            font-size: 12px;\n        }\n        .status-loaded { background: rgba(63, 185, 80, 0.2); color: var(--accent-green); }\n        .status-empty { background: var(--bg-secondary); color: var(--text-muted); }\n        .score-badge {\n            padding: 4px 12px;\n            border-radius: 12px;\n            font-size: 12px;\n            background: var(--accent-gold);\n            color: #000;\n            font-weight: 600;\n            margin-left: 8px;\n        }\n        \n        /* Tabs */\n        .tabs {\n            display: flex;\n            gap: 4px;\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 4px;\n            margin-bottom: 20px;\n        }\n        .tab {\n            flex: 1;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 8px;\n            padding: 12px 16px;\n            background: transparent;\n            border: none;\n            border-radius: 8px;\n            color: var(--text-secondary);\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n        .tab:hover:not(.disabled) { background: var(--bg-hover); color: var(--text-primary); }\n        .tab.active { background: var(--bg-card); color: var(--accent-gold); }\n        .tab.disabled { opacity: 0.4; cursor: not-allowed; }\n        .tab-number {\n            width: 20px;\n            height: 20px;\n            border-radius: 50%;\n            background: var(--border-color);\n            font-size: 11px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n        .tab.active .tab-number { background: var(--accent-gold); color: #000; }\n        \n        /* Buttons */\n        .btn {\n            padding: 10px 20px;\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            color: var(--text-secondary);\n            cursor: pointer;\n            font-size: 14px;\n            transition: all 0.2s;\n        }\n        .btn:hover:not(:disabled) { background: var(--bg-hover); border-color: var(--accent-blue); color: var(--text-primary); }\n        .btn:disabled { opacity: 0.5; cursor: not-allowed; }\n        .btn-primary { background: var(--accent-blue); border: none; color: #fff; }\n        .btn-gold { background: linear-gradient(135deg, #f0b429, #d4a012); border: none; color: #000; font-weight: 600; }\n        .btn-danger { background: rgba(248, 81, 73, 0.2); border-color: var(--accent-red); color: var(--accent-red); }\n        .btn-sm { padding: 6px 12px; font-size: 12px; }\n        .btn-lg { padding: 14px 28px; font-size: 16px; }\n        \n        /* Content */\n        .content { min-height: 500px; }\n        .tab-content { animation: fadeIn 0.2s; }\n        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }\n        \n        .toolbar { display: flex; gap: 12px; margin-bottom: 20px; }\n        \n        /* Empty State */\n        .empty-state {\n            text-align: center;\n            padding: 80px 20px;\n            color: var(--text-muted);\n        }\n        .empty-icon { font-size: 64px; margin-bottom: 20px; opacity: 0.5; }\n        .empty-state h2 { font-size: 20px; color: var(--text-secondary); margin-bottom: 8px; }\n        .hint { margin-top: 12px; font-size: 13px; }\n        \n        /* Code */\n        .code-info {\n            display: flex;\n            gap: 20px;\n            padding: 12px 16px;\n            background: var(--bg-secondary);\n            border-radius: 8px;\n            margin-bottom: 16px;\n            font-size: 13px;\n            color: var(--text-secondary);\n        }\n        .code-container {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            overflow: hidden;\n            margin-bottom: 20px;\n        }\n        .code-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 12px 16px;\n            background: var(--bg-card);\n            border-bottom: 1px solid var(--border-color);\n            font-size: 13px;\n            color: var(--text-muted);\n        }\n        .code-block {\n            padding: 16px;\n            margin: 0;\n            max-height: 400px;\n            overflow: auto;\n            font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', 'Monaco', monospace;\n            font-size: 13px;\n            line-height: 1.6;\n            background: var(--bg-card);\n            border-radius: 8px;\n            white-space: pre;\n            tab-size: 4;\n            -moz-tab-size: 4;\n        }\n        /* CodeMirror Editor */\n        .editor-container {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            overflow: hidden;\n            margin-bottom: 20px;\n            border: 1px solid var(--border-color);\n        }\n        #code-editor {\n            height: 500px;\n            font-size: 14px;\n        }\n        .CodeMirror {\n            height: 100%;\n            font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', 'Monaco', monospace;\n            font-size: 14px;\n            line-height: 1.6;\n            background: var(--bg-card) !important;\n            color: var(--text-primary) !important;\n        }\n        .CodeMirror-gutters {\n            background: var(--bg-secondary) !important;\n            border-right: 1px solid var(--border-color) !important;\n        }\n        .CodeMirror-linenumber {\n            color: var(--text-muted) !important;\n        }\n        .CodeMirror-cursor {\n            border-left: 2px solid var(--accent-gold) !important;\n        }\n        .CodeMirror-selected {\n            background: rgba(240, 180, 41, 0.2) !important;\n        }\n        .editor-tab {\n            display: flex;\n            flex-direction: column;\n            height: 100%;\n        }\n        \n        /* Params Preview */\n        .params-preview { margin-top: 20px; }\n        .params-preview h3 { font-size: 16px; margin-bottom: 12px; }\n        .params-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 12px; }\n        .param-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            padding: 12px;\n        }\n        .param-name { font-size: 12px; color: var(--text-muted); margin-bottom: 4px; }\n        .param-value { font-size: 20px; font-weight: 600; color: var(--accent-gold); }\n        .param-desc { font-size: 11px; color: var(--text-muted); margin-top: 4px; }\n        \n        /* Score Section */\n        .score-section {\n            display: grid;\n            grid-template-columns: 2fr repeat(4, 1fr);\n            gap: 16px;\n            margin-bottom: 24px;\n        }\n        .score-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 20px;\n            text-align: center;\n        }\n        .score-card.main-score {\n            background: linear-gradient(135deg, rgba(240, 180, 41, 0.1), rgba(212, 160, 18, 0.1));\n            border-color: var(--accent-gold);\n        }\n        .score-label { font-size: 12px; color: var(--text-muted); margin-bottom: 8px; }\n        .score-value { font-size: 36px; font-weight: 700; }\n        .main-score .score-value { color: var(--accent-gold); }\n        .score-bar {\n            height: 4px;\n            background: var(--bg-card);\n            border-radius: 2px;\n            margin-top: 12px;\n            overflow: hidden;\n        }\n        .score-fill {\n            height: 100%;\n            background: var(--accent-gold);\n            border-radius: 2px;\n        }\n        \n        /* Summary */\n        .summary-section { margin-bottom: 24px; }\n        .summary-section h3 { font-size: 16px; margin-bottom: 12px; }\n        .summary-content {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            line-height: 1.8;\n            white-space: pre-wrap;\n        }\n        \n        /* Advices */\n        .advices-section h3 { font-size: 16px; margin-bottom: 12px; }\n        .advices-list { display: flex; flex-direction: column; gap: 12px; }\n        .advice-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            overflow: hidden;\n        }\n        .advice-card.priority-high { border-left: 3px solid var(--accent-red); }\n        .advice-card.priority-medium { border-left: 3px solid var(--accent-gold); }\n        .advice-card.priority-low { border-left: 3px solid var(--accent-blue); }\n        .advice-header {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            padding: 12px 16px;\n            background: var(--bg-card);\n        }\n        .advice-priority { font-size: 12px; }\n        .advice-title { font-weight: 600; flex: 1; }\n        .advice-category {\n            font-size: 11px;\n            padding: 2px 8px;\n            background: var(--bg-hover);\n            border-radius: 4px;\n            color: var(--text-muted);\n        }\n        .advice-body { padding: 16px; color: var(--text-secondary); line-height: 1.6; }\n        .advice-body p { margin-bottom: 8px; }\n        .advice-footer { padding: 12px 16px; border-top: 1px solid var(--border-color); }\n        \n        /* Config Section */\n        .config-section { margin-bottom: 24px; }\n        .config-section h3 { font-size: 16px; margin-bottom: 12px; }\n        .config-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }\n        .config-item { display: flex; flex-direction: column; gap: 8px; }\n        .config-item label { font-size: 12px; color: var(--text-muted); }\n        .config-item select, .config-item input {\n            padding: 10px;\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            color: var(--text-primary);\n            font-size: 14px;\n        }\n        \n        /* Params Table */\n        .params-section { margin-bottom: 24px; }\n        .section-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 12px;\n        }\n        .section-header h3 { font-size: 16px; }\n        .params-table {\n            width: 100%;\n            border-collapse: collapse;\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            overflow: hidden;\n        }\n        .params-table th, .params-table td { padding: 12px; text-align: left; }\n        .params-table th {\n            background: var(--bg-card);\n            font-size: 12px;\n            color: var(--text-muted);\n            font-weight: 500;\n        }\n        .params-table td { border-top: 1px solid var(--border-color); }\n        .input-sm {\n            width: 100%;\n            padding: 6px 8px;\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 4px;\n            color: var(--text-primary);\n            font-size: 13px;\n        }\n        \n        /* Progress */\n        .progress-section {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 20px;\n            margin-bottom: 24px;\n        }\n        .progress-bar {\n            height: 8px;\n            background: var(--bg-card);\n            border-radius: 4px;\n            margin: 16px 0;\n            overflow: hidden;\n        }\n        .progress-fill {\n            height: 100%;\n            background: linear-gradient(90deg, var(--accent-gold), #e85d04);\n            transition: width 0.3s;\n        }\n        .progress-info { display: flex; justify-content: space-between; align-items: center; }\n        \n        /* Results */\n        .results-section { margin-top: 24px; }\n        .results-section h3 { font-size: 16px; margin-bottom: 12px; }\n        .results-table {\n            width: 100%;\n            border-collapse: collapse;\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            overflow: hidden;\n        }\n        .results-table th, .results-table td { padding: 12px; text-align: center; }\n        .results-table th { background: var(--bg-card); font-size: 12px; color: var(--text-muted); }\n        .results-table td { border-top: 1px solid var(--border-color); }\n        .results-table .best-result { background: rgba(240, 180, 41, 0.1); }\n        .positive { color: var(--accent-green); }\n        .negative { color: var(--accent-red); }\n        .score { font-weight: 600; color: var(--accent-gold); }\n        \n        /* Versions */\n        .versions-list { display: flex; flex-direction: column; gap: 12px; }\n        .version-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 16px;\n        }\n        .version-card.latest { border-color: var(--accent-gold); }\n        .version-header { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }\n        .version-name { font-weight: 600; font-size: 16px; }\n        .optimized-badge {\n            font-size: 11px;\n            padding: 2px 8px;\n            background: rgba(240, 180, 41, 0.2);\n            color: var(--accent-gold);\n            border-radius: 4px;\n        }\n        .version-time { font-size: 12px; color: var(--text-muted); margin-left: auto; }\n        .version-desc { color: var(--text-secondary); font-size: 14px; margin-bottom: 12px; }\n        .version-metrics {\n            display: flex;\n            gap: 16px;\n            font-size: 13px;\n            color: var(--text-muted);\n            margin-bottom: 12px;\n        }\n        .version-actions { display: flex; gap: 8px; }\n        \n        /* Chart */\n        .chart-section, .metrics-section { margin-bottom: 24px; }\n        .chart-section h3, .metrics-section h3 { font-size: 16px; margin-bottom: 16px; }\n        .bar-chart {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 20px;\n        }\n        .bar-item { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }\n        .bar-label { width: 40px; font-size: 13px; color: var(--text-muted); }\n        .bar-container { flex: 1; height: 24px; background: var(--bg-card); border-radius: 4px; overflow: hidden; }\n        .bar-fill { height: 100%; background: linear-gradient(90deg, var(--accent-gold), #e85d04); }\n        .bar-value { width: 60px; font-size: 13px; text-align: right; }\n        .metrics-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }\n        .metric-card {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 20px;\n            text-align: center;\n        }\n        .metric-label { font-size: 12px; color: var(--text-muted); margin-bottom: 8px; }\n        .metric-value { font-size: 24px; font-weight: 600; }\n        \n        /* Footer */\n        .footer {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 16px 0;\n            margin-top: 24px;\n            border-top: 1px solid var(--border-color);\n        }\n        .footer-left { display: flex; align-items: center; }\n        .footer-actions { display: flex; gap: 12px; }\n        .status { font-size: 13px; color: var(--text-muted); }\n        \n        .action-section { text-align: center; margin: 24px 0; }\n        .action-hint { font-size: 12px; color: var(--text-muted); margin-top: 8px; }\n        \n        /* Editor Top Bar */\n        .editor-top-bar {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 12px 16px;\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            margin-bottom: 16px;\n        }\n        .editor-info { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }\n        .editor-top-actions { display: flex; gap: 8px; }\n        .file-name { font-weight: 600; font-size: 15px; }\n        .file-stats { font-size: 13px; color: var(--text-muted); }\n        .score-indicator { font-weight: 600; padding: 4px 8px; background: var(--bg-card); border-radius: 4px; }\n        .opt-indicator { font-size: 13px; color: var(--accent-gold); }\n        .editor-toolbar {\n            display: flex;\n            gap: 8px;\n            padding: 8px 0;\n            margin-bottom: 8px;\n            flex-wrap: wrap;\n        }\n        .editor-container.empty {\n            min-height: 400px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            background: var(--bg-secondary);\n            border-radius: 12px;\n        }\n        .editor-placeholder {\n            text-align: center;\n            color: var(--text-muted);\n        }\n        .placeholder-icon { font-size: 64px; margin-bottom: 16px; }\n        .editor-placeholder h3 { font-size: 18px; margin-bottom: 8px; color: var(--text-primary); }\n        .editor-placeholder p { margin: 4px 0; }\n        .no-params-hint {\n            background: var(--bg-secondary);\n            border-radius: 8px;\n            padding: 12px 16px;\n            margin-top: 16px;\n            color: var(--text-muted);\n            font-size: 13px;\n        }\n        .no-params-hint code {\n            background: var(--bg-card);\n            padding: 2px 6px;\n            border-radius: 4px;\n            color: var(--accent-gold);\n        }\n        .params-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 12px;\n        }\n        .param-range { font-size: 11px; color: var(--text-muted); }\n        \n        /* Analysis Header */\n        .analysis-header {\n            display: flex;\n            gap: 32px;\n            padding: 24px;\n            background: var(--bg-secondary);\n            border-radius: 16px;\n            margin-bottom: 24px;\n        }\n        .main-score-card { flex: 0 0 180px; }\n        .score-ring { position: relative; width: 140px; height: 140px; margin: 0 auto; }\n        .score-ring svg { transform: rotate(-90deg); }\n        .score-bg { fill: none; stroke: var(--bg-card); stroke-width: 8; }\n        .score-progress { fill: none; stroke: var(--accent-gold); stroke-width: 8; stroke-linecap: round; transition: stroke-dasharray 0.5s; }\n        .score-text {\n            position: absolute;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            text-align: center;\n        }\n        .score-number { font-size: 36px; font-weight: 700; display: block; }\n        .score-label { font-size: 12px; color: var(--text-muted); }\n        .score-breakdown { flex: 1; display: flex; flex-direction: column; justify-content: center; gap: 12px; }\n        .breakdown-item { display: flex; align-items: center; gap: 12px; }\n        .breakdown-label { width: 80px; font-size: 13px; color: var(--text-secondary); }\n        .breakdown-bar { flex: 1; height: 8px; background: var(--bg-card); border-radius: 4px; overflow: hidden; }\n        .breakdown-fill { height: 100%; border-radius: 4px; transition: width 0.3s; }\n        .breakdown-value { width: 30px; font-size: 13px; font-weight: 600; text-align: right; }\n        .advices-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 16px;\n        }\n        .advices-filter { display: flex; gap: 8px; }\n        .filter-btn {\n            padding: 4px 12px;\n            background: var(--bg-card);\n            border: none;\n            border-radius: 4px;\n            color: var(--text-muted);\n            cursor: pointer;\n            font-size: 12px;\n        }\n        .filter-btn.active { background: var(--accent-gold); color: #000; }\n        .analysis-actions { display: flex; gap: 12px; justify-content: center; margin-top: 24px; }\n        \n        /* Optimize Header */\n        .optimize-header {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            margin-bottom: 20px;\n        }\n        .strategy-info { display: flex; gap: 16px; }\n        .strategy-name { font-weight: 600; }\n        .param-count, .combo-count { font-size: 13px; color: var(--text-muted); }\n        .config-desc { font-size: 11px; color: var(--text-muted); margin-top: 4px; }\n        .section-actions { display: flex; gap: 8px; }\n        .empty-params {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 32px;\n            text-align: center;\n            color: var(--text-muted);\n        }\n        .step-count { color: var(--accent-blue); font-weight: 600; }\n        .progress-details {\n            display: flex;\n            gap: 24px;\n            margin-top: 12px;\n            font-size: 13px;\n            color: var(--text-muted);\n        }\n        .results-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 16px;\n        }\n        .results-actions { display: flex; gap: 8px; }\n        .params-cell { font-size: 11px; color: var(--text-muted); max-width: 200px; overflow: hidden; text-overflow: ellipsis; }\n        \n        /* Versions Timeline */\n        .versions-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n        }\n        .versions-stats { display: flex; gap: 16px; color: var(--text-muted); }\n        .versions-actions { display: flex; gap: 8px; }\n        .versions-timeline { position: relative; }\n        .version-card {\n            display: flex;\n            gap: 16px;\n            margin-bottom: 16px;\n        }\n        .version-indicator {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            width: 24px;\n        }\n        .version-dot {\n            width: 12px;\n            height: 12px;\n            border-radius: 50%;\n            background: var(--border-color);\n        }\n        .version-dot.current { background: var(--accent-gold); }\n        .version-line { flex: 1; width: 2px; background: var(--border-color); margin-top: 4px; }\n        .version-content {\n            flex: 1;\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            border: 1px solid var(--border-color);\n        }\n        .version-card.latest .version-content { border-color: var(--accent-gold); }\n        .version-card.optimized .version-dot { background: var(--accent-green); }\n        .manual-badge {\n            font-size: 11px;\n            padding: 2px 8px;\n            background: rgba(88, 166, 255, 0.2);\n            color: var(--accent-blue);\n            border-radius: 4px;\n        }\n        .version-metrics {\n            display: flex;\n            gap: 16px;\n            margin: 12px 0;\n        }\n        .metric-item { display: flex; flex-direction: column; }\n        .metric-label { font-size: 11px; color: var(--text-muted); }\n        .metric-value { font-weight: 600; }\n        .metric-item.positive .metric-value { color: var(--accent-green); }\n        .metric-item.negative .metric-value { color: var(--accent-red); }\n        .version-params { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 12px; }\n        .param-tag {\n            font-size: 11px;\n            padding: 2px 6px;\n            background: var(--bg-card);\n            border-radius: 4px;\n            color: var(--text-muted);\n        }\n        .param-tag.more { background: var(--accent-gold); color: #000; }\n        \n        /* Visualization */\n        .visualize-tab { padding: 0 !important; }\n        .viz-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n        }\n        .viz-header h2 { font-size: 20px; }\n        .viz-info { color: var(--text-muted); }\n        .viz-metrics-grid {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 16px;\n            margin-bottom: 24px;\n        }\n        .viz-metric-card {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 20px;\n            display: flex;\n            gap: 16px;\n        }\n        .viz-metric-card.best {\n            background: linear-gradient(135deg, rgba(240, 180, 41, 0.2), rgba(232, 93, 4, 0.2));\n            border: 1px solid var(--accent-gold);\n        }\n        .viz-metric-icon { font-size: 32px; }\n        .viz-metric-content { flex: 1; }\n        .viz-metric-label { font-size: 12px; color: var(--text-muted); margin-bottom: 4px; }\n        .viz-metric-value { font-size: 24px; font-weight: 700; }\n        .viz-metric-sub { font-size: 12px; color: var(--text-muted); margin-top: 4px; }\n        .viz-section {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 20px;\n            margin-bottom: 20px;\n        }\n        .viz-section h3 { font-size: 16px; margin-bottom: 16px; }\n        .viz-bar-chart { display: flex; flex-direction: column; gap: 8px; }\n        .viz-bar-item { display: flex; align-items: center; gap: 12px; }\n        .viz-bar-item.best .viz-bar-fill { background: linear-gradient(90deg, var(--accent-gold), #e85d04); }\n        .viz-bar-label { width: 40px; font-size: 13px; color: var(--text-muted); }\n        .viz-bar-track {\n            flex: 1;\n            height: 28px;\n            background: var(--bg-card);\n            border-radius: 4px;\n            overflow: hidden;\n        }\n        .viz-bar-fill {\n            height: 100%;\n            background: var(--accent-blue);\n            display: flex;\n            align-items: center;\n            justify-content: flex-end;\n            padding-right: 8px;\n            border-radius: 4px;\n            transition: width 0.3s;\n        }\n        .viz-bar-value { font-size: 12px; font-weight: 600; color: #fff; }\n        .viz-stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }\n        .viz-stat-card { background: var(--bg-card); border-radius: 8px; padding: 16px; }\n        .viz-stat-card h4 { font-size: 13px; margin-bottom: 12px; color: var(--text-secondary); }\n        .viz-stat-range { display: flex; align-items: center; gap: 8px; }\n        .range-min, .range-max { font-size: 12px; color: var(--text-muted); width: 60px; }\n        .range-max { text-align: right; }\n        .range-bar { flex: 1; height: 6px; background: var(--bg-hover); border-radius: 3px; position: relative; }\n        .range-avg {\n            position: absolute;\n            top: -4px;\n            width: 14px;\n            height: 14px;\n            background: var(--accent-gold);\n            border-radius: 50%;\n            transform: translateX(-50%);\n        }\n        .viz-stat-avg { font-size: 12px; color: var(--text-muted); text-align: center; margin-top: 8px; }\n        .viz-sensitivity { display: flex; flex-direction: column; gap: 8px; }\n        .sensitivity-item { display: flex; align-items: center; gap: 12px; }\n        .sensitivity-name { width: 120px; font-size: 13px; }\n        .sensitivity-bar-container {\n            flex: 1;\n            height: 8px;\n            background: var(--bg-card);\n            border-radius: 4px;\n            overflow: hidden;\n        }\n        .sensitivity-bar { height: 100%; }\n        .sensitivity-bar.positive { background: var(--accent-green); }\n        .sensitivity-bar.negative { background: var(--accent-red); }\n        .sensitivity-value { width: 50px; font-size: 12px; text-align: right; }\n        .sensitivity-hint { font-size: 11px; color: var(--text-muted); margin-top: 12px; font-style: italic; }\n        .viz-best-params {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 12px;\n            margin-bottom: 20px;\n        }\n        .best-param-item {\n            background: var(--bg-card);\n            border-radius: 8px;\n            padding: 12px 16px;\n            display: flex;\n            flex-direction: column;\n        }\n        .best-param-name { font-size: 12px; color: var(--text-muted); margin-bottom: 4px; }\n        .best-param-value { font-size: 18px; font-weight: 600; color: var(--accent-gold); }\n        .viz-actions { display: flex; gap: 12px; justify-content: center; }\n        "}getScripts(){const n=this._strategyCode||"";return`\n        const vscode = acquireVsCodeApi();\n        let codeEditor = null;\n        \n        // åˆå§‹åŒ–CodeMirrorç¼–è¾‘å™¨\n        function initEditor() {\n            const editorElement = document.getElementById('code-editor');\n            if (!editorElement) return;\n            \n            codeEditor = CodeMirror(editorElement, {\n                value: ${JSON.stringify(n)},\n                mode: 'python',\n                theme: 'monokai',\n                lineNumbers: true,\n                indentUnit: 4,\n                indentWithTabs: false,\n                lineWrapping: true,\n                autofocus: true,\n                extraKeys: {\n                    'Tab': function(cm) {\n                        if (cm.somethingSelected()) {\n                            cm.indentSelection('add');\n                        } else {\n                            cm.replaceSelection('    ', 'end');\n                        }\n                    },\n                    'Shift-Tab': function(cm) {\n                        cm.indentSelection('subtract');\n                    }\n                }\n            });\n            \n            // ç›‘å¬ä»£ç å˜åŒ–\n            let changeTimeout = null;\n            codeEditor.on('change', function() {\n                clearTimeout(changeTimeout);\n                changeTimeout = setTimeout(function() {\n                    const code = codeEditor.getValue();\n                    vscode.postMessage({ command: 'codeChanged', code: code });\n                }, 500); // é˜²æŠ–500ms\n            });\n        }\n        \n        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–ç¼–è¾‘å™¨\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', initEditor);\n        } else {\n            initEditor();\n        }\n        \n        // === åŸºç¡€å¯¼èˆª ===\n        function switchTab(tab) { vscode.postMessage({ command: 'switchTab', tab }); }\n        function selectFile() { vscode.postMessage({ command: 'selectFile' }); }\n        \n        // === ç­–ç•¥ç¼–è¾‘å™¨ ===\n        function analyzeStrategy() { \n            if (codeEditor) {\n                const code = codeEditor.getValue();\n                vscode.postMessage({ command: 'getCodeResponse', code: code });\n            } else {\n                vscode.postMessage({ command: 'analyzeStrategy' }); \n            }\n        }\n        function reanalyzeStrategy() { analyzeStrategy(); }\n        function syncFromEditor() {\n            if (codeEditor) {\n                const code = codeEditor.getValue();\n                vscode.postMessage({ command: 'codeChanged', code: code });\n            }\n        }\n        function formatCode() {\n            // ç®€å•çš„ä»£ç æ ¼å¼åŒ–\n            if (codeEditor) {\n                const code = codeEditor.getValue();\n                // ç§»é™¤å¤šä½™ç©ºè¡Œ\n                const formatted = code.replace(/\\n{3,}/g, '\\n\\n').trim();\n                codeEditor.setValue(formatted);\n            }\n        }\n        function copyCode() {\n            if (codeEditor) {\n                navigator.clipboard.writeText(codeEditor.getValue());\n                alert('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');\n            }\n        }\n        function highlightParam(paramName) {\n            if (codeEditor) {\n                const code = codeEditor.getValue();\n                const regex = new RegExp(paramName + '\\\\s*=', 'g');\n                const match = regex.exec(code);\n                if (match) {\n                    const pos = codeEditor.posFromIndex(match.index);\n                    codeEditor.setCursor(pos);\n                    codeEditor.scrollIntoView(pos, 100);\n                }\n            }\n        }\n        function applyBestResult() {\n            vscode.postMessage({ command: 'applyBestResult' });\n        }\n        \n        // === å‚æ•°ä¼˜åŒ– ===\n        function updateParam(i, f, v) { vscode.postMessage({ command: 'updateParameter', index: i, field: f, value: v }); }\n        function addParameter() { vscode.postMessage({ command: 'addParameter' }); }\n        function removeParam(i) { vscode.postMessage({ command: 'removeParameter', index: i }); }\n        function autoDetectParams() { vscode.postMessage({ command: 'autoDetectParams' }); }\n        \n        function startOptimization() {\n            const config = {\n                algorithm: document.getElementById('algorithm')?.value || 'grid',\n                maxIterations: parseInt(document.getElementById('maxIterations')?.value || '50'),\n                target: document.getElementById('target')?.value || 'combined',\n                earlyStop: document.getElementById('earlyStop')?.value || 'none'\n            };\n            vscode.postMessage({ command: 'startOptimization', config });\n        }\n        function stopOptimization() { vscode.postMessage({ command: 'stopOptimization' }); }\n        function applyResult(id) { vscode.postMessage({ command: 'applyResult', resultId: id }); }\n        function viewResultDetail(id) { vscode.postMessage({ command: 'viewResultDetail', resultId: id }); }\n        function exportResults() { vscode.postMessage({ command: 'exportResults' }); }\n        \n        function updateAlgorithmInfo() {\n            const algorithm = document.getElementById('algorithm')?.value;\n            const desc = document.getElementById('algorithmDesc');\n            if (desc) {\n                if (algorithm === 'grid') {\n                    desc.textContent = 'ç©·ä¸¾æ‰€æœ‰å‚æ•°ç»„åˆï¼Œé€‚åˆå‚æ•°ç©ºé—´è¾ƒå°æ—¶';\n                } else {\n                    desc.textContent = 'éšæœºé‡‡æ ·å‚æ•°ç»„åˆï¼Œé€‚åˆå‚æ•°ç©ºé—´è¾ƒå¤§æ—¶';\n                }\n            }\n        }\n        \n        // === ç‰ˆæœ¬ç®¡ç† ===\n        function saveVersion() {\n            const desc = prompt('è¯·è¾“å…¥ç‰ˆæœ¬æè¿°ï¼š', 'æ‰‹åŠ¨ä¿å­˜');\n            if (desc !== null) {\n                // å…ˆè·å–å½“å‰ä»£ç å†å‘é€ä¿å­˜è¯·æ±‚\n                const code = codeEditor ? codeEditor.getValue() : '';\n                vscode.postMessage({ command: 'getCodeForSave', code: code, description: desc });\n            }\n        }\n        function loadVersion(id) { vscode.postMessage({ command: 'loadVersion', versionId: id }); }\n        function compareVersions(v1, v2) { vscode.postMessage({ command: 'compareVersions', v1, v2 }); }\n        function deleteVersion(id) {\n            if (confirm('ç¡®å®šåˆ é™¤æ­¤ç‰ˆæœ¬ï¼Ÿ')) vscode.postMessage({ command: 'deleteVersion', versionId: id });\n        }\n        function exportVersion(id) { vscode.postMessage({ command: 'exportVersion', versionId: id }); }\n        function exportAllVersions() { vscode.postMessage({ command: 'exportAllVersions' }); }\n        function clearAllVersions() {\n            if (confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰ç‰ˆæœ¬ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {\n                vscode.postMessage({ command: 'clearAllVersions' });\n            }\n        }\n        function viewVersionCode(id) { vscode.postMessage({ command: 'viewVersionCode', versionId: id }); }\n        \n        // === å…¶ä»– ===\n        function applyAdvice(id) { vscode.postMessage({ command: 'applyAdvice', adviceId: id }); }\n        function saveAndBacktest() { vscode.postMessage({ command: 'saveAndBacktest' }); }\n        function saveAndTrade() { vscode.postMessage({ command: 'saveAndTrade' }); }\n        function exportVisualization() { vscode.postMessage({ command: 'exportVisualization' }); }\n        \n        window.addEventListener('message', event => {\n            const msg = event.data;\n            if (msg.command === 'updateProgress') {\n                const fill = document.querySelector('.progress-fill');\n                const text = document.getElementById('progressText');\n                if (fill) fill.style.width = msg.progress + '%';\n                if (text) text.textContent = msg.current + '/' + msg.total + ' (' + msg.progress.toFixed(0) + '%)';\n            } else if (msg.command === 'updateCode') {\n                // æ›´æ–°ç¼–è¾‘å™¨ä»£ç \n                if (codeEditor) {\n                    codeEditor.setValue(msg.code || '');\n                }\n            } else if (msg.command === 'getCode') {\n                // è¿”å›å½“å‰ä»£ç \n                if (codeEditor) {\n                    const code = codeEditor.getValue();\n                    vscode.postMessage({ command: 'getCodeResponse', code: code });\n                }\n            }\n        });\n        `}dispose(){for(u.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const n=this._disposables.pop();n&&n.dispose()}}}e.StrategyOptimizerPanel=u},285:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.DataUpdateService=void 0;const o=s(t(398)),c=s(t(317)),d=s(t(928)),l=s(t(896)),p=t(628),g="DataUpdateService";class m{static instance;_pythonPath;constructor(){const n=o.workspace.getConfiguration("trquant");this._pythonPath=n.get("pythonPath","python")}static getInstance(){return m.instance||(m.instance=new m),m.instance}async updateMarketData(){try{p.logger.info("å¼€å§‹æ›´æ–°è¡Œæƒ…æ•°æ®...",g);const n=await this.executePythonScript('\nimport sys\nimport os\nfrom datetime import date, datetime, timedelta\n\n# ç¡®ä¿å·¥ä½œåŒºè·¯å¾„åœ¨ sys.path ä¸­\nworkspace_path = r\'__WORKSPACE_PATH__\'\nif workspace_path not in sys.path:\n    sys.path.insert(0, workspace_path)\n\ntry:\n    # ä½¿ç”¨ä¸æ¡Œé¢ç«¯ç›¸åŒçš„æ•°æ®æºç®¡ç†å™¨\n    from core.data_source_manager import get_data_source_manager, DataSourceType\n    \n    # è·å–æ•°æ®æºç®¡ç†å™¨ï¼ˆä¼šè‡ªåŠ¨åˆå§‹åŒ–ï¼‰\n    manager = get_data_source_manager()\n    print("âœ“ æ•°æ®æºç®¡ç†å™¨å·²å°±ç»ª")\n    \n    # æ£€æŸ¥JQDataæƒé™èŒƒå›´\n    jq_status = manager.get_source_status(DataSourceType.JQDATA)\n    if jq_status and jq_status.is_available:\n        print(f"âœ“ JQDataå¯ç”¨: {jq_status.start_date} è‡³ {jq_status.end_date}")\n        # ä½¿ç”¨æƒé™èŒƒå›´å†…çš„æ—¥æœŸ\n        end_date = jq_status.end_date or date.today().strftime(\'%Y-%m-%d\')\n        start_date = (datetime.strptime(end_date, \'%Y-%m-%d\') - timedelta(days=5)).strftime(\'%Y-%m-%d\')\n    else:\n        # é»˜è®¤ä½¿ç”¨æœ€è¿‘5å¤©\n        end_date = date.today().strftime(\'%Y-%m-%d\')\n        start_date = (date.today() - timedelta(days=5)).strftime(\'%Y-%m-%d\')\n    \n    print(f"âœ“ æŸ¥è¯¢æ—¥æœŸèŒƒå›´: {start_date} è‡³ {end_date}")\n    \n    # è·å–ä¸»è¦æŒ‡æ•°æ•°æ®ï¼ˆä¸æ¡Œé¢ç«¯ä¸€è‡´ï¼‰\n    indices = [\'000001.XSHG\', \'399001.XSHE\', \'399006.XSHE\', \'000300.XSHG\']\n    updated_count = 0\n    failed_count = 0\n    \n    for idx in indices:\n        try:\n            # ä½¿ç”¨æ•°æ®æºç®¡ç†å™¨çš„ç»Ÿä¸€æ¥å£\n            result = manager.get_price(idx, start_date, end_date)\n            if result.success and result.data is not None and not result.data.empty:\n                # ä¿å­˜åˆ°ç¼“å­˜\n                manager.save_to_cache(idx, result.data)\n                updated_count += 1\n                print(f"âœ“ {idx} å·²æ›´æ–°: {len(result.data)} æ¡æ•°æ® (æ¥æº: {result.source.value})")\n            else:\n                failed_count += 1\n                print(f"âœ— {idx} æ›´æ–°å¤±è´¥: {result.error if result.error else \'æ— æ•°æ®\'}")\n        except Exception as e:\n            failed_count += 1\n            print(f"âœ— æ›´æ–° {idx} å¤±è´¥: {e}")\n    \n    print(f"\\nâœ“ è¡Œæƒ…æ•°æ®æ›´æ–°å®Œæˆ")\n    print(f"  æˆåŠŸ: {updated_count} ä¸ªæŒ‡æ•°")\n    if failed_count > 0:\n        print(f"  å¤±è´¥: {failed_count} ä¸ªæŒ‡æ•°")\n        \nexcept ImportError as e:\n    print(f"âœ— å¯¼å…¥æ¨¡å—å¤±è´¥: {e}")\n    print("è¯·ç¡®ä¿å·²å®‰è£…ä¾èµ–: pip install jqdatasdk")\n    import traceback\n    traceback.print_exc()\n    sys.exit(1)\nexcept Exception as e:\n    print(f"âœ— æ›´æ–°å¤±è´¥: {e}")\n    import traceback\n    traceback.print_exc()\n    sys.exit(1)\n            ');return n.success?{success:!0,message:"è¡Œæƒ…æ•°æ®æ›´æ–°æˆåŠŸ",details:n.output}:{success:!1,message:`è¡Œæƒ…æ•°æ®æ›´æ–°å¤±è´¥: ${n.error}`,details:n.output}}catch(n){const e=n instanceof Error?n.message:String(n);return p.logger.error(`æ›´æ–°è¡Œæƒ…æ•°æ®å¤±è´¥: ${e}`,g),{success:!1,message:`æ›´æ–°å¤±è´¥: ${e}`}}}async updateFinancialData(){try{p.logger.info("å¼€å§‹æ›´æ–°è´¢åŠ¡æ•°æ®...",g);const n=await this.executePythonScript('\nimport sys\nimport os\n\n# ç¡®ä¿å·¥ä½œåŒºè·¯å¾„åœ¨ sys.path ä¸­\nworkspace_path = r\'__WORKSPACE_PATH__\'\nif workspace_path not in sys.path:\n    sys.path.insert(0, workspace_path)\n\ntry:\n    # ä½¿ç”¨ä¸æ¡Œé¢ç«¯ç›¸åŒçš„æ•°æ®æºç®¡ç†å™¨\n    from core.data_source_manager import get_data_source_manager\n    \n    # åˆå§‹åŒ–æ•°æ®æºç®¡ç†å™¨\n    manager = get_data_source_manager()\n    if not manager.initialize():\n        print("âœ— æ•°æ®æºç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥")\n        sys.exit(1)\n    \n    print("âœ“ æ•°æ®æºç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ")\n    \n    # è·å–JQDataå®¢æˆ·ç«¯ï¼ˆå¦‚æœå¯ç”¨ï¼‰\n    jq_client = manager.get_jq_client()\n    if not jq_client or not jq_client.is_authenticated():\n        print("âœ— JQDataæœªè®¤è¯ï¼Œæ— æ³•è·å–è´¢åŠ¡æ•°æ®")\n        print("è¯·å…ˆæµ‹è¯•èšå®½è®¤è¯")\n        sys.exit(1)\n    \n    # è´¢åŠ¡æ•°æ®æ›´æ–°é€»è¾‘\n    import jqdatasdk as jq\n    from jqdatasdk import query, valuation, indicator\n    \n    # è·å–æ‰€æœ‰è‚¡ç¥¨ä»£ç \n    stocks = jq.get_all_securities(types=[\'stock\'], date=None)\n    print(f"âœ“ è·å–åˆ° {len(stocks)} åªè‚¡ç¥¨")\n    \n    # æ‰¹é‡è·å–è´¢åŠ¡æ•°æ®ï¼ˆç¤ºä¾‹ï¼šå‰100åªï¼‰\n    stock_codes = stocks.index[:100].tolist()\n    \n    q = query(\n        valuation.code,\n        valuation.market_cap,\n        valuation.pe_ratio,\n        valuation.pb_ratio,\n        indicator.roe,\n        indicator.roa\n    ).filter(valuation.code.in_(stock_codes))\n    \n    df = jq.get_fundamentals(q, date=None)\n    print(f"âœ“ å·²æ›´æ–° {len(df)} åªè‚¡ç¥¨çš„è´¢åŠ¡æ•°æ®")\n    print("\\nâœ“ è´¢åŠ¡æ•°æ®æ›´æ–°å®Œæˆ")\n        \nexcept ImportError as e:\n    print(f"âœ— å¯¼å…¥æ¨¡å—å¤±è´¥: {e}")\n    print("è¯·ç¡®ä¿å·²å®‰è£…ä¾èµ–: pip install jqdatasdk")\n    import traceback\n    traceback.print_exc()\n    sys.exit(1)\nexcept Exception as e:\n    print(f"âœ— æ›´æ–°å¤±è´¥: {e}")\n    import traceback\n    traceback.print_exc()\n    sys.exit(1)\n            ');return n.success?{success:!0,message:"è´¢åŠ¡æ•°æ®æ›´æ–°æˆåŠŸ",details:n.output}:{success:!1,message:`è´¢åŠ¡æ•°æ®æ›´æ–°å¤±è´¥: ${n.error}`,details:n.output}}catch(n){const e=n instanceof Error?n.message:String(n);return p.logger.error(`æ›´æ–°è´¢åŠ¡æ•°æ®å¤±è´¥: ${e}`,g),{success:!1,message:`æ›´æ–°å¤±è´¥: ${e}`}}}async testJQAuth(){try{p.logger.info("æµ‹è¯•èšå®½è®¤è¯...",g);const n=await this.executePythonScript('\nimport sys\nimport os\n\n# ç¡®ä¿å·¥ä½œåŒºè·¯å¾„åœ¨ sys.path ä¸­\nworkspace_path = r\'__WORKSPACE_PATH__\'\nif workspace_path not in sys.path:\n    sys.path.insert(0, workspace_path)\n\ntry:\n    # ä½¿ç”¨ä¸æ¡Œé¢ç«¯ç›¸åŒçš„æ•°æ®æºç®¡ç†å™¨\n    from core.data_source_manager import get_data_source_manager, DataSourceType\n    \n    print("=" * 50)\n    print("æ­£åœ¨åˆå§‹åŒ–æ•°æ®æºç®¡ç†å™¨...")\n    print("=" * 50)\n    \n    # è·å–æ•°æ®æºç®¡ç†å™¨ï¼ˆä¼šè‡ªåŠ¨åˆå§‹åŒ–ï¼‰\n    manager = get_data_source_manager()\n    print("âœ“ æ•°æ®æºç®¡ç†å™¨å·²å°±ç»ª")\n    \n    # æ£€æŸ¥å„æ•°æ®æºçŠ¶æ€\n    print()\n    print("=" * 50)\n    print("æ•°æ®æºçŠ¶æ€")\n    print("=" * 50)\n    \n    all_status = manager.get_all_status()\n    for source_type, status in all_status.items():\n        icon = "âœ“" if status.is_available else "âœ—"\n        print(f"{icon} {source_type.value}:")\n        if status.is_available:\n            print(f"    è´¦æˆ·ç±»å‹: {status.account_type.value}")\n            if status.start_date and status.end_date:\n                print(f"    æ•°æ®èŒƒå›´: {status.start_date} è‡³ {status.end_date}")\n            if status.is_realtime:\n                print(f"    å®æ—¶æ•°æ®: æ˜¯")\n        else:\n            print(f"    é”™è¯¯: {status.error_message}")\n    \n    # æ£€æŸ¥MongoDB\n    print()\n    print("=" * 50)\n    print("MongoDB è¿æ¥æµ‹è¯•")\n    print("=" * 50)\n    try:\n        from pymongo import MongoClient\n        client = MongoClient(\'localhost\', 27017, serverSelectionTimeoutMS=3000)\n        client.server_info()\n        db_names = client.list_database_names()\n        print(f"âœ“ MongoDB å·²è¿æ¥")\n        print(f"    æ•°æ®åº“: {\', \'.join(db_names)}")\n    except Exception as e:\n        print(f"âœ— MongoDB è¿æ¥å¤±è´¥: {e}")\n    \n    # æ•°æ®è·å–æµ‹è¯•\n    print()\n    print("=" * 50)\n    print("æ•°æ®è·å–æµ‹è¯•")\n    print("=" * 50)\n    \n    jq_status = manager.get_source_status(DataSourceType.JQDATA)\n    if jq_status and jq_status.is_available:\n        # ä½¿ç”¨æƒé™èŒƒå›´å†…çš„æ—¥æœŸ\n        from datetime import datetime, timedelta\n        end_date = jq_status.end_date\n        start_date = (datetime.strptime(end_date, \'%Y-%m-%d\') - timedelta(days=5)).strftime(\'%Y-%m-%d\')\n        \n        print(f"æµ‹è¯•è·å–æŒ‡æ•°æ•°æ® ({start_date} è‡³ {end_date})...")\n        result = manager.get_price(\'000001.XSHG\', start_date, end_date)\n        if result.success and result.data is not None and not result.data.empty:\n            latest = result.data.iloc[-1]\n            print(f"âœ“ ä¸Šè¯æŒ‡æ•°æœ€æ–°æ”¶ç›˜ä»·: {latest.get(\'close\', \'N/A\')}")\n            print(f"    æ•°æ®æ¥æº: {result.source.value}")\n            print(f"    æ•°æ®æ¡æ•°: {len(result.data)}")\n        else:\n            print(f"âœ— è·å–å¤±è´¥: {result.error}")\n    else:\n        print("âš  JQData ä¸å¯ç”¨ï¼Œè·³è¿‡æ•°æ®è·å–æµ‹è¯•")\n    \n    print()\n    print("=" * 50)\n    print("âœ“ æ‰€æœ‰æµ‹è¯•å®Œæˆ")\n    print("=" * 50)\n        \nexcept ImportError as e:\n    print(f"âœ— å¯¼å…¥æ¨¡å—å¤±è´¥: {e}")\n    print("è¯·ç¡®ä¿å·²å®‰è£…ä¾èµ–: pip install jqdatasdk pymongo")\n    import traceback\n    traceback.print_exc()\n    sys.exit(1)\nexcept Exception as e:\n    print(f"âœ— æµ‹è¯•å¤±è´¥: {e}")\n    import traceback\n    traceback.print_exc()\n    sys.exit(1)\n            ');return n.success?{success:!0,message:"èšå®½è®¤è¯æµ‹è¯•æˆåŠŸ",details:n.output}:{success:!1,message:`èšå®½è®¤è¯æµ‹è¯•å¤±è´¥: ${n.error}`,details:n.output}}catch(n){const e=n instanceof Error?n.message:String(n);return p.logger.error(`æµ‹è¯•èšå®½è®¤è¯å¤±è´¥: ${e}`,g),{success:!1,message:`æµ‹è¯•å¤±è´¥: ${e}`}}}async executePythonScript(n){return new Promise(e=>{const t=o.workspace.workspaceFolders?.[0],a=t?.uri.fsPath||"";if(!a)return void e({success:!1,output:"",error:"æœªæ‰¾åˆ°å·¥ä½œåŒºè·¯å¾„ï¼Œè¯·å…ˆæ‰“å¼€é¡¹ç›®æ–‡ä»¶å¤¹"});const r=d.join(a,".temp_data_update.py"),i=n.replace(/__WORKSPACE_PATH__/g,a.replace(/\\/g,"/"));try{l.writeFileSync(r,i,"utf-8")}catch(n){return void e({success:!1,output:"",error:`æ— æ³•åˆ›å»ºä¸´æ—¶è„šæœ¬æ–‡ä»¶: ${n instanceof Error?n.message:String(n)}`})}const s=this._pythonPath||"python3",p=c.spawn(s,[r],{cwd:a,env:{...process.env,PYTHONUNBUFFERED:"1",PYTHONIOENCODING:"utf-8"}});let g="",m="";p.stdout.on("data",n=>{g+=n.toString("utf-8")}),p.stderr.on("data",n=>{m+=n.toString("utf-8")}),p.on("close",n=>{try{l.existsSync(r)&&l.unlinkSync(r)}catch(n){}e({success:0===n,output:g+(m?"\n[STDERR]\n"+m:"")||"æ— è¾“å‡º",error:0!==n?m||`è¿›ç¨‹é€€å‡ºç : ${n}`:void 0})}),p.on("error",n=>{try{l.existsSync(r)&&l.unlinkSync(r)}catch(n){}let t=n.message;n.message.includes("ENOENT")&&(t=`Pythonè§£é‡Šå™¨æœªæ‰¾åˆ°: ${s}ã€‚è¯·ç¡®ä¿å·²å®‰è£…Pythonå¹¶é…ç½®æ­£ç¡®è·¯å¾„ã€‚`),e({success:!1,output:"",error:t})})})}}e.DataUpdateService=m},317:n=>{n.exports=require("child_process")},327:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.getMainlines=async function(n,e){c.logger.info("æ‰§è¡Œè·å–æŠ•èµ„ä¸»çº¿å‘½ä»¤",l);const t=await o.window.showQuickPick([{label:"ğŸ“… çŸ­æœŸ (1-5å¤©)",value:"short",description:"é€‚åˆçŸ­çº¿äº¤æ˜“"},{label:"ğŸ“† ä¸­æœŸ (1-4å‘¨)",value:"medium",description:"é€‚åˆæ³¢æ®µæ“ä½œ"},{label:"ğŸ“† é•¿æœŸ (1æœˆ+)",value:"long",description:"é€‚åˆä»·å€¼æŠ•èµ„"}],{placeHolder:"é€‰æ‹©æŠ•èµ„å‘¨æœŸ"});t&&await o.window.withProgress({location:o.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(a,r)=>{try{if(a.report({message:"æ­£åœ¨è·å–æŠ•èµ„ä¸»çº¿...",increment:0}),r.isCancellationRequested)return void c.logger.info("ç”¨æˆ·å–æ¶ˆæ“ä½œ",l);const i=await n.getMainlines({top_n:20,time_horizon:t.value});if(a.report({increment:60}),!i.ok||!i.data)return void o.window.showErrorMessage(`è·å–æŠ•èµ„ä¸»çº¿å¤±è´¥: ${i.error||"æœªçŸ¥é”™è¯¯"}`);const s=i.data;c.logger.info(`è·å–åˆ° ${s.length} æ¡æŠ•èµ„ä¸»çº¿`,l),a.report({message:"æ¸²æŸ“ç»“æœ...",increment:20}),function(n,e,t){const a=o.window.createWebviewPanel("trquantMainlines","ğŸ¯ æŠ•èµ„ä¸»çº¿",o.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0});a.webview.html=function(n,e){const t=n.length>0?n.map((n,e)=>function(n,e){const t=e<3?`rank-${e+1}`:"rank-default",a=Math.min(100*n.score,100);return`\n        <div class="mainline-card" onclick="selectMainline('${n.name}')">\n            <div class="mainline-header">\n                <div class="mainline-rank">\n                    <div class="rank-badge ${t}">${e+1}</div>\n                    <span class="mainline-name">${n.name}</span>\n                </div>\n                <div class="mainline-score">\n                    <div class="score-bar">\n                        <div class="score-fill" style="width: ${a}%"></div>\n                    </div>\n                    <span class="score-value">${n.score.toFixed(2)}</span>\n                </div>\n            </div>\n            <div class="mainline-industries">\n                ${n.industries.map(n=>`<span class="industry-tag">${n}</span>`).join("")}\n            </div>\n            <div class="mainline-logic">\n                ğŸ’¡ ${n.logic||"æš‚æ— è¯¦ç»†è¯´æ˜"}\n            </div>\n        </div>\n    `}(n,e)).join(""):'<div class="empty-state">æš‚æ— æŠ•èµ„ä¸»çº¿æ•°æ®</div>';return`<!DOCTYPE html>\n<html lang="zh">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>æŠ•èµ„ä¸»çº¿</title>\n    <style>\n        :root {\n            --bg-primary: #1a1a2e;\n            --bg-secondary: #252540;\n            --bg-tertiary: #2d2d4a;\n            --text-primary: #ffffff;\n            --text-secondary: #9ca3af;\n            --text-muted: #6b7280;\n            --primary: #667eea;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --border: #3d3d5c;\n            --gold: #fbbf24;\n            --silver: #94a3b8;\n            --bronze: #b45309;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n            line-height: 1.6;\n        }\n\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border);\n        }\n\n        .header-left {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n\n        .header-icon { font-size: 36px; }\n\n        .header-title {\n            font-size: 24px;\n            font-weight: 600;\n        }\n\n        .header-subtitle {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .time-badge {\n            background: var(--primary);\n            color: white;\n            padding: 6px 16px;\n            border-radius: 20px;\n            font-size: 13px;\n        }\n\n        .stats-row {\n            display: grid;\n            grid-template-columns: repeat(3, 1fr);\n            gap: 16px;\n            margin-bottom: 24px;\n        }\n\n        .stat-card {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            text-align: center;\n            border: 1px solid var(--border);\n        }\n\n        .stat-value {\n            font-size: 28px;\n            font-weight: 700;\n            color: var(--primary);\n        }\n\n        .stat-label {\n            color: var(--text-secondary);\n            font-size: 13px;\n            margin-top: 4px;\n        }\n\n        .mainlines-list {\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n        }\n\n        .mainline-card {\n            background: var(--bg-secondary);\n            border-radius: 16px;\n            padding: 20px;\n            border: 1px solid var(--border);\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n\n        .mainline-card:hover {\n            border-color: var(--primary);\n            transform: translateY(-2px);\n        }\n\n        .mainline-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 12px;\n        }\n\n        .mainline-rank {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n        }\n\n        .rank-badge {\n            width: 32px;\n            height: 32px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 700;\n            font-size: 14px;\n        }\n\n        .rank-1 { background: var(--gold); color: #1a1a2e; }\n        .rank-2 { background: var(--silver); color: #1a1a2e; }\n        .rank-3 { background: var(--bronze); color: white; }\n        .rank-default { background: var(--bg-tertiary); color: var(--text-secondary); }\n\n        .mainline-name {\n            font-size: 18px;\n            font-weight: 600;\n        }\n\n        .mainline-score {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .score-bar {\n            width: 100px;\n            height: 8px;\n            background: var(--bg-tertiary);\n            border-radius: 4px;\n            overflow: hidden;\n        }\n\n        .score-fill {\n            height: 100%;\n            background: linear-gradient(90deg, var(--primary), var(--success));\n            border-radius: 4px;\n        }\n\n        .score-value {\n            font-weight: 600;\n            color: var(--success);\n            min-width: 50px;\n            text-align: right;\n        }\n\n        .mainline-industries {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 8px;\n            margin-bottom: 12px;\n        }\n\n        .industry-tag {\n            background: var(--bg-tertiary);\n            color: var(--text-secondary);\n            padding: 4px 12px;\n            border-radius: 16px;\n            font-size: 12px;\n        }\n\n        .mainline-logic {\n            color: var(--text-secondary);\n            font-size: 14px;\n            line-height: 1.6;\n            padding-left: 16px;\n            border-left: 3px solid var(--primary);\n        }\n\n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 24px;\n            padding-top: 24px;\n            border-top: 1px solid var(--border);\n        }\n\n        .btn {\n            padding: 12px 24px;\n            border-radius: 10px;\n            border: none;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s;\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n        }\n\n        .btn-primary:hover { background: #5a6fd6; }\n\n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n        }\n\n        .btn-secondary:hover { background: #3d3d5c; }\n\n        .empty-state {\n            text-align: center;\n            padding: 60px 20px;\n            color: var(--text-muted);\n        }\n\n        .timestamp {\n            text-align: center;\n            color: var(--text-muted);\n            font-size: 12px;\n            margin-top: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="header-left">\n            <span class="header-icon">ğŸ¯</span>\n            <div>\n                <div class="header-title">æŠ•èµ„ä¸»çº¿ TOP ${n.length}</div>\n                <div class="header-subtitle">åŸºäºå¸‚åœºçƒ­åº¦ã€èµ„é‡‘æµå‘ã€è¡Œä¸šæ™¯æ°”åº¦ç»¼åˆè¯„ä¼°</div>\n            </div>\n        </div>\n        <span class="time-badge">${{short:"çŸ­æœŸ (1-5å¤©)",medium:"ä¸­æœŸ (1-4å‘¨)",long:"é•¿æœŸ (1æœˆ+)"}[e]||e}</span>\n    </div>\n\n    <div class="stats-row">\n        <div class="stat-card">\n            <div class="stat-value">${n.length}</div>\n            <div class="stat-label">ä¸»çº¿æ•°é‡</div>\n        </div>\n        <div class="stat-card">\n            <div class="stat-value">${n.length>0?n[0].score.toFixed(2):"-"}</div>\n            <div class="stat-label">æœ€é«˜è¯„åˆ†</div>\n        </div>\n        <div class="stat-card">\n            <div class="stat-value">${function(n){const e=new Set;return n.forEach(n=>n.industries.forEach(n=>e.add(n))),e.size}(n)}</div>\n            <div class="stat-label">æ¶‰åŠè¡Œä¸š</div>\n        </div>\n    </div>\n\n    <div class="mainlines-list">\n        ${t}\n    </div>\n\n    <div class="actions">\n        <button class="btn btn-primary" onclick="generateStrategy()">\n            ğŸš€ åŸºäºä¸»çº¿ç”Ÿæˆç­–ç•¥\n        </button>\n        <button class="btn btn-secondary" onclick="copyPrompt()">\n            ğŸ“‹ å¤åˆ¶ä¸ºAI Prompt\n        </button>\n    </div>\n\n    <div class="timestamp">\n        æ›´æ–°æ—¶é—´: ${(new Date).toLocaleString("zh-CN")}\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        function selectMainline(mainline) {\n            vscode.postMessage({ command: 'selectMainline', mainline });\n        }\n        \n        function generateStrategy() {\n            vscode.postMessage({ command: 'generateStrategy' });\n        }\n        \n        function copyPrompt() {\n            vscode.postMessage({ command: 'copyPrompt' });\n        }\n    <\/script>\n</body>\n</html>`}(e,t),a.webview.onDidReceiveMessage(async n=>{switch(n.command){case"selectMainline":a=n.mainline,o.window.showInformationMessage(`å·²é€‰æ‹©ä¸»çº¿: ${a}`,"æŸ¥çœ‹è¯¦æƒ…","ç­›é€‰è‚¡ç¥¨").then(n=>{"æŸ¥çœ‹è¯¦æƒ…"===n?c.logger.info(`æŸ¥çœ‹ä¸»çº¿è¯¦æƒ…: ${a}`,l):"ç­›é€‰è‚¡ç¥¨"===n&&c.logger.info(`åŸºäºä¸»çº¿ç­›é€‰è‚¡ç¥¨: ${a}`,l)});break;case"generateStrategy":o.commands.executeCommand("trquant.generateStrategy");break;case"copyPrompt":{const n=p(e,t);await o.env.clipboard.writeText(n),o.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿");break}}var a},void 0,n.subscriptions)}(e,s,t.value),a.report({increment:20}),async function(n){if(0!==n.length)switch(await o.window.showInformationMessage(`è·å–åˆ° ${n.length} æ¡æŠ•èµ„ä¸»çº¿`,"ç”Ÿæˆç­–ç•¥","æ¨èå› å­","å¤åˆ¶Prompt")){case"ç”Ÿæˆç­–ç•¥":o.commands.executeCommand("trquant.generateStrategy");break;case"æ¨èå› å­":o.commands.executeCommand("trquant.recommendFactors");break;case"å¤åˆ¶Prompt":{const e=p(n,"short");await o.env.clipboard.writeText(e),o.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿");break}}}(s)}catch(n){d.ErrorHandler.handle(n,l)}})};const o=s(t(398)),c=t(628),d=t(799),l="GetMainlines";function p(n,e){return`# Aè‚¡æŠ•èµ„ä¸»çº¿åˆ†æ\n\n## åˆ†æå‘¨æœŸ: ${{short:"çŸ­æœŸ (1-5å¤©)",medium:"ä¸­æœŸ (1-4å‘¨)",long:"é•¿æœŸ (1æœˆ+)"}[e]||e}\n\n## TOP ${n.length} æŠ•èµ„ä¸»çº¿\n\n${n.map((n,e)=>`\n### ${e+1}. ${n.name} (è¯„åˆ†: ${n.score.toFixed(2)})\n- **ç›¸å…³è¡Œä¸š**: ${n.industries.join(", ")}\n- **æŠ•èµ„é€»è¾‘**: ${n.logic||"æš‚æ— "}\n`).join("\n")}\n\n---\n\nè¯·åŸºäºä»¥ä¸ŠæŠ•èµ„ä¸»çº¿ï¼Œå¸®æˆ‘ï¼š\n1. åˆ†æå½“å‰æœ€å€¼å¾—å…³æ³¨çš„ä¸»çº¿åŠå…¶åŸå› \n2. æ¨èé€‚åˆè¿™äº›ä¸»çº¿çš„é‡åŒ–å› å­\n3. ç”Ÿæˆé’ˆå¯¹TOP3ä¸»çº¿çš„PTradeé‡åŒ–ç­–ç•¥ä»£ç \n\nè¦æ±‚ï¼š\n- ç­–ç•¥åº”è¯¥èšç„¦äºä¸»çº¿ç›¸å…³çš„è‚¡ç¥¨æ± \n- åŒ…å«å®Œæ•´çš„é£æ§é€»è¾‘\n- æ·»åŠ è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š\n`}},334:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.MCPRegistrar=void 0;const o=s(t(398)),c=s(t(928)),d=s(t(896)),l=s(t(857)),p=t(628),g=t(478),m="MCPRegistrar";e.MCPRegistrar=class{static async registerServer(n){p.logger.info("å¼€å§‹æ³¨å†ŒMCP Server...",m);try{const e=this.getMCPConfigPath();p.logger.info(`MCPé…ç½®è·¯å¾„: ${e}`,m);const t=this.loadMCPConfig(e),a=g.config.getPythonPath(n.extensionPath),r=c.join(n.extensionPath,"python","mcp_server.py");t.mcpServers.trquant={command:a,args:[r],env:{PYTHONIOENCODING:"utf-8",TRQUANT_ROOT:c.dirname(n.extensionPath)}},this.saveMCPConfig(e,t),p.logger.info("MCP Server æ³¨å†ŒæˆåŠŸ",m),o.window.showInformationMessage("TRQuant MCP Server å·²æ³¨å†Œã€‚é‡å¯Cursoråç”Ÿæ•ˆã€‚","æŸ¥çœ‹é…ç½®","äº†è§£æ›´å¤š").then(n=>{"æŸ¥çœ‹é…ç½®"===n?this.openMCPConfig(e):"äº†è§£æ›´å¤š"===n&&o.env.openExternal(o.Uri.parse("https://docs.cursor.com/context/model-context-protocol"))})}catch(n){throw p.logger.error(`MCPæ³¨å†Œå¤±è´¥: ${n instanceof Error?n.message:String(n)}`,m),n}}static getMCPConfigPath(){const n=l.homedir(),e=[c.join(n,".cursor","mcp.json"),c.join(n,"Library","Application Support","Cursor","mcp.json"),c.join(n,"AppData","Roaming","Cursor","mcp.json")];for(const n of e)if(d.existsSync(n))return n;switch(l.platform()){case"darwin":return e[1];case"win32":return e[2];default:return e[0]}}static loadMCPConfig(n){try{if(d.existsSync(n)){const e=d.readFileSync(n,"utf-8");return JSON.parse(e)}}catch(n){p.logger.warn(`è¯»å–MCPé…ç½®å¤±è´¥: ${n}`,m)}return{mcpServers:{}}}static saveMCPConfig(n,e){const t=c.dirname(n);d.existsSync(t)||d.mkdirSync(t,{recursive:!0});const a=JSON.stringify(e,null,2);d.writeFileSync(n,a,"utf-8"),p.logger.info(`MCPé…ç½®å·²ä¿å­˜: ${n}`,m)}static async openMCPConfig(n){const e=await o.workspace.openTextDocument(n);await o.window.showTextDocument(e)}static isRegistered(){try{const n=this.getMCPConfigPath();return"trquant"in this.loadMCPConfig(n).mcpServers}catch{return!1}}static async unregisterServer(){p.logger.info("ç§»é™¤MCP Serveræ³¨å†Œ...",m);try{const n=this.getMCPConfigPath(),e=this.loadMCPConfig(n);"trquant"in e.mcpServers&&(delete e.mcpServers.trquant,this.saveMCPConfig(n,e),p.logger.info("MCP Server å·²ç§»é™¤",m))}catch(n){p.logger.error(`ç§»é™¤MCPæ³¨å†Œå¤±è´¥: ${n instanceof Error?n.message:String(n)}`,m)}}}},360:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.WorkflowPanel=void 0,e.registerWorkflowPanel=function(n,e){if(console.log("[WorkflowPanel] ========== å¼€å§‹æ³¨å†Œå·¥ä½œæµé¢æ¿å‘½ä»¤ =========="),c.logger.info("å¼€å§‹æ³¨å†Œå·¥ä½œæµé¢æ¿",d),!n)throw console.error("[WorkflowPanel] âŒ context å‚æ•°ä¸ºç©º"),new Error("context å‚æ•°ä¸èƒ½ä¸ºç©º");if(!e)throw console.error("[WorkflowPanel] âŒ client å‚æ•°ä¸ºç©º"),new Error("client å‚æ•°ä¸èƒ½ä¸ºç©º");console.log("[WorkflowPanel] å‚æ•°éªŒè¯é€šè¿‡ï¼Œå¼€å§‹æ³¨å†Œå‘½ä»¤...");try{const t=o.commands.registerCommand("trquant.openWorkflowPanel",()=>{console.log("[WorkflowPanel] âœ… trquant.openWorkflowPanel å‘½ä»¤è¢«è§¦å‘"),c.logger.info("æ‰“å¼€å·¥ä½œæµé¢æ¿å‘½ä»¤è¢«è§¦å‘",d);try{p.createOrShow(n.extensionUri,e),console.log("[WorkflowPanel] âœ… å·¥ä½œæµé¢æ¿å·²åˆ›å»º"),c.logger.info("å·¥ä½œæµé¢æ¿å·²åˆ›å»º",d)}catch(n){const e=n instanceof Error?n.message:String(n);console.error("[WorkflowPanel] âŒ åˆ›å»ºå·¥ä½œæµé¢æ¿å¤±è´¥:",e),c.logger.error(`åˆ›å»ºå·¥ä½œæµé¢æ¿å¤±è´¥: ${e}`,d),o.window.showErrorMessage(`æ‰“å¼€å·¥ä½œæµé¢æ¿å¤±è´¥: ${e}`)}});console.log("[WorkflowPanel] å‘½ä»¤å·²æ³¨å†Œï¼Œdisposable:",t),n.subscriptions.push(t),console.log("[WorkflowPanel] å‘½ä»¤å·²æ·»åŠ åˆ°context.subscriptionsï¼Œå½“å‰è®¢é˜…æ•°:",n.subscriptions.length),console.log("[WorkflowPanel] å‘½ä»¤å·²æ³¨å†Œåˆ°context.subscriptions"),setTimeout(()=>{o.commands.getCommands().then(n=>{console.log("[WorkflowPanel] æ£€æŸ¥å‘½ä»¤åˆ—è¡¨ï¼Œæ€»æ•°:",n.length),n.includes("trquant.openWorkflowPanel")?(console.log("[WorkflowPanel] âœ… å‘½ä»¤æ³¨å†ŒéªŒè¯æˆåŠŸ: trquant.openWorkflowPanel"),c.logger.info("å·¥ä½œæµé¢æ¿å‘½ä»¤æ³¨å†ŒéªŒè¯æˆåŠŸ",d)):(console.error("[WorkflowPanel] âŒ å‘½ä»¤æ³¨å†ŒéªŒè¯å¤±è´¥: trquant.openWorkflowPanel ä¸åœ¨å‘½ä»¤åˆ—è¡¨ä¸­"),console.error("[WorkflowPanel] æœç´¢trquantç›¸å…³å‘½ä»¤:",n.filter(n=>n.startsWith("trquant."))),c.logger.error("å·¥ä½œæµé¢æ¿å‘½ä»¤æ³¨å†ŒéªŒè¯å¤±è´¥",d))},n=>{console.error("[WorkflowPanel] éªŒè¯å‘½ä»¤æ—¶å‡ºé”™:",n)})},1e3),c.logger.info("å·¥ä½œæµé¢æ¿å·²æ³¨å†Œï¼ˆå¤ç”¨æ¡Œé¢ç³»ç»Ÿä»£ç ï¼‰",d),console.log("[WorkflowPanel] ========== å·¥ä½œæµé¢æ¿å‘½ä»¤æ³¨å†Œå®Œæˆ ==========")}catch(n){const e=n instanceof Error?n.message:String(n);throw console.error("[WorkflowPanel] âŒ æ³¨å†Œå‘½ä»¤æ—¶å‘ç”Ÿå¼‚å¸¸:",e),console.error("[WorkflowPanel] é”™è¯¯å †æ ˆ:",n instanceof Error?n.stack:"æ— å †æ ˆä¿¡æ¯"),c.logger.error(`æ³¨å†Œå·¥ä½œæµé¢æ¿å‘½ä»¤æ—¶å‘ç”Ÿå¼‚å¸¸: ${e}`,d),n}};const o=s(t(398)),c=t(628),d="WorkflowPanel",l=[{id:"data_source",name:"ä¿¡æ¯è·å–",icon:"ğŸ“¡",color:"#58a6ff"},{id:"market_trend",name:"å¸‚åœºè¶‹åŠ¿",icon:"ğŸ“ˆ",color:"#667eea"},{id:"mainline",name:"æŠ•èµ„ä¸»çº¿",icon:"ğŸ”¥",color:"#F59E0B"},{id:"candidate_pool",name:"å€™é€‰æ± æ„å»º",icon:"ğŸ“¦",color:"#a371f7"},{id:"factor",name:"å› å­æ„å»º",icon:"ğŸ§®",color:"#3fb950"},{id:"strategy",name:"ç­–ç•¥ç”Ÿæˆ",icon:"ğŸ’»",color:"#d29922"}];class p{static currentPanel;_panel;_extensionUri;_client;_disposables=[];_currentStep=null;_isRunning=!1;constructor(n,e,t){this._panel=n,this._extensionUri=e,this._client=t,this._panel.webview.html=this._getHtmlContent(),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.onDidReceiveMessage(n=>this._handleMessage(n),null,this._disposables)}static createOrShow(n,e){console.log("[WorkflowPanel] createOrShow è¢«è°ƒç”¨"),c.logger.info("åˆ›å»ºå·¥ä½œæµé¢æ¿",d);const t=o.ViewColumn.One;if(p.currentPanel)return console.log("[WorkflowPanel] é¢æ¿å·²å­˜åœ¨ï¼Œæ˜¾ç¤ºç°æœ‰é¢æ¿"),p.currentPanel._panel.reveal(t),p.currentPanel;console.log("[WorkflowPanel] åˆ›å»ºæ–°çš„å·¥ä½œæµé¢æ¿");const a=o.window.createWebviewPanel("trquantWorkflow","ğŸ”„ é›†æˆå·¥ä½œæµç¨‹",t,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[n]});return p.currentPanel=new p(a,n,e),console.log("[WorkflowPanel] å·¥ä½œæµé¢æ¿åˆ›å»ºæˆåŠŸ"),c.logger.info("å·¥ä½œæµé¢æ¿åˆ›å»ºæˆåŠŸ",d),p.currentPanel}dispose(){for(p.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const n=this._disposables.pop();n&&n.dispose()}}async _handleMessage(n){switch(c.logger.info(`[WorkflowPanel] æ”¶åˆ°æ¶ˆæ¯: ${n.command}`,d),n.command){case"runStep":await this._runStep(n.stepId||"");break;case"runAll":await this._runAll();break;case"cancel":this._isRunning=!1,this._postMessage({command:"cancelled"})}}async _runStep(n){if(this._isRunning)o.window.showWarningMessage("å·¥ä½œæµæ­£åœ¨æ‰§è¡Œä¸­ï¼Œè¯·ç­‰å¾…å®Œæˆ");else{this._isRunning=!0,this._currentStep=n,this._postMessage({command:"stepStarted",stepId:n,stepName:l.find(e=>e.id===n)?.name||n});try{const e=await this._client.callBridge("run_workflow_step",{step_id:n}),t=e;e.ok?this._postMessage({command:"stepFinished",stepId:n,success:!0,summary:t.summary||"æ‰§è¡ŒæˆåŠŸ",details:t.data||{},stepName:t.step_name||l.find(e=>e.id===n)?.name||n}):this._postMessage({command:"stepFinished",stepId:n,success:!1,summary:"object"==typeof t&&null!==t&&"error"in t&&"string"==typeof t.error?t.error:"æ‰§è¡Œå¤±è´¥",details:{},stepName:l.find(e=>e.id===n)?.name||n})}catch(e){const t=e instanceof Error?e.message:String(e);c.logger.error(`æ­¥éª¤ ${n} æ‰§è¡Œå¤±è´¥: ${t}`,d),this._postMessage({command:"stepFinished",stepId:n,success:!1,summary:`æ‰§è¡Œå¤±è´¥: ${t}`,details:{},stepName:l.find(e=>e.id===n)?.name||n})}finally{this._isRunning=!1,this._currentStep=null}}}async _runAll(){this._isRunning?o.window.showWarningMessage("å·¥ä½œæµæ­£åœ¨æ‰§è¡Œä¸­ï¼Œè¯·ç­‰å¾…å®Œæˆ"):(this._isRunning=!0,await o.window.withProgress({location:o.ProgressLocation.Notification,title:"ğŸ”„ æ‰§è¡Œå®Œæ•´å·¥ä½œæµ",cancellable:!0},async(n,e)=>{const t=[];let a=!1;this._postMessage({command:"allStarted"});try{const e=await this._client.callBridge("run_full_workflow",{}),r=e;if(!e.ok||!r.data)throw new Error(e.error||"æ‰§è¡Œå¤±è´¥");{const e=r.data,i=e.steps||[];for(const e of i){const r=this._getStepIdFromName(e.step_name);this._postMessage({command:"stepFinished",stepId:r,success:e.success,summary:e.summary||"",details:e.details||{},stepName:e.step_name}),t.push({step:e.step_name,success:e.success,error:e.error}),e.success||(a=!0),n.report({message:`${e.step_name}: ${e.success?"âœ…":"âŒ"}`,increment:100/i.length})}this._postMessage({command:"allFinished",success:!a,results:t,strategyFile:e.strategy_file,totalTime:e.total_time}),a?o.window.showWarningMessage("âš ï¸ å·¥ä½œæµå®Œæˆï¼Œéƒ¨åˆ†æ­¥éª¤æœ‰é”™è¯¯"):o.window.showInformationMessage("âœ… å®Œæ•´å·¥ä½œæµæ‰§è¡Œå®Œæˆï¼")}}catch(n){const e=n instanceof Error?n.message:String(n);c.logger.error(`å®Œæ•´å·¥ä½œæµæ‰§è¡Œå¤±è´¥: ${e}`,d),this._postMessage({command:"allFinished",success:!1,results:[],error:e}),o.window.showErrorMessage(`å·¥ä½œæµæ‰§è¡Œå¤±è´¥: ${e}`)}finally{this._isRunning=!1}}))}_getStepIdFromName(n){return{æ•°æ®æº:"data_source",æ•°æ®æºæ£€æµ‹:"data_source",å¸‚åœºè¶‹åŠ¿:"market_trend",æŠ•èµ„ä¸»çº¿:"mainline",å€™é€‰æ± :"candidate_pool",å€™é€‰æ± æ„å»º:"candidate_pool",å› å­æ¨è:"factor",ç­–ç•¥ç”Ÿæˆ:"strategy"}[n]||n.toLowerCase().replace(/\s+/g,"_")}_postMessage(n){this._panel.webview.postMessage(n)}_getHtmlContent(){return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>é›†æˆå·¥ä½œæµç¨‹</title>\n    <style>\n        :root {\n            --bg-primary: #0d1117;\n            --bg-secondary: #161b22;\n            --bg-tertiary: #21262d;\n            --border-color: #30363d;\n            --text-primary: #c9d1d9;\n            --text-secondary: #8b949e;\n            --accent-blue: #58a6ff;\n            --accent-green: #3fb950;\n            --accent-yellow: #d29922;\n            --accent-red: #f85149;\n            --accent-purple: #a371f7;\n        }\n        \n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            height: 100vh;\n            overflow: hidden;\n        }\n        \n        .container {\n            display: flex;\n            height: 100vh;\n            gap: 0;\n        }\n        \n        /* å·¦ä¾§æ­¥éª¤åŒºåŸŸ */\n        .steps-panel {\n            width: 280px;\n            background: var(--bg-secondary);\n            border-right: 1px solid var(--border-color);\n            padding: 16px;\n            overflow-y: auto;\n        }\n        \n        .header {\n            margin-bottom: 20px;\n        }\n        \n        .header h1 {\n            font-size: 18px;\n            font-weight: 600;\n            margin-bottom: 12px;\n        }\n        \n        .run-all-btn {\n            width: 100%;\n            padding: 10px;\n            background: linear-gradient(135deg, #6366f1, #8b5cf6);\n            color: white;\n            border: none;\n            border-radius: 8px;\n            cursor: pointer;\n            font-weight: 600;\n            font-size: 14px;\n            transition: all 0.2s;\n        }\n        \n        .run-all-btn:hover {\n            transform: translateY(-1px);\n            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);\n        }\n        \n        .run-all-btn:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n        }\n        \n        .steps-list {\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n        }\n        \n        .step-card {\n            background: var(--bg-tertiary);\n            border: 2px solid var(--border-color);\n            border-left: 4px solid var(--step-color);\n            border-radius: 10px;\n            padding: 14px;\n            cursor: pointer;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n        }\n        \n        .step-card:hover {\n            background: var(--bg-primary);\n            border-color: var(--accent-blue);\n        }\n        \n        .step-card.running {\n            border-color: var(--accent-yellow);\n            animation: pulse 1.5s infinite;\n        }\n        \n        .step-card.completed {\n            border-color: var(--accent-green);\n        }\n        \n        .step-card.failed {\n            border-color: var(--accent-red);\n        }\n        \n        @keyframes pulse {\n            0%, 100% { box-shadow: 0 0 0 0 rgba(217, 153, 34, 0.4); }\n            50% { box-shadow: 0 0 0 8px rgba(217, 153, 34, 0); }\n        }\n        \n        .step-icon {\n            font-size: 26px;\n            width: 36px;\n            text-align: center;\n        }\n        \n        .step-name {\n            flex: 1;\n            font-size: 15px;\n            font-weight: 600;\n        }\n        \n        .step-status {\n            font-size: 16px;\n        }\n        \n        /* å³ä¾§ç»“æœåŒºåŸŸ */\n        .result-panel {\n            flex: 1;\n            background: var(--bg-primary);\n            padding: 20px;\n            overflow-y: auto;\n        }\n        \n        .result-header {\n            margin-bottom: 20px;\n        }\n        \n        .result-title {\n            font-size: 20px;\n            font-weight: 600;\n            margin-bottom: 8px;\n        }\n        \n        .result-summary {\n            background: var(--bg-secondary);\n            padding: 16px;\n            border-radius: 8px;\n            border: 1px solid var(--border-color);\n            margin-bottom: 20px;\n        }\n        \n        .result-details {\n            background: var(--bg-secondary);\n            padding: 16px;\n            border-radius: 8px;\n            border: 1px solid var(--border-color);\n            max-height: 400px;\n            overflow-y: auto;\n        }\n        \n        .result-details table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n        \n        .result-details th,\n        .result-details td {\n            padding: 8px;\n            text-align: left;\n            border-bottom: 1px solid var(--border-color);\n        }\n        \n        .result-details th {\n            background: var(--bg-tertiary);\n            font-weight: 600;\n        }\n        \n        .empty-state {\n            text-align: center;\n            padding: 60px 20px;\n            color: var(--text-secondary);\n        }\n        \n        .empty-icon {\n            font-size: 48px;\n            margin-bottom: 12px;\n            opacity: 0.5;\n        }\n        \n        .progress-bar {\n            height: 6px;\n            background: var(--bg-tertiary);\n            border-radius: 3px;\n            overflow: hidden;\n            margin: 12px 0;\n        }\n        \n        .progress-fill {\n            height: 100%;\n            background: linear-gradient(90deg, #6366f1, #8b5cf6);\n            width: 0%;\n            transition: width 0.3s;\n        }\n    </style>\n</head>\n<body>\n    <div class="container">\n        \x3c!-- å·¦ä¾§æ­¥éª¤ --\x3e\n        <div class="steps-panel">\n            <div class="header">\n                <h1>ğŸ”„ é›†æˆå·¥ä½œæµç¨‹</h1>\n                <button class="run-all-btn" id="runAllBtn" onclick="runAll()">\n                    â–¶ï¸ ä¸€é”®æ‰§è¡Œå…¨éƒ¨\n                </button>\n            </div>\n            <div class="steps-list" id="stepsList">\n                ${l.map(n=>`\n                    <div class="step-card" id="step-${n.id}" \n                         style="--step-color: ${n.color}"\n                         onclick="runStep('${n.id}')">\n                        <div class="step-icon">${n.icon}</div>\n                        <div class="step-name">${n.name}</div>\n                        <div class="step-status" id="status-${n.id}">â–¶ï¸</div>\n                    </div>\n                `).join("")}\n            </div>\n        </div>\n        \n        \x3c!-- å³ä¾§ç»“æœ --\x3e\n        <div class="result-panel">\n            <div class="result-header">\n                <div class="result-title" id="resultTitle">ğŸ“‹ æ‰§è¡Œç»“æœ</div>\n            </div>\n            <div class="result-summary" id="resultSummary">\n                ç‚¹å‡»å·¦ä¾§æ­¥éª¤å¼€å§‹æ‰§è¡Œ...\n            </div>\n            <div class="result-details" id="resultDetails"></div>\n        </div>\n    </div>\n    \n    <script>\n        const vscode = acquireVsCodeApi();\n        let isRunning = false;\n        \n        function runStep(stepId) {\n            if (isRunning) {\n                return;\n            }\n            vscode.postMessage({ command: 'runStep', stepId });\n        }\n        \n        function runAll() {\n            if (isRunning) {\n                return;\n            }\n            vscode.postMessage({ command: 'runAll' });\n        }\n        \n        function setStepStatus(stepId, status) {\n            const card = document.getElementById('step-' + stepId);\n            const statusEl = document.getElementById('status-' + stepId);\n            \n            card.classList.remove('running', 'completed', 'failed');\n            \n            switch(status) {\n                case 'running':\n                    card.classList.add('running');\n                    statusEl.textContent = 'â³';\n                    break;\n                case 'completed':\n                    card.classList.add('completed');\n                    statusEl.textContent = 'âœ…';\n                    break;\n                case 'failed':\n                    card.classList.add('failed');\n                    statusEl.textContent = 'âŒ';\n                    break;\n                default:\n                    statusEl.textContent = 'â–¶ï¸';\n            }\n        }\n        \n        function formatDetails(details) {\n            if (!details || Object.keys(details).length === 0) {\n                return '<div style="color:var(--text-secondary);">æ— è¯¦ç»†æ•°æ®</div>';\n            }\n            \n            let html = '';\n            \n            // æŠ•èµ„ä¸»çº¿\n            if (details.top_mainlines) {\n                const mainlines = details.top_mainlines;\n                html += '<div style="margin-bottom:12px;"><strong>ğŸ”¥ æŠ•èµ„ä¸»çº¿ TOP' + mainlines.length + '</strong></div>';\n                html += '<table><tr><th>æ’å</th><th>åç§°</th><th>è¯„åˆ†</th></tr>';\n                mainlines.slice(0, 10).forEach(ml => {\n                    html += '<tr><td>#' + (ml.rank || '-') + '</td><td>' + (ml.name || '-') + '</td><td>' + ((ml.composite_score || ml.score || 0).toFixed?.(1) || '-') + '</td></tr>';\n                });\n                html += '</table>';\n            }\n            \n            // å€™é€‰æ± è‚¡ç¥¨\n            else if (details.stocks) {\n                const stocks = details.stocks;\n                html += '<div style="margin-bottom:12px;"><strong>ğŸ“¦ å€™é€‰æ± è‚¡ç¥¨ (' + stocks.length + 'åª)</strong></div>';\n                html += '<table><tr><th>ä»£ç </th><th>åç§°</th><th>æ¥æº</th><th>è¯„åˆ†</th></tr>';\n                stocks.slice(0, 15).forEach(s => {\n                    html += '<tr><td>' + (s.code || '-') + '</td><td>' + (s.name || '-') + '</td><td>' + (s.source || '-') + '</td><td>' + ((s.score || 0).toFixed?.(1) || '-') + '</td></tr>';\n                });\n                html += '</table>';\n            }\n            \n            // æ¨èå› å­\n            else if (details.recommended_factors) {\n                const factors = details.recommended_factors;\n                html += '<div style="margin-bottom:12px;"><strong>ğŸ§® æ¨èå› å­</strong></div>';\n                html += '<ul style="margin:0;padding-left:20px;">';\n                factors.forEach(f => {\n                    const weight = ((f.weight || 0) * 100).toFixed(0);\n                    html += '<li style="margin:6px 0;"><strong>' + (f.name || '-') + '</strong> (æƒé‡' + weight + '%) - ' + (f.reason || '') + '</li>';\n                });\n                html += '</ul>';\n            }\n            \n            // æ•°æ®æºæ£€æµ‹\n            else if (details.jqdata !== undefined || details.akshare !== undefined) {\n                html += '<div style="margin-bottom:12px;"><strong>ğŸ“¡ æ•°æ®æºçŠ¶æ€</strong></div>';\n                html += '<table><tr><th>æ•°æ®æº</th><th>çŠ¶æ€</th></tr>';\n                if (details.jqdata !== undefined) {\n                    html += '<tr><td>JQData</td><td style="color:' + (details.jqdata ? '#3fb950' : '#f85149') + ';">' + (details.jqdata ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨') + '</td></tr>';\n                }\n                if (details.akshare !== undefined) {\n                    html += '<tr><td>AKShare</td><td style="color:' + (details.akshare ? '#3fb950' : '#f85149') + ';">' + (details.akshare ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨') + '</td></tr>';\n                }\n                html += '</table>';\n            }\n            \n            // é»˜è®¤JSONæ˜¾ç¤º\n            else {\n                html += '<pre style="font-size:11px;overflow-x:auto;">' + JSON.stringify(details, null, 2) + '</pre>';\n            }\n            \n            return html;\n        }\n        \n        window.addEventListener('message', event => {\n            const message = event.data;\n            \n            switch (message.command) {\n                case 'stepStarted':\n                    isRunning = true;\n                    document.getElementById('runAllBtn').disabled = true;\n                    setStepStatus(message.stepId, 'running');\n                    document.getElementById('resultTitle').textContent = 'ğŸ“‹ ' + message.stepName + ' - æ‰§è¡Œä¸­';\n                    document.getElementById('resultSummary').textContent = 'æ­£åœ¨æ‰§è¡Œ ' + message.stepName + '...';\n                    document.getElementById('resultDetails').innerHTML = '';\n                    break;\n                    \n                case 'stepFinished':\n                    isRunning = false;\n                    document.getElementById('runAllBtn').disabled = false;\n                    setStepStatus(message.stepId, message.success ? 'completed' : 'failed');\n                    document.getElementById('resultTitle').textContent = 'ğŸ“‹ ' + message.stepName + ' - ' + (message.success ? 'âœ… å®Œæˆ' : 'âŒ å¤±è´¥');\n                    document.getElementById('resultSummary').textContent = message.summary || (message.success ? 'æ‰§è¡ŒæˆåŠŸ' : 'æ‰§è¡Œå¤±è´¥');\n                    document.getElementById('resultDetails').innerHTML = formatDetails(message.details);\n                    break;\n                    \n                case 'allStarted':\n                    isRunning = true;\n                    document.getElementById('runAllBtn').disabled = true;\n                    document.getElementById('resultTitle').textContent = 'ğŸ”„ æ‰§è¡Œå®Œæ•´å·¥ä½œæµ';\n                    document.getElementById('resultSummary').textContent = 'æ­£åœ¨æ‰§è¡Œæ‰€æœ‰æ­¥éª¤...';\n                    document.getElementById('resultDetails').innerHTML = '';\n                    // é‡ç½®æ‰€æœ‰æ­¥éª¤çŠ¶æ€\n                    ${l.map(n=>`setStepStatus('${n.id}', 'default');`).join("")}\n                    break;\n                    \n                case 'allFinished':\n                    isRunning = false;\n                    document.getElementById('runAllBtn').disabled = false;\n                    document.getElementById('resultTitle').textContent = message.success ? 'âœ… å·¥ä½œæµæ‰§è¡Œå®Œæˆ' : 'âš ï¸ å·¥ä½œæµå®Œæˆï¼ˆéƒ¨åˆ†å¤±è´¥ï¼‰';\n                    document.getElementById('resultSummary').textContent = 'å…±æ‰§è¡Œ ' + (message.results?.length || 0) + ' ä¸ªæ­¥éª¤';\n                    \n                    // æ˜¾ç¤ºæ±‡æ€»\n                    let summaryHtml = '<div style="margin-top:16px;">';\n                    summaryHtml += '<h4 style="margin-bottom:8px;">æ‰§è¡Œç»“æœæ±‡æ€»</h4>';\n                    if (message.results) {\n                        message.results.forEach(r => {\n                            summaryHtml += '<div style="display:flex;align-items:center;gap:8px;margin:4px 0;">';\n                            summaryHtml += '<span>' + (r.success ? 'âœ…' : 'âŒ') + '</span>';\n                            summaryHtml += '<span>' + r.step + '</span>';\n                            if (r.error) {\n                                summaryHtml += '<span style="color:#f85149;font-size:11px;">(' + r.error + ')</span>';\n                            }\n                            summaryHtml += '</div>';\n                        });\n                    }\n                    summaryHtml += '</div>';\n                    document.getElementById('resultDetails').innerHTML = summaryHtml;\n                    break;\n                    \n                case 'cancelled':\n                    isRunning = false;\n                    document.getElementById('runAllBtn').disabled = false;\n                    break;\n            }\n        });\n    <\/script>\n</body>\n</html>`}}e.WorkflowPanel=p},381:(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.platformAdapter=e.PlatformAdapter=void 0;const t=[{source:{platform:"joinquant",api:"get_price",signature:"get_price(security, start_date, end_date, frequency, fields, skip_paused, fq, count, panel, fill_paused)"},target:{platform:"ptrade",api:"get_history",signature:"get_history(count, frequency, field, security_list, skip_paused, fq, bar_count)"},paramMapping:{security:"security_list",count:"count",frequency:n=>"1d"===n?"daily":n,fields:"field",skip_paused:"skip_paused",fq:"fq"},notes:["PTradeçš„get_historyè¿”å›æ ¼å¼ä¸JoinQuantä¸åŒ","éœ€è¦å¤„ç†è¿”å›æ•°æ®çš„æ ¼å¼è½¬æ¢","PTradeä¸æ”¯æŒstart_date/end_dateå‚æ•°ï¼Œéœ€è¦ç”¨countæ›¿ä»£"],examples:{before:"df = get_price('000001.XSHE', count=20, end_date='2024-01-01', frequency='daily', fields=['close', 'volume'])",after:"df = get_history(count=20, frequency='daily', field=['close', 'volume'], security_list=['000001.XSHE'])"}},{source:{platform:"joinquant",api:"get_current_data",signature:"get_current_data(security)"},target:{platform:"ptrade",api:"get_snapshot",signature:"get_snapshot(stock_code)"},paramMapping:{security:"stock_code"},notes:["è¿”å›æ•°æ®ç»“æ„ä¸åŒï¼Œéœ€è¦é€‚é…å­—æ®µå"],examples:{before:"current = get_current_data('000001.XSHE')",after:"current = get_snapshot('000001.XSHE')"}},{source:{platform:"joinquant",api:"history",signature:"history(count, unit, field, security_list, df, skip_paused, fq)"},target:{platform:"ptrade",api:"get_history",signature:"get_history(count, frequency, field, security_list, skip_paused, fq, bar_count)"},paramMapping:{count:"count",unit:n=>"1d"===String(n)?"daily":"1m"===String(n)?"minute":String(n),field:"field",security_list:"security_list",skip_paused:"skip_paused",fq:"fq"},notes:["unitå‚æ•°éœ€è¦è½¬æ¢ä¸ºfrequency"],examples:{before:"df = history(20, '1d', 'close', ['000001.XSHE'])",after:"df = get_history(count=20, frequency='daily', field='close', security_list=['000001.XSHE'])"}},{source:{platform:"joinquant",api:"get_index_stocks",signature:"get_index_stocks(index_symbol, date)"},target:{platform:"ptrade",api:"get_index_stocks",signature:"get_index_stocks(index_code)"},paramMapping:{index_symbol:n=>String(n).replace(".XSHG",".SH").replace(".XSHE",".SZ")},notes:["è‚¡ç¥¨ä»£ç åç¼€éœ€è¦è½¬æ¢: .XSHGâ†’.SH, .XSHEâ†’.SZ"],examples:{before:"stocks = get_index_stocks('000300.XSHG')",after:"stocks = get_index_stocks('000300.SH')"}},{source:{platform:"joinquant",api:"order_target_value",signature:"order_target_value(security, value)"},target:{platform:"ptrade",api:"order_target_percent",signature:"order_target_percent(stock_code, percent)"},paramMapping:{security:"stock_code",value:n=>`${String(n)} / context.portfolio.total_value`},notes:["PTradeä½¿ç”¨ç™¾åˆ†æ¯”è€Œéé‡‘é¢","éœ€è¦è®¡ç®—: percent = value / portfolio.total_value"],examples:{before:"order_target_value('000001.XSHE', 100000)",after:"order_target_percent('000001.XSHE', 100000 / context.portfolio.total_value)"}},{source:{platform:"joinquant",api:"order",signature:"order(security, amount, style)"},target:{platform:"ptrade",api:"order_lots",signature:"order_lots(stock_code, lots, limit_price)"},paramMapping:{security:"stock_code",amount:n=>`${n} // 100`},notes:["PTradeä½¿ç”¨æ‰‹æ•°(100è‚¡=1æ‰‹)è€Œéè‚¡æ•°"],examples:{before:"order('000001.XSHE', 1000)",after:"order_lots('000001.XSHE', 10)"}},{source:{platform:"joinquant",api:"order_target",signature:"order_target(security, amount)"},target:{platform:"ptrade",api:"order_target_volume",signature:"order_target_volume(stock_code, volume)"},paramMapping:{security:"stock_code",amount:"volume"},notes:["å‚æ•°åä¸åŒä½†é€»è¾‘ç›¸åŒ"],examples:{before:"order_target('000001.XSHE', 1000)",after:"order_target_volume('000001.XSHE', 1000)"}},{source:{platform:"joinquant",api:"set_benchmark",signature:"set_benchmark(security)"},target:{platform:"ptrade",api:"",signature:""},paramMapping:{},notes:["PTradeä¸éœ€è¦è®¾ç½®åŸºå‡†ï¼Œæ­¤è¡Œå¯åˆ é™¤æˆ–æ³¨é‡Š"],examples:{before:"set_benchmark('000300.XSHG')",after:"# set_benchmark('000300.XSHG')  # PTradeä¸éœ€è¦æ­¤è®¾ç½®"}},{source:{platform:"joinquant",api:"set_option",signature:"set_option(option_name, value)"},target:{platform:"ptrade",api:"",signature:""},paramMapping:{},notes:["PTradeé…ç½®æ–¹å¼ä¸åŒï¼Œå¤§éƒ¨åˆ†é€‰é¡¹åœ¨ç­–ç•¥é…ç½®æ–‡ä»¶ä¸­è®¾ç½®"],examples:{before:"set_option('use_real_price', True)",after:"# PTradeåœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®use_real_price"}},{source:{platform:"joinquant",api:"set_slippage",signature:"set_slippage(slippage)"},target:{platform:"ptrade",api:"",signature:""},paramMapping:{},notes:["PTradeæ»‘ç‚¹åœ¨äº¤æ˜“é…ç½®ä¸­è®¾ç½®"],examples:{before:"set_slippage(PriceRelatedSlippage(0.002))",after:"# PTradeåœ¨äº¤æ˜“é…ç½®ä¸­è®¾ç½®æ»‘ç‚¹"}},{source:{platform:"joinquant",api:"set_order_cost",signature:"set_order_cost(cost, type)"},target:{platform:"ptrade",api:"",signature:""},paramMapping:{},notes:["PTradeè´¹ç”¨åœ¨è´¦æˆ·é…ç½®ä¸­è®¾ç½®"],examples:{before:"set_order_cost(OrderCost(open_tax=0, close_tax=0.001, open_commission=0.0003, close_commission=0.0003), type='stock')",after:"# PTradeåœ¨è´¦æˆ·é…ç½®ä¸­è®¾ç½®äº¤æ˜“è´¹ç”¨"}},{source:{platform:"joinquant",api:"log.info",signature:"log.info(msg)"},target:{platform:"ptrade",api:"print",signature:"print(msg)"},paramMapping:{msg:"msg"},notes:["PTradeä½¿ç”¨printè¾“å‡ºæ—¥å¿—"],examples:{before:"log.info('ç­–ç•¥å¼€å§‹è¿è¡Œ')",after:"print('[INFO] ç­–ç•¥å¼€å§‹è¿è¡Œ')"}},{source:{platform:"joinquant",api:"log.warn",signature:"log.warn(msg)"},target:{platform:"ptrade",api:"print",signature:"print(msg)"},paramMapping:{msg:"msg"},notes:["å»ºè®®æ·»åŠ [WARN]å‰ç¼€"],examples:{before:"log.warn('é£é™©æç¤º')",after:"print('[WARN] é£é™©æç¤º')"}},{source:{platform:"joinquant",api:"log.error",signature:"log.error(msg)"},target:{platform:"ptrade",api:"print",signature:"print(msg)"},paramMapping:{msg:"msg"},notes:["å»ºè®®æ·»åŠ [ERROR]å‰ç¼€"],examples:{before:"log.error('æ‰§è¡Œå¤±è´¥')",after:"print('[ERROR] æ‰§è¡Œå¤±è´¥')"}},{source:{platform:"joinquant",api:"run_daily",signature:"run_daily(func, time)"},target:{platform:"ptrade",api:"",signature:""},paramMapping:{},notes:["PTradeä¸æ”¯æŒrun_daily","éœ€è¦åœ¨on_barä¸­æ ¹æ®æ—¶é—´åˆ¤æ–­æ‰§è¡Œ","ç¤ºä¾‹: if context.current_dt.hour == 9 and context.current_dt.minute == 30:"],examples:{before:"run_daily(my_func, '09:30')",after:"# åœ¨on_barä¸­æ·»åŠ æ—¶é—´åˆ¤æ–­:\n# if context.current_dt.strftime('%H:%M') == '09:30':\n#     my_func(context)"}}];class a{mappings=t;convert(n,e,t){const a=[],r=n,i=e.compatibility.sourcePlatform;return i===t?(a.push("æºå¹³å°ä¸ç›®æ ‡å¹³å°ç›¸åŒï¼Œæ— éœ€è½¬æ¢"),{success:!0,targetPlatform:t,originalCode:n,convertedCode:r,changes:[],warnings:a,errors:[],stats:{totalChanges:0,apiChanges:0,structureChanges:0,addedLines:0,removedLines:0}}):"joinquant"===i&&"ptrade"===t?this.convertJoinQuantToPTrade(n,e):"ptrade"===i&&"joinquant"===t?this.convertPTradeToJoinQuant(n,e):{success:!1,targetPlatform:t,originalCode:n,convertedCode:n,changes:[],warnings:[],errors:[`æš‚ä¸æ”¯æŒ ${i} â†’ ${t} çš„è½¬æ¢`],stats:{totalChanges:0,apiChanges:0,structureChanges:0,addedLines:0,removedLines:0}}}convertJoinQuantToPTrade(n,e){const t=[],a=[],r=[];let i=n;const s=n.split("\n");for(const n of e.dependencies.apis){const e=this.findMapping(n.name,"joinquant","ptrade");if(e){if(""===e.target.api){const a=s[n.line-1],r=`# ${a.trim()}  # PTradeä¸éœ€è¦æ­¤è®¾ç½®`;i=this.replaceLine(i,n.line,r),t.push({type:"api_replace",line:n.line,original:a.trim(),converted:r,reason:e.notes?.[0]||"PTradeä¸æ”¯æŒæ­¤API"})}else{const a=new RegExp(`\\b${n.name}\\s*\\(`,"g"),r=`${e.target.api}(`;i=i.replace(a,r),t.push({type:"api_replace",line:n.line,original:n.name,converted:e.target.api,reason:`APIè½¬æ¢: ${n.name} â†’ ${e.target.api}`})}e.notes&&a.push(...e.notes)}else r.push(`ç¬¬${n.line}è¡Œ: API '${n.name}' æ— æ³•è‡ªåŠ¨è½¬æ¢`)}i=i.replace(/\.XSHG/g,".SH"),i=i.replace(/\.XSHE/g,".SZ"),t.push({type:"param_change",line:0,original:".XSHG/.XSHE",converted:".SH/.SZ",reason:"è‚¡ç¥¨ä»£ç åç¼€è½¬æ¢"}),i=i.replace(/log\.info\s*\(\s*f?(['"])/g,"print('[INFO] ' + $1"),i=i.replace(/log\.info\s*\(/g,"print('[INFO]', "),i=i.replace(/log\.warn\s*\(\s*f?(['"])/g,"print('[WARN] ' + $1"),i=i.replace(/log\.warn\s*\(/g,"print('[WARN]', "),i=i.replace(/log\.error\s*\(\s*f?(['"])/g,"print('[ERROR] ' + $1"),i=i.replace(/log\.error\s*\(/g,"print('[ERROR]', "),i.includes("def on_bar")||(a.push("éœ€è¦æ·»åŠ  on_bar() å…¥å£å‡½æ•°"),i+='\n\n# ============================================================\n# PTradeå…¥å£å‡½æ•° (è‡ªåŠ¨ç”Ÿæˆ)\n# ============================================================\n\ndef on_bar(context, data):\n    """\n    PTradeä¸»å…¥å£å‡½æ•°\n    è¯·å°†handle_dataä¸­çš„é€»è¾‘è¿ç§»åˆ°æ­¤å‡½æ•°\n    """\n    handle_data(context, data)\n',t.push({type:"structure_change",line:0,original:"",converted:"def on_bar(context, data)",reason:"æ·»åŠ PTradeå…¥å£å‡½æ•°"}));const o=n.matchAll(/run_daily\s*\(\s*(\w+)\s*,\s*['"](\d{2}:\d{2})['"]\s*\)/g);for(const n of o){const e=n[1],t=n[2];a.push(`run_daily(${e}, '${t}') éœ€è¦åœ¨on_barä¸­ç”¨æ—¶é—´åˆ¤æ–­å®ç°`)}const c=(new Date).toLocaleString("zh-CN"),d=`"""\n${e.meta.name} - PTradeç‰ˆæœ¬\n============================\n\nåŸå¹³å°: JoinQuant\nè½¬æ¢æ—¶é—´: ${c}\nè½¬æ¢å·¥å…·: TRQuant Strategy Optimizer\n\nåŸå§‹ä¿¡æ¯:\n---------\n${e.meta.description||"æ— æè¿°"}\n\næ³¨æ„äº‹é¡¹:\n---------\n1. è¯·æ£€æŸ¥è‚¡ç¥¨ä»£ç åç¼€æ˜¯å¦æ­£ç¡®\n2. ç¡®è®¤äº¤æ˜“è´¹ç”¨å’Œæ»‘ç‚¹é…ç½®\n3. æµ‹è¯•æ•°æ®è·å–å‡½æ•°è¿”å›æ ¼å¼\n"""`;return i=i.replace(/^[\s\S]*?"""[\s\S]*?"""/,d),{success:0===r.length,targetPlatform:"ptrade",originalCode:n,convertedCode:i,changes:t,warnings:a,errors:r,stats:{totalChanges:t.length,apiChanges:t.filter(n=>"api_replace"===n.type).length,structureChanges:t.filter(n=>"structure_change"===n.type).length,addedLines:t.filter(n=>"add"===n.type).length,removedLines:t.filter(n=>"remove"===n.type).length}}}convertPTradeToJoinQuant(n,e){const t=[],a=[];let r=n;return r=r.replace(/\.SH\b/g,".XSHG"),r=r.replace(/\.SZ\b/g,".XSHE"),r=r.replace(/\bget_history\s*\(/g,"get_price("),r=r.replace(/\bget_snapshot\s*\(/g,"get_current_data("),r=r.replace(/\border_target_percent\s*\(/g,"order_target_value("),r=r.replace(/\border_lots\s*\(/g,"order("),r=r.replace(/print\s*\(\s*\[INFO\]\s*/g,"log.info("),r=r.replace(/print\s*\(\s*\[WARN\]\s*/g,"log.warn("),r=r.replace(/print\s*\(\s*\[ERROR\]\s*/g,"log.error("),a.push("order_target_percentéœ€è¦æ‰‹åŠ¨è½¬æ¢ä¸ºé‡‘é¢å½¢å¼"),a.push("on_baré€»è¾‘éœ€è¦æ‹†åˆ†åˆ°handle_dataå’Œrun_daily"),{success:!0,targetPlatform:"joinquant",originalCode:n,convertedCode:r,changes:t,warnings:a,errors:[],stats:{totalChanges:t.length,apiChanges:t.filter(n=>"api_replace"===n.type).length,structureChanges:0,addedLines:0,removedLines:0}}}findMapping(n,e,t){return this.mappings.find(t=>t.source.platform===e&&t.source.api===n)}replaceLine(n,e,t){const a=n.split("\n");if(e>0&&e<=a.length){const n=a[e-1].match(/^\s*/)?.[0]||"";a[e-1]=n+t}return a.join("\n")}getAllMappings(){return this.mappings}addMapping(n){this.mappings.push(n)}}e.PlatformAdapter=a,e.platformAdapter=new a},395:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.MarketPanel=void 0;const o=s(t(398));class c{static currentPanel;_panel;_extensionUri;_client;_disposables=[];constructor(n,e,t){this._panel=n,this._extensionUri=e,this._client=t,this._update(),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.onDidReceiveMessage(async n=>{switch(n.command){case"refresh":await this._update();break;case"getMarketStatus":await o.commands.executeCommand("trquant.getMarketStatus");break;case"getMainlines":await o.commands.executeCommand("trquant.getMainlines");break;case"generateStrategy":await o.commands.executeCommand("trquant.generateStrategy")}},null,this._disposables)}static createOrShow(n,e){const t=o.ViewColumn.Beside;if(c.currentPanel)return void c.currentPanel._panel.reveal(t);const a=o.window.createWebviewPanel("trquantPanel","TRQuant æ§åˆ¶å°",t,{enableScripts:!0,retainContextWhenHidden:!0});c.currentPanel=new c(a,n,e)}async _update(){this._panel.webview.html=await this._getHtmlContent()}async _getHtmlContent(){let n=null,e=null;try{const t=await this._client.getMarketStatus();t.ok&&(n=t.data);const a=await this._client.getMainlines({top_n:5});a.ok&&(e=a.data)}catch(n){}const t="risk_on"===n?.regime?"#10b981":"risk_off"===n?.regime?"#ef4444":"#f59e0b";return`<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="UTF-8">\n    <style>\n        body {\n            font-family: 'Segoe UI', sans-serif;\n            background: #1a1a2e;\n            color: #fff;\n            padding: 20px;\n            margin: 0;\n        }\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid #333;\n        }\n        .logo {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n        }\n        .logo-icon { font-size: 32px; }\n        .logo-text {\n            font-size: 20px;\n            font-weight: bold;\n        }\n        .refresh-btn {\n            background: #333;\n            border: none;\n            color: #fff;\n            padding: 8px 16px;\n            border-radius: 8px;\n            cursor: pointer;\n        }\n        .refresh-btn:hover { background: #444; }\n\n        .status-card {\n            background: linear-gradient(135deg, ${t}22, ${t}11);\n            border: 1px solid ${t}44;\n            border-radius: 16px;\n            padding: 20px;\n            margin-bottom: 20px;\n        }\n        .status-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        .status-regime {\n            font-size: 24px;\n            font-weight: bold;\n        }\n        .status-badge {\n            background: ${t};\n            padding: 6px 16px;\n            border-radius: 20px;\n            font-size: 13px;\n        }\n        .status-summary {\n            margin-top: 12px;\n            color: #d1d5db;\n            line-height: 1.6;\n        }\n\n        .section {\n            background: #252540;\n            border-radius: 12px;\n            padding: 16px;\n            margin-bottom: 16px;\n        }\n        .section-title {\n            font-size: 14px;\n            color: #9ca3af;\n            margin-bottom: 12px;\n        }\n\n        .mainline-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 10px 0;\n            border-bottom: 1px solid #333;\n        }\n        .mainline-item:last-child { border: none; }\n\n        .actions {\n            display: grid;\n            grid-template-columns: repeat(2, 1fr);\n            gap: 12px;\n            margin-top: 20px;\n        }\n        .action-btn {\n            background: #667eea;\n            border: none;\n            color: #fff;\n            padding: 14px;\n            border-radius: 10px;\n            cursor: pointer;\n            font-size: 14px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 8px;\n        }\n        .action-btn:hover { background: #5a6fd6; }\n        .action-btn.primary { background: #10b981; }\n        .action-btn.primary:hover { background: #059669; }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="logo">\n            <span class="logo-icon">ğŸ“Š</span>\n            <span class="logo-text">TRQuant æ§åˆ¶å°</span>\n        </div>\n        <button class="refresh-btn" onclick="refresh()">ğŸ”„ åˆ·æ–°</button>\n    </div>\n\n    <div class="status-card">\n        <div class="status-header">\n            <span class="status-regime">\n                ${"risk_on"===n?.regime?"ğŸ“ˆ é£é™©åå¥½ä¸Šå‡":"risk_off"===n?.regime?"ğŸ“‰ é£é™©åå¥½ä¸‹é™":"â¡ï¸ éœ‡è¡å¸‚åœº"}\n            </span>\n            <span class="status-badge">${(n?.regime||"UNKNOWN").toUpperCase()}</span>\n        </div>\n        <div class="status-summary">\n            ${n?.summary||"æ­£åœ¨è·å–å¸‚åœºçŠ¶æ€..."}\n        </div>\n    </div>\n\n    ${e?`\n    <div class="section">\n        <div class="section-title">ğŸ¯ çƒ­é—¨ä¸»çº¿ TOP 5</div>\n        ${e.slice(0,5).map((n,e)=>`\n            <div class="mainline-item">\n                <span>${e+1}. ${n.name}</span>\n                <span style="color: #667eea">${n.score?.toFixed(2)}</span>\n            </div>\n        `).join("")}\n    </div>\n    `:""}\n\n    <div class="actions">\n        <button class="action-btn" onclick="getMarketStatus()">\n            ğŸ“Š å¸‚åœºçŠ¶æ€\n        </button>\n        <button class="action-btn" onclick="getMainlines()">\n            ğŸ¯ æŠ•èµ„ä¸»çº¿\n        </button>\n        <button class="action-btn" onclick="recommendFactors()">\n            ğŸ“ˆ å› å­æ¨è\n        </button>\n        <button class="action-btn primary" onclick="generateStrategy()">\n            ğŸš€ ç”Ÿæˆç­–ç•¥\n        </button>\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        function refresh() { vscode.postMessage({ command: 'refresh' }); }\n        function getMarketStatus() { vscode.postMessage({ command: 'getMarketStatus' }); }\n        function getMainlines() { vscode.postMessage({ command: 'getMainlines' }); }\n        function recommendFactors() { vscode.postMessage({ command: 'recommendFactors' }); }\n        function generateStrategy() { vscode.postMessage({ command: 'generateStrategy' }); }\n    <\/script>\n</body>\n</html>`}dispose(){for(c.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const n=this._disposables.pop();n&&n.dispose()}}}e.MarketPanel=c},398:n=>{n.exports=require("vscode")},405:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.recommendFactors=async function(n,e){c.logger.info("æ‰§è¡Œæ¨èå› å­å‘½ä»¤",l),await o.window.withProgress({location:o.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(t,a)=>{try{t.report({message:"è·å–å¸‚åœºçŠ¶æ€...",increment:0});const r=await n.getMarketStatus(),i=r.data?.regime||"neutral";if(a.isCancellationRequested)return;t.report({message:"æ¨èå› å­...",increment:30});const s=await n.recommendFactors({market_regime:i,top_n:15});if(t.report({increment:40}),!s.ok||!s.data)return void o.window.showErrorMessage(`è·å–å› å­æ¨èå¤±è´¥: ${s.error||"æœªçŸ¥é”™è¯¯"}`);const d=s.data;c.logger.info(`æ¨è ${d.length} ä¸ªå› å­`,l),t.report({message:"æ¸²æŸ“ç»“æœ...",increment:20}),function(n,e,t){const a=o.window.createWebviewPanel("trquantFactors","ğŸ“ˆ å› å­æ¨è",o.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0});a.webview.html=function(n,e){const t=g(e),a=p(n),r=Object.entries(a).map(([n,e])=>function(n,e){const t=e.map(n=>function(n){const e=n.weight>.7?"weight-high":n.weight>.4?"weight-medium":"weight-low";return`\n        <div class="factor-card" data-factor="${n.name}" onclick="toggleFactor('${n.name}', this)">\n            <div class="factor-header">\n                <span class="factor-name">${n.name}</span>\n                <span class="factor-weight ${e}">${(100*n.weight).toFixed(0)}%</span>\n            </div>\n            <div class="factor-reason">${n.reason||"åŸºäºå†å²è¡¨ç°æ¨è"}</div>\n        </div>\n    `}(n)).join("");return`\n        <div class="category-section">\n            <div class="category-title">${function(n){return{ç›ˆåˆ©èƒ½åŠ›:"ğŸ’°",æˆé•¿æ€§:"ğŸš€",ä¼°å€¼:"ğŸ“Š",åŠ¨é‡:"âš¡",æµåŠ¨æ€§:"ğŸ’§",æ³¢åŠ¨ç‡:"ğŸ“ˆ",è´¨é‡:"âœ¨",å…¶ä»–:"ğŸ“‹"}[n]||"ğŸ“‹"}(n)} ${n}</div>\n            <div class="factors-grid">\n                ${t}\n            </div>\n        </div>\n    `}(n,e)).join("");return`<!DOCTYPE html>\n<html lang="zh">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>å› å­æ¨è</title>\n    <style>\n        :root {\n            --bg-primary: #1a1a2e;\n            --bg-secondary: #252540;\n            --bg-tertiary: #2d2d4a;\n            --text-primary: #ffffff;\n            --text-secondary: #9ca3af;\n            --text-muted: #6b7280;\n            --primary: #667eea;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --border: #3d3d5c;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n            line-height: 1.6;\n        }\n\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border);\n        }\n\n        .header-left {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n\n        .header-icon { font-size: 36px; }\n\n        .header-title {\n            font-size: 24px;\n            font-weight: 600;\n        }\n\n        .header-subtitle {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .regime-badge {\n            background: ${t.color};\n            color: white;\n            padding: 6px 16px;\n            border-radius: 20px;\n            font-size: 13px;\n        }\n\n        .info-card {\n            background: linear-gradient(135deg, ${t.color}22, ${t.color}11);\n            border-left: 4px solid ${t.color};\n            border-radius: 12px;\n            padding: 16px 20px;\n            margin-bottom: 24px;\n        }\n\n        .info-card p {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .category-section {\n            margin-bottom: 24px;\n        }\n\n        .category-title {\n            font-size: 15px;\n            font-weight: 600;\n            color: var(--text-secondary);\n            margin-bottom: 12px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .category-title::before {\n            content: '';\n            width: 4px;\n            height: 16px;\n            background: var(--primary);\n            border-radius: 2px;\n        }\n\n        .factors-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));\n            gap: 12px;\n        }\n\n        .factor-card {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            border: 1px solid var(--border);\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n\n        .factor-card:hover {\n            border-color: var(--primary);\n        }\n\n        .factor-card.selected {\n            border-color: var(--success);\n            background: var(--success)11;\n        }\n\n        .factor-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 8px;\n        }\n\n        .factor-name {\n            font-weight: 600;\n            font-size: 15px;\n        }\n\n        .factor-weight {\n            background: var(--bg-tertiary);\n            padding: 4px 12px;\n            border-radius: 12px;\n            font-size: 13px;\n            font-weight: 600;\n        }\n\n        .weight-high { background: var(--success); color: white; }\n        .weight-medium { background: var(--warning); color: #1a1a2e; }\n        .weight-low { background: var(--bg-tertiary); color: var(--text-secondary); }\n\n        .factor-reason {\n            color: var(--text-secondary);\n            font-size: 13px;\n            line-height: 1.5;\n        }\n\n        .selected-factors {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            margin-bottom: 24px;\n            border: 1px solid var(--border);\n        }\n\n        .selected-title {\n            font-size: 14px;\n            color: var(--text-secondary);\n            margin-bottom: 12px;\n        }\n\n        .selected-list {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 8px;\n        }\n\n        .selected-tag {\n            background: var(--primary);\n            color: white;\n            padding: 6px 12px;\n            border-radius: 16px;\n            font-size: 13px;\n            display: flex;\n            align-items: center;\n            gap: 6px;\n        }\n\n        .selected-tag .remove {\n            cursor: pointer;\n            opacity: 0.7;\n        }\n\n        .selected-tag .remove:hover { opacity: 1; }\n\n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 24px;\n        }\n\n        .btn {\n            padding: 12px 24px;\n            border-radius: 10px;\n            border: none;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s;\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n        }\n\n        .btn-primary:hover { background: #5a6fd6; }\n\n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n        }\n\n        .btn-secondary:hover { background: #3d3d5c; }\n\n        .timestamp {\n            text-align: center;\n            color: var(--text-muted);\n            font-size: 12px;\n            margin-top: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="header-left">\n            <span class="header-icon">ğŸ“ˆ</span>\n            <div>\n                <div class="header-title">å› å­æ¨è</div>\n                <div class="header-subtitle">åŸºäºå½“å‰å¸‚åœºçŠ¶æ€çš„æ™ºèƒ½å› å­æ¨è</div>\n            </div>\n        </div>\n        <span class="regime-badge">å¸‚åœº: ${e.toUpperCase()}</span>\n    </div>\n\n    <div class="info-card">\n        <p>${t.factorAdvice}</p>\n    </div>\n\n    <div class="selected-factors" id="selectedFactors">\n        <div class="selected-title">å·²é€‰å› å­ (ç‚¹å‡»å¡ç‰‡æ·»åŠ /ç§»é™¤)</div>\n        <div class="selected-list" id="selectedList"></div>\n    </div>\n\n    ${r}\n\n    <div class="actions">\n        <button class="btn btn-primary" onclick="generateStrategy()">\n            ğŸš€ ä½¿ç”¨é€‰ä¸­å› å­ç”Ÿæˆç­–ç•¥\n        </button>\n        <button class="btn btn-secondary" onclick="copyPrompt()">\n            ğŸ“‹ å¤åˆ¶ä¸ºAI Prompt\n        </button>\n    </div>\n\n    <div class="timestamp">\n        æ›´æ–°æ—¶é—´: ${(new Date).toLocaleString("zh-CN")}\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        const selectedFactors = new Set();\n        \n        // é»˜è®¤é€‰ä¸­å‰5ä¸ªå› å­\n        const defaultFactors = ${JSON.stringify(n.slice(0,5).map(n=>n.name))};\n        defaultFactors.forEach(f => selectedFactors.add(f));\n        updateSelectedDisplay();\n        \n        function toggleFactor(name, element) {\n            if (selectedFactors.has(name)) {\n                selectedFactors.delete(name);\n                element.classList.remove('selected');\n            } else {\n                selectedFactors.add(name);\n                element.classList.add('selected');\n            }\n            updateSelectedDisplay();\n        }\n        \n        function removeFactor(name) {\n            selectedFactors.delete(name);\n            const card = document.querySelector(\`[data-factor="\${name}"]\`);\n            if (card) card.classList.remove('selected');\n            updateSelectedDisplay();\n        }\n        \n        function updateSelectedDisplay() {\n            const list = document.getElementById('selectedList');\n            list.innerHTML = Array.from(selectedFactors).map(f => \n                \`<span class="selected-tag">\n                    \${f}\n                    <span class="remove" onclick="removeFactor('\${f}')">Ã—</span>\n                </span>\`\n            ).join('');\n            \n            // æ›´æ–°å¡ç‰‡çŠ¶æ€\n            document.querySelectorAll('.factor-card').forEach(card => {\n                const factorName = card.getAttribute('data-factor');\n                if (selectedFactors.has(factorName)) {\n                    card.classList.add('selected');\n                }\n            });\n        }\n        \n        function generateStrategy() {\n            vscode.postMessage({ \n                command: 'generateStrategy',\n                factors: Array.from(selectedFactors)\n            });\n        }\n        \n        function copyPrompt() {\n            vscode.postMessage({ command: 'copyPrompt' });\n        }\n    <\/script>\n</body>\n</html>`}(e,t),a.webview.onDidReceiveMessage(async n=>{switch(n.command){case"generateStrategy":!function(n){c.logger.info(`ä½¿ç”¨å› å­ç”Ÿæˆç­–ç•¥: ${n.join(", ")}`,l),o.commands.executeCommand("trquant.generateStrategy")}(n.factors||e.slice(0,5).map(n=>n.name));break;case"copyPrompt":{const n=m(e,t);await o.env.clipboard.writeText(n),o.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿");break}}},void 0,n.subscriptions)}(e,d,i),t.report({increment:10}),async function(n){if(0!==n.length)switch(await o.window.showInformationMessage(`æ¨è ${n.length} ä¸ªå› å­`,"ç”Ÿæˆç­–ç•¥","å¤åˆ¶Prompt")){case"ç”Ÿæˆç­–ç•¥":o.commands.executeCommand("trquant.generateStrategy");break;case"å¤åˆ¶Prompt":{const e=m(n,"neutral");await o.env.clipboard.writeText(e),o.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿");break}}}(d)}catch(n){d.ErrorHandler.handle(n,l)}})};const o=s(t(398)),c=t(628),d=t(799),l="RecommendFactors";function p(n){const e={};for(const t of n){const n=t.category||"å…¶ä»–";e[n]||(e[n]=[]),e[n].push(t)}return e}function g(n){const e={risk_on:{color:"#10b981",factorAdvice:"å½“å‰å¸‚åœºé£é™©åå¥½ä¸Šå‡ï¼Œå»ºè®®ä¾§é‡æˆé•¿æ€§å’ŒåŠ¨é‡å› å­ã€‚é«˜Betaã€é«˜æˆé•¿çš„è‚¡ç¥¨å¯èƒ½è¡¨ç°æ›´å¥½ã€‚"},risk_off:{color:"#ef4444",factorAdvice:"å½“å‰å¸‚åœºé£é™©åå¥½ä¸‹é™ï¼Œå»ºè®®ä¾§é‡ä»·å€¼å’Œè´¨é‡å› å­ã€‚ä½æ³¢åŠ¨ã€é«˜åˆ†çº¢çš„è‚¡ç¥¨å¯èƒ½æ›´ç¨³å¥ã€‚"},neutral:{color:"#f59e0b",factorAdvice:"å½“å‰å¸‚åœºå¤„äºéœ‡è¡æ ¼å±€ï¼Œå»ºè®®å‡è¡¡é…ç½®å„ç±»å› å­ã€‚å¯ä»¥è€ƒè™‘å¸‚åœºä¸­æ€§ç­–ç•¥é™ä½æ–¹å‘æ€§é£é™©ã€‚"}};return e[n]||e.neutral}function m(n,e){const t=p(n);return`# é‡åŒ–å› å­æ¨è\n\n## å¸‚åœºçŠ¶æ€: ${e.toUpperCase()}\n\n${g(e).factorAdvice}\n\n## æ¨èå› å­åˆ—è¡¨\n\n${Object.entries(t).map(([n,e])=>`\n### ${n}\n${e.map(n=>`- **${n.name}** (æƒé‡: ${(100*n.weight).toFixed(0)}%): ${n.reason||""}`).join("\n")}\n`).join("\n")}\n\n---\n\nè¯·åŸºäºä»¥ä¸Šå› å­æ¨èï¼Œå¸®æˆ‘ï¼š\n1. åˆ†æå„å› å­åœ¨å½“å‰å¸‚åœºç¯å¢ƒä¸‹çš„æœ‰æ•ˆæ€§\n2. è®¾è®¡å› å­åˆæˆæ–¹æ¡ˆï¼ˆæƒé‡åˆ†é…ï¼‰\n3. ç”Ÿæˆä½¿ç”¨è¿™äº›å› å­çš„PTradeå¤šå› å­ç­–ç•¥ä»£ç \n\nè¦æ±‚ï¼š\n- å› å­éœ€è¦è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ï¼ˆZ-scoreï¼‰\n- è€ƒè™‘å› å­é—´çš„ç›¸å…³æ€§\n- åŒ…å«å®Œæ•´çš„é£æ§é€»è¾‘\n`}},410:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e}),o=this&&this.__exportStar||function(n,e){for(var t in n)"default"===t||Object.prototype.hasOwnProperty.call(e,t)||r(e,n,t)};Object.defineProperty(e,"__esModule",{value:!0}),e.OptimizationAdvisor=e.createOptimizationAdvisor=e.StrategyAnalyzer=e.createStrategyAnalyzer=e.ManualLearner=e.createManualLearner=e.createStrategyLearner=e.reportGenerator=e.platformAdapter=e.codeAnalyzer=e.strategyOptimizer=e.StrategyOptimizerService=void 0,e.registerStrategyOptimizer=function(n,a){const{logger:r}=t(628),i="StrategyOptimizer",s=n.globalStorageUri.fsPath,o=n.extensionPath?u.join(n.extensionPath,"AShare-manual"):void 0;try{e.strategyOptimizer.initLearner(s,o),r.info("ç­–ç•¥ä¼˜åŒ–å™¨å­¦ä¹ å¼•æ“å·²åˆå§‹åŒ–",i)}catch(n){const e=n instanceof Error?n.message:String(n);r.warn(`åˆå§‹åŒ–å­¦ä¹ å¼•æ“å¤±è´¥: ${e}`,i)}r.info("ç­–ç•¥ä¼˜åŒ–å™¨æœåŠ¡å·²æ³¨å†Œ",i)};const c=t(510),d=t(381),l=t(879),p=t(144),g=t(150),m=t(902),u=s(t(928)),h=t(64);o(t(64),e);class v{static instance;learner=null;manualLearner=null;storagePath="";manualPath="";strategyAnalyzer;optimizationAdvisor;constructor(){this.strategyAnalyzer=(0,g.createStrategyAnalyzer)(),this.optimizationAdvisor=(0,m.createOptimizationAdvisor)()}static getInstance(){return v.instance||(v.instance=new v),v.instance}initLearner(n,e){this.storagePath=n,this.learner=(0,p.createStrategyLearner)(n),e&&(this.manualPath=e,this.manualLearner=(0,p.createManualLearner)(n,e))}getLearner(){return this.learner}getManualLearner(){return this.manualLearner}async learnFromManual(){return this.manualLearner?this.manualLearner.learnFromManual():{success:!1,stats:{filesScanned:0,patternsExtracted:0,practicesExtracted:0,codeBlocksFound:0},log:["æ‰‹å†Œå­¦ä¹ å™¨æœªåˆå§‹åŒ–"]}}watchManualUpdates(n){return this.manualLearner?this.manualLearner.watchForUpdates(n):null}analyzeStrategy(n,e){return c.codeAnalyzer.analyze(n,e)}convertToPlatform(n,e,t){const a=t||this.analyzeStrategy(n);return d.platformAdapter.convert(n,a,e)}generateReport(n,e="html"){const t=this.analyzeStrategy(n);switch(e){case"json":return l.reportGenerator.generate(t);case"markdown":return l.reportGenerator.generateMarkdown(t);default:return l.reportGenerator.generateHTML(t)}}async optimizeStrategy(n,e,t){const a=this.analyzeStrategy(n,t),r=d.platformAdapter.convert(n,a,e);return{analysis:a,conversion:r,report:l.reportGenerator.generateHTML(a,r)}}checkCompatibility(n){const e=this.analyzeStrategy(n);return{sourcePlatform:e.compatibility.sourcePlatform,compatibility:{joinquant:{score:e.compatibility.joinquant.score,level:e.compatibility.joinquant.level},ptrade:{score:e.compatibility.ptrade.score,level:e.compatibility.ptrade.level},qmt:{score:e.compatibility.qmt.score,level:e.compatibility.qmt.level},universal:{score:100,level:"full"}}}}getAPIMappings(){return d.platformAdapter.getAllMappings()}getPlatformInfo(n){return h.PLATFORMS[n]}async learnFromDocuments(n){return this.learner?this.learner.learnFromDocuments(n):{learned:0,patterns:[],practices:[]}}async learnFromHistory(n){return this.learner?this.learner.learnFromHistory(n):{analyzed:0,successPatterns:[],failurePatterns:[]}}recordFeedback(n){if(this.learner){const e={timestamp:(new Date).toISOString(),strategyId:n.strategyId,type:n.type,content:n.content,resolved:!1};this.learner.recordFeedback(e)}}async getRecommendedPatterns(n){if(!this.learner)return[];const e=this.analyzeStrategy(n);return await this.learner.recommendPatterns(e)}async getRecommendedPractices(n){if(!this.learner)return[];const e=this.analyzeStrategy(n);return await this.learner.recommendBestPractices(e)}getLearningStats(){return this.learner?this.learner.getStats():null}saveLearningData(){this.learner&&this.learner.save()}analyzeStrategyDeep(n,e){return this.strategyAnalyzer.analyze(n,e)}generateOptimizationReport(n,e){const t=this.strategyAnalyzer.analyze(n,e);return this.optimizationAdvisor.generateReport(t)}quickOptimizationCheck(n){return this.generateOptimizationReport(n).advices.filter(n=>"high"===n.priority).map(n=>({priority:n.priority,title:n.title,suggestion:n.description}))}getStrategyScore(n){const e=this.generateOptimizationReport(n);return{overall:e.overallScore,...e.scoreBreakdown}}}e.StrategyOptimizerService=v,e.strategyOptimizer=v.getInstance();var f=t(510);Object.defineProperty(e,"codeAnalyzer",{enumerable:!0,get:function(){return f.codeAnalyzer}});var b=t(381);Object.defineProperty(e,"platformAdapter",{enumerable:!0,get:function(){return b.platformAdapter}});var y=t(879);Object.defineProperty(e,"reportGenerator",{enumerable:!0,get:function(){return y.reportGenerator}});var x=t(144);Object.defineProperty(e,"createStrategyLearner",{enumerable:!0,get:function(){return x.createStrategyLearner}}),Object.defineProperty(e,"createManualLearner",{enumerable:!0,get:function(){return x.createManualLearner}}),Object.defineProperty(e,"ManualLearner",{enumerable:!0,get:function(){return x.ManualLearner}});var w=t(150);Object.defineProperty(e,"createStrategyAnalyzer",{enumerable:!0,get:function(){return w.createStrategyAnalyzer}}),Object.defineProperty(e,"StrategyAnalyzer",{enumerable:!0,get:function(){return w.StrategyAnalyzer}});var _=t(902);Object.defineProperty(e,"createOptimizationAdvisor",{enumerable:!0,get:function(){return _.createOptimizationAdvisor}}),Object.defineProperty(e,"OptimizationAdvisor",{enumerable:!0,get:function(){return _.OptimizationAdvisor}})},478:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.config=e.ConfigManager=void 0;const o=s(t(398)),c=s(t(928)),d=s(t(857)),l={pythonPath:"win32"===d.platform()?"python":"python3",serverHost:"127.0.0.1",serverPort:5e3,timeout:6e4,mcpEnabled:!0,mcpPort:5001,autoRefresh:!1,refreshInterval:3e5,defaultPlatform:"ptrade",defaultStyle:"multi_factor",defaultRiskParams:{maxPosition:.1,stopLoss:.08,takeProfit:.2}};class p{static instance;config;disposables=[];constructor(){this.config=this.loadConfig(),this.disposables.push(o.workspace.onDidChangeConfiguration(n=>{n.affectsConfiguration("trquant")&&(this.config=this.loadConfig())}))}static getInstance(){return p.instance||(p.instance=new p),p.instance}loadConfig(){const n=o.workspace.getConfiguration("trquant");return{pythonPath:n.get("pythonPath")||l.pythonPath,serverHost:n.get("serverHost")||l.serverHost,serverPort:n.get("serverPort")||l.serverPort,timeout:n.get("timeout")||l.timeout,mcpEnabled:n.get("mcpEnabled")??l.mcpEnabled,mcpPort:n.get("mcpPort")||l.mcpPort,autoRefresh:n.get("autoRefresh")??l.autoRefresh,refreshInterval:n.get("refreshInterval")||l.refreshInterval,defaultPlatform:n.get("defaultPlatform")||l.defaultPlatform,defaultStyle:n.get("defaultStyle")||l.defaultStyle,defaultRiskParams:{maxPosition:n.get("defaultMaxPosition")||l.defaultRiskParams.maxPosition,stopLoss:n.get("defaultStopLoss")||l.defaultRiskParams.stopLoss,takeProfit:n.get("defaultTakeProfit")||l.defaultRiskParams.takeProfit}}}getConfig(){return{...this.config}}get(n){return this.config[n]}async set(n,e,t=o.ConfigurationTarget.Global){const a=o.workspace.getConfiguration("trquant");await a.update(n,e,t)}getPythonPath(n){const e=this.config.pythonPath;if(c.isAbsolute(e))return e;const t=c.join(n,"..","venv");return"win32"===d.platform()?c.join(t,"Scripts","python.exe"):c.join(t,"bin","python")}dispose(){this.disposables.forEach(n=>n.dispose())}}e.ConfigManager=p,e.config=p.getInstance()},485:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.WorkflowItem=e.WorkflowProvider=void 0,e.registerWorkflowProvider=function(n){const e=new c(n),t=o.window.createTreeView("trquant-workflow",{treeDataProvider:e,showCollapseAll:!0});return n.subscriptions.push(t),console.log("[TRQuant] å·¥ä½œæµæä¾›è€…å·²æ³¨å†Œ"),e};const o=s(t(398));class c{context;_onDidChangeTreeData=new o.EventEmitter;onDidChangeTreeData=this._onDidChangeTreeData.event;constructor(n){this.context=n}refresh(){this._onDidChangeTreeData.fire()}getTreeItem(n){return n}getChildren(n){if(n)return Promise.resolve(n.children||[]);const e=[new d("ğŸ“¡ 1. æ•°æ®ä¸­å¿ƒ","æ›´æ–°æ•°æ®åº“å’ŒçŸ¥è¯†åº“",o.TreeItemCollapsibleState.Collapsed,"trquant.openDataCenter",[new d("æ•°æ®æºé…ç½®","é…ç½®è¡Œæƒ…ã€è´¢åŠ¡æ•°æ®æº",o.TreeItemCollapsibleState.None,"trquant.openDataSource"),new d("æ•°æ®æ›´æ–°","å¢é‡æ›´æ–°å†å²æ•°æ®",o.TreeItemCollapsibleState.None,"trquant.updateData"),new d("çŸ¥è¯†åº“","ç®¡ç†ç­–ç•¥çŸ¥è¯†åº“",o.TreeItemCollapsibleState.None,"trquant.openKnowledgeBase"),new d("è´¨é‡æŠ¥å‘Š","æŸ¥çœ‹æ•°æ®å®Œæ•´æ€§",o.TreeItemCollapsibleState.None,"trquant.dataQuality")]),new d("ğŸ“ˆ 2. å¸‚åœºåˆ†æ","åˆ†æå¸‚åœºè¶‹åŠ¿å’ŒçŠ¶æ€",o.TreeItemCollapsibleState.Collapsed,"trquant.openMarketAnalysis",[new d("å¸‚åœºçŠ¶æ€","å½“å‰ Regime åˆ¤æ–­",o.TreeItemCollapsibleState.None,"trquant.getMarketStatus"),new d("æŒ‡æ•°è¶‹åŠ¿","ä¸»è¦æŒ‡æ•°èµ°åŠ¿åˆ†æ",o.TreeItemCollapsibleState.None,"trquant.indexTrend"),new d("æ¿å—è½®åŠ¨","è¡Œä¸šæ¿å—å¼ºå¼±",o.TreeItemCollapsibleState.None,"trquant.sectorRotation"),new d("æƒ…ç»ªæŒ‡æ ‡","å¸‚åœºæƒ…ç»ªç›‘æ§",o.TreeItemCollapsibleState.None,"trquant.sentiment")]),new d("ğŸ”¥ 3. æŠ•èµ„ä¸»çº¿","è¯†åˆ«å¸‚åœºçƒ­ç‚¹å’ŒæŠ•èµ„ä¸»çº¿",o.TreeItemCollapsibleState.Collapsed,"trquant.openMainlines",[new d("çƒ­ç‚¹ä¸»çº¿","å½“å‰çƒ­é—¨æŠ•èµ„ä¸»çº¿",o.TreeItemCollapsibleState.None,"trquant.getMainlines"),new d("å†å²ä¸»çº¿","å†å²ä¸»çº¿å›é¡¾",o.TreeItemCollapsibleState.None,"trquant.historyMainlines"),new d("LLM åˆ†æ","AI è¾…åŠ©ä¸»çº¿è§£è¯»",o.TreeItemCollapsibleState.None,"trquant.llmMainlines")]),new d("ğŸ“¦ 4. å€™é€‰æ± ","æ„å»ºè‚¡ç¥¨å€™é€‰æ± ",o.TreeItemCollapsibleState.Collapsed,"trquant.openCandidatePool",[new d("å€™é€‰è‚¡ç¥¨","æŸ¥çœ‹å€™é€‰æ± è‚¡ç¥¨",o.TreeItemCollapsibleState.None,"trquant.viewCandidates"),new d("ç­›é€‰è§„åˆ™","é…ç½®ç­›é€‰æ¡ä»¶",o.TreeItemCollapsibleState.None,"trquant.filterRules"),new d("å…³æ³¨åˆ—è¡¨","ä¸ªäººå…³æ³¨è‚¡ç¥¨",o.TreeItemCollapsibleState.None,"trquant.watchlist")]),new d("ğŸ“Š 5. å› å­ä¸­å¿ƒ","æ„å»ºå’Œä¼˜åŒ–é‡åŒ–å› å­",o.TreeItemCollapsibleState.Collapsed,"trquant.openFactorCenter",[new d("å› å­åº“","æŸ¥çœ‹å¯ç”¨å› å­",o.TreeItemCollapsibleState.None,"trquant.factorLibrary"),new d("å› å­æ£€éªŒ","IC/IR åˆ†æ",o.TreeItemCollapsibleState.None,"trquant.factorTest"),new d("å› å­æ¨è","åŸºäºå¸‚åœºçŠ¶æ€æ¨è",o.TreeItemCollapsibleState.None,"trquant.recommendFactors")]),new d("ğŸ› ï¸ 6. ç­–ç•¥å¼€å‘","å¼€å‘å’Œä¼˜åŒ–äº¤æ˜“ç­–ç•¥",o.TreeItemCollapsibleState.Collapsed,"trquant.openStrategyDev",[new d("åˆ›å»ºé¡¹ç›®","æ–°å»ºé‡åŒ–ç­–ç•¥é¡¹ç›®",o.TreeItemCollapsibleState.None,"trquant.createProject"),new d("ç­–ç•¥ç¼–è¾‘å™¨","ç¼–è¾‘ç­–ç•¥ä»£ç ",o.TreeItemCollapsibleState.None,"trquant.openStrategyOptimizer"),new d("å‚æ•°ä¼˜åŒ–","ç­–ç•¥å‚æ•°æœç´¢",o.TreeItemCollapsibleState.None,"trquant.optimizeStrategy"),new d("AI ç”Ÿæˆ","LLM è¾…åŠ©ç”Ÿæˆç­–ç•¥",o.TreeItemCollapsibleState.None,"trquant.generateStrategy")]),new d("ğŸ”„ 7. å›æµ‹ä¸­å¿ƒ","å›æµ‹éªŒè¯å’Œç»“æœåˆ†æ",o.TreeItemCollapsibleState.Collapsed,"trquant.openBacktestCenter",[new d("è¿è¡Œå›æµ‹","é…ç½®å¹¶æ‰§è¡Œå›æµ‹",o.TreeItemCollapsibleState.None,"trquant.runBacktest"),new d("å†å²å›æµ‹","æŸ¥çœ‹å†å²å›æµ‹è®°å½•",o.TreeItemCollapsibleState.None,"trquant.backtestHistory"),new d("ç»“æœåˆ†æ","æ·±å…¥åˆ†æå›æµ‹ç»“æœ",o.TreeItemCollapsibleState.None,"trquant.analyzeBacktest"),new d("å¯¹æ¯”åˆ†æ","å¤šç­–ç•¥å¯¹æ¯”",o.TreeItemCollapsibleState.None,"trquant.compareBacktests")]),new d("ğŸš€ 8. äº¤æ˜“ä¸­å¿ƒ","å®ç›˜æ¨¡æ‹Ÿå’Œå®ç›˜äº¤æ˜“",o.TreeItemCollapsibleState.Collapsed,"trquant.openTradingCenter",[new d("æ¨¡æ‹Ÿäº¤æ˜“","ç­–ç•¥æ¨¡æ‹ŸéªŒè¯",o.TreeItemCollapsibleState.None,"trquant.paperTrading"),new d("å®ç›˜éƒ¨ç½²","éƒ¨ç½²åˆ°äº¤æ˜“ç³»ç»Ÿ",o.TreeItemCollapsibleState.None,"trquant.deployStrategy"),new d("äº¤æ˜“ç›‘æ§","å®æ—¶ç›‘æ§é¢æ¿",o.TreeItemCollapsibleState.None,"trquant.tradingMonitor"),new d("é£æ§ç®¡ç†","é£é™©æ§åˆ¶è®¾ç½®",o.TreeItemCollapsibleState.None,"trquant.riskControl")])];return Promise.resolve(e)}}e.WorkflowProvider=c;class d extends o.TreeItem{label;description;collapsibleState;commandId;children;constructor(n,e,t,a,r){super(n,t),this.label=n,this.description=e,this.collapsibleState=t,this.commandId=a,this.description=e,this.children=r,a&&(this.command={command:a,title:n,arguments:[]}),this.iconPath=this.getIcon(),this.contextValue="workflowItem"}getIcon(){const n={"ğŸ“¡ 1. æ•°æ®ä¸­å¿ƒ":"database","ğŸ“ˆ 2. å¸‚åœºåˆ†æ":"graph-line","ğŸ”¥ 3. æŠ•èµ„ä¸»çº¿":"flame","ğŸ“¦ 4. å€™é€‰æ± ":"package","ğŸ“Š 5. å› å­ä¸­å¿ƒ":"symbol-variable","ğŸ› ï¸ 6. ç­–ç•¥å¼€å‘":"tools","ğŸ”„ 7. å›æµ‹ä¸­å¿ƒ":"history","ğŸš€ 8. äº¤æ˜“ä¸­å¿ƒ":"rocket"}[this.label];return n?new o.ThemeIcon(n):this.collapsibleState===o.TreeItemCollapsibleState.None?new o.ThemeIcon("circle-small"):void 0}}e.WorkflowItem=d},501:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.getMarketStatus=async function(n,e){c.logger.info("æ‰§è¡Œè·å–å¸‚åœºçŠ¶æ€å‘½ä»¤",l),await o.window.withProgress({location:o.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(t,a)=>{try{if(t.report({message:"æ­£åœ¨è·å–å¸‚åœºçŠ¶æ€...",increment:0}),a.isCancellationRequested)return void c.logger.info("ç”¨æˆ·å–æ¶ˆæ“ä½œ",l);const r=await n.getMarketStatus({universe:"CN_EQ",as_of:(new Date).toISOString().split("T")[0]});if(t.report({increment:50}),!r.ok||!r.data)return void o.window.showErrorMessage(`è·å–å¸‚åœºçŠ¶æ€å¤±è´¥: ${r.error||"æœªçŸ¥é”™è¯¯"}`);const i=r.data;c.logger.info(`å¸‚åœºçŠ¶æ€: ${i.regime}`,l),t.report({message:"æ¸²æŸ“ç»“æœ...",increment:30}),function(n,e){const t=o.window.createWebviewPanel("trquantMarketStatus","ğŸ“Š å¸‚åœºçŠ¶æ€",o.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0});t.webview.html=function(n){const e=p(n.regime),t=function(n){const e={SH000300:"æ²ªæ·±300",SZ399006:"åˆ›ä¸šæ¿æŒ‡",SH000016:"ä¸Šè¯50",SZ399905:"ä¸­è¯500"};return Object.entries(n).map(([n,t])=>{const a=e[n]||n,r="up"===t.trend?"â†‘":"down"===t.trend?"â†“":"â†’";return`\n                <div class="trend-item">\n                    <span class="trend-name">${a}</span>\n                    <div class="trend-value">\n                        <span class="trend-direction ${t.zscore>0?"positive":t.zscore<0?"negative":"neutral"}">${r}</span>\n                        <span class="zscore">(${t.zscore>=0?"+":""}${t.zscore.toFixed(2)})</span>\n                    </div>\n                </div>\n            `}).join("")}(n.index_trend),a=function(n){const e={growth:"æˆé•¿",value:"ä»·å€¼",momentum:"åŠ¨é‡",quality:"è´¨é‡",size:"å¸‚å€¼"};return n.map(n=>`\n                <div class="style-item">\n                    <span class="style-name">${e[n.style]||n.style}</span>\n                    <span class="style-score ${n.score>0?"positive":n.score<0?"negative":"neutral"}">${n.score>0?"+":""}${n.score.toFixed(2)}</span>\n                </div>\n            `).join("")}(n.style_rotation);return`<!DOCTYPE html>\n<html lang="zh">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>å¸‚åœºçŠ¶æ€</title>\n    <style>\n        :root {\n            --bg-primary: #1a1a2e;\n            --bg-secondary: #252540;\n            --bg-tertiary: #2d2d4a;\n            --text-primary: #ffffff;\n            --text-secondary: #9ca3af;\n            --text-muted: #6b7280;\n            --primary: #667eea;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --border: #3d3d5c;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n            line-height: 1.6;\n        }\n\n        .header {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border);\n        }\n\n        .header-icon { font-size: 36px; }\n\n        .header-content { flex: 1; }\n\n        .header-title {\n            font-size: 24px;\n            font-weight: 600;\n            margin-bottom: 4px;\n        }\n\n        .header-subtitle {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .regime-badge {\n            background: ${e.color};\n            color: white;\n            padding: 8px 20px;\n            border-radius: 24px;\n            font-weight: 600;\n            font-size: 14px;\n            text-transform: uppercase;\n        }\n\n        .card {\n            background: var(--bg-secondary);\n            border-radius: 16px;\n            padding: 20px;\n            margin-bottom: 16px;\n            border: 1px solid var(--border);\n        }\n\n        .card-title {\n            font-size: 14px;\n            color: var(--text-secondary);\n            margin-bottom: 16px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .card-title::before {\n            content: '';\n            width: 4px;\n            height: 16px;\n            background: var(--primary);\n            border-radius: 2px;\n        }\n\n        .trend-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 12px;\n        }\n\n        .trend-item {\n            background: var(--bg-tertiary);\n            border-radius: 12px;\n            padding: 16px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n\n        .trend-name {\n            font-weight: 500;\n            font-size: 14px;\n        }\n\n        .trend-value {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .trend-direction {\n            font-size: 18px;\n        }\n\n        .zscore {\n            font-size: 13px;\n            color: var(--text-secondary);\n        }\n\n        .positive { color: var(--success); }\n        .negative { color: var(--danger); }\n        .neutral { color: var(--warning); }\n\n        .style-list {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 12px;\n        }\n\n        .style-item {\n            background: var(--bg-tertiary);\n            border-radius: 12px;\n            padding: 12px 20px;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            flex: 1;\n            min-width: 150px;\n        }\n\n        .style-name { font-weight: 500; }\n\n        .style-score {\n            margin-left: auto;\n            font-weight: 600;\n            font-size: 18px;\n        }\n\n        .summary-card {\n            background: linear-gradient(135deg, ${e.color}22, ${e.color}11);\n            border-left: 4px solid ${e.color};\n        }\n\n        .summary-text {\n            color: var(--text-primary);\n            font-size: 15px;\n            line-height: 1.8;\n        }\n\n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 24px;\n        }\n\n        .btn {\n            padding: 12px 24px;\n            border-radius: 10px;\n            border: none;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s;\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n        }\n\n        .btn-primary:hover {\n            background: #5a6fd6;\n        }\n\n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n        }\n\n        .btn-secondary:hover {\n            background: #3d3d5c;\n        }\n\n        .timestamp {\n            text-align: center;\n            color: var(--text-muted);\n            font-size: 12px;\n            margin-top: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <span class="header-icon">${e.icon}</span>\n        <div class="header-content">\n            <div class="header-title">Aè‚¡å¸‚åœºçŠ¶æ€</div>\n            <div class="header-subtitle">åŸºäºå¤šç»´åº¦æŒ‡æ ‡ç»¼åˆåˆ†æ</div>\n        </div>\n        <span class="regime-badge">${n.regime}</span>\n    </div>\n\n    <div class="card summary-card">\n        <div class="card-title">åˆ†æç»“è®º</div>\n        <div class="summary-text">${n.summary||e.description}</div>\n    </div>\n\n    <div class="card">\n        <div class="card-title">æŒ‡æ•°è¶‹åŠ¿</div>\n        <div class="trend-grid">\n            ${t}\n        </div>\n    </div>\n\n    <div class="card">\n        <div class="card-title">é£æ ¼è½®åŠ¨</div>\n        <div class="style-list">\n            ${a}\n        </div>\n    </div>\n\n    <div class="actions">\n        <button class="btn btn-primary" onclick="copyPrompt()">\n            ğŸ“‹ å¤åˆ¶ä¸ºAI Prompt\n        </button>\n        <button class="btn btn-secondary" onclick="refresh()">\n            ğŸ”„ åˆ·æ–°æ•°æ®\n        </button>\n    </div>\n\n    <div class="timestamp">\n        æ›´æ–°æ—¶é—´: ${(new Date).toLocaleString("zh-CN")}\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        function copyPrompt() {\n            vscode.postMessage({ command: 'copyPrompt' });\n        }\n        \n        function refresh() {\n            vscode.postMessage({ command: 'refresh' });\n        }\n    <\/script>\n</body>\n</html>`}(e),t.webview.onDidReceiveMessage(async n=>{switch(n.command){case"copyPrompt":{const n=g(e);await o.env.clipboard.writeText(n),o.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿");break}case"refresh":o.commands.executeCommand("trquant.getMarketStatus"),t.dispose()}},void 0,n.subscriptions)}(e,i),t.report({increment:20}),async function(n){switch(await o.window.showInformationMessage(`å¸‚åœºçŠ¶æ€: ${n.regime.toUpperCase()}`,"å¤åˆ¶Prompt","ç”Ÿæˆç­–ç•¥","æŸ¥çœ‹ä¸»çº¿")){case"å¤åˆ¶Prompt":{const e=g(n);await o.env.clipboard.writeText(e),o.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿");break}case"ç”Ÿæˆç­–ç•¥":o.commands.executeCommand("trquant.generateStrategy");break;case"æŸ¥çœ‹ä¸»çº¿":o.commands.executeCommand("trquant.getMainlines")}}(i)}catch(n){d.ErrorHandler.handle(n,l)}})};const o=s(t(398)),c=t(628),d=t(799),l="GetMarketStatus";function p(n){const e={risk_on:{icon:"ğŸ“ˆ",color:"#10b981",description:"å½“å‰å¸‚åœºé£é™©åå¥½ä¸Šå‡ï¼Œé€‚åˆç§¯æé…ç½®æˆé•¿è‚¡å’Œé«˜Betaèµ„äº§ã€‚å»ºè®®å…³æ³¨ç§‘æŠ€ã€æ–°èƒ½æºç­‰é«˜æˆé•¿æ¿å—ã€‚"},risk_off:{icon:"ğŸ“‰",color:"#ef4444",description:"å½“å‰å¸‚åœºé£é™©åå¥½ä¸‹é™ï¼Œå»ºè®®é˜²å¾¡æ€§é…ç½®ã€‚å¯å…³æ³¨é«˜åˆ†çº¢ã€ä½æ³¢åŠ¨çš„ä»·å€¼è‚¡ï¼Œé€‚å½“é™ä½ä»“ä½ã€‚"},neutral:{icon:"â¡ï¸",color:"#f59e0b",description:"å½“å‰å¸‚åœºå¤„äºéœ‡è¡æ ¼å±€ï¼Œå»ºè®®å‡è¡¡é…ç½®ã€‚å¯é‡‡ç”¨å¸‚åœºä¸­æ€§ç­–ç•¥ï¼Œæ§åˆ¶é£é™©æ•å£ã€‚"}};return e[n]||e.neutral}function g(n){const e=p(n.regime);return`# Aè‚¡å¸‚åœºçŠ¶æ€åˆ†æ\n\n## å¸‚åœºRegime: ${n.regime.toUpperCase()}\n${e.description}\n\n## æŒ‡æ•°è¶‹åŠ¿\n${Object.entries(n.index_trend).map(([n,e])=>`- ${n}: ${e.trend} (åŠ¨é‡: ${e.zscore>=0?"+":""}${e.zscore.toFixed(2)})`).join("\n")}\n\n## é£æ ¼è½®åŠ¨\n${n.style_rotation.map(n=>`- ${n.style}: ${n.score>0?"å ä¼˜":"å¼±åŠ¿"} (${n.score>=0?"+":""}${n.score.toFixed(2)})`).join("\n")}\n\n## åˆ†ææ€»ç»“\n${n.summary||e.description}\n\n---\nè¯·åŸºäºä»¥ä¸Šå¸‚åœºçŠ¶æ€ï¼Œå¸®æˆ‘ç”Ÿæˆé€‚åˆå½“å‰å¸‚åœºç¯å¢ƒçš„PTradeé‡åŒ–ç­–ç•¥ä»£ç ã€‚è¦æ±‚ï¼š\n1. æ ¹æ®å¸‚åœºRegimeé€‰æ‹©åˆé€‚çš„ç­–ç•¥é£æ ¼\n2. åŒ…å«å®Œæ•´çš„é£æ§é€»è¾‘ï¼ˆæ­¢æŸ8%ï¼Œæ­¢ç›ˆ20%ï¼‰\n3. å•ç¥¨æœ€å¤§ä»“ä½10%\n4. æ·»åŠ è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š\n`}},510:(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.codeAnalyzer=e.CodeAnalyzer=void 0;const t=[{pattern:/get_price\s*\(/g,name:"get_price",category:"data"},{pattern:/get_fundamentals\s*\(/g,name:"get_fundamentals",category:"data"},{pattern:/get_current_data\s*\(/g,name:"get_current_data",category:"data"},{pattern:/get_extras\s*\(/g,name:"get_extras",category:"data"},{pattern:/get_index_stocks\s*\(/g,name:"get_index_stocks",category:"data"},{pattern:/get_industry_stocks\s*\(/g,name:"get_industry_stocks",category:"data"},{pattern:/get_concept_stocks\s*\(/g,name:"get_concept_stocks",category:"data"},{pattern:/get_all_securities\s*\(/g,name:"get_all_securities",category:"data"},{pattern:/history\s*\(/g,name:"history",category:"data"},{pattern:/attribute_history\s*\(/g,name:"attribute_history",category:"data"},{pattern:/order\s*\(/g,name:"order",category:"trade"},{pattern:/order_target\s*\(/g,name:"order_target",category:"trade"},{pattern:/order_target_value\s*\(/g,name:"order_target_value",category:"trade"},{pattern:/order_value\s*\(/g,name:"order_value",category:"trade"},{pattern:/cancel_order\s*\(/g,name:"cancel_order",category:"trade"},{pattern:/get_open_orders\s*\(/g,name:"get_open_orders",category:"trade"},{pattern:/set_benchmark\s*\(/g,name:"set_benchmark",category:"setting"},{pattern:/set_option\s*\(/g,name:"set_option",category:"setting"},{pattern:/set_slippage\s*\(/g,name:"set_slippage",category:"setting"},{pattern:/set_order_cost\s*\(/g,name:"set_order_cost",category:"setting"},{pattern:/set_universe\s*\(/g,name:"set_universe",category:"setting"},{pattern:/log\.info\s*\(/g,name:"log.info",category:"log"},{pattern:/log\.warn\s*\(/g,name:"log.warn",category:"log"},{pattern:/log\.error\s*\(/g,name:"log.error",category:"log"},{pattern:/run_daily\s*\(/g,name:"run_daily",category:"schedule"},{pattern:/run_weekly\s*\(/g,name:"run_weekly",category:"schedule"},{pattern:/run_monthly\s*\(/g,name:"run_monthly",category:"schedule"}],a=[{pattern:/get_history\s*\(/g,name:"get_history",category:"data"},{pattern:/get_snapshot\s*\(/g,name:"get_snapshot",category:"data"},{pattern:/get_Ede\s*\(/g,name:"get_Ede",category:"data"},{pattern:/order_target_percent\s*\(/g,name:"order_target_percent",category:"trade"},{pattern:/order_lots\s*\(/g,name:"order_lots",category:"trade"},{pattern:/on_bar\s*\(/g,name:"on_bar",category:"entry"}],r=[{pattern:/\bpe\b|\bPE\b|pe_ratio|å¸‚ç›ˆç‡/gi,type:"value",name:"PE"},{pattern:/\bpb\b|\bPB\b|pb_ratio|å¸‚å‡€ç‡/gi,type:"value",name:"PB"},{pattern:/\bps\b|\bPS\b|ps_ratio|å¸‚é”€ç‡/gi,type:"value",name:"PS"},{pattern:/\bpcf\b|\bPCF\b|å¸‚ç°ç‡/gi,type:"value",name:"PCF"},{pattern:/dividend|è‚¡æ¯|åˆ†çº¢/gi,type:"value",name:"Dividend"},{pattern:/revenue_growth|è¥æ”¶å¢é•¿/gi,type:"growth",name:"RevenueGrowth"},{pattern:/profit_growth|åˆ©æ¶¦å¢é•¿|å‡€åˆ©æ¶¦å¢é•¿/gi,type:"growth",name:"ProfitGrowth"},{pattern:/eps_growth|æ¯è‚¡æ”¶ç›Šå¢é•¿/gi,type:"growth",name:"EPSGrowth"},{pattern:/roe_growth|ROEå¢é•¿/gi,type:"growth",name:"ROEGrowth"},{pattern:/\broe\b|\bROE\b|å‡€èµ„äº§æ”¶ç›Šç‡/gi,type:"quality",name:"ROE"},{pattern:/\broa\b|\bROA\b|æ€»èµ„äº§æ”¶ç›Šç‡/gi,type:"quality",name:"ROA"},{pattern:/gross_margin|æ¯›åˆ©ç‡/gi,type:"quality",name:"GrossMargin"},{pattern:/net_margin|å‡€åˆ©ç‡/gi,type:"quality",name:"NetMargin"},{pattern:/asset_turnover|èµ„äº§å‘¨è½¬/gi,type:"quality",name:"AssetTurnover"},{pattern:/momentum|åŠ¨é‡/gi,type:"momentum",name:"Momentum"},{pattern:/return_\d+d|æ”¶ç›Šç‡/gi,type:"momentum",name:"Return"},{pattern:/relative_strength|ç›¸å¯¹å¼ºåº¦/gi,type:"momentum",name:"RelativeStrength"},{pattern:/volatility|æ³¢åŠ¨ç‡/gi,type:"volatility",name:"Volatility"},{pattern:/\bbeta\b|è´å¡”/gi,type:"volatility",name:"Beta"},{pattern:/std_dev|æ ‡å‡†å·®/gi,type:"volatility",name:"StdDev"}],i=[{pattern:/\bMA\b|ç§»åŠ¨å¹³å‡|ma\(/gi,type:"ma",name:"MA"},{pattern:/\bEMA\b|æŒ‡æ•°å¹³å‡|ema\(/gi,type:"ma",name:"EMA"},{pattern:/\bMACD\b|macd/gi,type:"macd",name:"MACD"},{pattern:/\bRSI\b|rsi|ç›¸å¯¹å¼ºå¼±/gi,type:"rsi",name:"RSI"},{pattern:/\bKDJ\b|kdj/gi,type:"kdj",name:"KDJ"},{pattern:/\bBOLL\b|å¸ƒæ—|boll/gi,type:"boll",name:"BOLL"},{pattern:/\bATR\b|atr|å¹³å‡çœŸå®æ³¢å¹…/gi,type:"atr",name:"ATR"}];class s{analyze(n,e){const t=n.split("\n"),a=this.extractMeta(n,e),r=this.extractCodeBlocks(n),i=this.categorizeComponents(r),s=this.analyzeDependencies(n,t);return{meta:a,components:i,dependencies:s,compatibility:this.calculateCompatibility(s.apis),stats:this.calculateStats(n,r)}}extractMeta(n,e){const t={name:e?.replace(".py","")||"æœªå‘½åç­–ç•¥",description:""},a=n.match(/^[\s\S]*?"""([\s\S]*?)"""/);if(a){const n=a[1],e=n.match(/^(.+?)\s*[-=]/m);e&&(t.name=e[1].trim());const r=n.match(/åˆ›å»ºæ—¶é—´[ï¼š:]\s*(.+)/);r&&(t.createTime=r[1].trim());const i=n.match(/å›æµ‹åŒºé—´[ï¼š:]\s*(\d{4}-\d{2}-\d{2})\s*è‡³\s*(\d{4}-\d{2}-\d{2})/);i&&(t.backtestPeriod={start:i[1],end:i[2]});const s=n.match(/åŸºå‡†[æŒ‡æ•°]*[ï¼š:]\s*(\S+)/);s&&(t.benchmark=s[1]);const o=n.match(/ç­–ç•¥[è¯´æ˜ç‰¹è‰²]*[ï¼š:]*\n?([\s\S]*?)(?=\n\n|è¿ç§»|å¹³å°|$)/);o&&(t.description=o[1].trim().replace(/^[-\d.\s]+/gm,"").trim())}return t}extractCodeBlocks(n){const e=[],t=n.split("\n");let a=null,r=0,i=!1,s="";for(let n=0;n<t.length;n++){const o=t[n],c=o.trim(),d=o.length-o.trimStart().length;if(c.startsWith('"""')||c.startsWith("'''")){i?c.endsWith(s)&&(i=!1):(i=!0,s=c.substring(0,3),c.endsWith(s)&&c.length>3&&(i=!1));continue}if(i)continue;const l=c.match(/^def\s+(\w+)\s*\(/);if(l){a&&void 0!==a.startLine&&(a.endLine=n-1,a.content=t.slice(a.startLine,n).join("\n"),e.push(a)),a={type:"function",name:l[1],startLine:n,endLine:n,content:""},r=d;continue}const p=c.match(/^class\s+(\w+)/);if(p){a&&void 0!==a.startLine&&(a.endLine=n-1,a.content=t.slice(a.startLine,n).join("\n"),e.push(a)),a={type:"class",name:p[1],startLine:n,endLine:n,content:""},r=d;continue}const g=c.match(/^([A-Z_][A-Z0-9_]*)\s*=/);if(g&&0===d&&!a){let a=n;for(let e=n+1;e<t.length;e++){const n=t[e],r=n.trim(),i=n.length-n.trimStart().length;if(""===r||0===i&&!r.startsWith("#"))break;a=e}e.push({type:"variable",name:g[1],startLine:n,endLine:a,content:t.slice(n,a+1).join("\n")});continue}a&&d<=r&&""!==c&&!c.startsWith("#")&&(a.endLine=n-1,a.content=t.slice(a.startLine,n).join("\n"),e.push(a),a=null)}return a&&void 0!==a.startLine&&(a.endLine=t.length-1,a.content=t.slice(a.startLine).join("\n"),e.push(a)),e}categorizeComponents(n){const e={stockSelection:[],timing:[],riskControl:[],execution:[],utilities:[]};for(const t of n){const n=t.name.toLowerCase(),a=t.content.toLowerCase();n.includes("select")||n.includes("filter")||n.includes("stock")||a.includes("é€‰è‚¡")||a.includes("stock_pool")||a.includes("get_index_stocks")?(t.category="selection",e.stockSelection.push(t)):n.includes("timing")||n.includes("signal")||n.includes("market")||a.includes("æ‹©æ—¶")||a.includes("ä¿¡å·")||a.includes("è¶‹åŠ¿")?(t.category="timing",e.timing.push(t)):n.includes("risk")||n.includes("stop")||n.includes("control")||a.includes("æ­¢æŸ")||a.includes("æ­¢ç›ˆ")||a.includes("é£æ§")?(t.category="risk",e.riskControl.push(t)):n.includes("execute")||n.includes("trade")||n.includes("order")||n.includes("handle_data")||n.includes("rebalance")||a.includes("order")||a.includes("äº¤æ˜“")?(t.category="execution",e.execution.push(t)):(t.category="util",e.utilities.push(t))}return e}analyzeDependencies(n,e){const s=[],o=[],c=[],d=[],l=n.matchAll(/^(?:from\s+(\S+)\s+)?import\s+(.+)$/gm);for(const n of l)n[1]?d.push(`${n[1]}.${n[2]}`):d.push(n[2]);for(const a of t){let t;for(;null!==(t=a.pattern.exec(n));){const r=n.substring(0,t.index).split("\n").length,i=e[r-1]||"";s.push({name:a.name,platform:"joinquant",line:r,params:{},context:i.trim(),canConvert:!0})}a.pattern.lastIndex=0}for(const t of a){let a;for(;null!==(a=t.pattern.exec(n));){const r=n.substring(0,a.index).split("\n").length,i=e[r-1]||"";s.push({name:t.name,platform:"ptrade",line:r,params:{},context:i.trim(),canConvert:!0})}t.pattern.lastIndex=0}const p=new Set;for(const e of r)e.pattern.test(n)&&(p.has(e.name)||(p.add(e.name),o.push({name:e.name,type:e.type}))),e.pattern.lastIndex=0;const g=new Set;for(const e of i)e.pattern.test(n)&&(g.has(e.name)||(g.add(e.name),c.push({name:e.name,type:e.type}))),e.pattern.lastIndex=0;return{apis:s,factors:o,indicators:c,imports:d}}calculateCompatibility(n){const e=n.filter(n=>"joinquant"===n.platform),t=n.filter(n=>"ptrade"===n.platform);let a="joinquant";t.length>e.length&&(a="ptrade");const r=n=>{if(n===a)return{score:100,level:"full",issues:[],suggestions:[]};const r=[],i="joinquant"===a?e:t;for(const e of i)this.hasAPIMapping(e.name,a,n)?r.push({severity:"info",line:e.line,message:`API '${e.name}' å¯è‡ªåŠ¨è½¬æ¢`,api:e.name,suggestion:"å°†è‡ªåŠ¨è½¬æ¢ä¸ºå¯¹åº”API"}):r.push({severity:"error",line:e.line,message:`API '${e.name}' åœ¨ ${n} ä¸­æ²¡æœ‰ç›´æ¥å¯¹åº”`,api:e.name,suggestion:"éœ€è¦æ‰‹åŠ¨å®ç°æˆ–å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆ"});const s=r.filter(n=>"error"===n.severity).length,o=i.length||1,c=Math.max(0,100-s/o*100);let d;return d=c>=95?"full":c>=80?"high":c>=60?"medium":c>=30?"low":"none",{score:Math.round(c),level:d,issues:r,suggestions:this.generateSuggestions(r,n)}};return{sourcePlatform:a,joinquant:r("joinquant"),ptrade:r("ptrade"),qmt:r("qmt")}}hasAPIMapping(n,e,t){const a={get_price:{joinquant:"get_price",ptrade:"get_history",qmt:"ContextInfo.get_market_data"},get_current_data:{joinquant:"get_current_data",ptrade:"get_snapshot",qmt:"ContextInfo.get_full_tick"},order_target_value:{joinquant:"order_target_value",ptrade:"order_target_percent",qmt:"order_target_volume"},order:{joinquant:"order",ptrade:"order_lots",qmt:"order_volume"},set_benchmark:{joinquant:"set_benchmark",ptrade:null,qmt:null},"log.info":{joinquant:"log.info",ptrade:"print",qmt:"print"},run_daily:{joinquant:"run_daily",ptrade:null,qmt:null},get_index_stocks:{joinquant:"get_index_stocks",ptrade:null,qmt:"ContextInfo.get_stock_list_in_sector"}}[n];if(!a)return!1;return null!=a[t]}generateSuggestions(n,e){const t=[],a=n.filter(n=>"error"===n.severity).map(n=>n.api);return 0===a.length?t.push("ä»£ç å¯ç›´æ¥è½¬æ¢ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹"):(t.push(`éœ€è¦å¤„ç† ${a.length} ä¸ªä¸å…¼å®¹çš„APIè°ƒç”¨`),a.includes("run_daily")&&t.push("PTradeä¸æ”¯æŒrun_dailyï¼Œéœ€è¦åœ¨on_barä¸­å®ç°æ—¥é¢‘é€»è¾‘"),a.includes("set_benchmark")&&t.push("PTradeæ— éœ€è®¾ç½®åŸºå‡†ï¼Œå¯åˆ é™¤æ­¤è¡Œ"),"ptrade"===e&&(t.push("éœ€è¦æ·»åŠ  on_bar() ä½œä¸ºå…¥å£å‡½æ•°"),t.push("å»ºè®®æ·»åŠ  initialize() å’Œ before_trading_start() å‡½æ•°"))),t}calculateStats(n,e){const t=n.split("\n"),a=t.length;let r=0,i=0,s=!1;for(const n of t){const e=n.trim();e.startsWith('"""')||e.startsWith("'''")?(s?s=!1:(s=!0,e.length>3&&(e.endsWith('"""')||e.endsWith("'''"))&&(s=!1)),r++):s||e.startsWith("#")||""===e?r++:i++}const o=e.filter(n=>"function"===n.type).length;let c;return c=o<=5&&a<=200?"low":o<=15&&a<=500?"medium":"high",{totalLines:a,codeLines:i,commentLines:r,functionCount:o,classCount:e.filter(n=>"class"===n.type).length,complexity:c}}}e.CodeAnalyzer=s,e.codeAnalyzer=new s},628:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.logger=e.Logger=e.LogLevel=void 0;const o=s(t(398));var c;!function(n){n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.WARN=2]="WARN",n[n.ERROR=3]="ERROR"}(c||(e.LogLevel=c={}));class d{static instance;outputChannel;minLevel=c.INFO;logs=[];maxLogs=1e3;constructor(){this.outputChannel=o.window.createOutputChannel("TRQuant")}static getInstance(){return d.instance||(d.instance=new d),d.instance}setLevel(n){this.minLevel=n}show(){this.outputChannel.show()}debug(n,e,t){this.log(c.DEBUG,n,e,t)}info(n,e,t){this.log(c.INFO,n,e,t)}warn(n,e,t){this.log(c.WARN,n,e,t)}error(n,e,t){this.log(c.ERROR,n,e,t)}log(n,e,t,a){if(n<this.minLevel)return;const r={level:n,message:e,timestamp:new Date,module:t,data:a};this.logs.push(r),this.logs.length>this.maxLogs&&this.logs.shift();const i=c[n].padEnd(5),s=`${r.timestamp.toISOString().substring(11,23)} ${i} ${t?`[${t}]`:""} ${e}${a?` | ${JSON.stringify(a)}`:""}`;this.outputChannel.appendLine(s),n===c.ERROR&&o.window.showErrorMessage(`TRQuant: ${e}`)}getRecentLogs(n=100){return this.logs.slice(-n)}clear(){this.logs=[],this.outputChannel.clear()}dispose(){this.outputChannel.dispose()}}e.Logger=d,e.logger=d.getInstance()},683:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.KnowledgeStore=void 0,e.getKnowledgeStore=function(n){return l||(l=new d(n)),l};const o=s(t(896)),c=s(t(928));class d{dataPath;data;isDirty=!1;constructor(n){this.dataPath=c.join(n,"knowledge.json"),this.data=this.load()}load(){try{if(o.existsSync(this.dataPath)){const n=o.readFileSync(this.dataPath,"utf-8");return JSON.parse(n)}}catch(n){console.error("[KnowledgeStore] åŠ è½½å¤±è´¥:",n)}return this.getDefaultData()}getDefaultData(){return{patterns:this.getBuiltinPatterns(),apiMappings:[],bestPractices:this.getBuiltinBestPractices(),userFeedback:[]}}getBuiltinPatterns(){return[{id:"multi_factor_selection",name:"å¤šå› å­é€‰è‚¡",category:"selection",description:"åŸºäºå¤šä¸ªé‡åŒ–å› å­å¯¹è‚¡ç¥¨è¿›è¡Œç»¼åˆè¯„åˆ†ç­›é€‰",codeTemplate:'\ndef select_stocks_by_factors(stocks, factor_weights):\n    """å¤šå› å­é€‰è‚¡"""\n    scores = {}\n    for stock in stocks:\n        score = 0\n        for factor, weight in factor_weights.items():\n            factor_value = get_factor_value(stock, factor)\n            score += factor_value * weight\n        scores[stock] = score\n    # è¿”å›å¾—åˆ†æœ€é«˜çš„è‚¡ç¥¨\n    return sorted(scores, key=scores.get, reverse=True)\n',effectiveness:85,usageCount:100},{id:"momentum_timing",name:"åŠ¨é‡æ‹©æ—¶",category:"timing",description:"åŸºäºä»·æ ¼åŠ¨é‡åˆ¤æ–­å¸‚åœºè¶‹åŠ¿",codeTemplate:"\ndef check_momentum_signal(index_code, lookback=20):\n    \"\"\"åŠ¨é‡æ‹©æ—¶ä¿¡å·\"\"\"\n    prices = get_price(index_code, count=lookback, fields=['close'])\n    returns = prices['close'].pct_change(lookback-1).iloc[-1]\n    \n    if returns > 0.05:\n        return 'bullish'\n    elif returns < -0.05:\n        return 'bearish'\n    return 'neutral'\n",effectiveness:70,usageCount:80},{id:"fixed_stop_loss",name:"å›ºå®šæ­¢æŸ",category:"risk",description:"å½“äºæŸè¾¾åˆ°é˜ˆå€¼æ—¶è‡ªåŠ¨æ­¢æŸ",codeTemplate:'\ndef check_stop_loss(context, stock, stop_loss_pct=-0.08):\n    """å›ºå®šæ­¢æŸæ£€æŸ¥"""\n    if stock not in context.portfolio.positions:\n        return False\n    \n    position = context.portfolio.positions[stock]\n    cost = position.avg_cost\n    current_price = position.price\n    \n    profit_pct = (current_price - cost) / cost\n    return profit_pct <= stop_loss_pct\n',effectiveness:90,usageCount:150},{id:"trailing_stop",name:"ç§»åŠ¨æ­¢æŸ",category:"risk",description:"æ ¹æ®æœ€é«˜ä»·åŠ¨æ€è°ƒæ•´æ­¢æŸçº¿",codeTemplate:'\ndef check_trailing_stop(context, stock, trail_pct=0.10):\n    """ç§»åŠ¨æ­¢æŸæ£€æŸ¥"""\n    if stock not in g.highest_prices:\n        return False\n    \n    highest = g.highest_prices[stock]\n    current = get_current_data()[stock].last_price\n    \n    # æ›´æ–°æœ€é«˜ä»·\n    if current > highest:\n        g.highest_prices[stock] = current\n        return False\n    \n    # æ£€æŸ¥å›æ’¤\n    drawdown = (highest - current) / highest\n    return drawdown >= trail_pct\n',effectiveness:85,usageCount:90},{id:"equal_weight_execution",name:"ç­‰æƒé‡æ‰§è¡Œ",category:"execution",description:"å¯¹ç›®æ ‡è‚¡ç¥¨è¿›è¡Œç­‰æƒé‡é…ç½®",codeTemplate:'\ndef execute_equal_weight(context, target_stocks, max_position=0.10):\n    """ç­‰æƒé‡æ‰§è¡Œ"""\n    if not target_stocks:\n        return\n    \n    total_value = context.portfolio.total_value\n    weight = min(1.0 / len(target_stocks), max_position)\n    \n    for stock in target_stocks:\n        target_value = total_value * weight\n        order_target_value(stock, target_value)\n',effectiveness:80,usageCount:120},{id:"market_regime_position",name:"å¸‚åœºçŠ¶æ€ä»“ä½ç®¡ç†",category:"risk",description:"æ ¹æ®å¸‚åœºçŠ¶æ€åŠ¨æ€è°ƒæ•´æ€»ä»“ä½",codeTemplate:"\nPOSITION_BY_REGIME = {\n    'risk_on': 0.90,   # ç‰›å¸‚é«˜ä»“ä½\n    'risk_off': 0.50,  # ç†Šå¸‚ä½ä»“ä½\n    'neutral': 0.70,   # éœ‡è¡ä¸­ä»“ä½\n}\n\ndef get_target_position(regime):\n    \"\"\"è·å–ç›®æ ‡ä»“ä½\"\"\"\n    return POSITION_BY_REGIME.get(regime, 0.70)\n",effectiveness:88,usageCount:85}]}getBuiltinBestPractices(){return[{id:"bp_stop_loss",title:"å¿…é¡»è®¾ç½®æ­¢æŸ",category:"é£æ§",description:"ä»»ä½•ç­–ç•¥éƒ½åº”è¯¥æœ‰æ­¢æŸæœºåˆ¶ï¼Œå»ºè®®å•ç¥¨æ­¢æŸçº¿è®¾ç½®åœ¨-8%å·¦å³",example:"\n# æ¨èçš„æ­¢æŸè®¾ç½®\nSTOP_LOSS = -0.08  # 8%æ­¢æŸ\nTAKE_PROFIT = 0.20  # 20%æ­¢ç›ˆ\n\ndef check_risk(context, stock):\n    profit = get_profit_pct(context, stock)\n    if profit <= STOP_LOSS:\n        order_target_value(stock, 0)\n        log.warn(f'æ­¢æŸ: {stock}')\n",references:["é‡åŒ–æŠ•èµ„ç­–ç•¥ä¸æŠ€æœ¯","Aè‚¡é‡åŒ–å®æˆ˜"]},{id:"bp_position_limit",title:"æ§åˆ¶å•ç¥¨ä»“ä½",category:"é£æ§",description:"å•ç¥¨ä»“ä½ä¸å®œè¶…è¿‡æ€»èµ„é‡‘çš„10%ï¼Œé¿å…ä¸ªè‚¡é£é™©é›†ä¸­",example:"\n# æ¨èçš„ä»“ä½æ§åˆ¶\nMAX_SINGLE_POSITION = 0.10  # å•ç¥¨æœ€å¤§10%\nMAX_TOTAL_POSITION = 0.80   # æ€»ä»“ä½æœ€å¤§80%\n\ndef calculate_position(context, stock, score):\n    max_value = context.portfolio.total_value * MAX_SINGLE_POSITION\n    target_value = min(calculated_value, max_value)\n    return target_value\n",references:["ç»„åˆç®¡ç†","é£é™©å¹³ä»·"]},{id:"bp_avoid_st",title:"è¿‡æ»¤STè‚¡ç¥¨",category:"é€‰è‚¡",description:"åœ¨é€‰è‚¡æ± ä¸­æ’é™¤STã€*STè‚¡ç¥¨ï¼Œé¿å…é€€å¸‚é£é™©",example:'\ndef filter_st_stocks(stocks):\n    """è¿‡æ»¤STè‚¡ç¥¨"""\n    current_data = get_current_data()\n    return [s for s in stocks \n            if not current_data[s].is_st \n            and not current_data[s].name.startswith(\'ST\')\n            and not current_data[s].name.startswith(\'*ST\')]\n',references:["Aè‚¡äº¤æ˜“è§„åˆ™"]},{id:"bp_avoid_suspension",title:"è¿‡æ»¤åœç‰Œè‚¡ç¥¨",category:"é€‰è‚¡",description:"äº¤æ˜“å‰æ£€æŸ¥è‚¡ç¥¨æ˜¯å¦åœç‰Œï¼Œé¿å…æ— æ•ˆä¸‹å•",example:'\ndef filter_paused_stocks(stocks):\n    """è¿‡æ»¤åœç‰Œè‚¡ç¥¨"""\n    current_data = get_current_data()\n    return [s for s in stocks \n            if not current_data[s].paused]\n',references:["äº¤æ˜“ç³»ç»Ÿè®¾è®¡"]},{id:"bp_limit_check",title:"æ¶¨è·Œåœæ£€æŸ¥",category:"æ‰§è¡Œ",description:"ä¸‹å•å‰æ£€æŸ¥æ˜¯å¦æ¶¨è·Œåœï¼Œé¿å…æ— æ•ˆå§”æ‰˜",example:'\ndef can_trade(stock):\n    """æ£€æŸ¥æ˜¯å¦å¯äº¤æ˜“"""\n    current_data = get_current_data()\n    data = current_data[stock]\n    \n    # æ¶¨åœä¸èƒ½ä¹°å…¥\n    if data.last_price >= data.high_limit * 0.995:\n        return False, \'buy\'\n    \n    # è·Œåœä¸èƒ½å–å‡º\n    if data.last_price <= data.low_limit * 1.005:\n        return False, \'sell\'\n    \n    return True, None\n',references:["Aè‚¡äº¤æ˜“è§„åˆ™","ç¨‹åºåŒ–äº¤æ˜“"]},{id:"bp_rebalance_frequency",title:"åˆç†çš„è°ƒä»“é¢‘ç‡",category:"æ‰§è¡Œ",description:"è°ƒä»“é¢‘ç‡ä¸å®œè¿‡é«˜ï¼Œå»ºè®®å‘¨é¢‘æˆ–æœˆé¢‘ï¼Œå‡å°‘äº¤æ˜“æˆæœ¬",example:'\n# æ¨èçš„è°ƒä»“è®¾ç½®\nREBALANCE_DAYS = 20  # æœˆåº¦è°ƒä»“\n\ndef should_rebalance(context):\n    """åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒä»“"""\n    if not hasattr(g, \'last_rebalance_date\'):\n        g.last_rebalance_date = context.current_dt.date()\n        return True\n    \n    days_since = (context.current_dt.date() - g.last_rebalance_date).days\n    if days_since >= REBALANCE_DAYS:\n        g.last_rebalance_date = context.current_dt.date()\n        return True\n    \n    return False\n',references:["äº¤æ˜“æˆæœ¬åˆ†æ"]},{id:"bp_logging",title:"å®Œå–„çš„æ—¥å¿—è®°å½•",category:"è°ƒè¯•",description:"è®°å½•å…³é”®æ“ä½œæ—¥å¿—ï¼Œä¾¿äºå›æµ‹åˆ†æå’Œé—®é¢˜æ’æŸ¥",example:'\ndef log_trade(context, stock, action, amount, price):\n    """è®°å½•äº¤æ˜“æ—¥å¿—"""\n    log.info(f\'[{context.current_dt}] {action}: {stock}, \'\n             f\'æ•°é‡: {amount}, ä»·æ ¼: {price:.2f}\')\n\ndef log_daily_summary(context):\n    """è®°å½•æ¯æ—¥æ€»ç»“"""\n    pv = context.portfolio.total_value\n    cash = context.portfolio.cash\n    positions = len(context.portfolio.positions)\n    log.info(f\'æ—¥ç»ˆ: æ€»å€¼={pv:.0f}, ç°é‡‘={cash:.0f}, æŒä»“={positions}åª\')\n',references:["é‡åŒ–ç³»ç»Ÿè®¾è®¡"]}]}save(){try{const n=c.dirname(this.dataPath);o.existsSync(n)||o.mkdirSync(n,{recursive:!0}),o.writeFileSync(this.dataPath,JSON.stringify(this.data,null,2),"utf-8"),this.isDirty=!1}catch(n){console.error("[KnowledgeStore] ä¿å­˜å¤±è´¥:",n)}}autoSave(){this.isDirty&&this.save()}getPatterns(n){return n?this.data.patterns.filter(e=>e.category===n):this.data.patterns}getPatternById(n){return this.data.patterns.find(e=>e.id===n)}addPattern(n){const e=this.data.patterns.findIndex(e=>e.id===n.id);e>=0?this.data.patterns[e]=n:this.data.patterns.push(n),this.isDirty=!0}updatePatternEffectiveness(n,e){const t=this.data.patterns.find(e=>e.id===n);t&&(t.effectiveness=e,t.usageCount++,this.isDirty=!0)}getAPIMappings(){return this.data.apiMappings}addAPIMapping(n){const e=this.data.apiMappings.findIndex(e=>e.source.api===n.source.api&&e.source.platform===n.source.platform&&e.target.platform===n.target.platform);e>=0?this.data.apiMappings[e]=n:this.data.apiMappings.push(n),this.isDirty=!0}getBestPractices(n){return n?this.data.bestPractices.filter(e=>e.category===n):this.data.bestPractices}addBestPractice(n){const e=this.data.bestPractices.findIndex(e=>e.id===n.id);e>=0?this.data.bestPractices[e]=n:this.data.bestPractices.push(n),this.isDirty=!0}getFeedback(n){return void 0!==n?this.data.userFeedback.filter(e=>e.resolved===n):this.data.userFeedback}addFeedback(n){this.data.userFeedback.push(n),this.isDirty=!0}resolveFeedback(n){const e=this.data.userFeedback.find(e=>e.timestamp===n);e&&(e.resolved=!0,this.isDirty=!0)}getStats(){return{patterns:this.data.patterns.length,apiMappings:this.data.apiMappings.length,bestPractices:this.data.bestPractices.length,feedback:{total:this.data.userFeedback.length,resolved:this.data.userFeedback.filter(n=>n.resolved).length,pending:this.data.userFeedback.filter(n=>!n.resolved).length}}}}e.KnowledgeStore=d;let l=null},767:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.ManualLearner=void 0,e.createManualLearner=function(n,e){return new u(n,e)};const o=s(t(896)),c=s(t(928)),d=t(683),l={"ashare-book1":{name:"Aè‚¡æŠ•èµ„åŸºç¡€",chapters:{"001":{name:"Aè‚¡å¸‚åœº",category:"åŸºç¡€çŸ¥è¯†"},"002":{name:"æŠ•èµ„å¿ƒç†",category:"äº¤æ˜“å¿ƒç†"},"003":{name:"é«˜å€è‚¡",category:"é€‰è‚¡ç­–ç•¥"},"004":{name:"è¡Œä¸šåˆ†æ",category:"è¡Œä¸šç ”ç©¶"},"005":{name:"åŸºæœ¬é¢",category:"åŸºæœ¬é¢åˆ†æ"},"006":{name:"é€‰è‚¡ç­›é€‰",category:"é€‰è‚¡ç­–ç•¥"},"007":{name:"äº¤æ˜“æ‰§è¡Œ",category:"äº¤æ˜“æ‰§è¡Œ"},"008":{name:"å·¥å…·ä½¿ç”¨",category:"å·¥å…·"},"009":{name:"æ¡ˆä¾‹åˆ†æ",category:"å®æˆ˜æ¡ˆä¾‹"},"010":{name:"äº¤æ˜“ç³»ç»Ÿ",category:"ç³»ç»Ÿæ„å»º"}}},"ashare-book2":{name:"å®è§‚ç»æµ",chapters:{"001":{name:"ç»æµå‘¨æœŸ",category:"å®è§‚æ‹©æ—¶"},"002":{name:"è´§å¸æ”¿ç­–",category:"æ”¿ç­–åˆ†æ"},"003":{name:"è´¢æ”¿æ”¿ç­–",category:"æ”¿ç­–åˆ†æ"},"004":{name:"è¡Œä¸šè½®åŠ¨",category:"è¡Œä¸šè½®åŠ¨"},"005":{name:"å¸‚åœºæƒ…ç»ª",category:"æƒ…ç»ªåˆ†æ"},"006":{name:"å®è§‚æ•°æ®",category:"æ•°æ®åˆ†æ"},"007":{name:"å…¨çƒå½±å“",category:"å…¨çƒè§†é‡"},"008":{name:"é£é™©ç›‘æ§",category:"é£æ§"},"009":{name:"å®è§‚æ‹©æ—¶",category:"å®è§‚æ‹©æ—¶"},"010":{name:"å®è§‚å·¥å…·",category:"å·¥å…·"}}},"ashare-book3":{name:"ä¸ªè‚¡ç ”ç©¶",chapters:{"001":{name:"ç ”ç©¶æ¡†æ¶",category:"ç ”ç©¶æ–¹æ³•"},"002":{name:"è´¢åŠ¡åˆ†æ",category:"åŸºæœ¬é¢åˆ†æ"},"003":{name:"ä¼°å€¼æ–¹æ³•",category:"ä¼°å€¼"},"004":{name:"è¡Œä¸šé¾™å¤´",category:"é€‰è‚¡ç­–ç•¥"},"005":{name:"æ¶ˆè´¹æ¡ˆä¾‹",category:"è¡Œä¸šç ”ç©¶"},"006":{name:"ç§‘æŠ€æ¡ˆä¾‹",category:"è¡Œä¸šç ”ç©¶"},"007":{name:"å‘¨æœŸæ¡ˆä¾‹",category:"è¡Œä¸šç ”ç©¶"},"008":{name:"é‡‘èæ¡ˆä¾‹",category:"è¡Œä¸šç ”ç©¶"},"009":{name:"åŒ»è¯æ¡ˆä¾‹",category:"è¡Œä¸šç ”ç©¶"},"010":{name:"æŠ¥å‘Šæ’°å†™",category:"ç ”ç©¶æ–¹æ³•"}}},"ashare-book4":{name:"æŠ€æœ¯åˆ†æ",chapters:{"001":{name:"æŠ€æœ¯åˆ†æåŸºç¡€",category:"æŠ€æœ¯åˆ†æ"},"002":{name:"Kçº¿å½¢æ€",category:"æŠ€æœ¯åˆ†æ"},"003":{name:"è¶‹åŠ¿åˆ†æ",category:"æŠ€æœ¯åˆ†æ"},"004":{name:"é‡ä»·å…³ç³»",category:"æŠ€æœ¯åˆ†æ"},"005":{name:"æŠ€æœ¯æŒ‡æ ‡",category:"æŠ€æœ¯æŒ‡æ ‡"}}},"ashare-book5":{name:"é‡åŒ–ä¸“é¢˜",chapters:{"001":{name:"å›æµ‹åŸºç¡€",category:"å›æµ‹"},"002":{name:"JQDataé›†æˆ",category:"æ•°æ®æº"},"003":{name:"éŸ¬ç¿å›æµ‹",category:"å›æµ‹"},"004":{name:"æŠ¥å‘Šåˆ†æ",category:"å›æµ‹åˆ†æ"},"005":{name:"é£é™©æ§åˆ¶",category:"é£æ§"},"006":{name:"PTradeå®ç›˜",category:"å®ç›˜äº¤æ˜“"},"007":{name:"QMTå®ç›˜",category:"å®ç›˜äº¤æ˜“"},"008":{name:"ç­–ç•¥è¿­ä»£",category:"ç­–ç•¥ä¼˜åŒ–"},"009":{name:"æ–‡ä»¶ç®¡ç†",category:"å·¥å…·"},"010":{name:"å®Œæ•´å·¥ä½œæµ",category:"ç³»ç»Ÿæ„å»º"}}},ashare:{name:"Aè‚¡é‡åŒ–æ ¸å¿ƒ",chapters:{"001":{name:"Aè‚¡å¸‚åœº",category:"åŸºç¡€çŸ¥è¯†"},"002":{name:"å› å­æ¡†æ¶",category:"å› å­æŠ•èµ„"},"003":{name:"é«˜å€è‚¡",category:"é€‰è‚¡ç­–ç•¥"},"004":{name:"è¡Œä¸šè½®åŠ¨",category:"è¡Œä¸šè½®åŠ¨"},"005":{name:"å¤šå› å­",category:"å¤šå› å­ç­–ç•¥"},"006":{name:"äº¤æ˜“æ‰§è¡Œ",category:"äº¤æ˜“æ‰§è¡Œ"},"007":{name:"é£é™©æ§åˆ¶",category:"é£æ§"},"008":{name:"å›æµ‹ç³»ç»Ÿ",category:"å›æµ‹"}}}},p=/```python\n([\s\S]*?)```/g,g=/(?:å»ºè®®|æ³¨æ„|æç¤º|æœ€ä½³å®è·µ|æ¨è)[ï¼š:]\s*(.+?)(?:\n|$)/g,m=/(?:æ­¢æŸ|æ­¢ç›ˆ|ä»“ä½|é£æ§)[ï¼š:]?\s*(.+?)(?:\n|$)/gi;class u{store;manualPath;learningLog=[];stats={filesScanned:0,patternsExtracted:0,practicesExtracted:0,codeBlocksFound:0};constructor(n,e){this.store=(0,d.getKnowledgeStore)(n),this.manualPath=e}async learnFromManual(){this.log("å¼€å§‹æ‰«æAè‚¡å®æ“æ‰‹å†Œ...");const n=c.join(this.manualPath,"src","pages");if(!o.existsSync(n))return this.log(`æ‰‹å†Œè·¯å¾„ä¸å­˜åœ¨: ${n}`),{success:!1,stats:this.stats,log:this.learningLog};for(const[e,t]of Object.entries(l)){const a=c.join(n,e);o.existsSync(a)&&await this.scanBookDirectory(a,e,t)}const e=c.join(this.manualPath,"docs");return o.existsSync(e)&&await this.scanDocsDirectory(e),this.store.save(),this.log(`å­¦ä¹ å®Œæˆï¼æ‰«æ${this.stats.filesScanned}ä¸ªæ–‡ä»¶ï¼Œæå–${this.stats.patternsExtracted}ä¸ªæ¨¡å¼ï¼Œ${this.stats.practicesExtracted}ä¸ªæœ€ä½³å®è·µ`),{success:!0,stats:this.stats,log:this.learningLog}}async scanBookDirectory(n,e,t){this.log(`æ‰«æ: ${t.name} (${e})`);const a=this.getAllMarkdownFiles(n);for(const n of a)try{const e=o.readFileSync(n,"utf-8"),a=c.basename(n),r=a.match(/(\d{3})_Chapter(\d+)/),i=r?r[1]:"000",s=t.chapters[i]||{name:"æœªçŸ¥",category:"é€šç”¨"};this.extractKnowledge(e,{source:`${t.name} - ${s.name}`,category:s.category,file:a}),this.stats.filesScanned++}catch(e){this.log(`å¤„ç†æ–‡ä»¶å¤±è´¥ ${n}: ${e}`)}}async scanDocsDirectory(n){this.log("æ‰«ædocsç›®å½•...");const e=o.readdirSync(n).filter(n=>n.endsWith(".md")).map(e=>c.join(n,e));for(const n of e)try{const e=o.readFileSync(n,"utf-8"),t=c.basename(n);this.extractKnowledge(e,{source:`æ–‡æ¡£: ${t}`,category:"å‚è€ƒæ–‡æ¡£",file:t}),this.stats.filesScanned++}catch(n){}}getAllMarkdownFiles(n){const e=[],t=o.readdirSync(n,{withFileTypes:!0});for(const a of t){const t=c.join(n,a.name);a.isDirectory()?e.push(...this.getAllMarkdownFiles(t)):a.name.endsWith(".md")&&e.push(t)}return e}extractKnowledge(n,e){const t=n.matchAll(p);for(const n of t){const t=n[1];this.stats.codeBlocksFound++;const a=t.match(/def\s+(\w+)\s*\([^)]*\):/);if(a){const n=a[1];this.addPatternFromCode(n,t,e)}}const a=n.matchAll(g);for(const n of a){const t=n[1].trim();t.length>10&&t.length<200&&this.addPractice(t,e)}const r=n.matchAll(m);for(const n of r){const t=n[1].trim();t.length>5&&t.length<150&&this.addPractice(t,{...e,category:"é£æ§"})}}addPatternFromCode(n,e,t){let a="execution";n.includes("select")||n.includes("filter")||n.includes("stock")?a="selection":n.includes("stop")||n.includes("risk")||n.includes("position")?a="risk":(n.includes("timing")||n.includes("signal")||n.includes("trend"))&&(a="timing");const r={id:`manual_${n}_${Date.now()}`,name:this.formatFunctionName(n),category:a,description:`ä»${t.source}å­¦ä¹ çš„${"selection"===a?"é€‰è‚¡":"risk"===a?"é£æ§":"timing"===a?"æ‹©æ—¶":"æ‰§è¡Œ"}å‡½æ•°`,codeTemplate:e.trim(),effectiveness:75,usageCount:0};this.store.addPattern(r),this.stats.patternsExtracted++}addPractice(n,e){const t={id:`manual_bp_${Date.now()}_${Math.random().toString(36).slice(2,6)}`,title:n.slice(0,50)+(n.length>50?"...":""),category:e.category,description:n,example:"",references:[e.source]};this.store.addBestPractice(t),this.stats.practicesExtracted++}watchForUpdates(n){const e=c.join(this.manualPath,"src","pages");return o.existsSync(e)?(this.log("å¼€å§‹ç›‘å¬æ‰‹å†Œæ›´æ–°..."),o.watch(e,{recursive:!0},(t,a)=>{if(a&&a.endsWith(".md")){this.log(`æ£€æµ‹åˆ°æ›´æ–°: ${a}`);const t=c.join(e,a);if(o.existsSync(t))try{const e=o.readFileSync(t,"utf-8");this.extractKnowledge(e,{source:"æ‰‹å†Œæ›´æ–°",category:"æ›´æ–°å†…å®¹",file:a}),this.store.save(),n&&n(a)}catch(n){this.log(`å¤„ç†æ›´æ–°å¤±è´¥: ${n}`)}}})):null}getChapterKnowledge(n,e){const t=l[n];if(!t)return{patterns:[],practices:[]};const a=t.chapters[e];if(!a)return{patterns:[],practices:[]};const r=`${t.name} - ${a.name}`;return{patterns:this.store.getPatterns().filter(n=>n.description.includes(r)),practices:this.store.getBestPractices().filter(n=>n.references.some(n=>n.includes(r)))}}getStats(){return{...this.stats,knowledgeStore:this.store.getStats()}}formatFunctionName(n){return n.replace(/_/g," ").replace(/([A-Z])/g," $1").trim().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" ")}log(n){const e=`[${(new Date).toISOString()}] ${n}`;this.learningLog.push(e),console.log(`[ManualLearner] ${n}`)}getLearningLog(){return this.learningLog}}e.ManualLearner=u},799:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorHandler=e.ConfigError=e.DataError=e.PythonError=e.TRQuantError=e.ErrorCode=void 0;const o=s(t(398)),c=t(628);var d;!function(n){n[n.UNKNOWN=1e3]="UNKNOWN",n[n.TIMEOUT=1001]="TIMEOUT",n[n.CANCELLED=1002]="CANCELLED",n[n.PYTHON_NOT_FOUND=2e3]="PYTHON_NOT_FOUND",n[n.PYTHON_EXECUTION_ERROR=2001]="PYTHON_EXECUTION_ERROR",n[n.BRIDGE_CONNECTION_ERROR=2002]="BRIDGE_CONNECTION_ERROR",n[n.BRIDGE_RESPONSE_PARSE_ERROR=2003]="BRIDGE_RESPONSE_PARSE_ERROR",n[n.DATA_NOT_AVAILABLE=3e3]="DATA_NOT_AVAILABLE",n[n.DATA_PARSE_ERROR=3001]="DATA_PARSE_ERROR",n[n.DATA_VALIDATION_ERROR=3002]="DATA_VALIDATION_ERROR",n[n.CONFIG_INVALID=4e3]="CONFIG_INVALID",n[n.CONFIG_MISSING=4001]="CONFIG_MISSING",n[n.MCP_CONNECTION_ERROR=5e3]="MCP_CONNECTION_ERROR",n[n.MCP_TOOL_NOT_FOUND=5001]="MCP_TOOL_NOT_FOUND",n[n.MCP_EXECUTION_ERROR=5002]="MCP_EXECUTION_ERROR"}(d||(e.ErrorCode=d={}));class l extends Error{code;details;timestamp;constructor(n,e,t){super(e),this.name="TRQuantError",this.code=n,this.details=t,this.timestamp=new Date,Object.setPrototypeOf(this,l.prototype)}toUserMessage(){return{[d.UNKNOWN]:"å‘ç”ŸæœªçŸ¥é”™è¯¯",[d.TIMEOUT]:"æ“ä½œè¶…æ—¶ï¼Œè¯·é‡è¯•",[d.CANCELLED]:"æ“ä½œå·²å–æ¶ˆ",[d.PYTHON_NOT_FOUND]:"Pythonè§£é‡Šå™¨æœªæ‰¾åˆ°ï¼Œè¯·æ£€æŸ¥é…ç½®",[d.PYTHON_EXECUTION_ERROR]:"Pythonæ‰§è¡Œé”™è¯¯",[d.BRIDGE_CONNECTION_ERROR]:"æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡",[d.BRIDGE_RESPONSE_PARSE_ERROR]:"åç«¯å“åº”è§£æå¤±è´¥",[d.DATA_NOT_AVAILABLE]:"æ•°æ®ä¸å¯ç”¨",[d.DATA_PARSE_ERROR]:"æ•°æ®è§£æå¤±è´¥",[d.DATA_VALIDATION_ERROR]:"æ•°æ®éªŒè¯å¤±è´¥",[d.CONFIG_INVALID]:"é…ç½®æ— æ•ˆ",[d.CONFIG_MISSING]:"ç¼ºå°‘å¿…è¦é…ç½®",[d.MCP_CONNECTION_ERROR]:"MCPæœåŠ¡è¿æ¥å¤±è´¥",[d.MCP_TOOL_NOT_FOUND]:"MCPå·¥å…·æœªæ‰¾åˆ°",[d.MCP_EXECUTION_ERROR]:"MCPå·¥å…·æ‰§è¡Œå¤±è´¥"}[this.code]||this.message}toLogString(){return`[${d[this.code]}] ${this.message}${this.details?` | Details: ${JSON.stringify(this.details)}`:""}`}}e.TRQuantError=l,e.PythonError=class extends l{constructor(n,e){super(d.PYTHON_EXECUTION_ERROR,n,e),this.name="PythonError"}},e.DataError=class extends l{constructor(n,e,t){super(n,e,t),this.name="DataError"}},e.ConfigError=class extends l{constructor(n,e){super(d.CONFIG_INVALID,n,e),this.name="ConfigError"}};class p{static handle(n,e){const t=e||"ErrorHandler";n instanceof l?(c.logger.error(n.toLogString(),t),o.window.showErrorMessage(n.toUserMessage())):n instanceof Error?(c.logger.error(n.message,t,{stack:n.stack}),o.window.showErrorMessage(`TRQuant: ${n.message}`)):(c.logger.error(String(n),t),o.window.showErrorMessage("TRQuant: å‘ç”ŸæœªçŸ¥é”™è¯¯"))}static async wrap(n,e){try{return await n()}catch(n){return void p.handle(n,e)}}static async withRetry(n,e=3,t=1e3,a){let r;for(let i=0;i<e;i++)try{return await n()}catch(n){r=n,c.logger.warn(`æ“ä½œå¤±è´¥ï¼Œç¬¬${i+1}æ¬¡é‡è¯•...`,a,{error:n instanceof Error?n.message:String(n)}),i<e-1&&await new Promise(n=>setTimeout(n,t))}throw r}static validateRequired(n,e){const t=e.filter(e=>void 0===n[e]||null===n[e]);if(t.length>0)throw new l(d.DATA_VALIDATION_ERROR,`ç¼ºå°‘å¿…éœ€å‚æ•°: ${t.join(", ")}`,{missing:t,provided:Object.keys(n)})}}e.ErrorHandler=p},857:n=>{n.exports=require("os")},879:(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.reportGenerator=e.ReportGenerator=void 0;class t{generate(n,e){return{title:`${n.meta.name} - ç­–ç•¥åˆ†ææŠ¥å‘Š`,generatedAt:(new Date).toLocaleString("zh-CN"),version:"1.0.0",investmentPhilosophy:this.generatePhilosophy(n),codeArchitecture:this.generateArchitecture(n),platformCompatibility:this.generateCompatibility(n,e),optimizations:this.generateOptimizations(n),codeQuality:this.generateQuality(n)}}generateMarkdown(n,e){const t=this.generate(n,e);return`# ${t.title}\n\n> ç”Ÿæˆæ—¶é—´: ${t.generatedAt}\n> ç‰ˆæœ¬: ${t.version}\n\n---\n\n## ğŸ“Š æŠ•èµ„ç†å¿µ\n\n### æ ¸å¿ƒé€»è¾‘\n${t.investmentPhilosophy.coreLogic}\n\n### å¸‚åœºé€‚åº”\n${t.investmentPhilosophy.marketAdaptation}\n\n### é£é™©ç®¡ç†\n${t.investmentPhilosophy.riskManagement}\n\n### ç‰¹è‰²äº®ç‚¹\n${t.investmentPhilosophy.uniqueFeatures.map(n=>`- ${n}`).join("\n")}\n\n---\n\n## ğŸ—ï¸ ä»£ç æ¶æ„\n\n### æ¦‚è¿°\n${t.codeArchitecture.overview}\n\n### æ¨¡å—è¯´æ˜\n\n${t.codeArchitecture.modules.map(n=>`\n#### ${n.name}\n- **ç”¨é€”**: ${n.purpose}\n- **å¤æ‚åº¦**: ${n.complexity}\n- **å‡½æ•°**: ${n.functions.join(", ")}\n- **ä¾èµ–**: ${n.dependencies.join(", ")||"æ— "}\n`).join("\n")}\n\n### æµç¨‹å›¾\n\n\`\`\`mermaid\n${t.codeArchitecture.flowChart}\n\`\`\`\n\n### æ•°æ®æµ\n\n\`\`\`mermaid\n${t.codeArchitecture.dataFlow}\n\`\`\`\n\n---\n\n## ğŸ”„ å¹³å°å…¼å®¹æ€§\n\n${t.platformCompatibility.summary}\n\n| å¹³å° | å…¼å®¹åº¦ | ç­‰çº§ | éœ€ä¿®æ”¹ | å¤‡æ³¨ |\n|------|--------|------|--------|------|\n${Object.entries(t.platformCompatibility.details).map(([n,e])=>`| ${n} | ${e.score}% | ${e.level} | ${e.changes}å¤„ | ${e.notes.join("; ")} |`).join("\n")}\n\n---\n\n## ğŸ’¡ ä¼˜åŒ–å»ºè®®\n\n### æ€§èƒ½ä¼˜åŒ–\n${t.optimizations.performance.map(n=>this.formatOptimization(n)).join("\n")}\n\n### é£æ§ä¼˜åŒ–\n${t.optimizations.risk.map(n=>this.formatOptimization(n)).join("\n")}\n\n### ä»£ç å¯è¯»æ€§\n${t.optimizations.readability.map(n=>this.formatOptimization(n)).join("\n")}\n\n### å¹³å°é€‚é…\n${t.optimizations.platform.map(n=>this.formatOptimization(n)).join("\n")}\n\n---\n\n## ğŸ“ˆ ä»£ç è´¨é‡\n\n**æ€»åˆ†: ${t.codeQuality.score}/100**\n\n| æŒ‡æ ‡ | å¾—åˆ† |\n|------|------|\n| å¯ç»´æŠ¤æ€§ | ${t.codeQuality.metrics.maintainability}/100 |\n| å¯æµ‹è¯•æ€§ | ${t.codeQuality.metrics.testability}/100 |\n| æ–‡æ¡£å®Œæ•´æ€§ | ${t.codeQuality.metrics.documentation}/100 |\n| å¤æ‚åº¦æ§åˆ¶ | ${t.codeQuality.metrics.complexity}/100 |\n\n### æ”¹è¿›å»ºè®®\n${t.codeQuality.suggestions.map(n=>`- ${n}`).join("\n")}\n\n---\n\n*æŠ¥å‘Šç”± TRQuant Strategy Optimizer è‡ªåŠ¨ç”Ÿæˆ*\n`}generateHTML(n,e){const t=this.generate(n,e);return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>${t.title}</title>\n    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"><\/script>\n    <style>\n        :root {\n            --primary: #6366f1;\n            --secondary: #8b5cf6;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --bg: #0f172a;\n            --card-bg: #1e293b;\n            --text: #e2e8f0;\n            --text-muted: #94a3b8;\n        }\n        \n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n            background: var(--bg);\n            color: var(--text);\n            line-height: 1.6;\n            padding: 2rem;\n        }\n        \n        .container {\n            max-width: 1200px;\n            margin: 0 auto;\n        }\n        \n        h1 {\n            font-size: 2.5rem;\n            background: linear-gradient(135deg, var(--primary), var(--secondary));\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            margin-bottom: 0.5rem;\n        }\n        \n        .meta {\n            color: var(--text-muted);\n            margin-bottom: 2rem;\n        }\n        \n        h2 {\n            font-size: 1.5rem;\n            color: var(--primary);\n            margin: 2rem 0 1rem;\n            display: flex;\n            align-items: center;\n            gap: 0.5rem;\n        }\n        \n        h3 {\n            font-size: 1.2rem;\n            margin: 1.5rem 0 0.5rem;\n        }\n        \n        .card {\n            background: var(--card-bg);\n            border-radius: 12px;\n            padding: 1.5rem;\n            margin-bottom: 1.5rem;\n            border: 1px solid rgba(255,255,255,0.1);\n        }\n        \n        .grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n            gap: 1rem;\n        }\n        \n        table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 1rem 0;\n        }\n        \n        th, td {\n            padding: 0.75rem;\n            text-align: left;\n            border-bottom: 1px solid rgba(255,255,255,0.1);\n        }\n        \n        th {\n            background: rgba(99,102,241,0.2);\n            font-weight: 600;\n        }\n        \n        .badge {\n            display: inline-block;\n            padding: 0.25rem 0.75rem;\n            border-radius: 9999px;\n            font-size: 0.75rem;\n            font-weight: 600;\n        }\n        \n        .badge-success { background: rgba(16,185,129,0.2); color: var(--success); }\n        .badge-warning { background: rgba(245,158,11,0.2); color: var(--warning); }\n        .badge-danger { background: rgba(239,68,68,0.2); color: var(--danger); }\n        .badge-info { background: rgba(99,102,241,0.2); color: var(--primary); }\n        \n        .score {\n            font-size: 3rem;\n            font-weight: 700;\n            background: linear-gradient(135deg, var(--primary), var(--secondary));\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n        }\n        \n        .progress {\n            height: 8px;\n            background: rgba(255,255,255,0.1);\n            border-radius: 4px;\n            overflow: hidden;\n            margin-top: 0.5rem;\n        }\n        \n        .progress-bar {\n            height: 100%;\n            background: linear-gradient(90deg, var(--primary), var(--secondary));\n            border-radius: 4px;\n        }\n        \n        ul {\n            list-style-position: inside;\n            margin: 0.5rem 0;\n        }\n        \n        li {\n            margin: 0.25rem 0;\n        }\n        \n        .mermaid {\n            background: rgba(255,255,255,0.05);\n            padding: 1rem;\n            border-radius: 8px;\n            margin: 1rem 0;\n        }\n        \n        .optimization {\n            border-left: 3px solid var(--primary);\n            padding-left: 1rem;\n            margin: 1rem 0;\n        }\n        \n        .optimization.high { border-color: var(--danger); }\n        .optimization.medium { border-color: var(--warning); }\n        .optimization.low { border-color: var(--success); }\n        \n        code {\n            background: rgba(99,102,241,0.2);\n            padding: 0.2rem 0.5rem;\n            border-radius: 4px;\n            font-family: 'Fira Code', monospace;\n            font-size: 0.9em;\n        }\n        \n        pre {\n            background: rgba(0,0,0,0.3);\n            padding: 1rem;\n            border-radius: 8px;\n            overflow-x: auto;\n        }\n        \n        pre code {\n            background: none;\n            padding: 0;\n        }\n    </style>\n</head>\n<body>\n    <div class="container">\n        <h1>${t.title}</h1>\n        <p class="meta">ğŸ“… ${t.generatedAt} | ğŸ”– ç‰ˆæœ¬ ${t.version}</p>\n        \n        \x3c!-- æŠ•èµ„ç†å¿µ --\x3e\n        <h2>ğŸ“Š æŠ•èµ„ç†å¿µ</h2>\n        <div class="grid">\n            <div class="card">\n                <h3>ğŸ¯ æ ¸å¿ƒé€»è¾‘</h3>\n                <p>${t.investmentPhilosophy.coreLogic}</p>\n            </div>\n            <div class="card">\n                <h3>ğŸ“ˆ å¸‚åœºé€‚åº”</h3>\n                <p>${t.investmentPhilosophy.marketAdaptation}</p>\n            </div>\n            <div class="card">\n                <h3>ğŸ›¡ï¸ é£é™©ç®¡ç†</h3>\n                <p>${t.investmentPhilosophy.riskManagement}</p>\n            </div>\n        </div>\n        <div class="card">\n            <h3>âœ¨ ç‰¹è‰²äº®ç‚¹</h3>\n            <ul>\n                ${t.investmentPhilosophy.uniqueFeatures.map(n=>`<li>${n}</li>`).join("")}\n            </ul>\n        </div>\n        \n        \x3c!-- ä»£ç æ¶æ„ --\x3e\n        <h2>ğŸ—ï¸ ä»£ç æ¶æ„</h2>\n        <div class="card">\n            <p>${t.codeArchitecture.overview}</p>\n        </div>\n        \n        <div class="grid">\n            ${t.codeArchitecture.modules.map(n=>`\n            <div class="card">\n                <h3>${n.name}</h3>\n                <p>${n.purpose}</p>\n                <p><span class="badge badge-info">${n.complexity}å¤æ‚åº¦</span></p>\n                <p><strong>å‡½æ•°:</strong> ${n.functions.join(", ")}</p>\n            </div>\n            `).join("")}\n        </div>\n        \n        <div class="card">\n            <h3>æµç¨‹å›¾</h3>\n            <div class="mermaid">\n${t.codeArchitecture.flowChart}\n            </div>\n        </div>\n        \n        \x3c!-- å¹³å°å…¼å®¹æ€§ --\x3e\n        <h2>ğŸ”„ å¹³å°å…¼å®¹æ€§</h2>\n        <div class="card">\n            <p>${t.platformCompatibility.summary}</p>\n            <table>\n                <tr>\n                    <th>å¹³å°</th>\n                    <th>å…¼å®¹åº¦</th>\n                    <th>ç­‰çº§</th>\n                    <th>éœ€ä¿®æ”¹</th>\n                    <th>å¤‡æ³¨</th>\n                </tr>\n                ${Object.entries(t.platformCompatibility.details).map(([n,e])=>`\n                <tr>\n                    <td><strong>${n}</strong></td>\n                    <td>\n                        <div>${e.score}%</div>\n                        <div class="progress"><div class="progress-bar" style="width: ${e.score}%"></div></div>\n                    </td>\n                    <td><span class="badge ${e.score>=80?"badge-success":e.score>=50?"badge-warning":"badge-danger"}">${e.level}</span></td>\n                    <td>${e.changes}å¤„</td>\n                    <td>${e.notes.join("; ")}</td>\n                </tr>\n                `).join("")}\n            </table>\n        </div>\n        \n        \x3c!-- ä¼˜åŒ–å»ºè®® --\x3e\n        <h2>ğŸ’¡ ä¼˜åŒ–å»ºè®®</h2>\n        ${this.renderOptimizationsHTML(t.optimizations)}\n        \n        \x3c!-- ä»£ç è´¨é‡ --\x3e\n        <h2>ğŸ“ˆ ä»£ç è´¨é‡</h2>\n        <div class="card">\n            <div style="text-align: center; margin-bottom: 1rem;">\n                <div class="score">${t.codeQuality.score}</div>\n                <div class="meta">æ€»åˆ† / 100</div>\n            </div>\n            <div class="grid">\n                ${Object.entries(t.codeQuality.metrics).map(([n,e])=>`\n                <div>\n                    <div style="display: flex; justify-content: space-between;">\n                        <span>${this.translateMetric(n)}</span>\n                        <span>${e}/100</span>\n                    </div>\n                    <div class="progress"><div class="progress-bar" style="width: ${e}%"></div></div>\n                </div>\n                `).join("")}\n            </div>\n            <h3 style="margin-top: 1.5rem;">æ”¹è¿›å»ºè®®</h3>\n            <ul>\n                ${t.codeQuality.suggestions.map(n=>`<li>${n}</li>`).join("")}\n            </ul>\n        </div>\n        \n        <p class="meta" style="text-align: center; margin-top: 3rem;">\n            æŠ¥å‘Šç”± TRQuant Strategy Optimizer è‡ªåŠ¨ç”Ÿæˆ\n        </p>\n    </div>\n    \n    <script>\n        mermaid.initialize({ \n            startOnLoad: true,\n            theme: 'dark',\n            themeVariables: {\n                primaryColor: '#6366f1',\n                primaryTextColor: '#e2e8f0',\n                primaryBorderColor: '#4f46e5',\n                lineColor: '#94a3b8',\n                secondaryColor: '#1e293b',\n                tertiaryColor: '#0f172a'\n            }\n        });\n    <\/script>\n</body>\n</html>`}generatePhilosophy(n){const e=n.dependencies.factors,t=n.components.riskControl.length>0,a=n.components.timing.length>0;let r="åŸºäº";const i=[...new Set(e.map(n=>n.type))];if(i.length>0){const n={value:"ä»·å€¼",growth:"æˆé•¿",quality:"è´¨é‡",momentum:"åŠ¨é‡",volatility:"æ³¢åŠ¨"};r+=i.map(e=>n[e]||e).join("+")+"å¤šå› å­æ¨¡å‹"}else r+="é‡åŒ–é€‰è‚¡æ¨¡å‹";r+="ï¼Œç­›é€‰å…·æœ‰æŠ•èµ„ä»·å€¼çš„æ ‡çš„";let s="";s=a?"å…·å¤‡å¸‚åœºæ‹©æ—¶èƒ½åŠ›ï¼Œæ ¹æ®å¸‚åœºè¶‹åŠ¿åŠ¨æ€è°ƒæ•´ä»“ä½":"é‡‡ç”¨å›ºå®šç­–ç•¥ï¼Œé€‚åˆé•¿æœŸæŒæœ‰";let o="";o=t?n.components.riskControl.map(n=>n.name).some(n=>n.includes("stop"))?"è®¾æœ‰æ­¢æŸæ­¢ç›ˆæœºåˆ¶ï¼Œæ§åˆ¶å•ç¥¨é£é™©":"åŒ…å«é£é™©æ§åˆ¶æ¨¡å—ï¼Œç®¡ç†ç»„åˆé£é™©":"å»ºè®®æ·»åŠ é£æ§æ¨¡å—ä»¥æ§åˆ¶ä¸‹è¡Œé£é™©";const c=[];return"low"===n.stats.complexity&&c.push("ä»£ç ç®€æ´ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤"),e.length>=3&&c.push(`å¤šç»´åº¦å› å­è¯„ä¼°ï¼ˆ${e.length}ä¸ªå› å­ï¼‰`),a&&c.push("åŠ¨æ€å¸‚åœºé€‚åº”èƒ½åŠ›"),t&&c.push("å®Œå–„çš„é£é™©æ§åˆ¶ä½“ç³»"),n.dependencies.indicators.length>0&&c.push(`æŠ€æœ¯æŒ‡æ ‡è¾…åŠ©ï¼ˆ${n.dependencies.indicators.map(n=>n.name).join("ã€")}ï¼‰`),{coreLogic:r,marketAdaptation:s,riskManagement:o,uniqueFeatures:c}}generateArchitecture(n){const e=[];n.components.stockSelection.length>0&&e.push({name:"é€‰è‚¡æ¨¡å—",purpose:"æ ¹æ®å› å­ç­›é€‰æŠ•èµ„æ ‡çš„",functions:n.components.stockSelection.map(n=>n.name),dependencies:["æ•°æ®è·å–","å› å­è®¡ç®—"],complexity:n.components.stockSelection.length>3?"high":"medium"}),n.components.timing.length>0&&e.push({name:"æ‹©æ—¶æ¨¡å—",purpose:"åˆ¤æ–­å¸‚åœºè¶‹åŠ¿ï¼Œç”Ÿæˆäº¤æ˜“ä¿¡å·",functions:n.components.timing.map(n=>n.name),dependencies:["å¸‚åœºæ•°æ®","æŠ€æœ¯æŒ‡æ ‡"],complexity:"medium"}),n.components.riskControl.length>0&&e.push({name:"é£æ§æ¨¡å—",purpose:"æ§åˆ¶é£é™©ï¼Œä¿æŠ¤èµ„é‡‘å®‰å…¨",functions:n.components.riskControl.map(n=>n.name),dependencies:["æŒä»“æ•°æ®","ä»·æ ¼æ•°æ®"],complexity:"medium"}),n.components.execution.length>0&&e.push({name:"æ‰§è¡Œæ¨¡å—",purpose:"æ‰§è¡Œäº¤æ˜“æŒ‡ä»¤ï¼Œç®¡ç†æŒä»“",functions:n.components.execution.map(n=>n.name),dependencies:["é€‰è‚¡ç»“æœ","é£æ§æ£€æŸ¥"],complexity:"medium"});const t=this.generateFlowChart(n),a=this.generateDataFlow(n);return{overview:`ç­–ç•¥åŒ…å« ${e.length} ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œ${n.stats.functionCount} ä¸ªå‡½æ•°ï¼Œä»£ç å¤æ‚åº¦ä¸º${"low"===n.stats.complexity?"ä½":"medium"===n.stats.complexity?"ä¸­":"é«˜"}ã€‚`,modules:e,flowChart:t,dataFlow:a}}generateFlowChart(n){return"graph TD\n    A[ç­–ç•¥å¯åŠ¨] --\x3e B[åˆå§‹åŒ–é…ç½®]\n    B --\x3e C{æ¯æ—¥æ‰§è¡Œ}\n    C --\x3e D[æ•°æ®è·å–]\n    D --\x3e E[é€‰è‚¡ç­›é€‰]\n    E --\x3e F[å› å­æ‰“åˆ†]\n    F --\x3e G{é£æ§æ£€æŸ¥}\n    G --\x3e|é€šè¿‡| H[æ‰§è¡Œäº¤æ˜“]\n    G --\x3e|ä¸é€šè¿‡| I[è°ƒæ•´æŒä»“]\n    H --\x3e J[è®°å½•æ—¥å¿—]\n    I --\x3e J\n    J --\x3e C\n    \n    style A fill:#6366f1,stroke:#4f46e5,color:#fff\n    style H fill:#10b981,stroke:#059669,color:#fff\n    style G fill:#f59e0b,stroke:#d97706,color:#fff"}generateDataFlow(n){return"graph LR\n    subgraph æ•°æ®å±‚\n        A1[è¡Œæƒ…æ•°æ®]\n        A2[è´¢åŠ¡æ•°æ®]\n        A3[æŒä»“æ•°æ®]\n    end\n    \n    subgraph è®¡ç®—å±‚\n        B1[å› å­è®¡ç®—]\n        B2[æŒ‡æ ‡è®¡ç®—]\n        B3[é£é™©è¯„ä¼°]\n    end\n    \n    subgraph å†³ç­–å±‚\n        C1[é€‰è‚¡å†³ç­–]\n        C2[ä»“ä½å†³ç­–]\n        C3[äº¤æ˜“æ‰§è¡Œ]\n    end\n    \n    A1 --\x3e B1\n    A2 --\x3e B1\n    A1 --\x3e B2\n    A3 --\x3e B3\n    B1 --\x3e C1\n    B2 --\x3e C2\n    B3 --\x3e C2\n    C1 --\x3e C3\n    C2 --\x3e C3\n    \n    style A1 fill:#3b82f6,stroke:#2563eb,color:#fff\n    style A2 fill:#3b82f6,stroke:#2563eb,color:#fff\n    style A3 fill:#3b82f6,stroke:#2563eb,color:#fff\n    style C3 fill:#10b981,stroke:#059669,color:#fff"}generateCompatibility(n,e){const t={};for(const e of["joinquant","ptrade","qmt"]){const a=n.compatibility[e];t[e]={score:a.score,level:this.translateLevel(a.level),changes:a.issues.filter(n=>"error"===n.severity).length,notes:a.suggestions.slice(0,2)}}const a=n.compatibility.sourcePlatform;return{summary:`å½“å‰ä»£ç åŸºäº ${a.toUpperCase()} å¹³å°å¼€å‘ã€‚å¯ç›´æ¥åœ¨ ${a} è¿è¡Œï¼Œè½¬æ¢åˆ°å…¶ä»–å¹³å°éœ€è¦è¿›è¡ŒAPIé€‚é…ã€‚`,details:t}}generateOptimizations(n){const e={performance:[],risk:[],readability:[],platform:[]};n.stats.totalLines>500&&e.performance.push({category:"æ€§èƒ½",priority:"medium",title:"ä»£ç é‡è¾ƒå¤§",description:"ç­–ç•¥ä»£ç è¶…è¿‡500è¡Œï¼Œå»ºè®®æ‹†åˆ†æ¨¡å—",impact:"æé«˜ä»£ç å¯ç»´æŠ¤æ€§å’Œæ‰§è¡Œæ•ˆç‡"}),0===n.components.riskControl.length&&e.risk.push({category:"é£æ§",priority:"high",title:"ç¼ºå°‘é£æ§æ¨¡å—",description:"å»ºè®®æ·»åŠ æ­¢æŸã€æ­¢ç›ˆã€ä»“ä½ç®¡ç†ç­‰é£æ§æœºåˆ¶",impact:"æ§åˆ¶ä¸‹è¡Œé£é™©ï¼Œä¿æŠ¤èµ„é‡‘å®‰å…¨",implementation:"æ·»åŠ  check_risk() å‡½æ•°ï¼Œè®¾ç½®æ­¢æŸçº¿-8%ï¼Œæ­¢ç›ˆçº¿20%"}),n.stats.commentLines<.2*n.stats.codeLines&&e.readability.push({category:"æ–‡æ¡£",priority:"low",title:"æ³¨é‡Šä¸è¶³",description:"ä»£ç æ³¨é‡Šæ¯”ä¾‹ä½äº20%ï¼Œå»ºè®®å¢åŠ æ³¨é‡Š",impact:"æé«˜ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§"});for(const t of["ptrade","qmt"]){const a=n.compatibility[t];a.score<100&&e.platform.push({category:"å¹³å°é€‚é…",priority:a.score<50?"high":"medium",title:`${t.toUpperCase()} é€‚é…`,description:`éœ€è¦ä¿®æ”¹ ${a.issues.filter(n=>"error"===n.severity).length} å¤„APIè°ƒç”¨`,impact:`æ”¯æŒåœ¨ ${t.toUpperCase()} å¹³å°è¿è¡Œ`,implementation:a.suggestions.join("\n")})}return e}generateQuality(n){const e={maintainability:0,testability:0,documentation:0,complexity:0};e.maintainability=Math.min(100,Math.max(0,100-n.stats.totalLines/10+5*n.stats.functionCount-("high"===n.stats.complexity?20:"medium"===n.stats.complexity?10:0))),e.testability=Math.min(100,10*n.stats.functionCount+5*n.components.utilities.length);const t=n.stats.commentLines/n.stats.totalLines;e.documentation=Math.min(100,200*t),e.complexity="low"===n.stats.complexity?90:"medium"===n.stats.complexity?70:50;const a=Math.round((e.maintainability+e.testability+e.documentation+e.complexity)/4),r=[];return e.maintainability<70&&r.push("å»ºè®®æ‹†åˆ†å¤§å‡½æ•°ï¼Œä¿æŒå•ä¸ªå‡½æ•°ä¸è¶…è¿‡50è¡Œ"),e.testability<70&&r.push("å»ºè®®å¢åŠ å·¥å…·å‡½æ•°ï¼Œæé«˜ä»£ç å¤ç”¨æ€§"),e.documentation<70&&r.push("å»ºè®®ä¸ºæ¯ä¸ªå‡½æ•°æ·»åŠ docstringè¯´æ˜"),e.complexity<70&&r.push("å»ºè®®ç®€åŒ–å¤æ‚é€»è¾‘ï¼Œä½¿ç”¨è®¾è®¡æ¨¡å¼é‡æ„"),{score:a,metrics:{maintainability:Math.round(e.maintainability),testability:Math.round(e.testability),documentation:Math.round(e.documentation),complexity:Math.round(e.complexity)},suggestions:r}}formatOptimization(n){return`\n#### ${"high"===n.priority?"ğŸ”´":"medium"===n.priority?"ğŸŸ¡":"ğŸŸ¢"} ${n.title}\n\n- **ä¼˜å…ˆçº§**: ${"high"===n.priority?"é«˜":"medium"===n.priority?"ä¸­":"ä½"}\n- **æè¿°**: ${n.description}\n- **å½±å“**: ${n.impact}\n${n.implementation?`- **å®ç°**: ${n.implementation}`:""}\n`}renderOptimizationsHTML(n){return[{key:"performance",title:"ğŸš€ æ€§èƒ½ä¼˜åŒ–",items:n.performance},{key:"risk",title:"ğŸ›¡ï¸ é£æ§ä¼˜åŒ–",items:n.risk},{key:"readability",title:"ğŸ“– ä»£ç å¯è¯»æ€§",items:n.readability},{key:"platform",title:"ğŸ”„ å¹³å°é€‚é…",items:n.platform}].map(n=>`\n            <div class="card">\n                <h3>${n.title}</h3>\n                ${0===n.items.length?'<p class="meta">æš‚æ— ä¼˜åŒ–å»ºè®®</p>':n.items.map(n=>`\n                    <div class="optimization ${n.priority}">\n                        <h4>${n.title}</h4>\n                        <p>${n.description}</p>\n                        <p class="meta">å½±å“: ${n.impact}</p>\n                        ${n.implementation?`<p><strong>å»ºè®®:</strong> ${n.implementation}</p>`:""}\n                    </div>\n                  `).join("")}\n            </div>\n        `).join("")}translateLevel(n){return{full:"å®Œå…¨å…¼å®¹",high:"é«˜åº¦å…¼å®¹",medium:"éƒ¨åˆ†å…¼å®¹",low:"ä½å…¼å®¹",none:"ä¸å…¼å®¹"}[n]||n}translateMetric(n){return{maintainability:"å¯ç»´æŠ¤æ€§",testability:"å¯æµ‹è¯•æ€§",documentation:"æ–‡æ¡£å®Œæ•´æ€§",complexity:"å¤æ‚åº¦æ§åˆ¶"}[n]||n}}e.ReportGenerator=t,e.reportGenerator=new t},896:n=>{n.exports=require("fs")},900:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.analyzeBacktest=async function(n,e){c.logger.info("æ‰§è¡Œå›æµ‹åˆ†æå‘½ä»¤",l);try{const t=await o.window.showQuickPick([{label:"ğŸ“‚ ä»æ–‡ä»¶å¯¼å…¥",value:"file",description:"é€‰æ‹©å›æµ‹ç»“æœæ–‡ä»¶"},{label:"ğŸ“ æ‰‹åŠ¨è¾“å…¥",value:"manual",description:"è¾“å…¥å…³é”®æŒ‡æ ‡"},{label:"ğŸ“‹ ä»å‰ªè´´æ¿",value:"clipboard",description:"ä»å‰ªè´´æ¿è¯»å–æŒ‡æ ‡"}],{placeHolder:"é€‰æ‹©å›æµ‹æ•°æ®æ¥æº"});if(!t)return;let a;switch(t.value){case"file":a=await async function(){const n=await o.window.showOpenDialog({canSelectMany:!1,filters:{JSONæ–‡ä»¶:["json"],CSVæ–‡ä»¶:["csv"],æ‰€æœ‰æ–‡ä»¶:["*"]},title:"é€‰æ‹©å›æµ‹ç»“æœæ–‡ä»¶"});if(!n||0===n.length)return;const e=n[0].fsPath,t=await o.workspace.fs.readFile(n[0]),a=Buffer.from(t).toString("utf-8");try{if(e.endsWith(".json"))return p(JSON.parse(a));if(e.endsWith(".csv"))return g(a)}catch(n){c.logger.error(`è§£ææ–‡ä»¶å¤±è´¥: ${n}`,l),o.window.showErrorMessage("æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ ¼å¼")}}();break;case"manual":a=await async function(){const n=await o.window.showInputBox({prompt:"æ€»æ”¶ç›Šç‡ (%)",value:"0",validateInput:n=>isNaN(parseFloat(n))?"è¯·è¾“å…¥æ•°å­—":null});if(!n)return;const e=await o.window.showInputBox({prompt:"å¤æ™®æ¯”ç‡",value:"0",validateInput:n=>isNaN(parseFloat(n))?"è¯·è¾“å…¥æ•°å­—":null});if(!e)return;const t=await o.window.showInputBox({prompt:"æœ€å¤§å›æ’¤ (%)",value:"0",validateInput:n=>isNaN(parseFloat(n))?"è¯·è¾“å…¥æ•°å­—":null});if(!t)return;const a=await o.window.showInputBox({prompt:"èƒœç‡ (%)",value:"50",validateInput:n=>isNaN(parseFloat(n))?"è¯·è¾“å…¥æ•°å­—":null});if(!a)return;const r=await o.window.showInputBox({prompt:"äº¤æ˜“æ¬¡æ•°",value:"0",validateInput:n=>isNaN(parseInt(n))?"è¯·è¾“å…¥æ•´æ•°":null});return r?{total_return:parseFloat(n)/100,annual_return:parseFloat(n)/100,sharpe_ratio:parseFloat(e),max_drawdown:parseFloat(t)/100,win_rate:parseFloat(a)/100,trade_count:parseInt(r),profit_loss_ratio:1}:void 0}();break;case"clipboard":a=await async function(){const n=await o.env.clipboard.readText();if(n.trim())try{return p(JSON.parse(n))}catch{try{return g(n)}catch{return void o.window.showErrorMessage("æ— æ³•è§£æå‰ªè´´æ¿å†…å®¹")}}else o.window.showWarningMessage("å‰ªè´´æ¿ä¸ºç©º")}()}if(!a)return void o.window.showWarningMessage("æœªèƒ½è·å–å›æµ‹æ•°æ®");await async function(n,e,t){await o.window.withProgress({location:o.ProgressLocation.Notification,title:"TRQuant",cancellable:!1},async a=>{a.report({message:"åˆ†æå›æµ‹ç»“æœ...",increment:0});const r=await n.analyzeBacktest({backtest_data:{metrics:t}});if(a.report({increment:60}),r.ok&&r.data)u(e,t,r.data);else{const n=function(n){const e=[],t=[];n.total_return<0?(e.push("âš ï¸ ç­–ç•¥äºæŸï¼Œéœ€è¦å…¨é¢æ£€è§†"),t.push("æ£€æŸ¥å…¥åœºä¿¡å·æ˜¯å¦è¿‡äºæ¿€è¿›"),t.push("è€ƒè™‘å¢åŠ æ›´å¤šè¿‡æ»¤æ¡ä»¶")):n.total_return<.1?(e.push("ğŸ’¡ æ”¶ç›Šè¾ƒä½ï¼Œå­˜åœ¨ä¼˜åŒ–ç©ºé—´"),t.push("å°è¯•è°ƒæ•´å› å­æƒé‡")):n.total_return>.5&&e.push("âœ… æ”¶ç›Šè¡¨ç°ä¼˜ç§€"),n.sharpe_ratio<.5?(e.push("âš ï¸ å¤æ™®æ¯”ç‡åä½ï¼Œé£é™©è°ƒæ•´æ”¶ç›Šä¸ä½³"),t.push("å¢åŠ æ­¢æŸæ¡ä»¶æˆ–é™ä½ä»“ä½")):n.sharpe_ratio>2?e.push("âœ… å¤æ™®æ¯”ç‡ä¼˜ç§€ï¼Œç­–ç•¥è´¨é‡é«˜"):e.push("ğŸ’¡ å¤æ™®æ¯”ç‡ä¸€èˆ¬ï¼Œå¯ä»¥ä¼˜åŒ–"),n.max_drawdown>.3?(e.push("âš ï¸ æœ€å¤§å›æ’¤è¿‡å¤§ï¼Œé£æ§éœ€è¦åŠ å¼º"),t.push("é™ä½å•ç¥¨ä»“ä½è‡³5%ä»¥ä¸‹"),t.push("å¢åŠ ç»„åˆåˆ†æ•£åº¦")):n.max_drawdown>.2?(e.push("ğŸ’¡ æœ€å¤§å›æ’¤ä¸­ç­‰ï¼Œå»ºè®®ä¼˜åŒ–"),t.push("è€ƒè™‘å¢åŠ åŠ¨æ€æ­¢æŸ")):e.push("âœ… æœ€å¤§å›æ’¤æ§åˆ¶è‰¯å¥½"),n.win_rate<.4?(e.push("âš ï¸ èƒœç‡åä½"),t.push("ä¼˜åŒ–é€‰è‚¡æ¡ä»¶"),t.push("å¢åŠ ç¡®è®¤ä¿¡å·")):n.win_rate>.6&&e.push("âœ… èƒœç‡è¾ƒé«˜"),n.trade_count<10?(e.push("ğŸ’¡ äº¤æ˜“æ¬¡æ•°è¾ƒå°‘ï¼Œç»Ÿè®¡æ„ä¹‰æœ‰é™"),t.push("å»¶é•¿å›æµ‹å‘¨æœŸ")):n.trade_count>500&&(e.push("ğŸ’¡ äº¤æ˜“é¢‘ç¹ï¼Œæ³¨æ„äº¤æ˜“æˆæœ¬"),t.push("è€ƒè™‘é™ä½æ¢ä»“é¢‘ç‡"));const a=m(n);return a>=80?e.unshift("ğŸ† ç­–ç•¥ç»¼åˆè¯„åˆ†: ä¼˜ç§€ ("+a+"/100)"):a>=60?e.unshift("ğŸ“Š ç­–ç•¥ç»¼åˆè¯„åˆ†: è‰¯å¥½ ("+a+"/100)"):a>=40?e.unshift("ğŸ“‹ ç­–ç•¥ç»¼åˆè¯„åˆ†: ä¸€èˆ¬ ("+a+"/100)"):e.unshift("âš ï¸ ç­–ç•¥ç»¼åˆè¯„åˆ†: è¾ƒå·® ("+a+"/100)"),{metrics:n,trades:[],diagnosis:e,suggestions:t.length>0?t:["ç­–ç•¥è¡¨ç°è‰¯å¥½ï¼Œä¿æŒè§‚å¯Ÿ"]}}(t);u(e,t,n)}a.report({increment:40})})}(n,e,a)}catch(n){d.ErrorHandler.handle(n,l)}};const o=s(t(398)),c=t(628),d=t(799),l="AnalyzeBacktest";function p(n){return{total_return:n.total_return??n.totalReturn??n.return??0,annual_return:n.annual_return??n.annualReturn??n.cagr??0,sharpe_ratio:n.sharpe_ratio??n.sharpeRatio??n.sharpe??0,max_drawdown:n.max_drawdown??n.maxDrawdown??n.mdd??0,win_rate:n.win_rate??n.winRate??0,trade_count:n.trade_count??n.tradeCount??n.trades??0,profit_loss_ratio:n.profit_loss_ratio??n.plRatio??1}}function g(n){const e=n.trim().split("\n"),t={};for(const n of e){const[e,a]=n.split(/[,\t:=]/);e&&a&&(t[e.trim().toLowerCase().replace(/\s+/g,"_")]=parseFloat(a.trim()))}return p(t)}function m(n){let e=50;return n.total_return>.5?e+=30:n.total_return>.2?e+=20:n.total_return>0?e+=10:e-=20,n.sharpe_ratio>2?e+=25:n.sharpe_ratio>1?e+=15:n.sharpe_ratio>.5?e+=5:e-=10,n.max_drawdown<.1?e+=25:n.max_drawdown<.2?e+=15:n.max_drawdown<.3?e+=5:e-=15,n.win_rate>.6?e+=20:n.win_rate>.5?e+=10:n.win_rate>.4?e+=0:e-=10,Math.max(0,Math.min(100,e))}function u(n,e,t){const a=o.window.createWebviewPanel("trquantBacktestAnalysis","ğŸ“Š å›æµ‹åˆ†ææŠ¥å‘Š",o.ViewColumn.Beside,{enableScripts:!0});a.webview.html=function(n,e){const t=m(n),a=t>=80?"#10b981":t>=60?"#f59e0b":"#ef4444";return`<!DOCTYPE html>\n<html lang="zh">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>å›æµ‹åˆ†ææŠ¥å‘Š</title>\n    <style>\n        :root {\n            --bg-primary: #1a1a2e;\n            --bg-secondary: #252540;\n            --bg-tertiary: #2d2d4a;\n            --text-primary: #ffffff;\n            --text-secondary: #9ca3af;\n            --primary: #667eea;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --border: #3d3d5c;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n            line-height: 1.6;\n        }\n\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border);\n        }\n\n        .header-title {\n            font-size: 24px;\n            font-weight: 600;\n        }\n\n        .score-badge {\n            width: 80px;\n            height: 80px;\n            border-radius: 50%;\n            background: ${a}22;\n            border: 3px solid ${a};\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n        }\n\n        .score-value {\n            font-size: 28px;\n            font-weight: 700;\n            color: ${a};\n        }\n\n        .score-label {\n            font-size: 12px;\n            color: var(--text-secondary);\n        }\n\n        .metrics-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n            gap: 16px;\n            margin-bottom: 24px;\n        }\n\n        .metric-card {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            text-align: center;\n            border: 1px solid var(--border);\n        }\n\n        .metric-value {\n            font-size: 24px;\n            font-weight: 700;\n            color: var(--primary);\n        }\n\n        .metric-label {\n            color: var(--text-secondary);\n            font-size: 13px;\n            margin-top: 4px;\n        }\n\n        .positive { color: var(--success); }\n        .negative { color: var(--danger); }\n\n        .section {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 20px;\n            margin-bottom: 16px;\n            border: 1px solid var(--border);\n        }\n\n        .section-title {\n            font-size: 15px;\n            font-weight: 600;\n            margin-bottom: 16px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .diagnosis-item, .suggestion-item {\n            padding: 12px 16px;\n            margin-bottom: 8px;\n            background: var(--bg-tertiary);\n            border-radius: 8px;\n            font-size: 14px;\n        }\n\n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 24px;\n        }\n\n        .btn {\n            padding: 12px 24px;\n            border-radius: 10px;\n            border: none;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s;\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n        }\n\n        .btn-primary:hover { background: #5a6fd6; }\n\n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n        }\n\n        .btn-secondary:hover { background: #3d3d5c; }\n\n        .timestamp {\n            text-align: center;\n            color: var(--text-muted);\n            font-size: 12px;\n            margin-top: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div>\n            <div class="header-title">ğŸ“Š å›æµ‹åˆ†ææŠ¥å‘Š</div>\n        </div>\n        <div class="score-badge">\n            <div class="score-value">${t}</div>\n            <div class="score-label">ç»¼åˆè¯„åˆ†</div>\n        </div>\n    </div>\n\n    <div class="metrics-grid">\n        <div class="metric-card">\n            <div class="metric-value ${n.total_return>=0?"positive":"negative"}">\n                ${(100*n.total_return).toFixed(2)}%\n            </div>\n            <div class="metric-label">æ€»æ”¶ç›Š</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">${n.sharpe_ratio.toFixed(2)}</div>\n            <div class="metric-label">å¤æ™®æ¯”ç‡</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value negative">${(100*n.max_drawdown).toFixed(2)}%</div>\n            <div class="metric-label">æœ€å¤§å›æ’¤</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">${(100*n.win_rate).toFixed(1)}%</div>\n            <div class="metric-label">èƒœç‡</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">${n.trade_count}</div>\n            <div class="metric-label">äº¤æ˜“æ¬¡æ•°</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">${n.profit_loss_ratio.toFixed(2)}</div>\n            <div class="metric-label">ç›ˆäºæ¯”</div>\n        </div>\n    </div>\n\n    <div class="section">\n        <div class="section-title">ğŸ” è¯Šæ–­ç»“æœ</div>\n        ${e.diagnosis.map(n=>`<div class="diagnosis-item">${n}</div>`).join("")}\n    </div>\n\n    <div class="section">\n        <div class="section-title">ğŸ’¡ ä¼˜åŒ–å»ºè®®</div>\n        ${e.suggestions.map(n=>`<div class="suggestion-item">${n}</div>`).join("")}\n    </div>\n\n    <div class="actions">\n        <button class="btn btn-primary" onclick="optimizeStrategy()">\n            ğŸš€ ç”Ÿæˆä¼˜åŒ–ç­–ç•¥\n        </button>\n        <button class="btn btn-secondary" onclick="copyReport()">\n            ğŸ“‹ å¤åˆ¶æŠ¥å‘Š\n        </button>\n    </div>\n\n    <div class="timestamp">\n        ç”Ÿæˆæ—¶é—´: ${(new Date).toLocaleString("zh-CN")}\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        function copyReport() {\n            vscode.postMessage({ command: 'copyReport' });\n        }\n        \n        function optimizeStrategy() {\n            vscode.postMessage({ command: 'optimizeStrategy' });\n        }\n    <\/script>\n</body>\n</html>`}(e,t),a.webview.onDidReceiveMessage(async n=>{switch(n.command){case"copyReport":{const n=function(n,e){return`# å›æµ‹åˆ†ææŠ¥å‘Š\n\n## ç»¼åˆè¯„åˆ†: ${m(n)}/100\n\n## å…³é”®æŒ‡æ ‡\n- æ€»æ”¶ç›Š: ${(100*n.total_return).toFixed(2)}%\n- å¤æ™®æ¯”ç‡: ${n.sharpe_ratio.toFixed(2)}\n- æœ€å¤§å›æ’¤: ${(100*n.max_drawdown).toFixed(2)}%\n- èƒœç‡: ${(100*n.win_rate).toFixed(1)}%\n- äº¤æ˜“æ¬¡æ•°: ${n.trade_count}\n- ç›ˆäºæ¯”: ${n.profit_loss_ratio.toFixed(2)}\n\n## è¯Šæ–­ç»“æœ\n${e.diagnosis.map(n=>`- ${n}`).join("\n")}\n\n## ä¼˜åŒ–å»ºè®®\n${e.suggestions.map(n=>`- ${n}`).join("\n")}\n\n---\nç”Ÿæˆæ—¶é—´: ${(new Date).toLocaleString("zh-CN")}\n`}(e,t);await o.env.clipboard.writeText(n),o.window.showInformationMessage("æŠ¥å‘Šå·²å¤åˆ¶åˆ°å‰ªè´´æ¿");break}case"optimizeStrategy":o.commands.executeCommand("trquant.generateStrategy")}},void 0,n.subscriptions)}},902:(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OptimizationAdvisor=void 0,e.createOptimizationAdvisor=function(n){return new r(n)};const a=t(628);class r{knowledgeStore=null;constructor(n){this.knowledgeStore=n||null}setKnowledgeStore(n){this.knowledgeStore=n}generateReport(n){a.logger.info(`ç”Ÿæˆä¼˜åŒ–æŠ¥å‘Š: ${n.name}`,"OptimizationAdvisor");const e=[];e.push(...this.generateRiskAdvices(n)),e.push(...this.generateFactorAdvices(n)),e.push(...this.generateSelectionAdvices(n)),e.push(...this.generateCodeAdvices(n)),this.knowledgeStore&&e.push(...this.getKnowledgeBasedAdvices(n));const t=this.calculateScores(n,e),r=this.generateSummary(n,t,e);return{strategyName:n.name,platform:n.platform,analysisTime:(new Date).toISOString(),overallScore:t.overall,scoreBreakdown:{risk:t.risk,factor:t.factor,selection:t.selection,code:t.code},advices:e.sort((n,e)=>{const t={high:0,medium:1,low:2};return t[n.priority]-t[e.priority]}),summary:r}}generateRiskAdvices(n){const e=[],t=n.riskControl;return t.stopLoss?t.stopLoss>.15&&e.push({id:"risk_stop_loss_tight",category:"risk",priority:"medium",title:"æ”¶ç´§æ­¢æŸçº¿",description:`å½“å‰æ­¢æŸçº¿ ${(100*t.stopLoss).toFixed(0)}% è¿‡äºå®½æ¾`,currentState:`${(100*t.stopLoss).toFixed(0)}%`,suggestedState:"8-12%",impact:"å‡å°‘å•æ¬¡äº¤æ˜“æŸå¤±"}):e.push({id:"risk_stop_loss",category:"risk",priority:"high",title:"æ·»åŠ æ­¢æŸæœºåˆ¶",description:"ç­–ç•¥ç¼ºå°‘æ­¢æŸè®¾ç½®ï¼Œåœ¨å¸‚åœºå¤§å¹…ä¸‹è·Œæ—¶å¯èƒ½é€ æˆé‡å¤§æŸå¤±",suggestedState:"æ­¢æŸçº¿ 8%",codeExample:"# æ­¢æŸè®¾ç½®\nSTOP_LOSS = 0.08  # 8%æ­¢æŸ\n\ndef check_stop_loss(context, stock):\n    cost = context.portfolio.positions[stock].avg_cost\n    price = context.portfolio.positions[stock].price\n    if (cost - price) / cost >= STOP_LOSS:\n        order_target(stock, 0)\n        log.info(f'{stock} è§¦å‘æ­¢æŸ')",impact:"æ˜¾è‘—é™ä½æœ€å¤§å›æ’¤",source:"Aè‚¡å®æ“æ‰‹å†Œ-é£æ§ç¯‡"}),t.takeProfit||e.push({id:"risk_take_profit",category:"risk",priority:"medium",title:"æ·»åŠ æ­¢ç›ˆæœºåˆ¶",description:"å»ºè®®è®¾ç½®åŠ¨æ€æ­¢ç›ˆï¼Œé”å®šåˆ©æ¶¦",suggestedState:"æ­¢ç›ˆçº¿ 20-30%",codeExample:"# æ­¢ç›ˆè®¾ç½®\nTAKE_PROFIT = 0.20  # 20%æ­¢ç›ˆ\n\ndef check_take_profit(context, stock):\n    cost = context.portfolio.positions[stock].avg_cost\n    price = context.portfolio.positions[stock].price\n    if (price - cost) / cost >= TAKE_PROFIT:\n        order_target(stock, 0)\n        log.info(f'{stock} è§¦å‘æ­¢ç›ˆ')",impact:"é”å®šæ”¶ç›Šï¼Œé¿å…åˆ©æ¶¦å›å"}),t.maxPosition||e.push({id:"risk_position",category:"risk",priority:"medium",title:"è®¾ç½®ä»“ä½ä¸Šé™",description:"å»ºè®®è®¾ç½®æœ€å¤§ä»“ä½æ§åˆ¶ï¼Œä¿ç•™ç°é‡‘åº”å¯¹é£é™©",suggestedState:"æœ€å¤§ä»“ä½ 80%",codeExample:"MAX_POSITION = 0.8  # æœ€å¤§ä»“ä½80%",impact:"ä¿ç•™æµåŠ¨æ€§ï¼Œä¾¿äºæŠ„åº•"}),t.hasDrawdownControl||e.push({id:"risk_drawdown",category:"risk",priority:"low",title:"æ·»åŠ å›æ’¤æ§åˆ¶",description:"å»ºè®®ç›‘æ§ç»„åˆå›æ’¤ï¼Œè§¦å‘é˜ˆå€¼æ—¶é™ä½ä»“ä½",suggestedState:"å›æ’¤è¶…15%å‡ä»“50%",impact:"æ§åˆ¶ç»„åˆçº§åˆ«é£é™©"}),e}generateFactorAdvices(n){const e=[],t=n.factors;0===t.length?e.push({id:"factor_missing",category:"factor",priority:"high",title:"æ·»åŠ é‡åŒ–å› å­",description:"ç­–ç•¥ç¼ºå°‘æ˜ç¡®çš„é‡åŒ–å› å­ï¼Œå»ºè®®ä½¿ç”¨å› å­é€‰è‚¡",suggestedState:"å¤šå› å­ç»„åˆ",codeExample:"# æ¨èå› å­ç»„åˆ\nfactors = {\n    'momentum': 0.3,    # åŠ¨é‡å› å­\n    'value': 0.3,       # ä»·å€¼å› å­\n    'quality': 0.2,     # è´¨é‡å› å­\n    'volatility': 0.2,  # ä½æ³¢å› å­\n}",impact:"æé«˜é€‰è‚¡çš„ç§‘å­¦æ€§å’Œç¨³å®šæ€§",source:"Aè‚¡å®æ“æ‰‹å†Œ-å› å­ç¯‡"}):1===t.length&&e.push({id:"factor_single",category:"factor",priority:"medium",title:"å¢åŠ å› å­å¤šæ ·æ€§",description:`å½“å‰ä»…ä½¿ç”¨ ${t[0].name}ï¼Œå»ºè®®ç»„åˆå¤šå› å­`,currentState:t[0].name,suggestedState:"3-5ä¸ªä½ç›¸å…³å› å­",impact:"é™ä½å•å› å­å¤±æ•ˆé£é™©ï¼Œæé«˜ç¨³å®šæ€§"});const a={};for(const n of t)a[n.type]=(a[n.type]||0)+1;return t.length>=2&&1===Object.keys(a).length&&e.push({id:"factor_diversity",category:"factor",priority:"medium",title:"å¢åŠ å› å­ç±»å‹å¤šæ ·æ€§",description:"å½“å‰å› å­ç±»å‹å•ä¸€ï¼Œå»ºè®®æ··åˆä¸åŒç±»å‹å› å­",currentState:`å…¨éƒ¨ä¸º${t[0].type}ç±»å‹`,suggestedState:"åŠ¨é‡+ä»·å€¼+è´¨é‡ç»„åˆ",impact:"å› å­äº’è¡¥ï¼Œé€‚åº”ä¸åŒå¸‚åœºç¯å¢ƒ"}),e}generateSelectionAdvices(n){const e=[],t=n.stockSelection;return"æœªçŸ¥"!==t.universe&&"å…¨å¸‚åœº"!==t.universe||e.push({id:"selection_universe",category:"selection",priority:"medium",title:"ç¼©å°è‚¡ç¥¨æ± èŒƒå›´",description:"å…¨å¸‚åœºé€‰è‚¡å¯èƒ½åŒ…å«æµåŠ¨æ€§å·®çš„è‚¡ç¥¨",suggestedState:"æ²ªæ·±300/ä¸­è¯500æˆåˆ†è‚¡",impact:"æé«˜æµåŠ¨æ€§ï¼Œé™ä½å†²å‡»æˆæœ¬"}),t.topN&&t.topN>30?e.push({id:"selection_topn_reduce",category:"selection",priority:"low",title:"å‡å°‘æŒè‚¡æ•°é‡",description:`å½“å‰æŒè‚¡${t.topN}åªï¼Œå¯èƒ½è¿‡äºåˆ†æ•£`,currentState:`${t.topN}åª`,suggestedState:"10-20åª",impact:"æé«˜é€‰è‚¡é›†ä¸­åº¦å’Œæ”¶ç›Šå¼¹æ€§"}):t.topN&&t.topN<5&&e.push({id:"selection_topn_increase",category:"selection",priority:"high",title:"å¢åŠ æŒè‚¡æ•°é‡",description:`å½“å‰æŒè‚¡${t.topN}åªï¼Œé£é™©è¿‡äºé›†ä¸­`,currentState:`${t.topN}åª`,suggestedState:"5-10åª",impact:"åˆ†æ•£é£é™©ï¼Œé™ä½æ³¢åŠ¨"}),t.filters.includes("æ’é™¤ST")||e.push({id:"selection_filter_st",category:"selection",priority:"medium",title:"æ’é™¤STè‚¡ç¥¨",description:"å»ºè®®è¿‡æ»¤ST/*STè‚¡ç¥¨ï¼Œé¿å…é€€å¸‚é£é™©",codeExample:"# æ’é™¤STè‚¡ç¥¨\nstocks = [s for s in stocks if not get_extras('is_st', s)]",impact:"é™ä½è¸©é›·é£é™©"}),e}generateCodeAdvices(n){const e=[];for(const t of n.issues)"code"===t.category&&e.push({id:`code_${t.message.replace(/\s+/g,"_").toLowerCase()}`,category:"code",priority:"error"===t.type?"high":"low",title:t.message,description:t.suggestion||"",impact:"ä»£ç è§„èŒƒæ€§"});return e}getKnowledgeBasedAdvices(n){if(!this.knowledgeStore)return[];const e=[],t=this.knowledgeStore.getBestPractices();for(const a of t.slice(0,5))this.checkPracticeApplied(a,n)||e.push({id:`kb_${a.id}`,category:this.mapPracticeCategory(a.category),priority:"medium",title:a.title,description:a.description,codeExample:a.example,source:a.references?.[0]||"çŸ¥è¯†åº“",impact:"æ¥è‡ªå®æ“ç»éªŒçš„ä¼˜åŒ–å»ºè®®"});return e}checkPracticeApplied(n,e){const t=n.description.toLowerCase();return!(!t.includes("æ­¢æŸ")||!e.riskControl.stopLoss)||!(!t.includes("æ­¢ç›ˆ")||!e.riskControl.takeProfit)||!!(t.includes("å¤šå› å­")&&e.factors.length>=3)}mapPracticeCategory(n){return{risk:"risk",selection:"selection",trading:"performance",position:"risk"}[n]||"performance"}calculateScores(n,e){let t=70,a=70,r=70,i=80;n.riskControl.stopLoss&&(t+=10),n.riskControl.takeProfit&&(t+=5),n.riskControl.maxPosition&&(t+=5),n.riskControl.hasDrawdownControl&&(t+=10),a+=Math.min(10*n.factors.length,30),n.stockSelection.topN&&n.stockSelection.topN>=5&&n.stockSelection.topN<=20&&(r+=10),r+=5*n.stockSelection.filters.length;const s=n.issues.filter(n=>"code"===n.category);i-=20*s.filter(n=>"error"===n.type).length,i-=5*s.filter(n=>"warning"===n.type).length;const o=5*e.filter(n=>"high"===n.priority).length;return{risk:Math.max(0,Math.min(100,t-o)),factor:Math.max(0,Math.min(100,a-o)),selection:Math.max(0,Math.min(100,r-o)),code:Math.max(0,Math.min(100,i)),overall:Math.round((t+a+r+i)/4-o)}}generateSummary(n,e,t){const a=t.filter(n=>"high"===n.priority),r=t.filter(n=>"medium"===n.priority);let i=`ç­–ç•¥ "${n.name}" æ•´ä½“è¯„åˆ† ${e.overall}/100ã€‚`;if(a.length>0){i+=`\n\nğŸ”´ å‘ç° ${a.length} ä¸ªé«˜ä¼˜å…ˆçº§é—®é¢˜éœ€è¦ä¼˜å…ˆå¤„ç†ï¼š`;for(const n of a.slice(0,3))i+=`\n  â€¢ ${n.title}`}r.length>0&&(i+=`\n\nğŸŸ¡ å‘ç° ${r.length} ä¸ªä¸­ç­‰ä¼˜å…ˆçº§ä¼˜åŒ–å»ºè®®ã€‚`);const s=[];return n.riskControl.stopLoss&&n.riskControl.takeProfit&&s.push("é£æ§å®Œå–„"),n.factors.length>=3&&s.push("å¤šå› å­é€‰è‚¡"),n.trading.hasTimingLogic&&s.push("åŒ…å«æ‹©æ—¶é€»è¾‘"),s.length>0&&(i+=`\n\nâœ… ç­–ç•¥äº®ç‚¹ï¼š${s.join("ã€")}`),i}}e.OptimizationAdvisor=r},928:n=>{n.exports=require("path")},974:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.DeveloperProvider=void 0,e.registerDeveloperProvider=function(n){const e=new u(n),t=o.window.createTreeView("trquant-developer",{treeDataProvider:e,showCollapseAll:!1});n.subscriptions.push(t);const a=o.commands.registerCommand("trquant.refreshDeveloper",()=>{e.refresh()});n.subscriptions.push(a),p.logger.info("å¼€å‘è€…åŠŸèƒ½åŒºå·²æ³¨å†Œ",g)},e.localBackup=async function(n){const e=o.workspace.workspaceFolders?.[0];if(!e)return void o.window.showWarningMessage("è¯·å…ˆæ‰“å¼€ä¸€ä¸ªå·¥ä½œåŒº");const t=e.uri.fsPath,a=["node_modules",".git",".backups","venv","__pycache__",".pytest_cache",".vscode",".cursor","*.pyc","*.pyo","*.log","dist","build","*.vsix"];try{await o.window.withProgress({location:o.ProgressLocation.Notification,title:"ğŸ’¾ æœ¬åœ°å¤‡ä»½",cancellable:!1},async n=>{const e=c.join(t,".backups");d.existsSync(e)||d.mkdirSync(e,{recursive:!0});const r=`backup-${(new Date).toISOString().replace(/[:.]/g,"-")}`,i=c.join(e,r);n.report({increment:0,message:"æ­£åœ¨åˆ›å»ºå¤‡ä»½ç›®å½•..."}),d.existsSync(i)||d.mkdirSync(i,{recursive:!0});const s={timestamp:(new Date).toISOString(),projectRoot:t,backupPath:i};d.writeFileSync(c.join(i,"backup-info.json"),JSON.stringify(s,null,2),"utf-8"),n.report({increment:10,message:"æ­£åœ¨å¤åˆ¶æ–‡ä»¶..."}),await async function(n,e,t){const a=n=>t.some(e=>e.includes("*")?new RegExp("^"+e.replace(/\*/g,".*")+"$").test(n):n===e||n.includes(e)),r=async(n,t)=>{const i=d.readdirSync(n,{withFileTypes:!0});for(const s of i){const i=c.join(n,s.name),o=c.join(t,s.name);a(s.name)||i===e||i.startsWith(e+c.sep)||(s.isDirectory()?(d.mkdirSync(o,{recursive:!0}),await r(i,o)):s.isFile()&&d.copyFileSync(i,o))}};await r(n,e)}(t,i,a),n.report({increment:100,message:"å¤‡ä»½å®Œæˆï¼"}),o.window.showInformationMessage(`âœ… æœ¬åœ°å¤‡ä»½å®Œæˆï¼\nå¤‡ä»½ä½ç½®: ${i}`,{modal:!1}),p.logger.info("æœ¬åœ°å¤‡ä»½å®Œæˆ",g,{backupPath:i})})}catch(n){const e=n instanceof Error?n.message:String(n);p.logger.error(`æœ¬åœ°å¤‡ä»½å¤±è´¥: ${e}`,g),o.window.showErrorMessage(`æœ¬åœ°å¤‡ä»½å¤±è´¥: ${e}`)}},e.gitCommit=async function(n){const e=o.workspace.workspaceFolders?.[0];if(!e)return void o.window.showWarningMessage("è¯·å…ˆæ‰“å¼€ä¸€ä¸ªå·¥ä½œåŒº");const t=e.uri.fsPath,a=c.join(t,".git");if(!d.existsSync(a)){if("æ˜¯"!==await o.window.showWarningMessage("å½“å‰ç›®å½•ä¸æ˜¯Gitä»“åº“ï¼Œæ˜¯å¦åˆå§‹åŒ–Gitä»“åº“ï¼Ÿ","æ˜¯","å¦"))return;try{await h("git",["init"],t),o.window.showInformationMessage("âœ… Gitä»“åº“åˆå§‹åŒ–æˆåŠŸ")}catch(n){return void o.window.showErrorMessage(`Gitåˆå§‹åŒ–å¤±è´¥: ${n}`)}}const r=(new Date).toISOString().slice(0,19).replace("T"," "),i=await o.window.showInputBox({prompt:"è¯·è¾“å…¥æäº¤æ¶ˆæ¯",placeHolder:"ä¾‹å¦‚: feat: æ·»åŠ æ–°åŠŸèƒ½",value:`backup: ${r}`});if(i)try{await o.window.withProgress({location:o.ProgressLocation.Notification,title:"ğŸ“ Git Commit",cancellable:!1},async n=>{n.report({increment:0,message:"æ­£åœ¨æ‰§è¡Œ git add..."}),await h("git",["add","-A"],t),p.logger.info("Git add å®Œæˆ",g),n.report({increment:50,message:"æ­£åœ¨æ‰§è¡Œ git commit..."}),await h("git",["commit","-m",i],t),p.logger.info("Git commit å®Œæˆ",g),n.report({increment:100,message:"æäº¤å®Œæˆï¼"}),o.window.showInformationMessage(`âœ… Git Commit å®Œæˆï¼\næäº¤æ¶ˆæ¯: ${i}`,{modal:!1}),p.logger.info("Git Commit å®Œæˆ",g,{commitMessage:i})})}catch(n){const e=n instanceof Error?n.message:String(n);p.logger.error(`Git Commit å¤±è´¥: ${e}`,g),o.window.showErrorMessage(`Git Commit å¤±è´¥: ${e}`)}},e.refreshSystem=async function(n){const e=n.extensionPath;let t=e;const a=c.join(e,"package.json");if(!d.existsSync(a)){const n=c.resolve(e,"../../.."),a=c.join(n,"extension","package.json");if(!d.existsSync(a))return void o.window.showErrorMessage("æ— æ³•æ‰¾åˆ°æ‰©å±•å¼€å‘ç›®å½•ã€‚è¯·åœ¨å¼€å‘æ¨¡å¼ä¸‹ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚");t=c.join(n,"extension")}const r=c.join(t,"package.json");if(d.existsSync(r))try{await o.window.withProgress({location:o.ProgressLocation.Notification,title:"ğŸ”„ åˆ·æ–°ç³»ç»Ÿ",cancellable:!1},async n=>{n.report({increment:0,message:"æ­£åœ¨æ£€æŸ¥ä¾èµ–..."}),p.logger.info("å¼€å§‹åˆ·æ–°ç³»ç»Ÿ",g,{extensionDir:t});try{const e=c.join(t,"node_modules");d.existsSync(e)?p.logger.info("ä¾èµ–å·²å­˜åœ¨ï¼Œè·³è¿‡å®‰è£…",g):(n.report({increment:5,message:"æ­£åœ¨å®‰è£…ä¾èµ–..."}),await v("npm install",t),p.logger.info("ä¾èµ–å®‰è£…å®Œæˆ",g))}catch(n){const e=n instanceof Error?n.message:String(n);p.logger.warn(`ä¾èµ–æ£€æŸ¥/å®‰è£…å¤±è´¥ï¼Œç»§ç»­å°è¯•ç¼–è¯‘: ${e}`,g)}n.report({increment:20,message:"æ­£åœ¨ç¼–è¯‘TypeScript..."});try{try{await v("npm --version",t)}catch(n){throw new Error("npm ä¸å¯ç”¨ï¼Œè¯·ç¡®ä¿å·²å®‰è£… Node.js å’Œ npm")}p.logger.info(`å¼€å§‹ç¼–è¯‘ï¼Œå·¥ä½œç›®å½•: ${t}`,g),await v("npm run compile",t),n.report({increment:40,message:"ç¼–è¯‘å®Œæˆï¼Œæ­£åœ¨æ‰“åŒ…æ‰©å±•..."}),p.logger.info("TypeScriptç¼–è¯‘å®Œæˆ",g)}catch(n){const e=n instanceof Error?n.message:String(n);throw p.logger.error(`ç¼–è¯‘å¤±è´¥: ${e}`,g,{extensionDir:t}),new Error(`ç¼–è¯‘å¤±è´¥: ${e}`)}n.report({increment:60,message:"æ­£åœ¨æ‰“åŒ…æ‰©å±•..."});try{await v("npx @vscode/vsce package --allow-missing-repository --no-dependencies",t),n.report({increment:80,message:"æ‰“åŒ…å®Œæˆï¼Œæ­£åœ¨å®‰è£…æ‰©å±•..."}),p.logger.info("æ‰©å±•æ‰“åŒ…å®Œæˆ",g)}catch(n){const e=n instanceof Error?n.message:String(n);throw new Error(`æ‰“åŒ…å¤±è´¥: ${e}`)}n.report({increment:90,message:"æ­£åœ¨å®‰è£…æ‰©å±•..."});try{const e=d.readdirSync(t).filter(n=>n.endsWith(".vsix")).sort().reverse();if(0===e.length)throw new Error("æœªæ‰¾åˆ°.vsixæ–‡ä»¶");const a=c.join(t,e[0]);await v(`cursor --install-extension "${a}" --force`,t),n.report({increment:100,message:"å®‰è£…å®Œæˆï¼Œå³å°†é‡æ–°åŠ è½½çª—å£..."}),p.logger.info("æ‰©å±•å®‰è£…å®Œæˆ",g)}catch(n){const e=n instanceof Error?n.message:String(n);throw new Error(`å®‰è£…å¤±è´¥: ${e}`)}}),o.window.showInformationMessage("âœ… ç³»ç»Ÿåˆ·æ–°å®Œæˆï¼çª—å£å³å°†é‡æ–°åŠ è½½...",{modal:!1}),setTimeout(()=>{o.commands.executeCommand("workbench.action.reloadWindow")},1e3)}catch(n){const e=n instanceof Error?n.message:String(n);p.logger.error(`åˆ·æ–°ç³»ç»Ÿå¤±è´¥: ${e}`,g),o.window.showErrorMessage(`åˆ·æ–°ç³»ç»Ÿå¤±è´¥: ${e}`)}else o.window.showErrorMessage("æœªæ‰¾åˆ° package.json")};const o=s(t(398)),c=s(t(928)),d=s(t(896)),l=s(t(317)),p=t(628),g="DeveloperProvider";class m extends o.TreeItem{label;collapsibleState;command;icon;constructor(n,e,t,a){super(n,e),this.label=n,this.collapsibleState=e,this.command=t,this.icon=a,this.tooltip=n,this.contextValue=this.getContextValue(),a&&(this.iconPath=new o.ThemeIcon(a))}getContextValue(){return this.label.includes("æœ¬åœ°å¤‡ä»½")?"localBackup":this.label.includes("Git Commit")?"gitCommit":this.label.includes("åˆ·æ–°")?"refresh":""}}class u{context;_onDidChangeTreeData=new o.EventEmitter;onDidChangeTreeData=this._onDidChangeTreeData.event;constructor(n){this.context=n}refresh(){this._onDidChangeTreeData.fire()}getTreeItem(n){return n}getChildren(n){return n?Promise.resolve([]):Promise.resolve([new m("ğŸ’¾ æœ¬åœ°å¤‡ä»½",o.TreeItemCollapsibleState.None,{command:"trquant.localBackup",title:"æœ¬åœ°å¤‡ä»½",arguments:[]},"save"),new m("ğŸ“ Git Commit",o.TreeItemCollapsibleState.None,{command:"trquant.gitCommit",title:"Git Commit",arguments:[]},"git-commit"),new m("ğŸ”„ åˆ·æ–°ç³»ç»Ÿ",o.TreeItemCollapsibleState.None,{command:"trquant.refreshSystem",title:"åˆ·æ–°ç³»ç»Ÿ",arguments:[]},"sync")])}}function h(n,e,t){return new Promise((a,r)=>{const i=l.spawn(n,e,{cwd:t,shell:!1,stdio:["ignore","pipe","pipe"]});let s="",o="";i.stdout?.on("data",n=>{s+=n.toString()}),i.stderr?.on("data",n=>{o+=n.toString()}),i.on("close",n=>{0===n?a(s):r(new Error(`å‘½ä»¤æ‰§è¡Œå¤±è´¥ (é€€å‡ºç : ${n}): ${o||s}`))}),i.on("error",n=>{r(new Error(`å‘½ä»¤æ‰§è¡Œé”™è¯¯: ${n.message}`))})})}function v(n,e){return new Promise((t,a)=>{const r={...process.env,PATH:process.env.PATH||"/usr/local/bin:/usr/bin:/bin",HOME:process.env.HOME||process.env.USERPROFILE};p.logger.info(`æ‰§è¡Œå‘½ä»¤: ${n}`,g,{cwd:e});const i=n.split(/\s+/),s=i[0],o=i.slice(1),c=l.spawn(s,o,{cwd:e,env:r,shell:!0,stdio:["ignore","pipe","pipe"]});let d="",m="";c.stdout?.on("data",n=>{const e=n.toString();d+=e,e.length<200&&p.logger.info(`å‘½ä»¤è¾“å‡º: ${e.trim()}`,g)}),c.stderr?.on("data",n=>{const e=n.toString();m+=e,e.length<200&&p.logger.warn(`å‘½ä»¤è­¦å‘Š: ${e.trim()}`,g)}),c.on("close",r=>{if(0===r)p.logger.info("å‘½ä»¤æ‰§è¡ŒæˆåŠŸ",g,{command:n}),t(d);else{const t=m||d||`é€€å‡ºç : ${r}`;p.logger.error(`å‘½ä»¤æ‰§è¡Œå¤±è´¥ (é€€å‡ºç : ${r})`,g,{command:n,cwd:e,stderr:m.substring(0,500),stdout:d.substring(0,500)}),a(new Error(`å‘½ä»¤æ‰§è¡Œå¤±è´¥ (é€€å‡ºç : ${r}): ${t.substring(0,500)}`))}}),c.on("error",t=>{p.logger.error(`å‘½ä»¤æ‰§è¡Œé”™è¯¯: ${t.message}`,g,{command:n,cwd:e}),a(new Error(`å‘½ä»¤æ‰§è¡Œé”™è¯¯: ${t.message}`))})})}e.DeveloperProvider=u}},e={},t=function t(a){var r=e[a];if(void 0!==r)return r.exports;var i=e[a]={exports:{}};return n[a].call(i.exports,i,i.exports,t),i.exports}(265);module.exports=t})();
//# sourceMappingURL=extension.js.map