# 韬睿量化投资工作流

> 版本: 1.0 | 日期: 2025-12-05 | 作者: TRQuant Team

## 📋 工作流总览

量化投资是一个系统化的决策过程，从信息获取到实盘交易形成完整闭环。本文档定义了韬睿量化平台的8步标准工作流。

```
┌──────────────────────────────────────────────────────────────────────┐
│                      韬睿量化投资工作流                                │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐          │
│  │ 步骤 1  │───▶│ 步骤 2  │───▶│ 步骤 3  │───▶│ 步骤 4  │          │
│  │信息获取 │    │市场趋势 │    │投资主线 │    │候选池   │          │
│  │数据更新 │    │趋势分析 │    │主线抓取 │    │股票筛选 │          │
│  └─────────┘    └─────────┘    └─────────┘    └─────────┘          │
│       │              │              │              │                 │
│       ▼              ▼              ▼              ▼                 │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐          │
│  │ 步骤 5  │◀───│ 步骤 6  │◀───│ 步骤 7  │◀───│ 步骤 8  │          │
│  │因子构建 │    │策略开发 │    │回测验证 │    │实盘交易 │          │
│  │因子分析 │    │代码优化 │    │结果反馈 │    │监控升级 │          │
│  └─────────┘    └─────────┘    └─────────┘    └─────────┘          │
│       │                              ▲              ▲                │
│       └──────────────────────────────┴──────────────┘                │
│                     (迭代优化闭环)                                    │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

---

## 🔄 详细工作流程

### 步骤 1: 📡 信息获取 (Data Acquisition)

**目标**: 更新所有数据库和知识库到最新状态

**输入**:
- 历史行情数据源配置
- 财务数据接口
- 新闻资讯API
- 研报数据库

**处理**:
```
1. 检查数据库连接状态
2. 增量更新行情数据 (日线/分钟线)
3. 同步最新财务报表
4. 抓取市场新闻和研报
5. 更新知识库索引
6. 数据质量校验
```

**输出**:
- 数据更新报告
- 数据完整性指标
- 异常数据告警

**工具**:
- TuShare / AKShare / Wind API
- MongoDB / PostgreSQL
- 知识库向量数据库

---

### 步骤 2: 📈 市场趋势 (Market Analysis)

**目标**: 分析当前市场环境和趋势

**输入**:
- 最新行情数据
- 宏观经济指标
- 市场情绪数据

**处理**:
```
1. 计算主要指数趋势
2. 分析市场 Regime (risk_on / risk_off / neutral)
3. 识别板块轮动方向
4. 计算市场情绪指标
5. 宏观经济因素评估
```

**输出**:
- 市场状态报告
  - market_regime: 当前市场状态
  - trend_direction: 趋势方向
  - volatility_level: 波动率水平
  - sector_rotation: 板块轮动信号
- 风险评估等级

**模型**:
- 趋势跟踪模型
- 波动率模型 (GARCH)
- 情绪指标模型

---

### 步骤 3: 🔥 投资主线 (Investment Themes)

**目标**: 识别当前市场热点和投资主线

**输入**:
- 市场趋势分析结果
- 新闻资讯数据
- 资金流向数据
- 历史主线数据

**处理**:
```
1. 新闻热点聚类分析
2. 资金流向监控
3. 板块强度排名
4. 主线持续性评估
5. LLM辅助主线解读
```

**输出**:
- 投资主线列表
  - name: 主线名称
  - score: 评分 (0-100)
  - industries: 相关行业
  - reasoning: 投资逻辑
  - hot_stocks: 龙头股票
- 主线生命周期阶段

**算法**:
- 文本聚类 (LDA/BERT)
- 资金流分析
- 动量排名

---

### 步骤 4: 📦 候选池构建 (Stock Pool)

**目标**: 基于前序分析构建股票候选池

**输入**:
- 市场状态
- 投资主线
- 全市场股票池
- 基本面数据

**处理**:
```
1. 基础筛选 (ST、停牌、涨跌停过滤)
2. 行业匹配 (基于投资主线)
3. 流动性筛选
4. 基本面初筛
5. 程序化规则筛选
6. LLM辅助优化建议
```

**输出**:
- 候选股票池
  - 初选池 (200-500只)
  - 精选池 (50-100只)
  - 重点关注 (10-30只)
- 每只股票的入池理由

**规则引擎**:
```python
def filter_candidates(universe, mainlines, market_status):
    # 基础过滤
    pool = filter_tradable(universe)
    
    # 行业匹配
    industries = extract_industries(mainlines)
    pool = filter_by_industry(pool, industries)
    
    # 市值筛选 (根据市场状态调整)
    if market_status == 'risk_on':
        pool = filter_by_cap(pool, min_cap=30亿, max_cap=500亿)
    else:
        pool = filter_by_cap(pool, min_cap=100亿)
    
    return pool
```

---

### 步骤 5: 📊 因子构建 (Factor Building)

**目标**: 构建和优化量化因子

**输入**:
- 候选股票池
- 历史行情数据
- 基本面数据
- 市场状态

**处理**:
```
1. 价量因子计算
   - 动量因子
   - 反转因子
   - 波动率因子
   
2. 基本面因子
   - 估值因子 (PE/PB/PS)
   - 质量因子 (ROE/ROA)
   - 成长因子 (营收/利润增速)
   
3. 技术因子
   - 趋势因子
   - 形态因子
   
4. 另类因子
   - 情绪因子
   - 资金流因子
   
5. 因子有效性检验
6. 因子组合优化
7. LLM因子推荐
```

**输出**:
- 因子库
  - factor_name: 因子名称
  - category: 因子类别
  - weight: 推荐权重
  - ic_mean: IC均值
  - ir: 信息比率
  - description: 因子描述

**因子推荐逻辑**:
```python
def recommend_factors(market_regime, candidates):
    if market_regime == 'risk_on':
        # 进攻型因子组合
        return {
            'momentum_20d': 0.3,
            'volume_surge': 0.2,
            'revenue_growth': 0.3,
            'relative_strength': 0.2
        }
    elif market_regime == 'risk_off':
        # 防守型因子组合
        return {
            'low_volatility': 0.3,
            'high_dividend': 0.25,
            'quality': 0.25,
            'value': 0.2
        }
    else:
        # 均衡型因子组合
        return {
            'multi_factor_composite': 0.4,
            'momentum_20d': 0.2,
            'value': 0.2,
            'quality': 0.2
        }
```

---

### 步骤 6: 🛠️ 策略开发 (Strategy Development)

**目标**: 开发和优化量化交易策略

**输入**:
- 候选股票池
- 因子库
- 市场状态
- 交易约束

**处理**:
```
1. 策略框架选择
   - 多因子选股
   - 趋势跟踪
   - 均值回归
   - 事件驱动
   
2. 策略代码生成
   - 初始化配置
   - 选股逻辑
   - 仓位管理
   - 风险控制
   
3. 策略初步优化
   - 参数搜索 (网格/随机)
   - 因子权重优化
   - 止损止盈优化
   
4. 代码质量检查
5. LLM代码优化建议
```

**输出**:
- 策略代码文件 (main.py)
- 策略配置文件 (config.yaml)
- 参数优化报告

**策略模板**:
```python
def initialize(context):
    # 基准设置
    set_benchmark('000300.XSHG')
    
    # 策略参数
    g.stock_num = 10
    g.factors = ['momentum', 'value', 'quality']
    g.rebalance_days = 5
    
    # 风险控制
    g.stop_loss = 0.08
    g.take_profit = 0.20

def handle_data(context, data):
    # 调仓日判断
    if not is_rebalance_day(context):
        return
    
    # 选股
    candidates = select_stocks(context, data)
    
    # 仓位调整
    rebalance_portfolio(context, candidates)
```

---

### 步骤 7: 🔄 回测验证 (Backtesting)

**目标**: 验证策略在历史数据上的表现

**输入**:
- 策略代码
- 历史数据
- 回测配置

**处理**:
```
1. 回测配置
   - 回测区间
   - 初始资金
   - 滑点成本
   - 手续费
   
2. 执行回测
   - 订单撮合
   - 持仓更新
   - 净值计算
   
3. 结果分析
   - 收益指标
   - 风险指标
   - 交易统计
   
4. 稳健性检验
   - Walk-Forward分析
   - 参数敏感性分析
   - 样本外验证
   
5. 结果反馈
   - 生成优化建议
   - 返回策略开发迭代
```

**输出**:
- 回测报告
  - total_return: 总收益率
  - annual_return: 年化收益率
  - sharpe_ratio: 夏普比率
  - max_drawdown: 最大回撤
  - win_rate: 胜率
  - profit_loss_ratio: 盈亏比
- 交易记录
- 持仓变化
- 优化建议

**迭代条件**:
```python
def evaluate_backtest(metrics):
    # 合格标准
    if (metrics['sharpe_ratio'] >= 1.5 and 
        metrics['max_drawdown'] <= 0.20 and
        metrics['annual_return'] >= 0.15):
        return 'PASS'  # 进入下一步
    else:
        return 'ITERATE'  # 返回策略开发优化
```

---

### 步骤 8: 🚀 实盘交易 (Live Trading)

**目标**: 策略部署到实盘交易系统

**子步骤 8.1: 实盘模拟**
```
1. 部署到模拟交易环境
2. 实时信号监控
3. 模拟订单执行
4. 对比理论vs实际
5. 错误检测和修复
```

**子步骤 8.2: 实盘交易**
```
1. 风控参数配置
2. 实盘部署
3. 自动/半自动交易
4. 实时监控
5. 异常告警
```

**子步骤 8.3: 监控升级**
```
1. 每日绩效追踪
2. 策略衰减检测
3. 市场环境变化适应
4. 参数动态调整
5. 策略迭代升级
```

**输出**:
- 实盘交易记录
- 绩效报告
- 风险报告
- 升级日志

**监控指标**:
```python
MONITORING_METRICS = {
    'daily': ['pnl', 'exposure', 'turnover', 'slippage'],
    'weekly': ['sharpe_rolling', 'drawdown', 'factor_exposure'],
    'monthly': ['strategy_decay', 'regime_shift', 'rebalance_signal']
}
```

---

## 🎯 平台功能映射

| 步骤 | 功能模块 | 侧边栏位置 | 主要操作 |
|------|----------|------------|----------|
| 1 | 信息获取 | 📡 数据中心 | 数据更新、质量检查 |
| 2 | 市场趋势 | 📈 市场分析 | 趋势分析、Regime判断 |
| 3 | 投资主线 | 🔥 投资主线 | 主线挖掘、LLM分析 |
| 4 | 候选池 | 📦 候选池 | 股票筛选、规则配置 |
| 5 | 因子构建 | 📊 因子中心 | 因子计算、推荐 |
| 6 | 策略开发 | 🛠️ 策略开发 | 代码生成、优化 |
| 7 | 回测验证 | 🔄 回测中心 | 回测运行、分析 |
| 8 | 实盘交易 | 🚀 交易中心 | 部署、监控 |

---

## 📐 UI布局设计

### 侧边栏结构

```
TRQuant
├── ⚡ 快捷操作
│   ├── 打开工作台
│   ├── 创建项目
│   └── 运行回测
│
├── 📡 1. 数据中心
│   ├── 数据源管理
│   ├── 数据更新
│   └── 质量报告
│
├── 📈 2. 市场分析
│   ├── 市场状态
│   ├── 指数趋势
│   └── 板块轮动
│
├── 🔥 3. 投资主线
│   ├── 热点主线
│   ├── 历史主线
│   └── LLM分析
│
├── 📦 4. 候选池
│   ├── 候选股票
│   ├── 筛选规则
│   └── 关注列表
│
├── 📊 5. 因子中心
│   ├── 因子库
│   ├── 因子检验
│   └── 因子推荐
│
├── 🛠️ 6. 策略开发
│   ├── 策略编辑器
│   ├── 策略优化
│   └── 版本管理
│
├── 🔄 7. 回测中心
│   ├── 回测配置
│   ├── 历史回测
│   └── 对比分析
│
├── 🚀 8. 交易中心
│   ├── 模拟交易
│   ├── 实盘交易
│   └── 监控面板
│
├── 📁 项目资源
│   └── (当前项目文件)
│
└── 🛠️ 开发者工具
    ├── 本地备份
    ├── Git提交
    └── 刷新系统
```

---

## 🔄 数据流

```
[数据源] ──▶ [数据中心] ──▶ [市场分析] ──▶ [投资主线]
                                              │
                                              ▼
[回测中心] ◀── [策略开发] ◀── [因子中心] ◀── [候选池]
     │
     ▼
[交易中心] ──▶ [监控] ──▶ [反馈] ──▶ [迭代优化]
```

---

## ✅ 实施清单

### Phase 1: 核心框架 (优先)
- [x] 工作流文档
- [ ] 侧边栏布局重构
- [ ] 数据中心模块
- [ ] 市场分析模块

### Phase 2: 分析模块
- [ ] 投资主线模块
- [ ] 候选池模块
- [ ] 因子中心模块

### Phase 3: 策略模块
- [x] 策略开发模块 (已有基础)
- [x] 策略优化器 (已实现)
- [ ] 版本管理增强

### Phase 4: 交易模块
- [x] 回测配置 (已有基础)
- [ ] 模拟交易
- [ ] 实盘接口
- [ ] 监控面板

---

*本文档随平台迭代持续更新*










