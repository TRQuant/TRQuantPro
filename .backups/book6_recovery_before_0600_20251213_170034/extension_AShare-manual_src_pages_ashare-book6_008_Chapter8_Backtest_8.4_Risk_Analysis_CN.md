---
title: "8.4 é£é™©åˆ†æ"
description: "æ·±å…¥è§£æé£é™©åˆ†æç³»ç»Ÿï¼ŒåŒ…æ‹¬æœ€å¤§å›æ’¤ã€æ³¢åŠ¨ç‡ã€å¤æ™®æ¯”ç‡ã€ä¿¡æ¯æ¯”ç‡ç­‰æ ¸å¿ƒæŠ€æœ¯"
lang: "zh-CN"
layout: "/src/layouts/HandbookLayout.astro"
currentBook: "ashare-book6"
updateDate: "2025-12-12"
---

# âš ï¸ 8.4 é£é™©åˆ†æ

> **æ ¸å¿ƒæ‘˜è¦ï¼š**
> 
> æœ¬èŠ‚è¯¦ç»†ä»‹ç»TRQuantç³»ç»Ÿçš„é£é™©åˆ†æåŠŸèƒ½ï¼ŒåŸºäºBulletTradeå›æµ‹ç»“æœè¿›è¡Œå…¨é¢çš„é£é™©è¯„ä¼°ã€‚åŒ…æ‹¬æœ€å¤§å›æ’¤ã€æ³¢åŠ¨ç‡ã€å¤æ™®æ¯”ç‡ã€ä¿¡æ¯æ¯”ç‡ã€é£é™©è°ƒæ•´æ”¶ç›Šç­‰å¤šä¸ªç»´åº¦çš„åˆ†æã€‚é€šè¿‡ç†è§£é£é™©åˆ†æçš„æ ¸å¿ƒæŠ€æœ¯ï¼Œå¸®åŠ©å¼€å‘è€…å…¨é¢è¯„ä¼°ç­–ç•¥çš„é£é™©æ°´å¹³ï¼Œè¯†åˆ«é£é™©æ¥æºå’Œé£é™©ç‰¹å¾ï¼Œä¸ºé£é™©æ§åˆ¶æä¾›ä¾æ®ã€‚

é£é™©åˆ†ææ˜¯å›æµ‹åˆ†æçš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œè´Ÿè´£å…¨é¢è¯„ä¼°ç­–ç•¥çš„é£é™©æ°´å¹³ï¼Œä»BulletTradeå›æµ‹ç»“æœä¸­æå–é£é™©æ•°æ®ï¼Œè¿›è¡Œå¤šç»´åº¦åˆ†æã€‚

## ğŸ“‹ ç« èŠ‚æ¦‚è§ˆ

<script>
function scrollToSection(sectionId) {
  const element = document.getElementById(sectionId);
  if (element) {
    const headerOffset = 100;
    const elementPosition = element.getBoundingClientRect().top;
    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
    window.scrollTo({
      top: offsetPosition,
      behavior: 'smooth'
    });
  }
}
</script>

<div class="section-overview">
  <div class="section-item" onclick="scrollToSection('section-8-4-1')">
    <h4>ğŸ“‰ 8.4.1 æœ€å¤§å›æ’¤åˆ†æ</h4>
    <p>æœ€å¤§å›æ’¤è®¡ç®—ã€å›æ’¤æ›²çº¿ã€å›æ’¤æŒç»­æ—¶é—´ã€å›æ’¤æ¢å¤æ—¶é—´</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-8-4-2')">
    <h4>ğŸ“Š 8.4.2 æ³¢åŠ¨ç‡åˆ†æ</h4>
    <p>æ³¢åŠ¨ç‡è®¡ç®—ã€ä¸‹è¡Œæ³¢åŠ¨ç‡ã€æ³¢åŠ¨ç‡åˆ†è§£ã€æ³¢åŠ¨ç‡ç¨³å®šæ€§</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-8-4-3')">
    <h4>ğŸ“ˆ 8.4.3 å¤æ™®æ¯”ç‡åˆ†æ</h4>
    <p>å¤æ™®æ¯”ç‡è®¡ç®—ã€ç´¢æè¯ºæ¯”ç‡ã€é£é™©è°ƒæ•´æ”¶ç›Šã€æ”¶ç›Šé£é™©æ¯”</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-8-4-4')">
    <h4>ğŸ¯ 8.4.4 ä¿¡æ¯æ¯”ç‡åˆ†æ</h4>
    <p>ä¿¡æ¯æ¯”ç‡è®¡ç®—ã€è·Ÿè¸ªè¯¯å·®ã€è¶…é¢æ”¶ç›Šç¨³å®šæ€§ã€ç›¸å¯¹é£é™©</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-8-4-5')">
    <h4>ğŸ’ 8.4.5 é£é™©ä»·å€¼åˆ†æ</h4>
    <p>VaRè®¡ç®—ã€CVaRè®¡ç®—ã€é£é™©ä»·å€¼åˆ†è§£ã€é£é™©ä»·å€¼å›æµ‹</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-8-4-6')">
    <h4>ğŸ“Š 8.4.6 é£é™©å¯è§†åŒ–</h4>
    <p>å›æ’¤æ›²çº¿å›¾ã€æ³¢åŠ¨ç‡åˆ†å¸ƒå›¾ã€é£é™©æŒ‡æ ‡å¯¹æ¯”å›¾ã€é£é™©çƒ­åŠ›å›¾</p>
  </div>
</div>

## ğŸ¯ å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬èŠ‚å­¦ä¹ ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š

- **è®¡ç®—æœ€å¤§å›æ’¤**ï¼šæŒæ¡æœ€å¤§å›æ’¤çš„è®¡ç®—æ–¹æ³•å’Œå›æ’¤æ›²çº¿åˆ†æ
- **åˆ†ææ³¢åŠ¨ç‡**ï¼šç†è§£æ³¢åŠ¨ç‡çš„è®¡ç®—å’Œæ³¢åŠ¨ç‡åˆ†è§£æ–¹æ³•
- **è®¡ç®—å¤æ™®æ¯”ç‡**ï¼šæŒæ¡å¤æ™®æ¯”ç‡å’Œç´¢æè¯ºæ¯”ç‡çš„è®¡ç®—æ–¹æ³•
- **åˆ†æä¿¡æ¯æ¯”ç‡**ï¼šç†è§£ä¿¡æ¯æ¯”ç‡å’Œè·Ÿè¸ªè¯¯å·®çš„è®¡ç®—æ–¹æ³•
- **è¯„ä¼°é£é™©ä»·å€¼**ï¼šæŒæ¡VaRå’ŒCVaRçš„è®¡ç®—æ–¹æ³•
- **å¯è§†åŒ–é£é™©**ï¼šç†è§£é£é™©å¯è§†åŒ–çš„æ–¹æ³•å’Œå›¾è¡¨ç±»å‹

## ğŸ“š æ ¸å¿ƒæ¦‚å¿µ

### æ¨¡å—å®šä½

- **å·¥ä½œæµä½ç½®**ï¼šæ­¥éª¤7 - ğŸ”„ å›æµ‹éªŒè¯ï¼ˆå›æµ‹åˆ†æå™¨ä¹‹åï¼‰
- **æ ¸å¿ƒèŒè´£**ï¼šæœ€å¤§å›æ’¤åˆ†æã€æ³¢åŠ¨ç‡åˆ†æã€å¤æ™®æ¯”ç‡åˆ†æã€ä¿¡æ¯æ¯”ç‡åˆ†æã€é£é™©ä»·å€¼åˆ†æ
- **æœåŠ¡å¯¹è±¡**ï¼šç­–ç•¥ä¼˜åŒ–ã€å›æµ‹æŠ¥å‘Šã€é£é™©æ§åˆ¶
- **æ•°æ®æ¥æº**ï¼šBulletTradeå›æµ‹ç»“æœï¼ˆå‡€å€¼æ›²çº¿ã€æ”¶ç›Šç‡åºåˆ—ã€åŸºå‡†æ›²çº¿ï¼‰

### æŠ€æœ¯æ ˆ

é£é™©åˆ†æåŸºäºä»¥ä¸‹æŠ€æœ¯ï¼š

1. **æ•°æ®æå–**ï¼šä»BulletTradeå›æµ‹ç»“æœä¸­æå–å‡€å€¼æ›²çº¿å’Œæ”¶ç›Šç‡åºåˆ—
2. **é£é™©è®¡ç®—**ï¼šä½¿ç”¨Pandaså’ŒNumPyè¿›è¡Œé£é™©æŒ‡æ ‡è®¡ç®—
3. **ç»Ÿè®¡åˆ†æ**ï¼šä½¿ç”¨ç»Ÿè®¡æ–¹æ³•è¿›è¡Œé£é™©åˆ†è§£å’Œé£é™©è¯„ä¼°
4. **å¯è§†åŒ–**ï¼šä½¿ç”¨Matplotlibå’ŒPlotlyç”Ÿæˆé£é™©åˆ†æå›¾è¡¨

<h2 id="section-8-4-1">ğŸ“‰ 8.4.1 æœ€å¤§å›æ’¤åˆ†æ</h2>

æœ€å¤§å›æ’¤åˆ†æè¯„ä¼°ç­–ç•¥åœ¨å›æµ‹æœŸé—´çš„æœ€å¤§äºæŸå¹…åº¦ã€‚

### ä»BulletTradeç»“æœæå–æ•°æ®

```python
from core.bullettrade import BulletTradeEngine, BTConfig

# æ‰§è¡ŒBulletTradeå›æµ‹
bt_engine = BulletTradeEngine(config)
bt_result = bt_engine.run_backtest(strategy_path, start_date, end_date)

# æå–å‡€å€¼æ›²çº¿
equity_curve = bt_result.equity_curve  # DataFrame: date, equity
```

### æœ€å¤§å›æ’¤è®¡ç®—

```python
import pandas as pd
import numpy as np
from typing import Dict, Any, Tuple

class MaxDrawdownAnalyzer:
    """æœ€å¤§å›æ’¤åˆ†æå™¨"""
    
    def analyze_max_drawdown(
        self,
        equity_curve: pd.DataFrame
    ) -> Dict[str, Any]:
        """
        åˆ†ææœ€å¤§å›æ’¤
        
        Args:
            equity_curve: å‡€å€¼æ›²çº¿ï¼ˆåŒ…å«dateå’Œequityåˆ—ï¼‰
        
        Returns:
            Dict: æœ€å¤§å›æ’¤åˆ†æç»“æœ
        """
        equity_curve = equity_curve.sort_values('date')
        equity = equity_curve['equity'].values
        dates = pd.to_datetime(equity_curve['date'])
        
        # è®¡ç®—ç´¯è®¡æœ€é«˜å€¼
        cumulative_max = np.maximum.accumulate(equity)
        
        # è®¡ç®—å›æ’¤
        drawdown = (equity - cumulative_max) / cumulative_max
        drawdown_series = pd.Series(drawdown, index=dates)
        
        # æœ€å¤§å›æ’¤
        max_drawdown = abs(drawdown.min())
        max_dd_idx = drawdown.idxmin()
        
        # æœ€å¤§å›æ’¤å¼€å§‹å’Œç»“æŸæ—¶é—´
        max_dd_start_idx = np.where(equity == cumulative_max[drawdown.idxmin()])[0]
        if len(max_dd_start_idx) > 0:
            max_dd_start_date = dates[max_dd_start_idx[0]]
        else:
            max_dd_start_date = dates[0]
        
        max_dd_end_date = max_dd_idx
        
        # æœ€å¤§å›æ’¤æŒç»­æ—¶é—´
        max_dd_duration = (max_dd_end_date - max_dd_start_date).days
        
        # å›æ’¤æ¢å¤æ—¶é—´ï¼ˆä»æœ€å¤§å›æ’¤æ¢å¤åˆ°æ–°é«˜ï¼‰
        recovery_date = self._calculate_recovery_date(
            equity_curve, max_dd_end_date, cumulative_max[drawdown.idxmin()]
        )
        recovery_duration = (recovery_date - max_dd_end_date).days if recovery_date else None
        
        # å›æ’¤ç»Ÿè®¡
        drawdown_stats = self._analyze_drawdowns(drawdown_series)
        
        return {
            'max_drawdown': max_drawdown,
            'max_dd_start_date': max_dd_start_date,
            'max_dd_end_date': max_dd_end_date,
            'max_dd_duration': max_dd_duration,
            'recovery_date': recovery_date,
            'recovery_duration': recovery_duration,
            'drawdown_curve': drawdown_series,
            'drawdown_stats': drawdown_stats
        }
    
    def _calculate_recovery_date(
        self,
        equity_curve: pd.DataFrame,
        max_dd_end_date: pd.Timestamp,
        peak_value: float
    ) -> pd.Timestamp:
        """è®¡ç®—å›æ’¤æ¢å¤æ—¥æœŸ"""
        equity_curve = equity_curve.sort_values('date')
        dates = pd.to_datetime(equity_curve['date'])
        
        # æ‰¾åˆ°æœ€å¤§å›æ’¤ç»“æŸåçš„æ•°æ®
        after_dd = equity_curve[dates > max_dd_end_date]
        
        if len(after_dd) == 0:
            return None
        
        # æ‰¾åˆ°ç¬¬ä¸€ä¸ªè¶…è¿‡å³°å€¼å‡€å€¼çš„æ—¥æœŸ
        recovery_idx = (after_dd['equity'] >= peak_value).idxmax()
        if pd.isna(recovery_idx):
            return None
        
        return pd.to_datetime(equity_curve.loc[recovery_idx, 'date'])
    
    def _analyze_drawdowns(self, drawdown_series: pd.Series) -> Dict[str, Any]:
        """åˆ†æå›æ’¤ç»Ÿè®¡"""
        drawdowns = drawdown_series[drawdown_series < 0]
        
        return {
            'drawdown_count': len(drawdowns[drawdowns < drawdowns.shift(1)]),  # å›æ’¤æ¬¡æ•°
            'avg_drawdown': abs(drawdowns.mean()) if len(drawdowns) > 0 else 0,
            'max_drawdown': abs(drawdowns.min()) if len(drawdowns) > 0 else 0,
            'drawdown_std': drawdowns.std() if len(drawdowns) > 0 else 0
        }
```

### ä½¿ç”¨ç¤ºä¾‹

```python
# åˆ†ææœ€å¤§å›æ’¤
analyzer = MaxDrawdownAnalyzer()
result = analyzer.analyze_max_drawdown(bt_result.equity_curve)

print(f"æœ€å¤§å›æ’¤: {result['max_drawdown']:.2%}")
print(f"æœ€å¤§å›æ’¤å¼€å§‹æ—¥æœŸ: {result['max_dd_start_date']}")
print(f"æœ€å¤§å›æ’¤ç»“æŸæ—¥æœŸ: {result['max_dd_end_date']}")
print(f"æœ€å¤§å›æ’¤æŒç»­æ—¶é—´: {result['max_dd_duration']}å¤©")
if result['recovery_date']:
    print(f"å›æ’¤æ¢å¤æ—¥æœŸ: {result['recovery_date']}")
    print(f"å›æ’¤æ¢å¤æ—¶é—´: {result['recovery_duration']}å¤©")
```

<h2 id="section-8-4-2">ğŸ“Š 8.4.2 æ³¢åŠ¨ç‡åˆ†æ</h2>

æ³¢åŠ¨ç‡åˆ†æè¯„ä¼°ç­–ç•¥æ”¶ç›Šçš„æ³¢åŠ¨ç¨‹åº¦ã€‚

### æ³¢åŠ¨ç‡è®¡ç®—

```python
class VolatilityAnalyzer:
    """æ³¢åŠ¨ç‡åˆ†æå™¨"""
    
    def analyze_volatility(
        self,
        returns: pd.Series,
        frequency: str = 'daily'
    ) -> Dict[str, Any]:
        """
        åˆ†ææ³¢åŠ¨ç‡
        
        Args:
            returns: æ”¶ç›Šç‡åºåˆ—
            frequency: é¢‘ç‡ï¼ˆ'daily', 'weekly', 'monthly'ï¼‰
        
        Returns:
            Dict: æ³¢åŠ¨ç‡åˆ†æç»“æœ
        """
        # è®¾è®¡åŸç†ï¼šå¹´åŒ–æ³¢åŠ¨ç‡è®¡ç®—
        # åŸå› ï¼šä¸åŒé¢‘ç‡çš„æ”¶ç›Šç‡éœ€è¦ä¸åŒçš„å¹´åŒ–å› å­
        # å…¬å¼ï¼šå¹´åŒ–æ³¢åŠ¨ç‡ = æ”¶ç›Šç‡æ ‡å‡†å·® * sqrt(å¹´äº¤æ˜“å¤©æ•°)
        # å¹´äº¤æ˜“å¤©æ•°ï¼šæ—¥çº¿252å¤©ï¼Œå‘¨çº¿52å‘¨ï¼Œæœˆçº¿12æœˆ
        # ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼šç»Ÿä¸€é‡çº²ï¼Œä¾¿äºä¸åŒé¢‘ç‡çš„ç­–ç•¥å¯¹æ¯”
        if frequency == 'daily':
            annual_volatility = returns.std() * np.sqrt(252)
        elif frequency == 'weekly':
            annual_volatility = returns.std() * np.sqrt(52)
        elif frequency == 'monthly':
            annual_volatility = returns.std() * np.sqrt(12)
        else:
            annual_volatility = returns.std() * np.sqrt(252)
        
        # è®¾è®¡åŸç†ï¼šä¸‹è¡Œæ³¢åŠ¨ç‡ï¼ˆåªè€ƒè™‘è´Ÿæ”¶ç›Šï¼‰
        # åŸå› ï¼šä¸‹è¡Œæ³¢åŠ¨ç‡æ›´å‡†ç¡®åæ˜ ç­–ç•¥çš„ä¸‹è¡Œé£é™©
        # ä½¿ç”¨åœºæ™¯ï¼šè®¡ç®—ç´¢æè¯ºæ¯”ç‡æ—¶ä½¿ç”¨ï¼Œæ¯”å¤æ™®æ¯”ç‡æ›´å…³æ³¨ä¸‹è¡Œé£é™©
        # ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼šæŠ•èµ„è€…æ›´å…³æ³¨ä¸‹è¡Œé£é™©ï¼Œä¸Šè¡Œæ³¢åŠ¨æ˜¯å¥½äº‹
        downside_returns = returns[returns < 0]
        downside_volatility = downside_returns.std() * np.sqrt(252) if len(downside_returns) > 0 else 0
        
        # è®¾è®¡åŸç†ï¼šä¸Šè¡Œæ³¢åŠ¨ç‡ï¼ˆåªè€ƒè™‘æ­£æ”¶ç›Šï¼‰
        # åŸå› ï¼šä¸Šè¡Œæ³¢åŠ¨ç‡åæ˜ ç­–ç•¥çš„æ”¶ç›Šæ³¢åŠ¨
        # ä½¿ç”¨åœºæ™¯ï¼šåˆ†æç­–ç•¥çš„æ”¶ç›Šç¨³å®šæ€§
        # ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼šä¸Šè¡Œæ³¢åŠ¨ç‡ä½è¡¨ç¤ºæ”¶ç›Šç¨³å®šï¼Œä¸Šè¡Œæ³¢åŠ¨ç‡é«˜è¡¨ç¤ºæ”¶ç›Šæ³¢åŠ¨å¤§
        upside_returns = returns[returns > 0]
        upside_volatility = upside_returns.std() * np.sqrt(252) if len(upside_returns) > 0 else 0
        
        # æ³¢åŠ¨ç‡åˆ†è§£ï¼ˆæŒ‰æ—¶é—´æ®µï¼‰
        volatility_by_period = self._decompose_volatility_by_period(returns)
        
        return {
            'annual_volatility': annual_volatility,
            'downside_volatility': downside_volatility,
            'upside_volatility': upside_volatility,
            'volatility_ratio': downside_volatility / annual_volatility if annual_volatility > 0 else 0,
            'volatility_by_period': volatility_by_period
        }
    
    def _decompose_volatility_by_period(self, returns: pd.Series) -> Dict[str, float]:
        """æŒ‰æ—¶é—´æ®µåˆ†è§£æ³¢åŠ¨ç‡"""
        returns.index = pd.to_datetime(returns.index)
        
        # æŒ‰å¹´åº¦åˆ†è§£
        yearly_vol = returns.groupby(returns.index.year).std() * np.sqrt(252)
        
        # æŒ‰å­£åº¦åˆ†è§£
        quarterly_vol = returns.groupby([returns.index.year, returns.index.quarter]).std() * np.sqrt(252)
        
        return {
            'yearly_volatility': yearly_vol.to_dict(),
            'quarterly_volatility': quarterly_vol.to_dict()
        }
```

<h2 id="section-8-4-3">ğŸ“ˆ 8.4.3 å¤æ™®æ¯”ç‡åˆ†æ</h2>

å¤æ™®æ¯”ç‡åˆ†æè¯„ä¼°ç­–ç•¥çš„é£é™©è°ƒæ•´æ”¶ç›Šã€‚

### å¤æ™®æ¯”ç‡è®¡ç®—

```python
class SharpeRatioAnalyzer:
    """å¤æ™®æ¯”ç‡åˆ†æå™¨"""
    
    def analyze_sharpe_ratio(
        self,
        returns: pd.Series,
        risk_free_rate: float = 0.03,
        frequency: str = 'daily'
    ) -> Dict[str, Any]:
        """
        åˆ†æå¤æ™®æ¯”ç‡
        
        Args:
            returns: æ”¶ç›Šç‡åºåˆ—
            risk_free_rate: æ— é£é™©åˆ©ç‡ï¼ˆå¹´åŒ–ï¼‰
            frequency: é¢‘ç‡ï¼ˆ'daily', 'weekly', 'monthly'ï¼‰
        
        Returns:
            Dict: å¤æ™®æ¯”ç‡åˆ†æç»“æœ
        """
        # å¹´åŒ–æ”¶ç›Šç‡
        if frequency == 'daily':
            annual_return = returns.mean() * 252
            annual_volatility = returns.std() * np.sqrt(252)
        elif frequency == 'weekly':
            annual_return = returns.mean() * 52
            annual_volatility = returns.std() * np.sqrt(52)
        elif frequency == 'monthly':
            annual_return = returns.mean() * 12
            annual_volatility = returns.std() * np.sqrt(12)
        else:
            annual_return = returns.mean() * 252
            annual_volatility = returns.std() * np.sqrt(252)
        
        # è®¾è®¡åŸç†ï¼šå¤æ™®æ¯”ç‡ï¼ˆé£é™©è°ƒæ•´åæ”¶ç›Šï¼‰
        # åŸå› ï¼šè¡¡é‡å•ä½é£é™©çš„è¶…é¢æ”¶ç›Šï¼Œæ˜¯å¸¸ç”¨çš„é£é™©è°ƒæ•´æŒ‡æ ‡
        # å…¬å¼ï¼šå¤æ™®æ¯”ç‡ = (å¹´åŒ–æ”¶ç›Šç‡ - æ— é£é™©åˆ©ç‡) / å¹´åŒ–æ³¢åŠ¨ç‡
        # ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼šç»¼åˆè€ƒè™‘æ”¶ç›Šå’Œé£é™©ï¼Œä¾¿äºç­–ç•¥å¯¹æ¯”
        # è¯„ä»·æ ‡å‡†ï¼š>1ä¸ºè‰¯å¥½ï¼Œ>2ä¸ºä¼˜ç§€ï¼Œ>3ä¸ºå“è¶Š
        sharpe_ratio = (annual_return - risk_free_rate) / annual_volatility if annual_volatility > 0 else 0
        
        # è®¾è®¡åŸç†ï¼šç´¢æè¯ºæ¯”ç‡ï¼ˆä½¿ç”¨ä¸‹è¡Œæ³¢åŠ¨ç‡ï¼‰
        # åŸå› ï¼šåªè€ƒè™‘ä¸‹è¡Œé£é™©ï¼Œæ¯”å¤æ™®æ¯”ç‡æ›´å…³æ³¨ç­–ç•¥çš„ä¸‹è¡Œä¿æŠ¤èƒ½åŠ›
        # å…¬å¼ï¼šç´¢æè¯ºæ¯”ç‡ = (å¹´åŒ–æ”¶ç›Šç‡ - æ— é£é™©åˆ©ç‡) / å¹´åŒ–ä¸‹è¡Œæ³¢åŠ¨ç‡
        # ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼šæŠ•èµ„è€…æ›´å…³æ³¨ä¸‹è¡Œé£é™©ï¼Œä¸Šè¡Œæ³¢åŠ¨æ˜¯å¥½äº‹
        # é€‚ç”¨åœºæ™¯ï¼šè¯„ä¼°ç­–ç•¥çš„ä¸‹è¡Œé£é™©æ§åˆ¶èƒ½åŠ›
        downside_returns = returns[returns < 0]
        downside_volatility = downside_returns.std() * np.sqrt(252) if len(downside_returns) > 0 else 0
        sortino_ratio = (annual_return - risk_free_rate) / downside_volatility if downside_volatility > 0 else 0
        
        # Calmaræ¯”ç‡ï¼ˆå¹´åŒ–æ”¶ç›Š / æœ€å¤§å›æ’¤ï¼‰
        # éœ€è¦ä»å‡€å€¼æ›²çº¿è®¡ç®—æœ€å¤§å›æ’¤
        calmar_ratio = None  # éœ€è¦equity_curve
        
        return {
            'annual_return': annual_return,
            'annual_volatility': annual_volatility,
            'risk_free_rate': risk_free_rate,
            'sharpe_ratio': sharpe_ratio,
            'sortino_ratio': sortino_ratio,
            'excess_return': annual_return - risk_free_rate
        }
```

<h2 id="section-8-4-4">ğŸ¯ 8.4.4 ä¿¡æ¯æ¯”ç‡åˆ†æ</h2>

ä¿¡æ¯æ¯”ç‡åˆ†æè¯„ä¼°ç­–ç•¥ç›¸å¯¹äºåŸºå‡†çš„è¶…é¢æ”¶ç›Šé£é™©ã€‚

### ä¿¡æ¯æ¯”ç‡è®¡ç®—

```python
class InformationRatioAnalyzer:
    """ä¿¡æ¯æ¯”ç‡åˆ†æå™¨"""
    
    def analyze_information_ratio(
        self,
        strategy_returns: pd.Series,
        benchmark_returns: pd.Series
    ) -> Dict[str, Any]:
        """
        åˆ†æä¿¡æ¯æ¯”ç‡
        
        Args:
            strategy_returns: ç­–ç•¥æ”¶ç›Šç‡åºåˆ—
            benchmark_returns: åŸºå‡†æ”¶ç›Šç‡åºåˆ—
        
        Returns:
            Dict: ä¿¡æ¯æ¯”ç‡åˆ†æç»“æœ
        """
        # å¯¹é½æ•°æ®
        aligned = pd.DataFrame({
            'strategy': strategy_returns,
            'benchmark': benchmark_returns
        }).dropna()
        
        # è¶…é¢æ”¶ç›Š
        excess_returns = aligned['strategy'] - aligned['benchmark']
        
        # å¹´åŒ–è¶…é¢æ”¶ç›Š
        annual_excess_return = excess_returns.mean() * 252
        
        # è·Ÿè¸ªè¯¯å·®ï¼ˆè¶…é¢æ”¶ç›Šçš„æ ‡å‡†å·®ï¼‰
        tracking_error = excess_returns.std() * np.sqrt(252)
        
        # ä¿¡æ¯æ¯”ç‡
        information_ratio = annual_excess_return / tracking_error if tracking_error > 0 else 0
        
        # è¶…é¢æ”¶ç›Šç¨³å®šæ€§
        excess_return_stability = 1 - (excess_returns.std() / abs(excess_returns.mean())) if excess_returns.mean() != 0 else 0
        
        return {
            'annual_excess_return': annual_excess_return,
            'tracking_error': tracking_error,
            'information_ratio': information_ratio,
            'excess_return_stability': excess_return_stability,
            'excess_returns': excess_returns
        }
```

<h2 id="section-8-4-5">ğŸ’ 8.4.5 é£é™©ä»·å€¼åˆ†æ</h2>

é£é™©ä»·å€¼åˆ†æè¯„ä¼°ç­–ç•¥åœ¨ç‰¹å®šç½®ä¿¡åº¦ä¸‹çš„æœ€å¤§å¯èƒ½æŸå¤±ã€‚

### VaRå’ŒCVaRè®¡ç®—

```python
class ValueAtRiskAnalyzer:
    """é£é™©ä»·å€¼åˆ†æå™¨"""
    
    def analyze_var(
        self,
        returns: pd.Series,
        confidence_levels: List[float] = [0.95, 0.99]
    ) -> Dict[str, Any]:
        """
        åˆ†æé£é™©ä»·å€¼
        
        Args:
            returns: æ”¶ç›Šç‡åºåˆ—
            confidence_levels: ç½®ä¿¡åº¦åˆ—è¡¨
        
        Returns:
            Dict: é£é™©ä»·å€¼åˆ†æç»“æœ
        """
        # å¹´åŒ–æ”¶ç›Šç‡
        annual_return = returns.mean() * 252
        annual_volatility = returns.std() * np.sqrt(252)
        
        var_results = {}
        cvar_results = {}
        
        for conf_level in confidence_levels:
            alpha = 1 - conf_level
            
            # VaRï¼ˆå‚æ•°æ³•ï¼Œå‡è®¾æ­£æ€åˆ†å¸ƒï¼‰
            var_param = annual_return - annual_volatility * np.abs(np.percentile([0], alpha * 100))
            var_param = annual_return - annual_volatility * 1.645 if conf_level == 0.95 else annual_return - annual_volatility * 2.326
            
            # VaRï¼ˆå†å²æ³•ï¼‰
            var_historical = np.percentile(returns, alpha * 100) * np.sqrt(252)
            
            # CVaRï¼ˆæ¡ä»¶é£é™©ä»·å€¼ï¼‰
            cvar_historical = returns[returns <= np.percentile(returns, alpha * 100)].mean() * np.sqrt(252) if len(returns[returns <= np.percentile(returns, alpha * 100)]) > 0 else 0
            
            var_results[conf_level] = {
                'var_parametric': var_param,
                'var_historical': var_historical
            }
            
            cvar_results[conf_level] = {
                'cvar_historical': cvar_historical
            }
        
        return {
            'var_results': var_results,
            'cvar_results': cvar_results,
            'annual_return': annual_return,
            'annual_volatility': annual_volatility
        }
```

<h2 id="section-8-4-6">ğŸ“Š 8.4.6 é£é™©å¯è§†åŒ–</h2>

é£é™©å¯è§†åŒ–å°†é£é™©åˆ†æç»“æœä»¥å›¾è¡¨å½¢å¼å±•ç¤ºã€‚

### é£é™©å›¾è¡¨ç”Ÿæˆ

```python
import matplotlib.pyplot as plt
import matplotlib.dates as mdates

class RiskVisualizer:
    """é£é™©å¯è§†åŒ–å™¨"""
    
    def plot_drawdown_curve(
        self,
        drawdown_curve: pd.Series,
        save_path: str = None
    ):
        """ç»˜åˆ¶å›æ’¤æ›²çº¿"""
        fig, ax = plt.subplots(figsize=(12, 6))
        
        dates = drawdown_curve.index
        drawdown_pct = drawdown_curve * 100
        
        ax.fill_between(dates, drawdown_pct, 0, alpha=0.3, color='red', label='å›æ’¤')
        ax.plot(dates, drawdown_pct, color='red', linewidth=1.5)
        
        ax.axhline(y=0, color='black', linestyle='-', linewidth=0.5)
        ax.set_xlabel('æ—¥æœŸ', fontsize=12)
        ax.set_ylabel('å›æ’¤ (%)', fontsize=12)
        ax.set_title('å›æ’¤æ›²çº¿', fontsize=14, fontweight='bold')
        ax.grid(True, alpha=0.3)
        
        # æ ¼å¼åŒ–xè½´æ—¥æœŸ
        ax.xaxis.set_major_formatter(mdates.DateFormatter('%Y-%m'))
        ax.xaxis.set_major_locator(mdates.MonthLocator(interval=3))
        plt.xticks(rotation=45)
        
        plt.tight_layout()
        
        if save_path:
            plt.savefig(save_path, dpi=300, bbox_inches='tight')
        
        return fig
```

## ğŸ”— ç›¸å…³ç« èŠ‚

- **8.1 å›æµ‹æ¡†æ¶**ï¼šäº†è§£å›æµ‹æ¡†æ¶ï¼Œé£é™©åˆ†æåŸºäºå›æµ‹ç»“æœ
- **8.2 å›æµ‹åˆ†æå™¨**ï¼šäº†è§£å›æµ‹åˆ†æå™¨ï¼Œé£é™©åˆ†ææ˜¯åˆ†æå™¨çš„ä¸€éƒ¨åˆ†
- **8.3 æ”¶ç›Šåˆ†æ**ï¼šäº†è§£æ”¶ç›Šåˆ†æï¼Œæ”¶ç›Šå’Œé£é™©éœ€è¦ç»“åˆåˆ†æ

## ğŸ’¡ å…³é”®è¦ç‚¹

1. **æœ€å¤§å›æ’¤åˆ†æ**ï¼šè¯„ä¼°ç­–ç•¥åœ¨å›æµ‹æœŸé—´çš„æœ€å¤§äºæŸå¹…åº¦
2. **æ³¢åŠ¨ç‡åˆ†æ**ï¼šè¯„ä¼°ç­–ç•¥æ”¶ç›Šçš„æ³¢åŠ¨ç¨‹åº¦
3. **å¤æ™®æ¯”ç‡åˆ†æ**ï¼šè¯„ä¼°ç­–ç•¥çš„é£é™©è°ƒæ•´æ”¶ç›Š
4. **ä¿¡æ¯æ¯”ç‡åˆ†æ**ï¼šè¯„ä¼°ç­–ç•¥ç›¸å¯¹äºåŸºå‡†çš„è¶…é¢æ”¶ç›Šé£é™©
5. **é£é™©ä»·å€¼åˆ†æ**ï¼šè¯„ä¼°ç­–ç•¥åœ¨ç‰¹å®šç½®ä¿¡åº¦ä¸‹çš„æœ€å¤§å¯èƒ½æŸå¤±
6. **é£é™©å¯è§†åŒ–**ï¼šé€šè¿‡å›¾è¡¨ç›´è§‚å±•ç¤ºé£é™©åˆ†æç»“æœ

## ğŸ”® æ€»ç»“ä¸å±•æœ›

<div class="summary-outlook">
  <h3>æœ¬èŠ‚å›é¡¾</h3>
  <p>æœ¬èŠ‚è¯¦ç»†ä»‹ç»äº†é£é™©åˆ†æåŠŸèƒ½ï¼ŒåŒ…æ‹¬æœ€å¤§å›æ’¤ã€æ³¢åŠ¨ç‡ã€å¤æ™®æ¯”ç‡ã€ä¿¡æ¯æ¯”ç‡ã€é£é™©ä»·å€¼ç­‰å¤šä¸ªç»´åº¦çš„åˆ†æã€‚é€šè¿‡ç†è§£é£é™©åˆ†æçš„æ ¸å¿ƒæŠ€æœ¯ï¼Œå¸®åŠ©å¼€å‘è€…å…¨é¢è¯„ä¼°ç­–ç•¥çš„é£é™©æ°´å¹³ï¼Œè¯†åˆ«é£é™©æ¥æºå’Œé£é™©ç‰¹å¾ï¼Œä¸ºé£é™©æ§åˆ¶æä¾›ä¾æ®ã€‚</p>
  
  <h3>ä¸‹èŠ‚é¢„å‘Š</h3>
  <p>æŒæ¡äº†é£é™©åˆ†æåï¼Œä¸‹ä¸€èŠ‚å°†è¯¦ç»†ä»‹ç»äº¤æ˜“åˆ†æï¼ŒåŒ…æ‹¬äº¤æ˜“æ¬¡æ•°ã€æ¢æ‰‹ç‡ã€èƒœç‡ã€ç›ˆäºæ¯”ç­‰äº¤æ˜“æŒ‡æ ‡ã€‚é€šè¿‡ç†è§£äº¤æ˜“åˆ†æçš„è¯¦ç»†æ–¹æ³•ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡å¦‚ä½•å…¨é¢è¯„ä¼°ç­–ç•¥çš„äº¤æ˜“è¡¨ç°ã€‚</p>
  
  <a href="/ashare-book6/008_Chapter8_Backtest/8.5_Trade_Analysis_CN" class="next-section">
    ç»§ç»­å­¦ä¹ ï¼š8.5 äº¤æ˜“åˆ†æ â†’
  </a>
</div>

> **é€‚ç”¨ç‰ˆæœ¬**: v1.0.0+  
> **æœ€åæ›´æ–°**: 2025-12-12

