# TRQuant ä»£ç è§„èŒƒåŒ–è§„åˆ™
# åŸºäº Compound Engineering ç†å¿µï¼šè®©æ¯æ¬¡ä»£ç ç”Ÿæˆéƒ½æ›´è§„èŒƒã€æ›´æ˜“ç»´æŠ¤

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

### Compound Engineering ç†å¿µ
- **æ¯æ¬¡ä»£ç ç”Ÿæˆéƒ½åº”è¯¥è®©åç»­ä»£ç æ›´å®¹æ˜“å†™**
- **ä»£ç åº”è¯¥è‡ªæ–‡æ¡£åŒ–ï¼Œå‡å°‘ç»´æŠ¤æˆæœ¬**
- **éµå¾ªç°æœ‰æ¨¡å¼ï¼Œå»ºç«‹å¯å¤ç”¨çš„ç»„ä»¶**
- **è´¨é‡ä¼˜å…ˆï¼šç¬¬ä¸€æ¬¡å°±å†™å¯¹ï¼Œè€Œä¸æ˜¯åç»­ä¿®å¤**

---

## ğŸ“ Python ä»£ç è§„èŒƒ

### ä»£ç é£æ ¼
- **PEP 8 ä¸¥æ ¼éµå¾ª**ï¼šä½¿ç”¨ `black` æ ¼å¼åŒ–ï¼Œ`ruff` æ£€æŸ¥
- **ç±»å‹æç¤ºå¿…é¡»**ï¼šæ‰€æœ‰å‡½æ•°å¿…é¡»æœ‰ç±»å‹æ³¨è§£
- **æ–‡æ¡£å­—ç¬¦ä¸²**ï¼šæ‰€æœ‰å…¬å…±å‡½æ•°ã€ç±»å¿…é¡»æœ‰ docstringï¼ˆGoogle é£æ ¼ï¼‰
- **è¡Œé•¿åº¦**ï¼šæœ€å¤§ 100 å­—ç¬¦ï¼ˆè€Œé 80ï¼‰
- **å¯¼å…¥é¡ºåº**ï¼šæ ‡å‡†åº“ â†’ ç¬¬ä¸‰æ–¹ â†’ æœ¬åœ°ï¼Œæ¯ç»„ä¹‹é—´ç©ºè¡Œ

### å‘½åè§„èŒƒ
```python
# å˜é‡å’Œå‡½æ•°ï¼šsnake_case
def calculate_momentum_factor(data: pd.DataFrame) -> pd.Series:
    """è®¡ç®—åŠ¨é‡å› å­"""
    pass

# ç±»åï¼šPascalCase
class FactorCalculator:
    """å› å­è®¡ç®—å™¨"""
    pass

# å¸¸é‡ï¼šUPPER_SNAKE_CASE
MAX_POSITION_SIZE = 0.1
STOP_LOSS_THRESHOLD = 0.08

# ç§æœ‰æ–¹æ³•/å±æ€§ï¼šå•ä¸‹åˆ’çº¿å‰ç¼€
def _internal_helper(self):
    pass
```

### ä»£ç ç»„ç»‡
- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªå‡½æ•°åªåšä¸€ä»¶äº‹
- **å‡½æ•°é•¿åº¦**ï¼šä¸è¶…è¿‡ 50 è¡Œï¼Œå¤æ‚é€»è¾‘æ‹†åˆ†ä¸ºå°å‡½æ•°
- **ç±»è®¾è®¡**ï¼šä¼˜å…ˆç»„åˆè€Œéç»§æ‰¿
- **é”™è¯¯å¤„ç†**ï¼šä½¿ç”¨å…·ä½“å¼‚å¸¸ç±»å‹ï¼Œæä¾›æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯

### ç¤ºä¾‹æ¨¡æ¿
```python
from typing import Optional, List, Dict
import pandas as pd
import numpy as np

class FactorCalculator:
    """å› å­è®¡ç®—å™¨åŸºç±»
    
    Attributes:
        data: è¾“å…¥æ•°æ®
        config: é…ç½®å‚æ•°
    """
    
    def __init__(self, data: pd.DataFrame, config: Optional[Dict] = None) -> None:
        """åˆå§‹åŒ–å› å­è®¡ç®—å™¨
        
        Args:
            data: è‚¡ç¥¨æ•°æ®DataFrame
            config: å¯é€‰é…ç½®å­—å…¸
        """
        self.data = data
        self.config = config or {}
    
    def calculate(self) -> pd.Series:
        """è®¡ç®—å› å­å€¼
        
        Returns:
            å› å­å€¼Seriesï¼Œç´¢å¼•ä¸ºè‚¡ç¥¨ä»£ç 
            
        Raises:
            ValueError: å½“æ•°æ®æ ¼å¼ä¸æ­£ç¡®æ—¶
        """
        if self.data.empty:
            raise ValueError("è¾“å…¥æ•°æ®ä¸èƒ½ä¸ºç©º")
        # å®ç°é€»è¾‘
        return pd.Series()
```

---

## ğŸ“ TypeScript/JavaScript ä»£ç è§„èŒƒ

### ä»£ç é£æ ¼
- **TypeScript ä¸¥æ ¼æ¨¡å¼**ï¼š`strict: true`
- **ESLint + Prettier**ï¼šè‡ªåŠ¨æ ¼å¼åŒ–å’Œæ£€æŸ¥
- **2 ç©ºæ ¼ç¼©è¿›**ï¼šä¸ç°æœ‰ä»£ç ä¿æŒä¸€è‡´
- **åˆ†å·**ï¼šä½¿ç”¨åˆ†å·
- **å¼•å·**ï¼šå•å¼•å·ä¼˜å…ˆ

### ç±»å‹ç³»ç»Ÿ
- **é¿å… `any`**ï¼šä½¿ç”¨å…·ä½“ç±»å‹æˆ– `unknown`
- **æ¥å£ä¼˜å…ˆ**ï¼šä½¿ç”¨ `interface` è€Œé `type`ï¼ˆé™¤ééœ€è¦è”åˆç±»å‹ï¼‰
- **æ³›å‹çº¦æŸ**ï¼šåˆç†ä½¿ç”¨æ³›å‹æé«˜ä»£ç å¤ç”¨æ€§

### å‘½åè§„èŒƒ
```typescript
// å˜é‡å’Œå‡½æ•°ï¼šcamelCase
const calculateFactor = (data: DataFrame): Series => {
  // ...
};

// ç±»åï¼šPascalCase
class FactorCalculator {
  // ...
}

// å¸¸é‡ï¼šUPPER_SNAKE_CASE
const MAX_POSITION_SIZE = 0.1;

// ç§æœ‰æˆå‘˜ï¼šä¸‹åˆ’çº¿å‰ç¼€
private _internalMethod(): void {
  // ...
}
```

### å¼‚æ­¥å¤„ç†
- **ä¼˜å…ˆ async/await**ï¼šé¿å… Promise.then é“¾
- **é”™è¯¯å¤„ç†**ï¼šæ‰€æœ‰ async å‡½æ•°å¿…é¡»æœ‰ try-catch
- **ç±»å‹å®‰å…¨**ï¼šPromise è¿”å›å€¼å¿…é¡»æœ‰ç±»å‹æ³¨è§£

### ç¤ºä¾‹æ¨¡æ¿
```typescript
import { ExtensionContext, window } from 'vscode';

interface FactorConfig {
  period: number;
  method: 'sma' | 'ema';
}

class FactorCalculator {
  private data: DataFrame;
  private config: FactorConfig;
  
  constructor(data: DataFrame, config: FactorConfig) {
    this.data = data;
    this.config = config;
  }
  
  /**
   * è®¡ç®—å› å­å€¼
   * @returns å› å­å€¼Series
   * @throws {Error} å½“æ•°æ®æ ¼å¼ä¸æ­£ç¡®æ—¶
   */
  async calculate(): Promise<Series> {
    try {
      if (this.data.isEmpty()) {
        throw new Error('è¾“å…¥æ•°æ®ä¸èƒ½ä¸ºç©º');
      }
      // å®ç°é€»è¾‘
      return new Series();
    } catch (error) {
      window.showErrorMessage(`è®¡ç®—å› å­å¤±è´¥: ${error.message}`);
      throw error;
    }
  }
}
```

---

## ğŸ—ï¸ æ¶æ„è§„èŒƒ

### æ–‡ä»¶ç»„ç»‡
```
core/
  â”œâ”€â”€ factors/          # å› å­æ¨¡å—
  â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”œâ”€â”€ base_factor.py
  â”‚   â””â”€â”€ momentum_factors.py
  â”œâ”€â”€ data_provider.py  # æ•°æ®æä¾›è€…
  â””â”€â”€ strategy.py       # ç­–ç•¥åŸºç±»

extension/src/
  â”œâ”€â”€ commands/         # å‘½ä»¤
  â”œâ”€â”€ services/         # æœåŠ¡
  â”œâ”€â”€ views/            # è§†å›¾
  â””â”€â”€ utils/            # å·¥å…·å‡½æ•°
```

### ä¾èµ–ç®¡ç†
- **æœ€å°ä¾èµ–**ï¼šåªå¼•å…¥å¿…è¦çš„åº“
- **ç‰ˆæœ¬é”å®š**ï¼šä½¿ç”¨ `requirements.txt` å’Œ `package-lock.json`
- **é¿å…å¾ªç¯ä¾èµ–**ï¼šä½¿ç”¨ä¾èµ–æ³¨å…¥æˆ–äº‹ä»¶ç³»ç»Ÿ

### é”™è¯¯å¤„ç†æ¨¡å¼
```python
# Python: ä½¿ç”¨å…·ä½“å¼‚å¸¸
class DataSourceError(Exception):
    """æ•°æ®æºé”™è¯¯"""
    pass

def fetch_data():
    try:
        # ...
    except ConnectionError as e:
        raise DataSourceError(f"è¿æ¥å¤±è´¥: {e}") from e
```

```typescript
// TypeScript: ä½¿ç”¨é”™è¯¯ç±»
class DataSourceError extends Error {
  constructor(message: string, public code: string) {
    super(message);
    this.name = 'DataSourceError';
  }
}

async function fetchData(): Promise<Data> {
  try {
    // ...
  } catch (error) {
    throw new DataSourceError('è¿æ¥å¤±è´¥', 'CONNECTION_ERROR');
  }
}
```

---

## ğŸ§ª æµ‹è¯•è§„èŒƒ

### Python æµ‹è¯•
- **pytest**ï¼šä½¿ç”¨ pytest æ¡†æ¶
- **æµ‹è¯•æ–‡ä»¶å‘½å**ï¼š`test_*.py`
- **è¦†ç›–ç‡ç›®æ ‡**ï¼šæ ¸å¿ƒæ¨¡å— > 80%
- **æµ‹è¯•ç»„ç»‡**ï¼šæ¯ä¸ªæµ‹è¯•å‡½æ•°æµ‹è¯•ä¸€ä¸ªåœºæ™¯

```python
import pytest
from core.factors.momentum_factors import MomentumFactor

def test_momentum_factor_calculation():
    """æµ‹è¯•åŠ¨é‡å› å­è®¡ç®—"""
    data = create_test_data()
    factor = MomentumFactor(data)
    result = factor.calculate()
    assert not result.empty
    assert len(result) == len(data)
```

### TypeScript æµ‹è¯•
- **Jest**ï¼šä½¿ç”¨ Jest æµ‹è¯•æ¡†æ¶
- **æµ‹è¯•æ–‡ä»¶å‘½å**ï¼š`*.test.ts` æˆ– `*.spec.ts`
- **Mock å¤–éƒ¨ä¾èµ–**ï¼šä½¿ç”¨ Jest mocks

```typescript
import { FactorCalculator } from './factorCalculator';

describe('FactorCalculator', () => {
  it('should calculate factor correctly', async () => {
    const data = createTestData();
    const calculator = new FactorCalculator(data);
    const result = await calculator.calculate();
    expect(result).toBeDefined();
    expect(result.length).toBe(data.length);
  });
});
```

---

## ğŸ“ æ–‡æ¡£è§„èŒƒ

### ä»£ç æ³¨é‡Š
- **ä¸ºä»€ä¹ˆè€Œéæ˜¯ä»€ä¹ˆ**ï¼šæ³¨é‡Šè§£é‡ŠåŸå› ï¼Œä»£ç æœ¬èº«åº”è¯¥æ¸…æ™°
- **TODO æ ‡è®°**ï¼š`# TODO: åŸå› ` æˆ– `// TODO: åŸå› `
- **å¤æ‚é€»è¾‘**ï¼šå¿…é¡»æ³¨é‡Šè§£é‡Šç®—æ³•æˆ–ä¸šåŠ¡é€»è¾‘

### æ–‡æ¡£å­—ç¬¦ä¸²
```python
def calculate_sharpe_ratio(returns: pd.Series, risk_free_rate: float = 0.03) -> float:
    """è®¡ç®—å¤æ™®æ¯”ç‡
    
    ä½¿ç”¨å¹´åŒ–æ”¶ç›Šç‡å’Œæ³¢åŠ¨ç‡è®¡ç®—é£é™©è°ƒæ•´åçš„æ”¶ç›ŠæŒ‡æ ‡ã€‚
    
    Args:
        returns: æ”¶ç›Šç‡åºåˆ—ï¼ˆæ—¥åº¦ï¼‰
        risk_free_rate: æ— é£é™©åˆ©ç‡ï¼Œé»˜è®¤ 3%
        
    Returns:
        å¤æ™®æ¯”ç‡å€¼
        
    Raises:
        ValueError: å½“æ”¶ç›Šç‡åºåˆ—ä¸ºç©ºæ—¶
        
    Example:
        >>> returns = pd.Series([0.01, 0.02, -0.01])
        >>> sharpe = calculate_sharpe_ratio(returns)
        >>> print(f"Sharpe Ratio: {sharpe:.2f}")
    """
    if returns.empty:
        raise ValueError("æ”¶ç›Šç‡åºåˆ—ä¸èƒ½ä¸ºç©º")
    # å®ç°...
```

---

## ğŸ”„ ä»£ç ç”Ÿæˆå·¥ä½œæµ

### ç”Ÿæˆæ–°åŠŸèƒ½æ—¶çš„æ£€æŸ¥æ¸…å•

1. **åˆ†æç°æœ‰æ¨¡å¼**
   - æŸ¥æ‰¾ç±»ä¼¼åŠŸèƒ½çš„å®ç°
   - éµå¾ªç°æœ‰çš„æ¶æ„æ¨¡å¼
   - å¤ç”¨å·²æœ‰çš„å·¥å…·å‡½æ•°

2. **è®¾è®¡æ¥å£**
   - å®šä¹‰æ¸…æ™°çš„è¾“å…¥è¾“å‡º
   - è€ƒè™‘é”™è¯¯æƒ…å†µ
   - è®¾è®¡å¯æµ‹è¯•çš„æ¥å£

3. **å®ç°ä»£ç **
   - éµå¾ªå‘½åè§„èŒƒ
   - æ·»åŠ ç±»å‹æ³¨è§£
   - ç¼–å†™æ–‡æ¡£å­—ç¬¦ä¸²
   - å¤„ç†é”™è¯¯æƒ…å†µ

4. **è´¨é‡æ£€æŸ¥**
   - è¿è¡Œæ ¼å¼åŒ–å·¥å…·ï¼ˆblack/ruff/prettierï¼‰
   - æ£€æŸ¥ç±»å‹é”™è¯¯
   - è¿è¡Œæµ‹è¯•
   - æ£€æŸ¥ä»£ç è¦†ç›–ç‡

5. **æ–‡æ¡£æ›´æ–°**
   - æ›´æ–°ç›¸å…³æ–‡æ¡£
   - æ·»åŠ ä½¿ç”¨ç¤ºä¾‹
   - è®°å½•è®¾è®¡å†³ç­–

---

## ğŸ› ï¸ å·¥å…·é…ç½®

### Python å·¥å…·
```bash
# æ ¼å¼åŒ–
black . --line-length 100

# æ£€æŸ¥
ruff check .

# ç±»å‹æ£€æŸ¥
mypy .
```

### TypeScript å·¥å…·
```bash
# æ ¼å¼åŒ–
npm run format

# æ£€æŸ¥
npm run lint

# ç±»å‹æ£€æŸ¥
npm run type-check
```

---

## âš ï¸ ç¦æ­¢äº‹é¡¹

- âŒ ä½¿ç”¨ `any` ç±»å‹ï¼ˆTypeScriptï¼‰
- âŒ å¿½ç•¥é”™è¯¯ï¼ˆå¿…é¡»å¤„ç†æ‰€æœ‰å¼‚å¸¸ï¼‰
- âŒ é­”æ³•æ•°å­—ï¼ˆä½¿ç”¨å‘½åå¸¸é‡ï¼‰
- âŒ æ·±å±‚åµŒå¥—ï¼ˆè¶…è¿‡ 3 å±‚éœ€è¦é‡æ„ï¼‰
- âŒ è¿‡é•¿çš„å‡½æ•°ï¼ˆè¶…è¿‡ 50 è¡Œéœ€è¦æ‹†åˆ†ï¼‰
- âŒ ç¡¬ç¼–ç é…ç½®ï¼ˆä½¿ç”¨é…ç½®æ–‡ä»¶ï¼‰
- âŒ æ³¨é‡Šæ‰çš„ä»£ç ï¼ˆåˆ é™¤è€Œéæ³¨é‡Šï¼‰

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **DRY åŸåˆ™**ï¼šä½†ä¸è¦è¿‡åº¦æŠ½è±¡ï¼Œç®€å•é‡å¤ä¼˜äºå¤æ‚æŠ½è±¡
2. **KISS åŸåˆ™**ï¼šä¿æŒç®€å•ï¼Œé¿å…è¿‡åº¦è®¾è®¡
3. **YAGNI åŸåˆ™**ï¼šä¸è¦å®ç°å½“å‰ä¸éœ€è¦çš„åŠŸèƒ½
4. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªå‡½æ•°/ç±»åªåšä¸€ä»¶äº‹
5. **å¼€é—­åŸåˆ™**ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­

---

**æœ€åæ›´æ–°**: 2025-12-06  
**é€‚ç”¨é¡¹ç›®**: TRQuant é‡åŒ–æŠ•èµ„ç³»ç»Ÿ  
**å‚è€ƒ**: Compound Engineering Philosophy

