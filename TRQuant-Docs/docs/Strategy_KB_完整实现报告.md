# Strategy KBï¼ˆé‡‘èçŸ¥è¯†åº“ï¼‰å®Œæ•´å®ç°æŠ¥å‘Š

> **å®Œæˆæ—¶é—´**: 2025-12-10  
> **çŠ¶æ€**: âœ… å…¨éƒ¨å®Œæˆå¹¶æµ‹è¯•é€šè¿‡

---

## ğŸ“‹ å®ç°æ€»è§ˆ

### æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| **ç ”ç©¶å¡** | âœ… 100% | 20å¼ ç ”ç©¶å¡ï¼Œè¦†ç›–5ç±»ç­–ç•¥ |
| **è§„åˆ™æ–‡ä»¶** | âœ… 100% | 5ä¸ªYAMLè§„åˆ™æ–‡ä»¶ |
| **å‘é‡æ£€ç´¢** | âœ… 100% | Chroma + BM25ï¼Œå·²æµ‹è¯•é€šè¿‡ |
| **MCPå·¥å…·** | âœ… 100% | 7ä¸ªå·¥å…·å…¨éƒ¨å®ç° |
| **Workflowé›†æˆ** | âœ… 100% | ç­–ç•¥ç”Ÿæˆæµç¨‹é›†æˆå®Œæˆ |

---

## ğŸ“Š ç ”ç©¶å¡ç»Ÿè®¡

### åˆ†å¸ƒæƒ…å†µ

- **åŠ¨é‡ç­–ç•¥**: 6å¼ 
  - card_001: å°å¸‚å€¼å› å­
  - card_002: è¶‹åŠ¿è·Ÿè¸ª
  - card_003: åŠ¨é‡å› å­ç»„åˆ
  - card_004: ä»·æ ¼åŠ¨é‡
  - card_013: æˆäº¤é‡åŠ¨é‡
  - card_018: çªç ´ç­–ç•¥

- **å‡å€¼å›å½’**: 4å¼ 
  - card_005: å‡å€¼å›å½’
  - card_006: é…å¯¹äº¤æ˜“
  - card_014: RSIå‡å€¼å›å½’
  - card_019: å¸ƒæ—å¸¦å‡å€¼å›å½’

- **è´¨é‡æˆé•¿**: 4å¼ 
  - card_007: è´¨é‡å› å­
  - card_008: æˆé•¿å› å­
  - card_015: ä»·å€¼å› å­
  - card_020: ä½æ³¢åŠ¨ç‡

- **äº‹ä»¶é©±åŠ¨**: 3å¼ 
  - card_009: ä¸šç»©å…¬å‘Š
  - card_010: åˆ†çº¢äº‹ä»¶
  - card_016: å¹¶è´­é‡ç»„äº‹ä»¶

- **è¡Œä¸šè½®åŠ¨**: 3å¼ 
  - card_011: è¡Œä¸šè½®åŠ¨
  - card_012: è¡Œä¸šåŠ¨é‡
  - card_017: é£æ ¼è½®åŠ¨

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### 1. Strategy KB Server

**æ–‡ä»¶**: `mcp_servers/strategy_kb_server.py`

**å·¥å…·**:
- `strategy_kb.rule.get` - è·å–è§„åˆ™
- `strategy_kb.rule.validate` - æ ¡éªŒç­–ç•¥
- `strategy_kb.card.create/read/search` - ç ”ç©¶å¡CRUD
- `strategy_kb.query` - å‘é‡æ£€ç´¢
- `strategy_kb.version.get` - è·å–ç‰ˆæœ¬

**æŠ€æœ¯æ ˆ**:
- LangChainç”Ÿæ€ï¼ˆChroma + HuggingFaceEmbeddingsï¼‰
- BM25å…³é”®è¯æ£€ç´¢
- YAMLè§„åˆ™å¼•æ“

### 2. Workflowé›†æˆ

**æ–‡ä»¶**: 
- `mcp_servers/workflow_server_strategy_integration.py` - é›†æˆå‡½æ•°
- `mcp_servers/workflow_server.py` - å·²æ›´æ–°

**å·¥å…·**:
- `workflow.strategy.generate_candidate` - ç”Ÿæˆå€™é€‰ç­–ç•¥

**åŠŸèƒ½**:
- è§„åˆ™çº¦æŸç­–ç•¥ç”Ÿæˆ
- ç ”ç©¶å¡æ£€ç´¢ä¸å¼•ç”¨
- ç­–ç•¥è‰æ¡ˆè‡ªåŠ¨æ ¡éªŒ
- ç‰ˆæœ¬ç»‘å®š

---

## ğŸ§ª æµ‹è¯•ç»“æœ

### æµ‹è¯•è¦†ç›–

âœ… **Strategy KBå¯ç”¨æ€§æ£€æŸ¥**
- è§„åˆ™è·å–: æ­£å¸¸
- ç ”ç©¶å¡æ£€ç´¢: æ­£å¸¸

âœ… **ç­–ç•¥ç”ŸæˆåŠŸèƒ½**
- åŸºç¡€ç”Ÿæˆï¼ˆæ— ç ”ç©¶å¡æŸ¥è¯¢ï¼‰: âœ… é€šè¿‡
- å¸¦ç ”ç©¶å¡æŸ¥è¯¢: âœ… é€šè¿‡ï¼ˆè¿”å›5ä¸ªå¼•ç”¨ï¼‰
- è§„åˆ™æ ¡éªŒ: âœ… é€šè¿‡ï¼ˆèƒ½æ­£ç¡®æ£€æµ‹è¿è§„ï¼‰

### æµ‹è¯•è„šæœ¬

- `scripts/test_strategy_kb.py` - Strategy KBåŸºç¡€åŠŸèƒ½æµ‹è¯•
- `scripts/test_strategy_kb_workflow.py` - Workflowé›†æˆæµ‹è¯•

---

## ğŸ“š æ–‡æ¡£æ¸…å•

### è®¾è®¡æ–‡æ¡£
- âœ… `docs/Strategy_KB_è®¾è®¡æ–‡æ¡£.md` - å®Œæ•´è®¾è®¡æ–‡æ¡£
- âœ… `docs/Strategy_KB_Workflowé›†æˆæ–¹æ¡ˆ.md` - é›†æˆæ–¹æ¡ˆ

### ä½¿ç”¨æ–‡æ¡£
- âœ… `docs/Strategy_KB_ä½¿ç”¨æ•™ç¨‹.md` - è¯¦ç»†ä½¿ç”¨æ•™ç¨‹
- âœ… `docs/Strategy_KB_Workflowé›†æˆç®€æ˜æ•™ç¨‹.md` - ç®€æ˜æ•™ç¨‹

### å®æ–½æ–‡æ¡£
- âœ… `docs/Strategy_KB_å®æ–½æ¸…å•.md` - å®æ–½æ¸…å•
- âœ… `docs/Strategy_KB_å®Œæˆæ€»ç»“.md` - å®Œæˆæ€»ç»“

---

## ğŸ¯ å…³é”®ç‰¹æ€§

### 1. ç»“æ„åŒ–ä¼˜å…ˆ
- è§„åˆ™/çº¦æŸ/æ¨¡æ¿å…ˆç»“æ„åŒ–ï¼ˆYAMLï¼‰
- ç ”ç©¶å¡ä½¿ç”¨Markdown frontmatter
- ç¡¬çº¦æŸä¸èµ°å‘é‡æ£€ç´¢ï¼Œèµ°è§„åˆ™å¼•æ“

### 2. å¼•ç”¨å¼ºåˆ¶
- ç­–ç•¥å»ºè®®å¿…é¡»ç»™research card/è§„åˆ™å¼•ç”¨
- æŸ¥è¯¢ç»“æœåŒ…å«citationsï¼ˆå¸¦æ–‡ä»¶è·¯å¾„ã€ç‰ˆæœ¬ï¼‰

### 3. è¯æ®é—­ç¯
- ç ”ç©¶å¡åŒ…å«`backtest_report_ids`
- ç‰ˆæœ¬ç»‘å®šï¼ˆkb_version + factor_version + template_versionï¼‰

### 4. å‘é‡æ£€ç´¢
- ä½¿ç”¨LangChainç”Ÿæ€ï¼ˆChroma + HuggingFaceEmbeddingsï¼‰
- æ”¯æŒè‡ªåŠ¨åŠ è½½/æ„å»ºç´¢å¼•
- é™çº§æœºåˆ¶ï¼ˆç´¢å¼•ä¸å¯ç”¨æ—¶ä½¿ç”¨ç®€å•æœç´¢ï¼‰

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
docs/strategy_kb/
â”œâ”€â”€ rules/                    # è§„åˆ™æ–‡ä»¶ï¼ˆ5ä¸ªYAMLï¼‰
â”œâ”€â”€ cards/                    # ç ”ç©¶å¡ï¼ˆ20å¼ ï¼‰
â”‚   â”œâ”€â”€ momentum/            # 6å¼ 
â”‚   â”œâ”€â”€ mean_reversion/      # 4å¼ 
â”‚   â”œâ”€â”€ quality_growth/      # 4å¼ 
â”‚   â”œâ”€â”€ event_driven/        # 3å¼ 
â”‚   â””â”€â”€ sector_rotation/     # 3å¼ 
â”œâ”€â”€ materials/               # åŸå§‹èµ„æ–™ï¼ˆå¾…å¡«å……ï¼‰
â””â”€â”€ evidence/                # è¯æ®ï¼ˆå¾…å¡«å……ï¼‰

mcp_servers/
â”œâ”€â”€ strategy_kb_server.py    # Strategy KBæœåŠ¡å™¨
â””â”€â”€ workflow_server_strategy_integration.py  # Workflowé›†æˆ

scripts/
â”œâ”€â”€ test_strategy_kb.py      # Strategy KBæµ‹è¯•
â”œâ”€â”€ test_strategy_kb_workflow.py  # Workflowé›†æˆæµ‹è¯•
â””â”€â”€ build_strategy_kb_index.py    # ç´¢å¼•æ„å»ºè„šæœ¬
```

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹

1. **æ„å»ºç´¢å¼•**ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰
   ```bash
   python scripts/build_strategy_kb_index.py
   ```

2. **ç”Ÿæˆç­–ç•¥**
   ```python
   # é€šè¿‡MCPå·¥å…·è°ƒç”¨
   workflow.strategy.generate_candidate({
       "mainline": "å°å¸‚å€¼å› å­æœ‰æ•ˆæ€§",
       "candidate_pool": ["000001", "000002"],
       "factors": ["factor_market_cap"],
       "research_query": "å°å¸‚å€¼ç­–ç•¥"
   })
   ```

3. **æŸ¥çœ‹æ•™ç¨‹**
   - ç®€æ˜æ•™ç¨‹: `docs/Strategy_KB_Workflowé›†æˆç®€æ˜æ•™ç¨‹.md`
   - è¯¦ç»†æ•™ç¨‹: `docs/Strategy_KB_ä½¿ç”¨æ•™ç¨‹.md`

---

## âœ… éªŒæ”¶æ ‡å‡†

- [x] ç›®å½•ç»“æ„å®Œæ•´
- [x] 5ä¸ªè§„åˆ™æ–‡ä»¶ï¼ˆYAMLæ ¼å¼ï¼‰
- [x] 20å¼ ç ”ç©¶å¡ï¼ˆè¦†ç›–5ç±»ç­–ç•¥ï¼‰
- [x] 7ä¸ªP0å·¥å…·å…¨éƒ¨å®ç°
- [x] å‘é‡æ£€ç´¢åŠŸèƒ½å®ç°å¹¶æµ‹è¯•é€šè¿‡
- [x] Workflowé›†æˆå®Œæˆå¹¶æµ‹è¯•é€šè¿‡
- [x] MCPé…ç½®æ›´æ–°
- [x] æµ‹è¯•è„šæœ¬å’Œæ–‡æ¡£å®Œæ•´

---

## ğŸ“‹ ä¸‹ä¸€æ­¥

### P1å¢å¼ºåŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

1. **å¢é‡æ›´æ–°æœºåˆ¶**
   - `strategy_kb.index.update` - å¢é‡æ›´æ–°ç´¢å¼•
   - ç ”ç©¶å¡å˜æ›´è§¦å‘ç´¢å¼•æ›´æ–°

2. **è´¨é‡ä¿éšœ**
   - ç ”ç©¶å¡è´¨é‡æ£€æŸ¥ï¼ˆå¿…å¡«å­—æ®µã€æ ¼å¼éªŒè¯ï¼‰
   - è§„åˆ™ä¸€è‡´æ€§æ£€æŸ¥

3. **åŸå§‹èµ„æ–™å±‚**
   - ç ”æŠ¥/è®ºæ–‡/ä¼šè®®çºªè¦çš„å‘é‡åŒ–ç´¢å¼•
   - å¼•ç”¨é©±åŠ¨æ£€ç´¢

---

*æœ€åæ›´æ–°: 2025-12-10*
