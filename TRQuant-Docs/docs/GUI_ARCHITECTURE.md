# TRQuant GUI架构设计

> **设计时间**: 2025-12-15
> **架构版本**: 2.0

## 📋 GUI定位

TRQuant系统采用**双GUI架构**，分别服务于不同的工作流程：

### 1. 研究型GUI (Research GUI)
**定位**: 信息获取 → 因子推荐等研究步骤

**功能范围**:
- 📊 市场状态分析
- 📈 投资主线识别
- 🔍 因子研究和推荐
- 📝 研究报告生成
- 💡 策略思路探索

**适用场景**:
- 量化研究员
- 策略分析师
- 数据科学家

**技术栈**: (待确认原有GUI技术栈)

---

### 2. 工程型GUI (Engineering GUI)
**定位**: 策略生成 → 回测 → 优化 → 实盘

**功能范围**:
- 📋 策略库管理
- ⚙️ 策略生成和配置
- ▶️ 回测执行（BulletTrade/QMT/快速回测）
- 📊 回测结果分析
- 🔧 策略优化（Optuna/网格搜索）
- 🏦 券商App回测
- 📄 报告生成和查看
- 🚀 实盘交易（待开发）

**适用场景**:
- 策略工程师
- 量化交易员
- 系统运维人员

**技术栈**: PyQt6

**文件位置**: `gui/main_window_v2.py`

---

## 🏗️ 架构图

```
┌─────────────────────────────────────────────────────────┐
│                    TRQuant 系统                           │
└─────────────────────────────────────────────────────────┘
                            │
        ┌───────────────────┴───────────────────┐
        │                                       │
┌───────▼────────┐                    ┌────────▼────────┐
│  研究型GUI      │                    │   工程型GUI      │
│  Research GUI  │                    │ Engineering GUI │
├────────────────┤                    ├─────────────────┤
│ • 市场分析      │                    │ • 策略管理       │
│ • 主线识别      │                    │ • 回测执行       │
│ • 因子推荐      │                    │ • 结果分析       │
│ • 研究报告      │                    │ • 策略优化       │
│                │                    │ • 券商回测       │
│                │                    │ • 实盘交易       │
└────────────────┘                    └─────────────────┘
        │                                       │
        └───────────────────┬───────────────────┘
                            │
                    ┌───────▼────────┐
                    │   MCP统一层     │
                    │  (core/mcp/)   │
                    └───────┬────────┘
                            │
        ┌───────────────────┼───────────────────┐
        │                   │                   │
┌───────▼────────┐  ┌───────▼────────┐  ┌───────▼────────┐
│  MCP服务器集群  │  │   核心引擎      │  │   数据层        │
│                │  │                │  │                │
│ • market       │  │ • BulletTrade  │  │ • MongoDB      │
│ • factor       │  │ • QMT          │  │ • JQData       │
│ • workflow     │  │ • Optuna       │  │ • 文件系统      │
│ • backtest     │  │ • 策略生成器    │  │                │
│ • optimizer    │  │                │  │                │
└────────────────┘  └────────────────┘  └────────────────┘
```

---

## 📁 文件组织

### 研究型GUI
```
gui/research/
├── main_window.py          # 研究型主窗口
├── widgets/
│   ├── market_panel.py     # 市场分析面板
│   ├── mainline_panel.py   # 主线识别面板
│   ├── factor_panel.py     # 因子研究面板
│   └── report_panel.py     # 研究报告面板
└── ...
```

### 工程型GUI
```
gui/
├── main_window_v2.py       # 工程型主窗口 ⭐
├── widgets/
│   ├── strategy_manager_panel.py    # 策略管理
│   ├── backtest_progress_panel.py   # 回测进度
│   ├── backtest_result_panel.py    # 结果分析
│   ├── report_viewer_panel.py      # 报告查看
│   └── optimizer_panel.py          # 优化面板（待开发）
└── ...
```

---

## 🔄 工作流程

### 研究流程 (Research Workflow)
```
市场分析 → 主线识别 → 因子推荐 → 因子研究 → 策略思路 → 研究报告
   ↓          ↓          ↓          ↓          ↓          ↓
研究型GUI ←──────────────────────────────────────────────┐
                                                          │
                                                          ↓
```

### 工程流程 (Engineering Workflow)
```
策略生成 → 回测执行 → 结果分析 → 策略优化 → 券商回测 → 实盘交易
   ↓          ↓          ↓          ↓          ↓          ↓
工程型GUI ←──────────────────────────────────────────────┐
                                                          │
                                                          ↓
```

### 完整流程 (Full Workflow)
```
研究阶段 (研究型GUI)
    ↓
策略思路
    ↓
工程阶段 (工程型GUI)
    ↓
策略实现 → 回测 → 优化 → 实盘
```

---

## 🎯 设计原则

1. **职责分离**: 研究型专注研究，工程型专注实现
2. **统一接口**: 都通过MCP统一层调用后端服务
3. **数据共享**: 通过MongoDB共享研究结果和策略数据
4. **独立运行**: 两个GUI可以独立启动和使用
5. **渐进增强**: 工程型GUI逐步增加实盘等功能

---

## 📝 开发计划

### 研究型GUI (待完善)
- [ ] 确认原有GUI技术栈
- [ ] 重构为研究型定位
- [ ] 集成市场分析MCP工具
- [ ] 集成因子推荐MCP工具
- [ ] 研究报告生成

### 工程型GUI (当前版本)
- [x] 策略管理面板
- [x] 回测进度面板
- [x] 结果分析面板
- [x] 报告查看面板
- [ ] 策略优化面板
- [ ] 券商App回测集成
- [ ] 实盘交易面板（待开发）

---

## 🚀 启动方式

### 研究型GUI
```bash
python -m gui.research.main_window
```

### 工程型GUI
```bash
python -m gui.main_window_v2
# 或
python scripts/test_gui.py
```

---

## 📊 功能对比

| 功能模块 | 研究型GUI | 工程型GUI |
|---------|----------|----------|
| 市场分析 | ✅ | ❌ |
| 主线识别 | ✅ | ❌ |
| 因子推荐 | ✅ | ❌ |
| 策略管理 | ❌ | ✅ |
| 回测执行 | ❌ | ✅ |
| 结果分析 | ❌ | ✅ |
| 策略优化 | ❌ | ✅ |
| 券商回测 | ❌ | ✅ |
| 实盘交易 | ❌ | ⏳ |

---

**架构设计完成！** 🎉
