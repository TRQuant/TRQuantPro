---
title: "3.4 MCPå·¥å…·é›†æˆ"
description: "æ·±å…¥è§£æå¸‚åœºåˆ†ææ¨¡å—çš„MCPå·¥å…·é›†æˆï¼ŒåŒ…æ‹¬trquant_market_statusã€trquant_mainlinesã€çŸ¥è¯†åº“æŸ¥è¯¢ç­‰å·¥å…·çš„ä½¿ç”¨"
lang: "zh-CN"
layout: "/src/layouts/HandbookLayout.astro"
currentBook: "ashare-book6"
updateDate: "2025-12-12"
---

# ğŸ› ï¸ 3.4 MCPå·¥å…·é›†æˆ

> **æ ¸å¿ƒæ‘˜è¦ï¼š**
> 
> æœ¬èŠ‚ç³»ç»Ÿä»‹ç»å¸‚åœºåˆ†ææ¨¡å—ä¸MCPå·¥å…·çš„æ·±åº¦é›†æˆï¼Œæ”¯æŒé€šè¿‡MCPå·¥å…·è¿›è¡Œå¸‚åœºçŠ¶æ€æŸ¥è¯¢ã€æŠ•èµ„ä¸»çº¿è·å–ã€çŸ¥è¯†åº“æŸ¥è¯¢å’Œæ•°æ®æ”¶é›†ã€‚é€šè¿‡ç†è§£TRQuant MCPå·¥å…·ã€KB MCP Serverå·¥å…·å’ŒData Collectorå·¥å…·çš„ä½¿ç”¨æ–¹æ³•ã€å‚æ•°è¯´æ˜ã€è¿”å›ç»“æœå’Œåº”ç”¨åœºæ™¯ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡å¦‚ä½•ä½¿ç”¨MCPå·¥å…·æå‡å¸‚åœºåˆ†ææ•ˆç‡ï¼Œå®ç°AIå¢å¼ºçš„å¸‚åœºåˆ†æèƒ½åŠ›ã€‚

å¸‚åœºåˆ†ææ¨¡å—ä¸MCPå·¥å…·æ·±åº¦é›†æˆï¼Œæä¾›å¸‚åœºçŠ¶æ€æŸ¥è¯¢ã€æŠ•èµ„ä¸»çº¿è·å–ã€çŸ¥è¯†åº“æŸ¥è¯¢ç­‰åŠŸèƒ½ã€‚

## ğŸ“‹ ç« èŠ‚æ¦‚è§ˆ

<script>
function scrollToSection(sectionId) {
  const element = document.getElementById(sectionId);
  if (element) {
    const headerOffset = 100;
    const elementPosition = element.getBoundingClientRect().top;
    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
    window.scrollTo({
      top: offsetPosition,
      behavior: 'smooth'
    });
  }
}
</script>

<div class="section-overview">
  <div class="section-item" onclick="scrollToSection('section-3-4-1')">
    <h4>ğŸ“Š 3.4.1 TRQuant MCPå·¥å…·</h4>
    <p>trquant_market_statusã€trquant_mainlineså·¥å…·çš„ä½¿ç”¨æ–¹æ³•å’Œåº”ç”¨åœºæ™¯</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-3-4-2')">
    <h4>ğŸ” 3.4.2 KB MCP Serverå·¥å…·</h4>
    <p>kb.queryçŸ¥è¯†åº“æŸ¥è¯¢å·¥å…·çš„ä½¿ç”¨æ–¹æ³•å’ŒæŸ¥è¯¢æŠ€å·§</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-3-4-3')">
    <h4>ğŸ“¥ 3.4.3 Data Collectorå·¥å…·</h4>
    <p>data_collector.crawl_webç½‘é¡µçˆ¬å–å·¥å…·çš„ä½¿ç”¨æ–¹æ³•å’Œæ•°æ®æ”¶é›†</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-3-4-4')">
    <h4>ğŸ”„ 3.4.4 å·¥å…·é›†æˆå·¥ä½œæµ</h4>
    <p>MCPå·¥å…·åœ¨å¸‚åœºåˆ†æä¸­çš„å®Œæ•´å·¥ä½œæµå’Œæœ€ä½³å®è·µ</p>
  </div>
</div>

## ğŸ¯ å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬èŠ‚å­¦ä¹ ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š

- **ä½¿ç”¨TRQuant MCPå·¥å…·**ï¼šæŒæ¡å¸‚åœºçŠ¶æ€æŸ¥è¯¢å’ŒæŠ•èµ„ä¸»çº¿è·å–çš„å®Œæ•´æ–¹æ³•
- **ä½¿ç”¨KB MCPå·¥å…·**ï¼šæŒæ¡çŸ¥è¯†åº“æŸ¥è¯¢æ–¹æ³•å’ŒæŸ¥è¯¢æŠ€å·§
- **ä½¿ç”¨Data Collectorå·¥å…·**ï¼šæŒæ¡æ•°æ®æ”¶é›†æ–¹æ³•å’Œæ•°æ®å¤„ç†
- **æ„å»ºå·¥å…·é›†æˆå·¥ä½œæµ**ï¼šç†è§£MCPå·¥å…·åœ¨å¸‚åœºåˆ†æä¸­çš„å®Œæ•´åº”ç”¨æµç¨‹

## ğŸ“š æ ¸å¿ƒæ¦‚å¿µ

### MCPå·¥å…·é›†æˆæ¶æ„

å¸‚åœºåˆ†ææ¨¡å—é€šè¿‡MCPï¼ˆModel Context Protocolï¼‰åè®®ä¸AIå·¥å…·é“¾æ·±åº¦é›†æˆï¼š

1. **TRQuant MCP Server**ï¼šæä¾›å¸‚åœºåˆ†æç›¸å…³çš„ä¸“ä¸šå·¥å…·
2. **KB MCP Server**ï¼šæä¾›çŸ¥è¯†åº“æŸ¥è¯¢èƒ½åŠ›
3. **Data Collector MCP Server**ï¼šæä¾›æ•°æ®æ”¶é›†èƒ½åŠ›

### å·¥å…·è°ƒç”¨æ–¹å¼

åœ¨Cursorä¸­ï¼ŒMCPå·¥å…·å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è°ƒç”¨ï¼š

1. **ç›´æ¥è°ƒç”¨**ï¼šåœ¨AIå¯¹è¯ä¸­ç›´æ¥è¯·æ±‚ä½¿ç”¨å·¥å…·
2. **å‘½ä»¤è°ƒç”¨**ï¼šé€šè¿‡å‘½ä»¤é¢æ¿æ‰§è¡Œç›¸å…³å‘½ä»¤
3. **ä»£ç è°ƒç”¨**ï¼šåœ¨Pythonä»£ç ä¸­é€šè¿‡MCPå®¢æˆ·ç«¯è°ƒç”¨

<h2 id="section-3-4-1">ğŸ“Š 3.4.1 TRQuant MCPå·¥å…·</h2>

TRQuant MCPå·¥å…·æä¾›å¸‚åœºåˆ†æç›¸å…³çš„ä¸“ä¸šåŠŸèƒ½ï¼ŒåŒ…æ‹¬å¸‚åœºçŠ¶æ€æŸ¥è¯¢å’ŒæŠ•èµ„ä¸»çº¿è·å–ã€‚

### trquant_market_status

è·å–Aè‚¡å¸‚åœºå½“å‰çŠ¶æ€ï¼ŒåŒ…æ‹¬å¸‚åœºRegimeï¼ˆrisk_on/risk_off/neutralï¼‰ã€æŒ‡æ•°è¶‹åŠ¿å’Œé£æ ¼è½®åŠ¨ã€‚

#### å·¥å…·å®šä¹‰

```python
MCPTool(
    name="trquant_market_status",
    description="è·å–Aè‚¡å¸‚åœºå½“å‰çŠ¶æ€ï¼ŒåŒ…æ‹¬å¸‚åœºRegimeï¼ˆrisk_on/risk_off/neutralï¼‰ã€æŒ‡æ•°è¶‹åŠ¿å’Œé£æ ¼è½®åŠ¨",
    input_schema={
        "type": "object",
        "properties": {
            "universe": {
                "type": "string",
                "description": "å¸‚åœºï¼Œé»˜è®¤CN_EQè¡¨ç¤ºAè‚¡",
                "default": "CN_EQ"
            }
        },
        "required": []
    }
)
```

#### å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| universe | string | å¦ | "CN_EQ" | å¸‚åœºæ ‡è¯†ï¼ŒCN_EQè¡¨ç¤ºAè‚¡å¸‚åœº |

#### ä½¿ç”¨ç¤ºä¾‹

**åœ¨Cursor AIå¯¹è¯ä¸­ä½¿ç”¨**ï¼š

```
ç”¨æˆ·: ç°åœ¨Aè‚¡å¸‚åœºçŠ¶æ€å¦‚ä½•ï¼Ÿ

AI: è®©æˆ‘è°ƒç”¨TRQuantå·¥å…·æŸ¥çœ‹å½“å‰å¸‚åœºçŠ¶æ€...
[è°ƒç”¨ trquant_market_status]
```

**åœ¨Pythonä»£ç ä¸­ä½¿ç”¨**ï¼š

```python
from mcp import MCPClient

# åˆå§‹åŒ–MCPå®¢æˆ·ç«¯
client = MCPClient(server_url="http://localhost:8000")

# è°ƒç”¨å·¥å…·
result = client.call_tool(
    "trquant_market_status",
    {"universe": "CN_EQ"}
)

# å¤„ç†ç»“æœ
regime = result["regime"]
index_trend = result["index_trend"]
style_rotation = result["style_rotation"]

print(f"å¸‚åœºçŠ¶æ€: {regime}")
print(f"æŒ‡æ•°è¶‹åŠ¿: {index_trend}")
print(f"é£æ ¼è½®åŠ¨: {style_rotation}")
```

#### è¿”å›ç»“æœ

```python
{
    "regime": "risk_on",  # å¸‚åœºçŠ¶æ€ï¼šrisk_on/risk_off/neutral
    "index_trend": {
        "shanghai": "up",      # ä¸Šè¯æŒ‡æ•°è¶‹åŠ¿ï¼šup/down/sideways
        "shenzhen": "up",      # æ·±è¯æˆæŒ‡è¶‹åŠ¿
        "chuangye": "up"       # åˆ›ä¸šæ¿æŒ‡è¶‹åŠ¿
    },
    "style_rotation": {
        "large_cap": 0.6,      # å¤§ç›˜è‚¡é£æ ¼å¼ºåº¦ï¼ˆ0-1ï¼‰
        "mid_cap": 0.3,        # ä¸­ç›˜è‚¡é£æ ¼å¼ºåº¦
        "small_cap": 0.1       # å°ç›˜è‚¡é£æ ¼å¼ºåº¦
    },
    "timestamp": "2025-12-12T10:00:00"
}
```

#### ç»“æœè§£è¯»

**å¸‚åœºRegime**ï¼š

| Regime | å«ä¹‰ | å¸‚åœºç‰¹å¾ | æŠ•èµ„å»ºè®® |
|--------|------|----------|----------|
| risk_on | é£é™©åå¥½ä¸Šå‡ | å¸‚åœºæƒ…ç»ªä¹è§‚ï¼Œæˆé•¿è‚¡è¡¨ç°å¥½ | é…ç½®æˆé•¿è‚¡ã€é«˜Betaè‚¡ç¥¨ |
| risk_off | é£é™©åå¥½ä¸‹é™ | å¸‚åœºæƒ…ç»ªæ‚²è§‚ï¼Œä»·å€¼è‚¡è¡¨ç°å¥½ | é…ç½®ä»·å€¼è‚¡ã€é˜²å¾¡æ€§è‚¡ç¥¨ |
| neutral | éœ‡è¡ | å¸‚åœºæƒ…ç»ªä¸­æ€§ï¼Œæ— æ˜æ˜¾æ–¹å‘ | å‡è¡¡é…ç½®ã€ä¸­æ€§ç­–ç•¥ |

**æŒ‡æ•°è¶‹åŠ¿**ï¼š

- `up`ï¼šä¸Šæ¶¨è¶‹åŠ¿ï¼ŒåŠ¨é‡Z-Score > 0.5
- `down`ï¼šä¸‹è·Œè¶‹åŠ¿ï¼ŒåŠ¨é‡Z-Score < -0.5
- `sideways`ï¼šæ¨ªç›˜éœ‡è¡ï¼Œ-0.5 â‰¤ åŠ¨é‡Z-Score â‰¤ 0.5

**é£æ ¼è½®åŠ¨**ï¼š

- æ•°å€¼èŒƒå›´ï¼š0-1ï¼Œæ•°å€¼è¶Šå¤§è¡¨ç¤ºè¯¥é£æ ¼è¶Šå¼º
- æ€»å’Œä¸º1ï¼Œè¡¨ç¤ºé£æ ¼è½®åŠ¨çš„ç›¸å¯¹å¼ºåº¦

#### åº”ç”¨åœºæ™¯

1. **ç­–ç•¥æ–¹å‘é€‰æ‹©**ï¼šæ ¹æ®å¸‚åœºRegimeé€‰æ‹©é€‚åˆçš„ç­–ç•¥é£æ ¼
2. **å› å­æ¨è**ï¼šæ ¹æ®å¸‚åœºçŠ¶æ€æ¨èç›¸åº”çš„å› å­
3. **é£é™©æ§åˆ¶**ï¼šæ ¹æ®å¸‚åœºçŠ¶æ€è°ƒæ•´ä»“ä½å’Œé£é™©å‚æ•°
4. **ç­–ç•¥ä¼˜åŒ–**ï¼šæ ¹æ®å¸‚åœºçŠ¶æ€åŠ¨æ€ä¼˜åŒ–ç­–ç•¥å‚æ•°

### trquant_mainlines

è·å–å½“å‰Aè‚¡å¸‚åœºçš„æŠ•èµ„ä¸»çº¿ï¼ŒåŒ…æ‹¬ä¸»çº¿åç§°ã€è¯„åˆ†ã€ç›¸å…³è¡Œä¸šå’ŒæŠ•èµ„é€»è¾‘ã€‚

#### å·¥å…·å®šä¹‰

```python
MCPTool(
    name="trquant_mainlines",
    description="è·å–å½“å‰Aè‚¡å¸‚åœºçš„æŠ•èµ„ä¸»çº¿ï¼ŒåŒ…æ‹¬ä¸»çº¿åç§°ã€è¯„åˆ†ã€ç›¸å…³è¡Œä¸šå’ŒæŠ•èµ„é€»è¾‘",
    input_schema={
        "type": "object",
        "properties": {
            "top_n": {
                "type": "integer",
                "description": "è¿”å›å‰Næ¡ä¸»çº¿ï¼Œé»˜è®¤10",
                "default": 10
            },
            "time_horizon": {
                "type": "string",
                "enum": ["short", "medium", "long"],
                "description": "æŠ•èµ„å‘¨æœŸï¼šshort(1-5å¤©)ã€medium(1-4å‘¨)ã€long(1æœˆ+)",
                "default": "short"
            }
        },
        "required": []
    }
)
```

#### å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| top_n | integer | å¦ | 10 | è¿”å›å‰Næ¡ä¸»çº¿ï¼ŒèŒƒå›´1-50 |
| time_horizon | string | å¦ | "short" | æŠ•èµ„å‘¨æœŸï¼šshort(1-5å¤©)/medium(1-4å‘¨)/long(1æœˆ+) |

#### ä½¿ç”¨ç¤ºä¾‹

**åœ¨Cursor AIå¯¹è¯ä¸­ä½¿ç”¨**ï¼š

```
ç”¨æˆ·: å¸®æˆ‘è·å–å½“å‰å¸‚åœºçš„æŠ•èµ„ä¸»çº¿

AI: è®©æˆ‘è°ƒç”¨TRQuantå·¥å…·è·å–æŠ•èµ„ä¸»çº¿...
[è°ƒç”¨ trquant_mainlines]
```

**åœ¨Pythonä»£ç ä¸­ä½¿ç”¨**ï¼š

```python
# è·å–çŸ­æœŸæŠ•èµ„ä¸»çº¿
short_mainlines = client.call_tool(
    "trquant_mainlines",
    {
        "time_horizon": "short",
        "top_n": 10
    }
)

# è·å–ä¸­æœŸæŠ•èµ„ä¸»çº¿
medium_mainlines = client.call_tool(
    "trquant_mainlines",
    {
        "time_horizon": "medium",
        "top_n": 20
    }
)

# å¤„ç†ç»“æœ
for mainline in short_mainlines:
    if mainline['score'] >= 80:
        print(f"é«˜è¯„åˆ†ä¸»çº¿: {mainline['name']}")
        print(f"ç›¸å…³è¡Œä¸š: {mainline['industries']}")
        print(f"æŠ•èµ„é€»è¾‘: {mainline['logic']}")
```

#### è¿”å›ç»“æœ

```python
[
    {
        "name": "AIç®—åŠ›åŸºç¡€è®¾æ–½",
        "score": 85,
        "industries": ["åŠå¯¼ä½“è®¾å¤‡", "æœåŠ¡å™¨", "å…‰æ¨¡å—"],
        "logic": "AIåº”ç”¨çˆ†å‘å¸¦åŠ¨ç®—åŠ›éœ€æ±‚ï¼Œæ”¿ç­–æ”¯æŒç®—åŠ›åŸºç¡€è®¾æ–½å»ºè®¾ï¼Œç›¸å…³å…¬å¸ä¸šç»©å¢é•¿ç¡®å®šæ€§å¼º",
        "stage": "growing",        # ç”Ÿå‘½å‘¨æœŸé˜¶æ®µï¼šemerging/growing/mature/declining
        "type": "industry",        # ä¸»çº¿ç±»å‹ï¼špolicy/industry/event/cycle/theme
        "recommendation": "strong_buy",  # æ¨èç­‰çº§ï¼šstrong_buy/buy/hold/sell
        "position_suggestion": 0.3      # å»ºè®®ä»“ä½ï¼ˆ0-1ï¼‰
    },
    # ... æ›´å¤šä¸»çº¿
]
```

#### ç»“æœè§£è¯»

**ä¸»çº¿è¯„åˆ†**ï¼š

- è¯„åˆ†èŒƒå›´ï¼š0-100
- è¯„åˆ†è¶Šé«˜ï¼Œä¸»çº¿æŠ•èµ„ä»·å€¼è¶Šå¤§
- å»ºè®®å…³æ³¨è¯„åˆ†â‰¥80çš„ä¸»çº¿

**ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ**ï¼š

| é˜¶æ®µ | å«ä¹‰ | ç‰¹å¾ | æŠ•èµ„å»ºè®® |
|------|------|------|----------|
| emerging | å¯åŠ¨æœŸ | ä¸»çº¿åˆšå‡ºç°ï¼Œè¯„åˆ†è¾ƒä½ | è°¨æ…å‚ä¸ï¼Œå°ä»“ä½è¯•æ¢ |
| growing | æˆé•¿æœŸ | ä¸»çº¿å¿«é€Ÿå‘å±•ï¼Œè¯„åˆ†ä¸Šå‡ | ç§¯æé…ç½®ï¼ŒåŠ å¤§ä»“ä½ |
| mature | æˆç†ŸæœŸ | ä¸»çº¿ç¨³å®šå‘å±•ï¼Œè¯„åˆ†è¾ƒé«˜ | ç¨³å®šæŒæœ‰ï¼Œé€‚åº¦å‡ä»“ |
| declining | è¡°é€€æœŸ | ä¸»çº¿å¼€å§‹è¡°é€€ï¼Œè¯„åˆ†ä¸‹é™ | åŠæ—¶é€€å‡ºï¼Œé¿å…æŸå¤± |

**ä¸»çº¿ç±»å‹**ï¼š

- `policy`ï¼šæ”¿ç­–é©±åŠ¨å‹
- `industry`ï¼šäº§ä¸šè¶‹åŠ¿å‹
- `event`ï¼šäº‹ä»¶é©±åŠ¨å‹
- `cycle`ï¼šå‘¨æœŸè½®åŠ¨å‹
- `theme`ï¼šä¸»é¢˜æ¦‚å¿µå‹

#### åº”ç”¨åœºæ™¯

1. **å€™é€‰æ± æ„å»º**ï¼šæ ¹æ®æŠ•èµ„ä¸»çº¿æ„å»ºè‚¡ç¥¨å€™é€‰æ± 
2. **å› å­æ¨è**ï¼šæ ¹æ®ä¸»çº¿ç±»å‹æ¨èç›¸åº”çš„å› å­
3. **ç­–ç•¥ç”Ÿæˆ**ï¼šæ ¹æ®ä¸»çº¿ç”Ÿæˆç›¸åº”çš„æŠ•èµ„ç­–ç•¥
4. **ä»“ä½é…ç½®**ï¼šæ ¹æ®ä¸»çº¿è¯„åˆ†å’Œå»ºè®®ä»“ä½é…ç½®èµ„é‡‘

<h2 id="section-3-4-2">ğŸ” 3.4.2 KB MCP Serverå·¥å…·</h2>

KB MCP Serveræä¾›çŸ¥è¯†åº“æŸ¥è¯¢èƒ½åŠ›ï¼Œæ”¯æŒæŸ¥è¯¢å¼€å‘æ‰‹å†Œå’Œå·¥ç¨‹ä»£ç åº“ã€‚

### kb.query

æŸ¥è¯¢çŸ¥è¯†åº“ï¼Œè·å–å¸‚åœºåˆ†æç›¸å…³çš„æ–‡æ¡£å’Œä»£ç ã€‚

#### å·¥å…·å®šä¹‰

```python
MCPTool(
    name="kb.query",
    description="æŸ¥è¯¢çŸ¥è¯†åº“ï¼Œè·å–ç›¸å…³æ–‡æ¡£å’Œä»£ç ",
    input_schema={
        "type": "object",
        "properties": {
            "query": {
                "type": "string",
                "description": "æŸ¥è¯¢å…³é”®è¯æˆ–é—®é¢˜"
            },
            "collection": {
                "type": "string",
                "enum": ["manual_kb", "engineering_kb", "both"],
                "description": "æŸ¥è¯¢èŒƒå›´ï¼šmanual_kbï¼ˆæ‰‹å†Œï¼‰/engineering_kbï¼ˆä»£ç åº“ï¼‰/bothï¼ˆä¸¤è€…ï¼‰",
                "default": "both"
            },
            "top_k": {
                "type": "integer",
                "description": "è¿”å›å‰Kä¸ªç»“æœï¼Œé»˜è®¤5",
                "default": 5
            }
        },
        "required": ["query"]
    }
)
```

#### å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| query | string | æ˜¯ | - | æŸ¥è¯¢å…³é”®è¯æˆ–é—®é¢˜ |
| collection | string | å¦ | "both" | æŸ¥è¯¢èŒƒå›´ï¼šmanual_kb/engineering_kb/both |
| top_k | integer | å¦ | 5 | è¿”å›å‰Kä¸ªç»“æœï¼ŒèŒƒå›´1-20 |

#### ä½¿ç”¨ç¤ºä¾‹

**æŸ¥è¯¢å¸‚åœºåˆ†æç›¸å…³æ–‡æ¡£**ï¼š

```python
# æŸ¥è¯¢å¸‚åœºåˆ†æç›¸å…³çš„å¼€å‘æ–‡æ¡£
results = client.call_tool(
    "kb.query",
    {
        "query": "å¦‚ä½•åˆ¤æ–­å¸‚åœºè¶‹åŠ¿ï¼ŸæŠ€æœ¯æŒ‡æ ‡åˆ†ææ–¹æ³•",
        "collection": "manual_kb",
        "top_k": 5
    }
)

# å¤„ç†ç»“æœ
for result in results:
    print(f"æ–‡æ¡£: {result['title']}")
    print(f"ç›¸å…³æ€§: {result['score']}")
    print(f"å†…å®¹ç‰‡æ®µ: {result['snippet']}")
```

**æŸ¥è¯¢å¸‚åœºåˆ†æç›¸å…³ä»£ç **ï¼š

```python
# æŸ¥è¯¢å¸‚åœºåˆ†æç›¸å…³çš„ä»£ç å®ç°
results = client.call_tool(
    "kb.query",
    {
        "query": "å¸‚åœºçŠ¶æ€åˆ¤æ–­ è¶‹åŠ¿åˆ†æ æŠ€æœ¯æŒ‡æ ‡",
        "collection": "engineering_kb",
        "top_k": 10
    }
)

# å¤„ç†ç»“æœ
for result in results:
    print(f"æ–‡ä»¶: {result['file_path']}")
    print(f"å‡½æ•°: {result['function_name']}")
    print(f"ä»£ç ç‰‡æ®µ: {result['code_snippet']}")
```

#### è¿”å›ç»“æœ

```python
[
    {
        "title": "3.1 è¶‹åŠ¿åˆ†æ",
        "file_path": "/ashare-book6/003_Chapter3_Market_Analysis/3.1_Trend_Analysis_CN.md",
        "snippet": "è¶‹åŠ¿åˆ†ææ˜¯å¸‚åœºåˆ†ææ¨¡å—çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œè´Ÿè´£åˆ†æå¸‚åœºè¶‹åŠ¿...",
        "score": 0.95,
        "type": "document"
    },
    {
        "file_path": "core/market_analyzer.py",
        "function_name": "analyze_trend",
        "code_snippet": "def analyze_trend(data):\n    # è¶‹åŠ¿åˆ†æå®ç°...",
        "score": 0.88,
        "type": "code"
    },
    # ... æ›´å¤šç»“æœ
]
```

#### æŸ¥è¯¢æŠ€å·§

1. **ä½¿ç”¨å…·ä½“å…³é”®è¯**ï¼šä½¿ç”¨å…·ä½“çš„æœ¯è¯­å’Œæ¦‚å¿µï¼Œé¿å…è¿‡äºå®½æ³›çš„æŸ¥è¯¢
2. **ç»„åˆæŸ¥è¯¢**ï¼šä½¿ç”¨å¤šä¸ªå…³é”®è¯ç»„åˆæŸ¥è¯¢ï¼Œæé«˜æŸ¥è¯¢ç²¾åº¦
3. **æŒ‡å®šæŸ¥è¯¢èŒƒå›´**ï¼šæ ¹æ®éœ€æ±‚é€‰æ‹©manual_kbæˆ–engineering_kb
4. **è°ƒæ•´top_k**ï¼šæ ¹æ®éœ€æ±‚è°ƒæ•´è¿”å›ç»“æœæ•°é‡

#### åº”ç”¨åœºæ™¯

1. **å¼€å‘æ–‡æ¡£æŸ¥è¯¢**ï¼šæŸ¥è¯¢å¼€å‘æ‰‹å†Œä¸­çš„ç›¸å…³ç« èŠ‚
2. **ä»£ç å®ç°æŸ¥è¯¢**ï¼šæŸ¥è¯¢ä»£ç åº“ä¸­çš„ç›¸å…³å®ç°
3. **æœ€ä½³å®è·µæŸ¥è¯¢**ï¼šæŸ¥è¯¢å¼€å‘æœ€ä½³å®è·µå’Œè®¾è®¡æ¨¡å¼
4. **é—®é¢˜è§£å†³**ï¼šæŸ¥è¯¢é—®é¢˜è§£å†³æ–¹æ¡ˆå’Œæ•…éšœæ’é™¤æ–¹æ³•

<h2 id="section-3-4-3">ğŸ“¥ 3.4.3 Data Collectorå·¥å…·</h2>

Data Collector MCP Serveræä¾›æ•°æ®æ”¶é›†èƒ½åŠ›ï¼Œæ”¯æŒç½‘é¡µçˆ¬å–ã€PDFä¸‹è½½ã€å­¦æœ¯è®ºæ–‡æ”¶é›†ç­‰åŠŸèƒ½ã€‚

### data_collector.crawl_web

çˆ¬å–ç½‘é¡µå†…å®¹ï¼Œæ”¶é›†å¸‚åœºåˆ†æç›¸å…³çš„æ•°æ®å’Œç ”ç©¶èµ„æ–™ã€‚

#### å·¥å…·å®šä¹‰

```python
MCPTool(
    name="data_collector.crawl_web",
    description="çˆ¬å–ç½‘é¡µå†…å®¹ï¼Œæå–æ–‡æœ¬å’Œé“¾æ¥",
    input_schema={
        "type": "object",
        "properties": {
            "url": {
                "type": "string",
                "description": "ç›®æ ‡ç½‘é¡µURL"
            },
            "extract_text": {
                "type": "boolean",
                "description": "æ˜¯å¦æå–æ–‡æœ¬å†…å®¹ï¼Œé»˜è®¤true",
                "default": true
            },
            "max_depth": {
                "type": "integer",
                "description": "æœ€å¤§çˆ¬å–æ·±åº¦ï¼Œé»˜è®¤1",
                "default": 1
            },
            "output_dir": {
                "type": "string",
                "description": "è¾“å‡ºç›®å½•ï¼Œé»˜è®¤data/collected"
            }
        },
        "required": ["url"]
    }
)
```

#### å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| url | string | æ˜¯ | - | ç›®æ ‡ç½‘é¡µURL |
| extract_text | boolean | å¦ | true | æ˜¯å¦æå–æ–‡æœ¬å†…å®¹ |
| max_depth | integer | å¦ | 1 | æœ€å¤§çˆ¬å–æ·±åº¦ï¼ŒèŒƒå›´1-3 |
| output_dir | string | å¦ | "data/collected" | è¾“å‡ºç›®å½•è·¯å¾„ |

#### ä½¿ç”¨ç¤ºä¾‹

**çˆ¬å–å¸‚åœºåˆ†æç›¸å…³ç½‘é¡µ**ï¼š

```python
# çˆ¬å–å¸‚åœºåˆ†æç›¸å…³ç½‘é¡µ
result = client.call_tool(
    "data_collector.crawl_web",
    {
        "url": "https://example.com/market-analysis",
        "extract_text": True,
        "max_depth": 2,
        "output_dir": "data/collected/market_analysis"
    }
)

# å¤„ç†ç»“æœ
print(f"çˆ¬å–é¡µé¢æ•°: {result['pages_crawled']}")
print(f"æå–æ–‡æœ¬é•¿åº¦: {result['text_length']}")
print(f"ä¿å­˜è·¯å¾„: {result['output_path']}")
```

#### è¿”å›ç»“æœ

```python
{
    "pages_crawled": 5,
    "text_length": 50000,
    "output_path": "data/collected/market_analysis",
    "files": [
        "page_1.html",
        "page_2.html",
        "page_3.html"
    ],
    "timestamp": "2025-12-12T10:00:00"
}
```

#### åº”ç”¨åœºæ™¯

1. **ç ”ç©¶æŠ¥å‘Šæ”¶é›†**ï¼šæ”¶é›†å¸‚åœºåˆ†æç›¸å…³çš„ç ”ç©¶æŠ¥å‘Š
2. **è¡Œä¸šæ•°æ®æ”¶é›†**ï¼šæ”¶é›†è¡Œä¸šåˆ†æèµ„æ–™å’Œæ•°æ®
3. **æ”¿ç­–è§£è¯»æ”¶é›†**ï¼šæ”¶é›†æ”¿ç­–è§£è¯»æ–‡æ¡£å’Œåˆ†æ
4. **æ–°é—»èµ„è®¯æ”¶é›†**ï¼šæ”¶é›†å¸‚åœºç›¸å…³çš„æ–°é—»èµ„è®¯

<h2 id="section-3-4-4">ğŸ”„ 3.4.4 å·¥å…·é›†æˆå·¥ä½œæµ</h2>

MCPå·¥å…·åœ¨å¸‚åœºåˆ†æä¸­çš„å®Œæ•´å·¥ä½œæµå’Œæœ€ä½³å®è·µã€‚

### å®Œæ•´å·¥ä½œæµç¤ºä¾‹

**åœºæ™¯ï¼šåˆ†æå½“å‰å¸‚åœºå¹¶ç”ŸæˆæŠ•èµ„å»ºè®®**

```python
# 1. è·å–å¸‚åœºçŠ¶æ€
market_status = client.call_tool(
    "trquant_market_status",
    {"universe": "CN_EQ"}
)

# 2. æ ¹æ®å¸‚åœºçŠ¶æ€è·å–æŠ•èµ„ä¸»çº¿
time_horizon = "short" if market_status["regime"] == "risk_on" else "medium"
mainlines = client.call_tool(
    "trquant_mainlines",
    {
        "time_horizon": time_horizon,
        "top_n": 10
    }
)

# 3. æŸ¥è¯¢ç›¸å…³çŸ¥è¯†åº“
knowledge = client.call_tool(
    "kb.query",
    {
        "query": f"å¸‚åœºçŠ¶æ€{market_status['regime']} æŠ•èµ„ç­–ç•¥",
        "collection": "both",
        "top_k": 5
    }
)

# 4. æ”¶é›†å¤–éƒ¨èµ„æ–™ï¼ˆå¦‚éœ€è¦ï¼‰
if market_status["regime"] == "risk_off":
    external_data = client.call_tool(
        "data_collector.crawl_web",
        {
            "url": "https://example.com/risk-off-analysis",
            "extract_text": True
        }
    )

# 5. ç»¼åˆåˆ†æå¹¶ç”ŸæˆæŠ•èµ„å»ºè®®
investment_advice = generate_advice(
    market_status=market_status,
    mainlines=mainlines,
    knowledge=knowledge
)
```

### æœ€ä½³å®è·µ

1. **å·¥å…·è°ƒç”¨é¡ºåº**ï¼šå…ˆè·å–å¸‚åœºçŠ¶æ€ï¼Œå†æ ¹æ®çŠ¶æ€è·å–æŠ•èµ„ä¸»çº¿
2. **é”™è¯¯å¤„ç†**ï¼šå¯¹å·¥å…·è°ƒç”¨è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§
3. **ç»“æœç¼“å­˜**ï¼šå¯¹é¢‘ç¹è°ƒç”¨çš„å·¥å…·ç»“æœè¿›è¡Œç¼“å­˜ï¼Œæé«˜æ•ˆç‡
4. **ç»“æœéªŒè¯**ï¼šå¯¹å·¥å…·è¿”å›çš„ç»“æœè¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿æ•°æ®è´¨é‡

### å·¥å…·ç»„åˆä½¿ç”¨

**å¸‚åœºåˆ†æ + ä¸»çº¿è¯†åˆ«**ï¼š

```python
# è·å–å¸‚åœºçŠ¶æ€
market_status = client.call_tool("trquant_market_status", {"universe": "CN_EQ"})

# æ ¹æ®å¸‚åœºçŠ¶æ€é€‰æ‹©æŠ•èµ„å‘¨æœŸ
if market_status["regime"] == "risk_on":
    time_horizon = "short"  # çŸ­æœŸä¸»çº¿
elif market_status["regime"] == "risk_off":
    time_horizon = "long"   # é•¿æœŸä¸»çº¿
else:
    time_horizon = "medium" # ä¸­æœŸä¸»çº¿

# è·å–æŠ•èµ„ä¸»çº¿
mainlines = client.call_tool(
    "trquant_mainlines",
    {"time_horizon": time_horizon, "top_n": 10}
)
```

**çŸ¥è¯†åº“æŸ¥è¯¢ + æ•°æ®æ”¶é›†**ï¼š

```python
# æŸ¥è¯¢ç›¸å…³çŸ¥è¯†
knowledge = client.call_tool(
    "kb.query",
    {"query": "å¸‚åœºåˆ†æ æŠ€æœ¯æŒ‡æ ‡", "collection": "both"}
)

# å¦‚æœçŸ¥è¯†åº“ç»“æœä¸è¶³ï¼Œæ”¶é›†å¤–éƒ¨èµ„æ–™
if len(knowledge) < 3:
    external_data = client.call_tool(
        "data_collector.crawl_web",
        {"url": "https://example.com/market-analysis"}
    )
```

## ğŸ”— ç›¸å…³ç« èŠ‚

- **3.1 è¶‹åŠ¿åˆ†æ**ï¼šäº†è§£è¶‹åŠ¿åˆ†ææ–¹æ³•ï¼Œä¸ºMCPå·¥å…·ä½¿ç”¨æä¾›åŸºç¡€
- **3.2 å¸‚åœºçŠ¶æ€**ï¼šäº†è§£å¸‚åœºçŠ¶æ€åˆ¤æ–­ï¼Œç†è§£`trquant_market_status`å·¥å…·çš„è¾“å‡º
- **3.3 äº”ç»´è¯„åˆ†ç³»ç»Ÿ**ï¼šäº†è§£äº”ç»´è¯„åˆ†ç³»ç»Ÿï¼Œç†è§£å¸‚åœºåˆ†æçš„ç»¼åˆè¯„ä¼°
- **ç¬¬4ç« ï¼šæŠ•èµ„ä¸»çº¿è¯†åˆ«**ï¼šäº†è§£å¦‚ä½•ä½¿ç”¨`trquant_mainlines`å·¥å…·è·å–æŠ•èµ„ä¸»çº¿
- **ç¬¬10ç« ï¼šå¼€å‘æŒ‡å—**ï¼šäº†è§£MCPå·¥å…·çš„å¼€å‘å’Œä½¿ç”¨æ–¹æ³•

## ğŸ’¡ å…³é”®è¦ç‚¹

1. **TRQuant MCPå·¥å…·**ï¼šæä¾›å¸‚åœºçŠ¶æ€æŸ¥è¯¢å’ŒæŠ•èµ„ä¸»çº¿è·å–åŠŸèƒ½ï¼Œæ˜¯å¸‚åœºåˆ†æçš„æ ¸å¿ƒå·¥å…·
2. **KB MCPå·¥å…·**ï¼šæä¾›çŸ¥è¯†åº“æŸ¥è¯¢åŠŸèƒ½ï¼Œæ”¯æŒå¸‚åœºåˆ†æç›¸å…³ç ”ç©¶å’Œé—®é¢˜è§£å†³
3. **Data Collectorå·¥å…·**ï¼šæä¾›æ•°æ®æ”¶é›†åŠŸèƒ½ï¼Œæ”¯æŒå¤–éƒ¨èµ„æ–™è·å–å’Œç ”ç©¶
4. **å·¥å…·é›†æˆå·¥ä½œæµ**ï¼šé€šè¿‡å·¥å…·ç»„åˆä½¿ç”¨ï¼Œæ„å»ºå®Œæ•´çš„å¸‚åœºåˆ†æå·¥ä½œæµ

## ğŸ”® æ€»ç»“ä¸å±•æœ›

<div class="summary-outlook">
  <h3>æœ¬èŠ‚å›é¡¾</h3>
  <p>æœ¬èŠ‚ç³»ç»Ÿä»‹ç»äº†å¸‚åœºåˆ†ææ¨¡å—ä¸MCPå·¥å…·çš„æ·±åº¦é›†æˆï¼ŒåŒ…æ‹¬TRQuant MCPå·¥å…·ã€KB MCP Serverå·¥å…·å’ŒData Collectorå·¥å…·çš„ä½¿ç”¨æ–¹æ³•ã€å‚æ•°è¯´æ˜ã€è¿”å›ç»“æœå’Œåº”ç”¨åœºæ™¯ã€‚é€šè¿‡ç†è§£MCPå·¥å…·åœ¨å¸‚åœºåˆ†æä¸­çš„åº”ç”¨ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡å¦‚ä½•ä½¿ç”¨MCPå·¥å…·æå‡å¸‚åœºåˆ†ææ•ˆç‡ï¼Œå®ç°AIå¢å¼ºçš„å¸‚åœºåˆ†æèƒ½åŠ›ã€‚</p>
  
  <h3>ä¸‹èŠ‚é¢„å‘Š</h3>
  <p>æŒæ¡äº†å¸‚åœºåˆ†ææ¨¡å—åï¼Œä¸‹ä¸€ç« å°†ä»‹ç»æŠ•èµ„ä¸»çº¿è¯†åˆ«æ¨¡å—ï¼ŒåŒ…æ‹¬ä¸»çº¿è¯„åˆ†ã€ä¸»çº¿ç­›é€‰ã€ä¸»çº¿è¯†åˆ«å¼•æ“å’ŒMCPå·¥å…·é›†æˆã€‚é€šè¿‡ç†è§£æŠ•èµ„ä¸»çº¿è¯†åˆ«çš„æ ¸å¿ƒå®ç°ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡å¦‚ä½•ä¸ºé‡åŒ–æŠ•èµ„å†³ç­–æä¾›æ ¸å¿ƒæ–¹å‘ã€‚</p>
  
  <a href="/ashare-book6/004_Chapter4_Mainline_Identification/004_Chapter4_Mainline_Identification_CN" class="next-section">
    ç»§ç»­å­¦ä¹ ï¼šç¬¬4ç« ï¼šæŠ•èµ„ä¸»çº¿è¯†åˆ« â†’
  </a>
</div>

> **é€‚ç”¨ç‰ˆæœ¬**: v1.0.0+  
> **æœ€åæ›´æ–°**: 2025-12-12
