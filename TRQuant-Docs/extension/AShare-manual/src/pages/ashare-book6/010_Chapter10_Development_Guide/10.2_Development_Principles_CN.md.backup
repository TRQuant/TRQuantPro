---
title: "10.2 å¼€å‘åŸåˆ™"
description: "æ·±å…¥è§£æTRQuantç³»ç»Ÿå¼€å‘åŸåˆ™ï¼ŒåŒ…æ‹¬æ¨¡å—åŒ–è®¾è®¡ã€æ¥å£æŠ½è±¡ã€å·¥ä½œæµç¼–æ’ã€å¯è¿½æº¯æ€§ç­‰æ€»ä½“è®¾è®¡åŸåˆ™ï¼Œä¸ºç³»ç»Ÿå¼€å‘æä¾›æ ¸å¿ƒè®¾è®¡ç†å¿µæŒ‡å¯¼"
lang: "zh-CN"
layout: "/src/layouts/HandbookLayout.astro"
currentBook: "ashare-book6"
updateDate: "2025-12-12"
---

# ğŸ¯ 10.2 å¼€å‘åŸåˆ™

> **æ ¸å¿ƒæ‘˜è¦ï¼š**
> 
> æœ¬èŠ‚ç³»ç»Ÿä»‹ç»TRQuantç³»ç»Ÿçš„å¼€å‘åŸåˆ™ï¼ŒåŒ…æ‹¬æ¨¡å—åŒ–è®¾è®¡ã€æ¥å£æŠ½è±¡ã€å·¥ä½œæµç¼–æ’ã€å¯è¿½æº¯æ€§ç­‰æ€»ä½“è®¾è®¡åŸåˆ™ã€‚é€šè¿‡ç†è§£å¼€å‘åŸåˆ™çš„æ ¸å¿ƒå†…å®¹ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡ç³»ç»Ÿå¼€å‘çš„è®¾è®¡ç†å¿µï¼Œä¸ºæ„å»ºé«˜è´¨é‡çš„ç³»ç»Ÿå¥ å®šåŸºç¡€ã€‚

å¼€å‘åŸåˆ™æ˜¯ç³»ç»Ÿè®¾è®¡çš„æŒ‡å¯¼æ€æƒ³ï¼Œéµå¾ªè¿™äº›åŸåˆ™èƒ½å¤Ÿç¡®ä¿ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œå¯è¿½æº¯æ€§ã€‚

## ğŸ“‹ ç« èŠ‚æ¦‚è§ˆ

<script>
function scrollToSection(sectionId) {
  const element = document.getElementById(sectionId);
  if (element) {
    const headerOffset = 100;
    const elementPosition = element.getBoundingClientRect().top;
    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
    window.scrollTo({
      top: offsetPosition,
      behavior: 'smooth'
    });
  }
}
</script>

<div class="section-overview">
  <div class="section-item" onclick="scrollToSection('section-10-2-1')">
    <h4>ğŸ§© 10.2.1 æ¨¡å—åŒ–è®¾è®¡</h4>
    <p>å•ä¸€èŒè´£ã€ä½è€¦åˆé«˜å†…èšã€ç‹¬ç«‹æµ‹è¯•ã€æ¨¡å—åˆ’åˆ†</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-10-2-2')">
    <h4>ğŸ”Œ 10.2.2 æ¥å£æŠ½è±¡</h4>
    <p>ç»Ÿä¸€APIã€å¤šå®ç°æ”¯æŒã€æ˜“äºæ‰©å±•ã€æ¥å£è®¾è®¡</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-10-2-3')">
    <h4>ğŸ”„ 10.2.3 å·¥ä½œæµç¼–æ’</h4>
    <p>ç»Ÿä¸€æ¥å£ã€æ­¥éª¤çº§è°ƒç”¨ã€å®Œæ•´æ‰§è¡Œã€å·¥ä½œæµè®¾è®¡</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-10-2-4')">
    <h4>ğŸ“‹ 10.2.4 å¯è¿½æº¯æ€§</h4>
    <p>è¯æ®è®°å½•ã€ç‰ˆæœ¬ç®¡ç†ã€å¯å®¡è®¡ã€å¯å¤ç°</p>
  </div>
  <div class="section-item" onclick="scrollToSection('section-10-2-5')">
    <h4>ğŸ’¡ 10.2.5 æœ€ä½³å®è·µ</h4>
    <p>DRYåŸåˆ™ã€ä¾èµ–æ³¨å…¥ã€é”™è¯¯å¤„ç†ã€ç±»å‹å®‰å…¨</p>
  </div>
</div>

## ğŸ¯ å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬èŠ‚å­¦ä¹ ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š

- **ç†è§£æ¨¡å—åŒ–è®¾è®¡**ï¼šæŒæ¡å•ä¸€èŒè´£ã€ä½è€¦åˆé«˜å†…èšçš„è®¾è®¡åŸåˆ™
- **æŒæ¡æ¥å£æŠ½è±¡**ï¼šç†è§£ç»Ÿä¸€APIæ¥å£å’Œå¤šå®ç°æ”¯æŒçš„è®¾è®¡æ–¹æ³•
- **ç†Ÿæ‚‰å·¥ä½œæµç¼–æ’**ï¼šç†è§£ç»Ÿä¸€å·¥ä½œæµæ¥å£å’Œæ­¥éª¤çº§è°ƒç”¨çš„è®¾è®¡
- **å®ç°å¯è¿½æº¯æ€§**ï¼šæŒæ¡è¯æ®è®°å½•ã€ç‰ˆæœ¬ç®¡ç†å’Œå¯å®¡è®¡çš„è®¾è®¡
- **åº”ç”¨æœ€ä½³å®è·µ**ï¼šç†è§£DRYåŸåˆ™ã€ä¾èµ–æ³¨å…¥ç­‰å¼€å‘æœ€ä½³å®è·µ

## ğŸ“š æ ¸å¿ƒæ¦‚å¿µ

### è®¾è®¡åŸåˆ™æ¦‚è¿°

- **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€ï¼Œæ¨¡å—é—´ä½è€¦åˆé«˜å†…èš
- **æ¥å£æŠ½è±¡**ï¼šç»Ÿä¸€çš„APIæ¥å£ï¼Œæ”¯æŒå¤šç§å®ç°æ–¹å¼
- **å·¥ä½œæµç¼–æ’**ï¼šç»Ÿä¸€çš„å·¥ä½œæµæ¥å£ï¼Œæ”¯æŒæ­¥éª¤çº§è°ƒç”¨
- **å¯è¿½æº¯æ€§**ï¼šæ‰€æœ‰æ“ä½œè®°å½•è¯æ®ï¼Œç‰ˆæœ¬ç®¡ç†ï¼Œå¯å®¡è®¡å¯å¤ç°

### è®¾è®¡ç›®æ ‡

- **å¯ç»´æŠ¤æ€§**ï¼šä»£ç æ¸…æ™°ï¼Œæ˜“äºç†è§£å’Œä¿®æ”¹
- **å¯æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ–°åŠŸèƒ½å’Œæ¨¡å—
- **å¯æµ‹è¯•æ€§**ï¼šæ¨¡å—ç‹¬ç«‹ï¼Œæ˜“äºå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- **å¯è¿½æº¯æ€§**ï¼šæ‰€æœ‰æ“ä½œå¯å®¡è®¡ï¼Œç‰ˆæœ¬å¯ç®¡ç†

<h2 id="section-10-2-1">ğŸ§© 10.2.1 æ¨¡å—åŒ–è®¾è®¡</h2>

æ¨¡å—åŒ–è®¾è®¡æ˜¯ç³»ç»Ÿæ¶æ„çš„åŸºç¡€ï¼Œç¡®ä¿æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€ï¼Œæ¨¡å—é—´ä½è€¦åˆé«˜å†…èšã€‚

### å•ä¸€èŒè´£åŸåˆ™

æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„åŠŸèƒ½ï¼Œé¿å…èŒè´£æ··ä¹±ã€‚

```python
# âŒ ä¸å¥½çš„è®¾è®¡ï¼šèŒè´£æ··ä¹±
class DataManager:
    """æ•°æ®ç®¡ç†å™¨ - èŒè´£è¿‡å¤š"""
    def fetch_data(self): pass      # æ•°æ®è·å–
    def process_data(self): pass    # æ•°æ®å¤„ç†
    def save_data(self): pass       # æ•°æ®å­˜å‚¨
    def analyze_data(self): pass    # æ•°æ®åˆ†æ
    def visualize_data(self): pass  # æ•°æ®å¯è§†åŒ–

# âœ… å¥½çš„è®¾è®¡ï¼šèŒè´£å•ä¸€
class DataFetcher:
    """æ•°æ®è·å–å™¨ - åªè´Ÿè´£æ•°æ®è·å–"""
    def fetch_data(self): pass

class DataProcessor:
    """æ•°æ®å¤„ç†å™¨ - åªè´Ÿè´£æ•°æ®å¤„ç†"""
    def process_data(self): pass

class DataStorage:
    """æ•°æ®å­˜å‚¨å™¨ - åªè´Ÿè´£æ•°æ®å­˜å‚¨"""
    def save_data(self): pass
```

### æ¨¡å—åˆ’åˆ†åŸåˆ™

**è®¾è®¡åŸç†**ï¼š
- **æŒ‰ä¸šåŠ¡é¢†åŸŸåˆ’åˆ†**ï¼šæ¯ä¸ªæ¨¡å—å¯¹åº”ä¸€ä¸ªä¸šåŠ¡é¢†åŸŸï¼ˆæ•°æ®æºã€å¸‚åœºåˆ†æã€ä¸»çº¿è¯†åˆ«ç­‰ï¼‰
- **åŠŸèƒ½å†…èš**ï¼šç›¸å…³åŠŸèƒ½é›†ä¸­åœ¨åŒä¸€æ¨¡å—ï¼Œå‡å°‘è·¨æ¨¡å—è°ƒç”¨
- **æ¥å£æ¸…æ™°**ï¼šæ¨¡å—é—´é€šè¿‡æ˜ç¡®çš„æ¥å£é€šä¿¡ï¼Œéšè—å†…éƒ¨å®ç°

**ä¸ºä»€ä¹ˆè¿™æ ·åˆ’åˆ†**ï¼š
1. **ä¸šåŠ¡å¯¹é½**ï¼šæ¨¡å—åˆ’åˆ†ä¸ä¸šåŠ¡é¢†åŸŸå¯¹åº”ï¼Œä¾¿äºç†è§£å’Œç»´æŠ¤
2. **å›¢é˜Ÿåä½œ**ï¼šä¸åŒå¼€å‘è€…å¯ä»¥å¹¶è¡Œå¼€å‘ä¸åŒæ¨¡å—ï¼Œå‡å°‘å†²çª
3. **ç‹¬ç«‹æ¼”è¿›**ï¼šæ¨¡å—å¯ä»¥ç‹¬ç«‹æ¼”è¿›ï¼Œä¸å½±å“å…¶ä»–æ¨¡å—

**æ›¿ä»£æ–¹æ¡ˆå¯¹æ¯”**ï¼š
- **æ–¹æ¡ˆAï¼šæŒ‰æŠ€æœ¯å±‚æ¬¡åˆ’åˆ†**ï¼ˆå¦‚controllerã€serviceã€daoï¼‰
  - ä¼˜ç‚¹ï¼šæŠ€æœ¯ç»“æ„æ¸…æ™°
  - ç¼ºç‚¹ï¼šä¸šåŠ¡é€»è¾‘åˆ†æ•£ï¼Œéš¾ä»¥ç†è§£
- **æ–¹æ¡ˆBï¼šæŒ‰ä¸šåŠ¡é¢†åŸŸåˆ’åˆ†ï¼ˆå½“å‰æ–¹æ¡ˆï¼‰**
  - ä¼˜ç‚¹ï¼šä¸šåŠ¡é€»è¾‘é›†ä¸­ï¼Œæ˜“äºç†è§£
  - ç¼ºç‚¹ï¼šå¯èƒ½å­˜åœ¨æŠ€æœ¯ä»£ç é‡å¤

```python
# core/ æ¨¡å—åˆ’åˆ†ç¤ºä¾‹
core/
â”œâ”€â”€ data_source/          # æ•°æ®æºæ¨¡å—
â”‚   â”œâ”€â”€ jqdata_client.py  # JQDataå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ akshare_client.py # AKShareå®¢æˆ·ç«¯
â”‚   â””â”€â”€ data_source_manager.py  # æ•°æ®æºç®¡ç†å™¨
â”‚
â”œâ”€â”€ market_analysis/      # å¸‚åœºåˆ†ææ¨¡å—
â”‚   â”œâ”€â”€ trend_analyzer.py # è¶‹åŠ¿åˆ†æå™¨
â”‚   â””â”€â”€ market_status.py  # å¸‚åœºçŠ¶æ€åˆ¤æ–­
â”‚
â”œâ”€â”€ mainline/            # ä¸»çº¿è¯†åˆ«æ¨¡å—
â”‚   â”œâ”€â”€ mainline_scanner.py  # ä¸»çº¿æ‰«æå™¨
â”‚   â””â”€â”€ mainline_scorer.py   # ä¸»çº¿è¯„åˆ†å™¨
â”‚
â”œâ”€â”€ candidate_pool/      # å€™é€‰æ± æ¨¡å—
â”‚   â”œâ”€â”€ pool_builder.py  # å€™é€‰æ± æ„å»ºå™¨
â”‚   â””â”€â”€ stock_scorer.py  # è‚¡ç¥¨è¯„åˆ†å™¨
â”‚
â”œâ”€â”€ factor/              # å› å­æ¨¡å—
â”‚   â”œâ”€â”€ factor_calculator.py  # å› å­è®¡ç®—å™¨
â”‚   â””â”€â”€ factor_library.py     # å› å­åº“
â”‚
â”œâ”€â”€ strategy/            # ç­–ç•¥æ¨¡å—
â”‚   â”œâ”€â”€ strategy_generator.py  # ç­–ç•¥ç”Ÿæˆå™¨
â”‚   â””â”€â”€ strategy_optimizer.py  # ç­–ç•¥ä¼˜åŒ–å™¨
â”‚
â””â”€â”€ backtest/            # å›æµ‹æ¨¡å—
    â”œâ”€â”€ bullettrade_engine.py  # BulletTradeå¼•æ“
    â””â”€â”€ backtest_analyzer.py   # å›æµ‹åˆ†æå™¨
```

### ä½è€¦åˆé«˜å†…èš

**è®¾è®¡åŸç†**ï¼š
- **ä½è€¦åˆ**ï¼šæ¨¡å—é—´é€šè¿‡æ¥å£é€šä¿¡ï¼Œå‡å°‘ç›´æ¥ä¾èµ–
- **é«˜å†…èš**ï¼šç›¸å…³åŠŸèƒ½é›†ä¸­åœ¨åŒä¸€æ¨¡å—ï¼Œæé«˜æ¨¡å—å†…èšåº¦
- **ä¾èµ–å€’ç½®**ï¼šé«˜å±‚æ¨¡å—ä¾èµ–æŠ½è±¡æ¥å£ï¼Œä¸ä¾èµ–å…·ä½“å®ç°

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡**ï¼š
1. **å¯ç»´æŠ¤æ€§**ï¼šä¿®æ”¹ä¸€ä¸ªæ¨¡å—ä¸å½±å“å…¶ä»–æ¨¡å—
2. **å¯æµ‹è¯•æ€§**ï¼šæ¨¡å—å¯ä»¥ç‹¬ç«‹æµ‹è¯•ï¼Œä¾¿äºå•å…ƒæµ‹è¯•
3. **å¯æ‰©å±•æ€§**ï¼šæ·»åŠ æ–°åŠŸèƒ½åªéœ€å®ç°æ¥å£ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 

**å®ç°æ–¹å¼**ï¼š
- ä½¿ç”¨æŠ½è±¡åŸºç±»ï¼ˆABCï¼‰å®šä¹‰æ¥å£
- ä½¿ç”¨ä¾èµ–æ³¨å…¥ä¼ é€’ä¾èµ–
- ä½¿ç”¨æ¥å£éš”ç¦»åŸåˆ™ï¼Œé¿å…æ¥å£è‡ƒè‚¿

```python
# âœ… ä½è€¦åˆï¼šæ¨¡å—é—´é€šè¿‡æ¥å£é€šä¿¡
# è®¾è®¡åŸç†ï¼šDataSourceManagerä¸ä¾èµ–å…·ä½“æ•°æ®æºå®ç°ï¼Œåªä¾èµ–DataSourceæ¥å£
# åŸå› ï¼šæ”¯æŒåŠ¨æ€æ·»åŠ /ç§»é™¤æ•°æ®æºï¼Œæ— éœ€ä¿®æ”¹DataSourceManagerä»£ç 
class DataSourceManager:
    """æ•°æ®æºç®¡ç†å™¨ - é€šè¿‡æ¥å£ä¸æ•°æ®æºäº¤äº’"""
    def __init__(self, data_sources: List[DataSource]):
        # è®¾è®¡è€ƒè™‘ï¼šä½¿ç”¨æ¥å£åˆ—è¡¨ï¼Œæ”¯æŒå¤šç§æ•°æ®æºå®ç°
        self.data_sources = data_sources
    
    def get_data(self, symbol: str, source: str = None):
        """
        è·å–æ•°æ® - ä¸å…³å¿ƒå…·ä½“å®ç°
        
        è®¾è®¡åŸç†ï¼šé€šè¿‡æ¥å£è°ƒç”¨ï¼Œéšè—å®ç°ç»†èŠ‚
        åŸå› ï¼šæ•°æ®æºå®ç°å¯èƒ½å˜åŒ–ï¼ˆå¦‚APIå˜æ›´ï¼‰ï¼Œä½†æ¥å£ä¿æŒç¨³å®š
        """
        for ds in self.data_sources:
            if source is None or ds.name == source:
                return ds.fetch(symbol)  # è°ƒç”¨æ¥å£æ–¹æ³•ï¼Œä¸å…³å¿ƒå®ç°
        raise ValueError(f"æ•°æ®æº {source} ä¸å­˜åœ¨")

# âœ… é«˜å†…èšï¼šç›¸å…³åŠŸèƒ½é›†ä¸­åœ¨åŒä¸€æ¨¡å—
# è®¾è®¡åŸç†ï¼šæ‰€æœ‰è¶‹åŠ¿åˆ†æç›¸å…³åŠŸèƒ½é›†ä¸­åœ¨TrendAnalyzerç±»ä¸­
# åŸå› ï¼šè¿™äº›åŠŸèƒ½å¯†åˆ‡ç›¸å…³ï¼Œæ”¾åœ¨ä¸€èµ·ä¾¿äºç†è§£å’Œç»´æŠ¤
class TrendAnalyzer:
    """è¶‹åŠ¿åˆ†æå™¨ - æ‰€æœ‰è¶‹åŠ¿åˆ†æåŠŸèƒ½é›†ä¸­"""
    def analyze_trend(self, data: pd.DataFrame): 
        """åˆ†æè¶‹åŠ¿ - æ ¸å¿ƒåŠŸèƒ½"""
        pass
    
    def calculate_indicators(self, data: pd.DataFrame): 
        """è®¡ç®—æŒ‡æ ‡ - è¾…åŠ©åŠŸèƒ½ï¼Œä¸ºanalyze_trendæœåŠ¡"""
        pass
    
    def judge_market_status(self, indicators: Dict): 
        """åˆ¤æ–­å¸‚åœºçŠ¶æ€ - è¾…åŠ©åŠŸèƒ½ï¼Œä½¿ç”¨indicatorsç»“æœ"""
        pass
    
    def generate_report(self, analysis_result: Dict): 
        """ç”ŸæˆæŠ¥å‘Š - è¾…åŠ©åŠŸèƒ½ï¼Œä½¿ç”¨analysis_result"""
        pass
```

### ç‹¬ç«‹æµ‹è¯•

```python
# æ¨¡å—ç‹¬ç«‹ï¼Œæ˜“äºæµ‹è¯•
# tests/test_trend_analyzer.py
import pytest
from core.market_analysis.trend_analyzer import TrendAnalyzer

def test_trend_analyzer():
    """æµ‹è¯•è¶‹åŠ¿åˆ†æå™¨"""
    analyzer = TrendAnalyzer()
    
    # å‡†å¤‡æµ‹è¯•æ•°æ®
    test_data = create_test_data()
    
    # æ‰§è¡Œæµ‹è¯•
    result = analyzer.analyze_trend(test_data)
    
    # éªŒè¯ç»“æœ
    assert result is not None
    assert 'trend' in result
    assert 'status' in result
```

<h2 id="section-10-2-2">ğŸ”Œ 10.2.2 æ¥å£æŠ½è±¡</h2>

æ¥å£æŠ½è±¡ç¡®ä¿ç»Ÿä¸€çš„APIæ¥å£ï¼Œæ”¯æŒå¤šç§å®ç°æ–¹å¼ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤ã€‚

### ç»Ÿä¸€æ¥å£è®¾è®¡

```python
# core/interfaces/data_source.py
from abc import ABC, abstractmethod
from typing import Dict, List, Optional
import pandas as pd

class DataSource(ABC):
    """æ•°æ®æºæ¥å£ - ç»Ÿä¸€çš„æ•°æ®æºæŠ½è±¡"""
    
    @property
    @abstractmethod
    def name(self) -> str:
        """æ•°æ®æºåç§°"""
        pass
    
    @abstractmethod
    def fetch_ohlcv(
        self,
        symbol: str,
        start_date: str,
        end_date: str
    ) -> pd.DataFrame:
        """è·å–OHLCVæ•°æ®"""
        pass
    
    @abstractmethod
    def fetch_financial_data(
        self,
        symbol: str,
        report_date: str
    ) -> Dict:
        """è·å–è´¢åŠ¡æ•°æ®"""
        pass
    
    @abstractmethod
    def is_available(self) -> bool:
        """æ£€æŸ¥æ•°æ®æºæ˜¯å¦å¯ç”¨"""
        pass

# å…·ä½“å®ç°
class JQDataClient(DataSource):
    """JQDataå®¢æˆ·ç«¯å®ç°"""
    
    @property
    def name(self) -> str:
        return "jqdata"
    
    def fetch_ohlcv(self, symbol: str, start_date: str, end_date: str) -> pd.DataFrame:
        """å®ç°JQDataçš„OHLCVæ•°æ®è·å–"""
        import jqdata
        return jqdata.get_price(symbol, start_date, end_date)
    
    def fetch_financial_data(self, symbol: str, report_date: str) -> Dict:
        """å®ç°JQDataçš„è´¢åŠ¡æ•°æ®è·å–"""
        import jqdata
        return jqdata.get_fundamentals(symbol, report_date)
    
    def is_available(self) -> bool:
        """æ£€æŸ¥JQDataæ˜¯å¦å¯ç”¨"""
        try:
            import jqdata
            return jqdata.is_connected()
        except:
            return False

class AKShareClient(DataSource):
    """AKShareå®¢æˆ·ç«¯å®ç°"""
    
    @property
    def name(self) -> str:
        return "akshare"
    
    def fetch_ohlcv(self, symbol: str, start_date: str, end_date: str) -> pd.DataFrame:
        """å®ç°AKShareçš„OHLCVæ•°æ®è·å–"""
        import akshare as ak
        return ak.stock_zh_a_hist(symbol, start_date, end_date)
    
    # ... å…¶ä»–æ–¹æ³•å®ç°
```

### å¤šå®ç°æ”¯æŒ

```python
# core/data_source/data_source_manager.py
class DataSourceManager:
    """æ•°æ®æºç®¡ç†å™¨ - æ”¯æŒå¤šç§æ•°æ®æºå®ç°"""
    
    def __init__(self):
        self.sources: Dict[str, DataSource] = {}
        self._register_default_sources()
    
    def _register_default_sources(self):
        """æ³¨å†Œé»˜è®¤æ•°æ®æº"""
        # æ³¨å†ŒJQData
        try:
            jqdata = JQDataClient()
            if jqdata.is_available():
                self.register_source(jqdata)
        except:
            pass
        
        # æ³¨å†ŒAKShare
        try:
            akshare = AKShareClient()
            if akshare.is_available():
                self.register_source(akshare)
        except:
            pass
    
    def register_source(self, source: DataSource):
        """æ³¨å†Œæ•°æ®æº"""
        self.sources[source.name] = source
    
    def get_data(
        self,
        symbol: str,
        source_name: str = None,
        **kwargs
    ) -> pd.DataFrame:
        """è·å–æ•°æ® - è‡ªåŠ¨é€‰æ‹©æˆ–æŒ‡å®šæ•°æ®æº"""
        if source_name:
            source = self.sources.get(source_name)
            if not source:
                raise ValueError(f"æ•°æ®æº {source_name} ä¸å­˜åœ¨")
            return source.fetch_ohlcv(symbol, **kwargs)
        
        # è‡ªåŠ¨é€‰æ‹©å¯ç”¨æ•°æ®æº
        for source in self.sources.values():
            if source.is_available():
                try:
                    return source.fetch_ohlcv(symbol, **kwargs)
                except:
                    continue
        
        raise RuntimeError("æ²¡æœ‰å¯ç”¨çš„æ•°æ®æº")
```

### æ˜“äºæ‰©å±•

```python
# æ·»åŠ æ–°çš„æ•°æ®æºå®ç°
class WindClient(DataSource):
    """Windå®¢æˆ·ç«¯å®ç° - æ–°å¢æ•°æ®æº"""
    
    @property
    def name(self) -> str:
        return "wind"
    
    def fetch_ohlcv(self, symbol: str, start_date: str, end_date: str) -> pd.DataFrame:
        """å®ç°Windçš„OHLCVæ•°æ®è·å–"""
        import WindPy as w
        w.start()
        data = w.wsd(symbol, "open,high,low,close,volume", start_date, end_date)
        return convert_to_dataframe(data)
    
    # ... å…¶ä»–æ–¹æ³•å®ç°

# ä½¿ç”¨æ–°æ•°æ®æº
manager = DataSourceManager()
manager.register_source(WindClient())
```

<h2 id="section-10-2-3">ğŸ”„ 10.2.3 å·¥ä½œæµç¼–æ’</h2>

å·¥ä½œæµç¼–æ’æä¾›ç»Ÿä¸€çš„å·¥ä½œæµæ¥å£ï¼Œæ”¯æŒæ­¥éª¤çº§è°ƒç”¨å’Œå®Œæ•´å·¥ä½œæµæ‰§è¡Œã€‚

### ç»Ÿä¸€å·¥ä½œæµæ¥å£

```python
# core/workflow/workflow_interface.py
from abc import ABC, abstractmethod
from typing import Dict, Any, Optional
from dataclasses import dataclass

@dataclass
class WorkflowResult:
    """å·¥ä½œæµç»“æœ"""
    step_name: str
    success: bool
    data: Dict[str, Any]
    error: Optional[str] = None

class WorkflowStep(ABC):
    """å·¥ä½œæµæ­¥éª¤æ¥å£"""
    
    @property
    @abstractmethod
    def step_name(self) -> str:
        """æ­¥éª¤åç§°"""
        pass
    
    @property
    @abstractmethod
    def step_number(self) -> int:
        """æ­¥éª¤åºå·"""
        pass
    
    @abstractmethod
    def execute(
        self,
        context: Dict[str, Any]
    ) -> WorkflowResult:
        """æ‰§è¡Œæ­¥éª¤"""
        pass
    
    @abstractmethod
    def get_dependencies(self) -> List[str]:
        """è·å–ä¾èµ–çš„æ­¥éª¤åç§°"""
        pass

# å…·ä½“æ­¥éª¤å®ç°
class DataSourceStep(WorkflowStep):
    """æ•°æ®æºæ­¥éª¤"""
    
    @property
    def step_name(self) -> str:
        return "data_source"
    
    @property
    def step_number(self) -> int:
        return 1
    
    def get_dependencies(self) -> List[str]:
        return []
    
    def execute(self, context: Dict[str, Any]) -> WorkflowResult:
        """æ‰§è¡Œæ•°æ®æºæ£€æµ‹"""
        from core.data_source.data_source_manager import DataSourceManager
        
        manager = DataSourceManager()
        sources = manager.get_available_sources()
        
        return WorkflowResult(
            step_name=self.step_name,
            success=len(sources) > 0,
            data={'sources': sources}
        )
```

### å·¥ä½œæµç¼–æ’å™¨

```python
# core/workflow/workflow_orchestrator.py
class WorkflowOrchestrator:
    """å·¥ä½œæµç¼–æ’å™¨ - ç»Ÿä¸€ç¼–æ’å·¥ä½œæµ"""
    
    def __init__(self):
        self.steps: Dict[str, WorkflowStep] = {}
        self._register_steps()
    
    def _register_steps(self):
        """æ³¨å†Œå·¥ä½œæµæ­¥éª¤"""
        self.steps['data_source'] = DataSourceStep()
        self.steps['market_analysis'] = MarketAnalysisStep()
        self.steps['mainline'] = MainlineStep()
        # ... å…¶ä»–æ­¥éª¤
    
    def execute_step(
        self,
        step_name: str,
        context: Dict[str, Any] = None
    ) -> WorkflowResult:
        """æ‰§è¡Œå•ä¸ªæ­¥éª¤"""
        if step_name not in self.steps:
            raise ValueError(f"æ­¥éª¤ {step_name} ä¸å­˜åœ¨")
        
        step = self.steps[step_name]
        
        # æ£€æŸ¥ä¾èµ–
        dependencies = step.get_dependencies()
        for dep in dependencies:
            if dep not in context.get('completed_steps', []):
                raise ValueError(f"æ­¥éª¤ {step_name} çš„ä¾èµ– {dep} æœªå®Œæˆ")
        
        # æ‰§è¡Œæ­¥éª¤
        if context is None:
            context = {}
        
        return step.execute(context)
    
    def execute_full_workflow(
        self,
        context: Dict[str, Any] = None
    ) -> Dict[str, WorkflowResult]:
        """æ‰§è¡Œå®Œæ•´å·¥ä½œæµ"""
        if context is None:
            context = {}
        
        context['completed_steps'] = []
        results = {}
        
        # æŒ‰æ­¥éª¤åºå·æ’åº
        sorted_steps = sorted(
            self.steps.values(),
            key=lambda s: s.step_number
        )
        
        for step in sorted_steps:
            try:
                result = self.execute_step(step.step_name, context)
                results[step.step_name] = result
                
                if result.success:
                    context['completed_steps'].append(step.step_name)
                    context[step.step_name] = result.data
                else:
                    # æ­¥éª¤å¤±è´¥ï¼Œå¯ä»¥é€‰æ‹©ç»§ç»­æˆ–åœæ­¢
                    logger.warning(f"æ­¥éª¤ {step.step_name} æ‰§è¡Œå¤±è´¥: {result.error}")
            except Exception as e:
                logger.error(f"æ­¥éª¤ {step.step_name} æ‰§è¡Œå¼‚å¸¸: {e}")
                results[step.step_name] = WorkflowResult(
                    step_name=step.step_name,
                    success=False,
                    data={},
                    error=str(e)
                )
        
        return results
```

<h2 id="section-10-2-4">ğŸ“‹ 10.2.4 å¯è¿½æº¯æ€§</h2>

å¯è¿½æº¯æ€§ç¡®ä¿æ‰€æœ‰æ“ä½œè®°å½•è¯æ®ï¼Œç‰ˆæœ¬ç®¡ç†ï¼Œå¯å®¡è®¡å¯å¤ç°ã€‚

### è¯æ®è®°å½•

```python
# core/audit/evidence_recorder.py
from typing import Dict, Any, Optional
from datetime import datetime
import json

class EvidenceRecorder:
    """è¯æ®è®°å½•å™¨ - è®°å½•æ‰€æœ‰æ“ä½œè¯æ®"""
    
    def __init__(self, db_connection=None):
        self.db = db_connection
    
    def record_operation(
        self,
        operation: str,
        operator: str,
        params: Dict[str, Any],
        result: Dict[str, Any],
        reason: Optional[str] = None
    ):
        """è®°å½•æ“ä½œè¯æ®"""
        evidence = {
            'operation': operation,
            'operator': operator,
            'timestamp': datetime.now().isoformat(),
            'params': params,
            'result': result,
            'reason': reason
        }
        
        if self.db:
            self.db.execute(
                """
                INSERT INTO audit_log 
                (operation, operator, timestamp, params, result, reason)
                VALUES (%s, %s, %s, %s, %s, %s)
                """,
                (
                    operation,
                    operator,
                    evidence['timestamp'],
                    json.dumps(params),
                    json.dumps(result),
                    reason
                )
            )
        
        logger.info(f"è®°å½•æ“ä½œè¯æ®: {operation} by {operator}")
```

### ç‰ˆæœ¬ç®¡ç†

```python
# core/version/version_manager.py
from typing import Dict, Any, Optional
from datetime import datetime
import git

class VersionManager:
    """ç‰ˆæœ¬ç®¡ç†å™¨ - ç®¡ç†ä»£ç å’Œé…ç½®ç‰ˆæœ¬"""
    
    def __init__(self, repo_path: str = None):
        if repo_path:
            self.repo = git.Repo(repo_path)
        else:
            self.repo = None
    
    def create_version_tag(
        self,
        version: str,
        message: str
    ) -> str:
        """åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾"""
        if not self.repo:
            return None
        
        tag = self.repo.create_tag(
            version,
            message=message
        )
        
        logger.info(f"åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾: {version}")
        return tag.name
    
    def get_current_version(self) -> str:
        """è·å–å½“å‰ç‰ˆæœ¬"""
        if not self.repo:
            return "unknown"
        
        try:
            return self.repo.git.describe(tags=True)
        except:
            return "dev"
    
    def record_strategy_version(
        self,
        strategy_id: str,
        version: str,
        changes: Dict[str, Any]
    ):
        """è®°å½•ç­–ç•¥ç‰ˆæœ¬"""
        # è®°å½•åˆ°æ•°æ®åº“
        # ...
        pass
```

<h2 id="section-10-2-5">ğŸ’¡ 10.2.5 æœ€ä½³å®è·µ</h2>

æœ€ä½³å®è·µåŒ…æ‹¬DRYåŸåˆ™ã€ä¾èµ–æ³¨å…¥ã€é”™è¯¯å¤„ç†ã€ç±»å‹å®‰å…¨ç­‰ã€‚

### DRYåŸåˆ™

```python
# âŒ ä¸å¥½çš„è®¾è®¡ï¼šé‡å¤ä»£ç 
def calculate_sharpe_ratio_1(returns):
    mean = returns.mean()
    std = returns.std()
    return mean / std if std > 0 else 0

def calculate_sharpe_ratio_2(returns):
    mean = returns.mean()
    std = returns.std()
    return mean / std if std > 0 else 0

# âœ… å¥½çš„è®¾è®¡ï¼šæå–å…¬å…±é€»è¾‘
def calculate_sharpe_ratio(returns: pd.Series) -> float:
    """è®¡ç®—å¤æ™®æ¯”ç‡ - ç»Ÿä¸€å®ç°"""
    mean = returns.mean()
    std = returns.std()
    return mean / std if std > 0 else 0
```

### ä¾èµ–æ³¨å…¥

```python
# âœ… ä¾èµ–æ³¨å…¥ï¼šä¾¿äºæµ‹è¯•å’Œæ›¿æ¢
class StrategyGenerator:
    """ç­–ç•¥ç”Ÿæˆå™¨ - é€šè¿‡ä¾èµ–æ³¨å…¥è·å–æœåŠ¡"""
    
    def __init__(
        self,
        factor_library=None,
        candidate_pool=None,
        backtest_engine=None
    ):
        self.factor_library = factor_library
        self.candidate_pool = candidate_pool
        self.backtest_engine = backtest_engine
    
    def generate_strategy(self, config: Dict):
        """ç”Ÿæˆç­–ç•¥"""
        # ä½¿ç”¨æ³¨å…¥çš„æœåŠ¡
        factors = self.factor_library.get_factors(config['factors'])
        candidates = self.candidate_pool.get_candidates(config['pool'])
        # ...
```

### ç»Ÿä¸€é”™è¯¯å¤„ç†

```python
# core/utils/error_handler.py
class TRQuantError(Exception):
    """TRQuantåŸºç¡€å¼‚å¸¸"""
    pass

class DataSourceError(TRQuantError):
    """æ•°æ®æºé”™è¯¯"""
    pass

class StrategyError(TRQuantError):
    """ç­–ç•¥é”™è¯¯"""
    pass

def handle_error(func):
    """ç»Ÿä¸€é”™è¯¯å¤„ç†è£…é¥°å™¨"""
    def wrapper(*args, **kwargs):
        try:
            return func(*args, **kwargs)
        except TRQuantError as e:
            logger.error(f"TRQuanté”™è¯¯: {e}")
            raise
        except Exception as e:
            logger.error(f"æœªçŸ¥é”™è¯¯: {e}", exc_info=True)
            raise TRQuantError(f"æœªçŸ¥é”™è¯¯: {e}") from e
    return wrapper
```

### ç±»å‹å®‰å…¨

```python
# âœ… ä½¿ç”¨ç±»å‹æç¤º
from typing import Dict, List, Optional
import pandas as pd

def calculate_returns(
    prices: pd.Series,
    method: str = "simple"
) -> pd.Series:
    """è®¡ç®—æ”¶ç›Šç‡ - ç±»å‹å®‰å…¨"""
    if method == "simple":
        return prices.pct_change()
    elif method == "log":
        return pd.Series(np.log(prices / prices.shift(1)))
    else:
        raise ValueError(f"æœªçŸ¥æ–¹æ³•: {method}")
```

## ğŸ”— ç›¸å…³ç« èŠ‚

- **1.2 ç³»ç»Ÿæ¶æ„**ï¼šäº†è§£ç³»ç»Ÿæ•´ä½“æ¶æ„è®¾è®¡
- **10.3 å¼€å‘å·¥ä½œæµ**ï¼šäº†è§£å¼€å‘æµç¨‹å’Œè§„èŒƒ
- **10.11 å¼€å‘æµç¨‹æ–¹æ³•è®º**ï¼šäº†è§£å¼€å‘æ–¹æ³•è®º

## ğŸ’¡ å…³é”®è¦ç‚¹

1. **æ¨¡å—åŒ–è®¾è®¡**ï¼šå•ä¸€èŒè´£ï¼Œä½è€¦åˆé«˜å†…èš
2. **æ¥å£æŠ½è±¡**ï¼šç»Ÿä¸€æ¥å£ï¼Œå¤šå®ç°æ”¯æŒ
3. **å·¥ä½œæµç¼–æ’**ï¼šç»Ÿä¸€æ¥å£ï¼Œæ­¥éª¤çº§è°ƒç”¨
4. **å¯è¿½æº¯æ€§**ï¼šè¯æ®è®°å½•ï¼Œç‰ˆæœ¬ç®¡ç†
5. **æœ€ä½³å®è·µ**ï¼šDRYã€ä¾èµ–æ³¨å…¥ã€é”™è¯¯å¤„ç†ã€ç±»å‹å®‰å…¨

## ğŸ”® æ€»ç»“ä¸å±•æœ›

<div class="summary-outlook">
  <h3>æœ¬èŠ‚å›é¡¾</h3>
  <p>æœ¬èŠ‚ç³»ç»Ÿä»‹ç»äº†å¼€å‘åŸåˆ™ï¼ŒåŒ…æ‹¬æ¨¡å—åŒ–è®¾è®¡ã€æ¥å£æŠ½è±¡ã€å·¥ä½œæµç¼–æ’ã€å¯è¿½æº¯æ€§å’Œæœ€ä½³å®è·µã€‚é€šè¿‡ç†è§£å¼€å‘åŸåˆ™çš„æ ¸å¿ƒå†…å®¹ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡ç³»ç»Ÿå¼€å‘çš„è®¾è®¡ç†å¿µï¼Œä¸ºæ„å»ºé«˜è´¨é‡çš„ç³»ç»Ÿå¥ å®šåŸºç¡€ã€‚</p>
  
  <h3>ä¸‹èŠ‚é¢„å‘Š</h3>
  <p>æŒæ¡äº†å¼€å‘åŸåˆ™åï¼Œä¸‹ä¸€èŠ‚å°†ä»‹ç»å¼€å‘å·¥ä½œæµï¼ŒåŒ…æ‹¬éœ€æ±‚åˆ†æã€æ¶æ„è®¾è®¡ã€æ¥å£å®šä¹‰ã€å®ç°å¼€å‘ã€æµ‹è¯•éªŒè¯å’Œæ–‡æ¡£æ›´æ–°ç­‰å¼€å‘æµç¨‹ã€‚é€šè¿‡ç†è§£å¼€å‘å·¥ä½œæµï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡ç³»ç»Ÿå¼€å‘çš„å…·ä½“æµç¨‹ã€‚</p>
  
  <a href="/ashare-book6/010_Chapter10_Development_Guide/10.3_Development_Workflow_CN" class="next-section">
    ç»§ç»­å­¦ä¹ ï¼š10.3 å¼€å‘å·¥ä½œæµ â†’
  </a>
</div>

> **é€‚ç”¨ç‰ˆæœ¬**: v1.0.0+  
> **æœ€åæ›´æ–°**: 2025-12-12
